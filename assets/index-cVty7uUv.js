(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function hx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nd={exports:{}},So={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m0;function ES(){if(m0)return So;m0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,a){var l=null;if(a!==void 0&&(l=""+a),s.key!==void 0&&(l=""+s.key),"key"in s){a={};for(var u in s)u!=="key"&&(a[u]=s[u])}else a=s;return s=a.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:a}}return So.Fragment=e,So.jsx=t,So.jsxs=t,So}var _0;function RS(){return _0||(_0=1,nd.exports=ES()),nd.exports}var ne=RS(),id={exports:{}},wo={},sd={exports:{}},rd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y0;function CS(){return y0||(y0=1,(function(n){function e(S,I){var N=S.length;S.push(I);e:for(;0<N;){var G=N-1>>>1,w=S[G];if(0<s(w,I))S[G]=I,S[N]=w,N=G;else break e}}function t(S){return S.length===0?null:S[0]}function i(S){if(S.length===0)return null;var I=S[0],N=S.pop();if(N!==I){S[0]=N;e:for(var G=0,w=S.length,k=w>>>1;G<k;){var W=2*(G+1)-1,Q=S[W],ae=W+1,ue=S[ae];if(0>s(Q,N))ae<w&&0>s(ue,Q)?(S[G]=ue,S[ae]=N,G=ae):(S[G]=Q,S[W]=N,G=W);else if(ae<w&&0>s(ue,N))S[G]=ue,S[ae]=N,G=ae;else break e}}return I}function s(S,I){var N=S.sortIndex-I.sortIndex;return N!==0?N:S.id-I.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();n.unstable_now=function(){return l.now()-u}}var h=[],d=[],p=1,_=null,y=3,v=!1,T=!1,E=!1,R=!1,P=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function L(S){for(var I=t(d);I!==null;){if(I.callback===null)i(d);else if(I.startTime<=S)i(d),I.sortIndex=I.expirationTime,e(h,I);else break;I=t(d)}}function H(S){if(E=!1,L(S),!T)if(t(h)!==null)T=!0,J||(J=!0,De());else{var I=t(d);I!==null&&Fe(H,I.startTime-S)}}var J=!1,fe=-1,de=5,le=-1;function _e(){return R?!0:!(n.unstable_now()-le<de)}function Se(){if(R=!1,J){var S=n.unstable_now();le=S;var I=!0;try{e:{T=!1,E&&(E=!1,D(fe),fe=-1),v=!0;var N=y;try{t:{for(L(S),_=t(h);_!==null&&!(_.expirationTime>S&&_e());){var G=_.callback;if(typeof G=="function"){_.callback=null,y=_.priorityLevel;var w=G(_.expirationTime<=S);if(S=n.unstable_now(),typeof w=="function"){_.callback=w,L(S),I=!0;break t}_===t(h)&&i(h),L(S)}else i(h);_=t(h)}if(_!==null)I=!0;else{var k=t(d);k!==null&&Fe(H,k.startTime-S),I=!1}}break e}finally{_=null,y=N,v=!1}I=void 0}}finally{I?De():J=!1}}}var De;if(typeof M=="function")De=function(){M(Se)};else if(typeof MessageChannel<"u"){var Ee=new MessageChannel,xe=Ee.port2;Ee.port1.onmessage=Se,De=function(){xe.postMessage(null)}}else De=function(){P(Se,0)};function Fe(S,I){fe=P(function(){S(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(S){S.callback=null},n.unstable_forceFrameRate=function(S){0>S||125<S?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<S?Math.floor(1e3/S):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(S){switch(y){case 1:case 2:case 3:var I=3;break;default:I=y}var N=y;y=I;try{return S()}finally{y=N}},n.unstable_requestPaint=function(){R=!0},n.unstable_runWithPriority=function(S,I){switch(S){case 1:case 2:case 3:case 4:case 5:break;default:S=3}var N=y;y=S;try{return I()}finally{y=N}},n.unstable_scheduleCallback=function(S,I,N){var G=n.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?G+N:G):N=G,S){case 1:var w=-1;break;case 2:w=250;break;case 5:w=1073741823;break;case 4:w=1e4;break;default:w=5e3}return w=N+w,S={id:p++,callback:I,priorityLevel:S,startTime:N,expirationTime:w,sortIndex:-1},N>G?(S.sortIndex=N,e(d,S),t(h)===null&&S===t(d)&&(E?(D(fe),fe=-1):E=!0,Fe(H,N-G))):(S.sortIndex=w,e(h,S),T||v||(T=!0,J||(J=!0,De()))),S},n.unstable_shouldYield=_e,n.unstable_wrapCallback=function(S){var I=y;return function(){var N=y;y=I;try{return S.apply(this,arguments)}finally{y=N}}}})(rd)),rd}var b0;function MS(){return b0||(b0=1,sd.exports=CS()),sd.exports}var ad={exports:{}},Le={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v0;function PS(){if(v0)return Le;v0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.iterator;function y(w){return w===null||typeof w!="object"?null:(w=_&&w[_]||w["@@iterator"],typeof w=="function"?w:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,E={};function R(w,k,W){this.props=w,this.context=k,this.refs=E,this.updater=W||v}R.prototype.isReactComponent={},R.prototype.setState=function(w,k){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,k,"setState")},R.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function P(){}P.prototype=R.prototype;function D(w,k,W){this.props=w,this.context=k,this.refs=E,this.updater=W||v}var M=D.prototype=new P;M.constructor=D,T(M,R.prototype),M.isPureReactComponent=!0;var L=Array.isArray,H={H:null,A:null,T:null,S:null,V:null},J=Object.prototype.hasOwnProperty;function fe(w,k,W,Q,ae,ue){return W=ue.ref,{$$typeof:n,type:w,key:k,ref:W!==void 0?W:null,props:ue}}function de(w,k){return fe(w.type,k,void 0,void 0,void 0,w.props)}function le(w){return typeof w=="object"&&w!==null&&w.$$typeof===n}function _e(w){var k={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(W){return k[W]})}var Se=/\/+/g;function De(w,k){return typeof w=="object"&&w!==null&&w.key!=null?_e(""+w.key):k.toString(36)}function Ee(){}function xe(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(Ee,Ee):(w.status="pending",w.then(function(k){w.status==="pending"&&(w.status="fulfilled",w.value=k)},function(k){w.status==="pending"&&(w.status="rejected",w.reason=k)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function Fe(w,k,W,Q,ae){var ue=typeof w;(ue==="undefined"||ue==="boolean")&&(w=null);var me=!1;if(w===null)me=!0;else switch(ue){case"bigint":case"string":case"number":me=!0;break;case"object":switch(w.$$typeof){case n:case e:me=!0;break;case p:return me=w._init,Fe(me(w._payload),k,W,Q,ae)}}if(me)return ae=ae(w),me=Q===""?"."+De(w,0):Q,L(ae)?(W="",me!=null&&(W=me.replace(Se,"$&/")+"/"),Fe(ae,k,W,"",function(ze){return ze})):ae!=null&&(le(ae)&&(ae=de(ae,W+(ae.key==null||w&&w.key===ae.key?"":(""+ae.key).replace(Se,"$&/")+"/")+me)),k.push(ae)),1;me=0;var Ue=Q===""?".":Q+":";if(L(w))for(var Te=0;Te<w.length;Te++)Q=w[Te],ue=Ue+De(Q,Te),me+=Fe(Q,k,W,ue,ae);else if(Te=y(w),typeof Te=="function")for(w=Te.call(w),Te=0;!(Q=w.next()).done;)Q=Q.value,ue=Ue+De(Q,Te++),me+=Fe(Q,k,W,ue,ae);else if(ue==="object"){if(typeof w.then=="function")return Fe(xe(w),k,W,Q,ae);throw k=String(w),Error("Objects are not valid as a React child (found: "+(k==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":k)+"). If you meant to render a collection of children, use an array instead.")}return me}function S(w,k,W){if(w==null)return w;var Q=[],ae=0;return Fe(w,Q,"","",function(ue){return k.call(W,ue,ae++)}),Q}function I(w){if(w._status===-1){var k=w._result;k=k(),k.then(function(W){(w._status===0||w._status===-1)&&(w._status=1,w._result=W)},function(W){(w._status===0||w._status===-1)&&(w._status=2,w._result=W)}),w._status===-1&&(w._status=0,w._result=k)}if(w._status===1)return w._result.default;throw w._result}var N=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var k=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(k))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function G(){}return Le.Children={map:S,forEach:function(w,k,W){S(w,function(){k.apply(this,arguments)},W)},count:function(w){var k=0;return S(w,function(){k++}),k},toArray:function(w){return S(w,function(k){return k})||[]},only:function(w){if(!le(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},Le.Component=R,Le.Fragment=t,Le.Profiler=s,Le.PureComponent=D,Le.StrictMode=i,Le.Suspense=h,Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Le.__COMPILER_RUNTIME={__proto__:null,c:function(w){return H.H.useMemoCache(w)}},Le.cache=function(w){return function(){return w.apply(null,arguments)}},Le.cloneElement=function(w,k,W){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var Q=T({},w.props),ae=w.key,ue=void 0;if(k!=null)for(me in k.ref!==void 0&&(ue=void 0),k.key!==void 0&&(ae=""+k.key),k)!J.call(k,me)||me==="key"||me==="__self"||me==="__source"||me==="ref"&&k.ref===void 0||(Q[me]=k[me]);var me=arguments.length-2;if(me===1)Q.children=W;else if(1<me){for(var Ue=Array(me),Te=0;Te<me;Te++)Ue[Te]=arguments[Te+2];Q.children=Ue}return fe(w.type,ae,void 0,void 0,ue,Q)},Le.createContext=function(w){return w={$$typeof:l,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:a,_context:w},w},Le.createElement=function(w,k,W){var Q,ae={},ue=null;if(k!=null)for(Q in k.key!==void 0&&(ue=""+k.key),k)J.call(k,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(ae[Q]=k[Q]);var me=arguments.length-2;if(me===1)ae.children=W;else if(1<me){for(var Ue=Array(me),Te=0;Te<me;Te++)Ue[Te]=arguments[Te+2];ae.children=Ue}if(w&&w.defaultProps)for(Q in me=w.defaultProps,me)ae[Q]===void 0&&(ae[Q]=me[Q]);return fe(w,ue,void 0,void 0,null,ae)},Le.createRef=function(){return{current:null}},Le.forwardRef=function(w){return{$$typeof:u,render:w}},Le.isValidElement=le,Le.lazy=function(w){return{$$typeof:p,_payload:{_status:-1,_result:w},_init:I}},Le.memo=function(w,k){return{$$typeof:d,type:w,compare:k===void 0?null:k}},Le.startTransition=function(w){var k=H.T,W={};H.T=W;try{var Q=w(),ae=H.S;ae!==null&&ae(W,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(G,N)}catch(ue){N(ue)}finally{H.T=k}},Le.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Le.use=function(w){return H.H.use(w)},Le.useActionState=function(w,k,W){return H.H.useActionState(w,k,W)},Le.useCallback=function(w,k){return H.H.useCallback(w,k)},Le.useContext=function(w){return H.H.useContext(w)},Le.useDebugValue=function(){},Le.useDeferredValue=function(w,k){return H.H.useDeferredValue(w,k)},Le.useEffect=function(w,k,W){var Q=H.H;if(typeof W=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(w,k)},Le.useId=function(){return H.H.useId()},Le.useImperativeHandle=function(w,k,W){return H.H.useImperativeHandle(w,k,W)},Le.useInsertionEffect=function(w,k){return H.H.useInsertionEffect(w,k)},Le.useLayoutEffect=function(w,k){return H.H.useLayoutEffect(w,k)},Le.useMemo=function(w,k){return H.H.useMemo(w,k)},Le.useOptimistic=function(w,k){return H.H.useOptimistic(w,k)},Le.useReducer=function(w,k,W){return H.H.useReducer(w,k,W)},Le.useRef=function(w){return H.H.useRef(w)},Le.useState=function(w){return H.H.useState(w)},Le.useSyncExternalStore=function(w,k,W){return H.H.useSyncExternalStore(w,k,W)},Le.useTransition=function(){return H.H.useTransition()},Le.version="19.1.0",Le}var x0;function Bp(){return x0||(x0=1,ad.exports=PS()),ad.exports}var od={exports:{}},Gt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T0;function OS(){if(T0)return Gt;T0=1;var n=Bp();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(h,d,p){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:h,containerInfo:d,implementation:p}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Gt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Gt.createPortal=function(h,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,p)},Gt.flushSync=function(h){var d=l.T,p=i.p;try{if(l.T=null,i.p=2,h)return h()}finally{l.T=d,i.p=p,i.d.f()}},Gt.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(h,d))},Gt.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Gt.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var p=d.as,_=u(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:v}):p==="script"&&i.d.X(h,{crossOrigin:_,integrity:y,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Gt.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=u(d.as,d.crossOrigin);i.d.M(h,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(h)},Gt.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,_=u(p,d.crossOrigin);i.d.L(h,p,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Gt.preloadModule=function(h,d){if(typeof h=="string")if(d){var p=u(d.as,d.crossOrigin);i.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(h)},Gt.requestFormReset=function(h){i.d.r(h)},Gt.unstable_batchedUpdates=function(h,d){return h(d)},Gt.useFormState=function(h,d,p){return l.H.useFormState(h,d,p)},Gt.useFormStatus=function(){return l.H.useHostTransitionStatus()},Gt.version="19.1.0",Gt}var S0;function IS(){if(S0)return od.exports;S0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),od.exports=OS(),od.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w0;function NS(){if(w0)return wo;w0=1;var n=MS(),e=Bp(),t=IS();function i(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function a(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function l(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function u(r){if(a(r)!==r)throw Error(i(188))}function h(r){var o=r.alternate;if(!o){if(o=a(r),o===null)throw Error(i(188));return o!==r?null:r}for(var c=r,f=o;;){var g=c.return;if(g===null)break;var m=g.alternate;if(m===null){if(f=g.return,f!==null){c=f;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===c)return u(g),r;if(m===f)return u(g),o;m=m.sibling}throw Error(i(188))}if(c.return!==f.return)c=g,f=m;else{for(var b=!1,x=g.child;x;){if(x===c){b=!0,c=g,f=m;break}if(x===f){b=!0,f=g,c=m;break}x=x.sibling}if(!b){for(x=m.child;x;){if(x===c){b=!0,c=m,f=g;break}if(x===f){b=!0,f=m,c=g;break}x=x.sibling}if(!b)throw Error(i(189))}}if(c.alternate!==f)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?r:o}function d(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=d(r),o!==null)return o;r=r.sibling}return null}var p=Object.assign,_=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),D=Symbol.for("react.consumer"),M=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),fe=Symbol.for("react.memo"),de=Symbol.for("react.lazy"),le=Symbol.for("react.activity"),_e=Symbol.for("react.memo_cache_sentinel"),Se=Symbol.iterator;function De(r){return r===null||typeof r!="object"?null:(r=Se&&r[Se]||r["@@iterator"],typeof r=="function"?r:null)}var Ee=Symbol.for("react.client.reference");function xe(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===Ee?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case T:return"Fragment";case R:return"Profiler";case E:return"StrictMode";case H:return"Suspense";case J:return"SuspenseList";case le:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case v:return"Portal";case M:return(r.displayName||"Context")+".Provider";case D:return(r._context.displayName||"Context")+".Consumer";case L:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case fe:return o=r.displayName||null,o!==null?o:xe(r.type)||"Memo";case de:o=r._payload,r=r._init;try{return xe(r(o))}catch{}}return null}var Fe=Array.isArray,S=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,N={pending:!1,data:null,method:null,action:null},G=[],w=-1;function k(r){return{current:r}}function W(r){0>w||(r.current=G[w],G[w]=null,w--)}function Q(r,o){w++,G[w]=r.current,r.current=o}var ae=k(null),ue=k(null),me=k(null),Ue=k(null);function Te(r,o){switch(Q(me,o),Q(ue,r),Q(ae,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?$y(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=$y(o),r=Wy(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}W(ae),Q(ae,r)}function ze(){W(ae),W(ue),W(me)}function Qe(r){r.memoizedState!==null&&Q(Ue,r);var o=ae.current,c=Wy(o,r.type);o!==c&&(Q(ue,r),Q(ae,c))}function Ut(r){ue.current===r&&(W(ae),W(ue)),Ue.current===r&&(W(Ue),yo._currentValue=N)}var sn=Object.prototype.hasOwnProperty,pn=n.unstable_scheduleCallback,ii=n.unstable_cancelCallback,Xe=n.unstable_shouldYield,Ye=n.unstable_requestPaint,rn=n.unstable_now,Yu=n.unstable_getCurrentPriorityLevel,Xi=n.unstable_ImmediatePriority,Ma=n.unstable_UserBlockingPriority,Yi=n.unstable_NormalPriority,fl=n.unstable_LowPriority,yi=n.unstable_IdlePriority,gn=n.log,pr=n.unstable_setDisableYieldValue,ln=null,st=null;function Wn(r){if(typeof gn=="function"&&pr(r),st&&typeof st.setStrictMode=="function")try{st.setStrictMode(ln,r)}catch{}}var Tt=Math.clz32?Math.clz32:qu,bi=Math.log,gr=Math.LN2;function qu(r){return r>>>=0,r===0?32:31-(bi(r)/gr|0)|0}var mr=256,qi=4194304;function Xn(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Ki(r,o,c){var f=r.pendingLanes;if(f===0)return 0;var g=0,m=r.suspendedLanes,b=r.pingedLanes;r=r.warmLanes;var x=f&134217727;return x!==0?(f=x&~m,f!==0?g=Xn(f):(b&=x,b!==0?g=Xn(b):c||(c=x&~r,c!==0&&(g=Xn(c))))):(x=f&~m,x!==0?g=Xn(x):b!==0?g=Xn(b):c||(c=f&~r,c!==0&&(g=Xn(c)))),g===0?0:o!==0&&o!==g&&(o&m)===0&&(m=g&-g,c=o&-o,m>=c||m===32&&(c&4194048)!==0)?o:g}function Ds(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function hl(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dl(){var r=mr;return mr<<=1,(mr&4194048)===0&&(mr=256),r}function vi(){var r=qi;return qi<<=1,(qi&62914560)===0&&(qi=4194304),r}function ee(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function we(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function ye(r,o,c,f,g,m){var b=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var x=r.entanglements,O=r.expirationTimes,q=r.hiddenUpdates;for(c=b&~c;0<c;){var te=31-Tt(c),re=1<<te;x[te]=0,O[te]=-1;var K=q[te];if(K!==null)for(q[te]=null,te=0;te<K.length;te++){var Z=K[te];Z!==null&&(Z.lane&=-536870913)}c&=~re}f!==0&&pe(r,f,0),m!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=m&~(b&~o))}function pe(r,o,c){r.pendingLanes|=o,r.suspendedLanes&=~o;var f=31-Tt(o);r.entangledLanes|=o,r.entanglements[f]=r.entanglements[f]|1073741824|c&4194090}function he(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var f=31-Tt(c),g=1<<f;g&o|r[f]&o&&(r[f]|=o),c&=~g}}function ce(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function be(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Ce(){var r=I.p;return r!==0?r:(r=window.event,r===void 0?32:u0(r.type))}function Me(r,o){var c=I.p;try{return I.p=r,o()}finally{I.p=c}}var Re=Math.random().toString(36).slice(2),ke="__reactFiber$"+Re,St="__reactProps$"+Re,Ze="__reactContainer$"+Re,Ht="__reactEvents$"+Re,qt="__reactListeners$"+Re,Kt="__reactHandles$"+Re,jt="__reactResources$"+Re,wt="__reactMarker$"+Re;function mn(r){delete r[ke],delete r[St],delete r[Ht],delete r[qt],delete r[Kt]}function Zt(r){var o=r[ke];if(o)return o;for(var c=r.parentNode;c;){if(o=c[Ze]||c[ke]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=Ky(r);r!==null;){if(c=r[ke])return c;r=Ky(r)}return o}r=c,c=r.parentNode}return null}function Zi(r){if(r=r[ke]||r[Ze]){var o=r.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return r}return null}function Cn(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(i(33))}function Qi(r){var o=r[jt];return o||(o=r[jt]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Rt(r){r[wt]=!0}var pl=new Set,gl={};function xi(r,o){Gi(r,o),Gi(r+"Capture",o)}function Gi(r,o){for(gl[r]=o,r=0;r<o.length;r++)pl.add(o[r])}var y1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Dg={},Bg={};function b1(r){return sn.call(Bg,r)?!0:sn.call(Dg,r)?!1:y1.test(r)?Bg[r]=!0:(Dg[r]=!0,!1)}function ml(r,o,c){if(b1(o))if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+c)}}function _l(r,o,c){if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+c)}}function Ti(r,o,c,f){if(f===null)r.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(o,c,""+f)}}var Ku,Ug;function _r(r){if(Ku===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);Ku=o&&o[1]||"",Ug=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ku+r+Ug}var Zu=!1;function Qu(r,o){if(!r||Zu)return"";Zu=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(Z){var K=Z}Reflect.construct(r,[],re)}else{try{re.call()}catch(Z){K=Z}r.call(re.prototype)}}else{try{throw Error()}catch(Z){K=Z}(re=r())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(Z){if(Z&&K&&typeof Z.stack=="string")return[Z.stack,K.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=f.DetermineComponentFrameRoot(),b=m[0],x=m[1];if(b&&x){var O=b.split(`
`),q=x.split(`
`);for(g=f=0;f<O.length&&!O[f].includes("DetermineComponentFrameRoot");)f++;for(;g<q.length&&!q[g].includes("DetermineComponentFrameRoot");)g++;if(f===O.length||g===q.length)for(f=O.length-1,g=q.length-1;1<=f&&0<=g&&O[f]!==q[g];)g--;for(;1<=f&&0<=g;f--,g--)if(O[f]!==q[g]){if(f!==1||g!==1)do if(f--,g--,0>g||O[f]!==q[g]){var te=`
`+O[f].replace(" at new "," at ");return r.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",r.displayName)),te}while(1<=f&&0<=g);break}}}finally{Zu=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?_r(c):""}function v1(r){switch(r.tag){case 26:case 27:case 5:return _r(r.type);case 16:return _r("Lazy");case 13:return _r("Suspense");case 19:return _r("SuspenseList");case 0:case 15:return Qu(r.type,!1);case 11:return Qu(r.type.render,!1);case 1:return Qu(r.type,!0);case 31:return _r("Activity");default:return""}}function Lg(r){try{var o="";do o+=v1(r),r=r.return;while(r);return o}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function Mn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Fg(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function x1(r){var o=Fg(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),f=""+r[o];if(!r.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,m=c.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return g.call(this)},set:function(b){f=""+b,m.call(this,b)}}),Object.defineProperty(r,o,{enumerable:c.enumerable}),{getValue:function(){return f},setValue:function(b){f=""+b},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function yl(r){r._valueTracker||(r._valueTracker=x1(r))}function zg(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),f="";return r&&(f=Fg(r)?r.checked?"true":"false":r.value),r=f,r!==c?(o.setValue(r),!0):!1}function bl(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var T1=/[\n"\\]/g;function Pn(r){return r.replace(T1,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Gu(r,o,c,f,g,m,b,x){r.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?r.type=b:r.removeAttribute("type"),o!=null?b==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+Mn(o)):r.value!==""+Mn(o)&&(r.value=""+Mn(o)):b!=="submit"&&b!=="reset"||r.removeAttribute("value"),o!=null?Ju(r,b,Mn(o)):c!=null?Ju(r,b,Mn(c)):f!=null&&r.removeAttribute("value"),g==null&&m!=null&&(r.defaultChecked=!!m),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?r.name=""+Mn(x):r.removeAttribute("name")}function Vg(r,o,c,f,g,m,b,x){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(r.type=m),o!=null||c!=null){if(!(m!=="submit"&&m!=="reset"||o!=null))return;c=c!=null?""+Mn(c):"",o=o!=null?""+Mn(o):c,x||o===r.value||(r.value=o),r.defaultValue=o}f=f??g,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=x?r.checked:!!f,r.defaultChecked=!!f,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(r.name=b)}function Ju(r,o,c){o==="number"&&bl(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function yr(r,o,c,f){if(r=r.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=o.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&f&&(r[c].defaultSelected=!0)}else{for(c=""+Mn(c),o=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,f&&(r[g].defaultSelected=!0);return}o!==null||r[g].disabled||(o=r[g])}o!==null&&(o.selected=!0)}}function Hg(r,o,c){if(o!=null&&(o=""+Mn(o),o!==r.value&&(r.value=o),c==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=c!=null?""+Mn(c):""}function jg(r,o,c,f){if(o==null){if(f!=null){if(c!=null)throw Error(i(92));if(Fe(f)){if(1<f.length)throw Error(i(93));f=f[0]}c=f}c==null&&(c=""),o=c}c=Mn(o),r.defaultValue=c,f=r.textContent,f===c&&f!==""&&f!==null&&(r.value=f)}function br(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var S1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function $g(r,o,c){var f=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":f?r.setProperty(o,c):typeof c!="number"||c===0||S1.has(o)?o==="float"?r.cssFloat=c:r[o]=(""+c).trim():r[o]=c+"px"}function Wg(r,o,c){if(o!=null&&typeof o!="object")throw Error(i(62));if(r=r.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var g in o)f=o[g],o.hasOwnProperty(g)&&c[g]!==f&&$g(r,g,f)}else for(var m in o)o.hasOwnProperty(m)&&$g(r,m,o[m])}function ef(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var w1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),A1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vl(r){return A1.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var tf=null;function nf(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var vr=null,xr=null;function Xg(r){var o=Zi(r);if(o&&(r=o.stateNode)){var c=r[St]||null;e:switch(r=o.stateNode,o.type){case"input":if(Gu(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Pn(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var f=c[o];if(f!==r&&f.form===r.form){var g=f[St]||null;if(!g)throw Error(i(90));Gu(f,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)f=c[o],f.form===r.form&&zg(f)}break e;case"textarea":Hg(r,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&yr(r,!!c.multiple,o,!1)}}}var sf=!1;function Yg(r,o,c){if(sf)return r(o,c);sf=!0;try{var f=r(o);return f}finally{if(sf=!1,(vr!==null||xr!==null)&&(rc(),vr&&(o=vr,r=xr,xr=vr=null,Xg(o),r)))for(o=0;o<r.length;o++)Xg(r[o])}}function Pa(r,o){var c=r.stateNode;if(c===null)return null;var f=c[St]||null;if(f===null)return null;c=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(i(231,o,typeof c));return c}var Si=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rf=!1;if(Si)try{var Oa={};Object.defineProperty(Oa,"passive",{get:function(){rf=!0}}),window.addEventListener("test",Oa,Oa),window.removeEventListener("test",Oa,Oa)}catch{rf=!1}var Ji=null,af=null,xl=null;function qg(){if(xl)return xl;var r,o=af,c=o.length,f,g="value"in Ji?Ji.value:Ji.textContent,m=g.length;for(r=0;r<c&&o[r]===g[r];r++);var b=c-r;for(f=1;f<=b&&o[c-f]===g[m-f];f++);return xl=g.slice(r,1<f?1-f:void 0)}function Tl(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Sl(){return!0}function Kg(){return!1}function cn(r){function o(c,f,g,m,b){this._reactName=c,this._targetInst=g,this.type=f,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var x in r)r.hasOwnProperty(x)&&(c=r[x],this[x]=c?c(m):m[x]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Sl:Kg,this.isPropagationStopped=Kg,this}return p(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Sl)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Sl)},persist:function(){},isPersistent:Sl}),o}var Bs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wl=cn(Bs),Ia=p({},Bs,{view:0,detail:0}),E1=cn(Ia),of,lf,Na,Al=p({},Ia,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uf,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Na&&(Na&&r.type==="mousemove"?(of=r.screenX-Na.screenX,lf=r.screenY-Na.screenY):lf=of=0,Na=r),of)},movementY:function(r){return"movementY"in r?r.movementY:lf}}),Zg=cn(Al),R1=p({},Al,{dataTransfer:0}),C1=cn(R1),M1=p({},Ia,{relatedTarget:0}),cf=cn(M1),P1=p({},Bs,{animationName:0,elapsedTime:0,pseudoElement:0}),O1=cn(P1),I1=p({},Bs,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),N1=cn(I1),k1=p({},Bs,{data:0}),Qg=cn(k1),D1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},B1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},U1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function L1(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=U1[r])?!!o[r]:!1}function uf(){return L1}var F1=p({},Ia,{key:function(r){if(r.key){var o=D1[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Tl(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?B1[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uf,charCode:function(r){return r.type==="keypress"?Tl(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Tl(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),z1=cn(F1),V1=p({},Al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gg=cn(V1),H1=p({},Ia,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uf}),j1=cn(H1),$1=p({},Bs,{propertyName:0,elapsedTime:0,pseudoElement:0}),W1=cn($1),X1=p({},Al,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Y1=cn(X1),q1=p({},Bs,{newState:0,oldState:0}),K1=cn(q1),Z1=[9,13,27,32],ff=Si&&"CompositionEvent"in window,ka=null;Si&&"documentMode"in document&&(ka=document.documentMode);var Q1=Si&&"TextEvent"in window&&!ka,Jg=Si&&(!ff||ka&&8<ka&&11>=ka),em=" ",tm=!1;function nm(r,o){switch(r){case"keyup":return Z1.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function im(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Tr=!1;function G1(r,o){switch(r){case"compositionend":return im(o);case"keypress":return o.which!==32?null:(tm=!0,em);case"textInput":return r=o.data,r===em&&tm?null:r;default:return null}}function J1(r,o){if(Tr)return r==="compositionend"||!ff&&nm(r,o)?(r=qg(),xl=af=Ji=null,Tr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Jg&&o.locale!=="ko"?null:o.data;default:return null}}var e2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sm(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!e2[r.type]:o==="textarea"}function rm(r,o,c,f){vr?xr?xr.push(f):xr=[f]:vr=f,o=fc(o,"onChange"),0<o.length&&(c=new wl("onChange","change",null,c,f),r.push({event:c,listeners:o}))}var Da=null,Ba=null;function t2(r){Fy(r,0)}function El(r){var o=Cn(r);if(zg(o))return r}function am(r,o){if(r==="change")return o}var om=!1;if(Si){var hf;if(Si){var df="oninput"in document;if(!df){var lm=document.createElement("div");lm.setAttribute("oninput","return;"),df=typeof lm.oninput=="function"}hf=df}else hf=!1;om=hf&&(!document.documentMode||9<document.documentMode)}function cm(){Da&&(Da.detachEvent("onpropertychange",um),Ba=Da=null)}function um(r){if(r.propertyName==="value"&&El(Ba)){var o=[];rm(o,Ba,r,nf(r)),Yg(t2,o)}}function n2(r,o,c){r==="focusin"?(cm(),Da=o,Ba=c,Da.attachEvent("onpropertychange",um)):r==="focusout"&&cm()}function i2(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return El(Ba)}function s2(r,o){if(r==="click")return El(o)}function r2(r,o){if(r==="input"||r==="change")return El(o)}function a2(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var _n=typeof Object.is=="function"?Object.is:a2;function Ua(r,o){if(_n(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),f=Object.keys(o);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var g=c[f];if(!sn.call(o,g)||!_n(r[g],o[g]))return!1}return!0}function fm(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function hm(r,o){var c=fm(r);r=0;for(var f;c;){if(c.nodeType===3){if(f=r+c.textContent.length,r<=o&&f>=o)return{node:c,offset:o-r};r=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=fm(c)}}function dm(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?dm(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function pm(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=bl(r.document);o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=bl(r.document)}return o}function pf(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var o2=Si&&"documentMode"in document&&11>=document.documentMode,Sr=null,gf=null,La=null,mf=!1;function gm(r,o,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;mf||Sr==null||Sr!==bl(f)||(f=Sr,"selectionStart"in f&&pf(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),La&&Ua(La,f)||(La=f,f=fc(gf,"onSelect"),0<f.length&&(o=new wl("onSelect","select",null,o,c),r.push({event:o,listeners:f}),o.target=Sr)))}function Us(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var wr={animationend:Us("Animation","AnimationEnd"),animationiteration:Us("Animation","AnimationIteration"),animationstart:Us("Animation","AnimationStart"),transitionrun:Us("Transition","TransitionRun"),transitionstart:Us("Transition","TransitionStart"),transitioncancel:Us("Transition","TransitionCancel"),transitionend:Us("Transition","TransitionEnd")},_f={},mm={};Si&&(mm=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);function Ls(r){if(_f[r])return _f[r];if(!wr[r])return r;var o=wr[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in mm)return _f[r]=o[c];return r}var _m=Ls("animationend"),ym=Ls("animationiteration"),bm=Ls("animationstart"),l2=Ls("transitionrun"),c2=Ls("transitionstart"),u2=Ls("transitioncancel"),vm=Ls("transitionend"),xm=new Map,yf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yf.push("scrollEnd");function Yn(r,o){xm.set(r,o),xi(o,[r])}var Tm=new WeakMap;function On(r,o){if(typeof r=="object"&&r!==null){var c=Tm.get(r);return c!==void 0?c:(o={value:r,source:o,stack:Lg(o)},Tm.set(r,o),o)}return{value:r,source:o,stack:Lg(o)}}var In=[],Ar=0,bf=0;function Rl(){for(var r=Ar,o=bf=Ar=0;o<r;){var c=In[o];In[o++]=null;var f=In[o];In[o++]=null;var g=In[o];In[o++]=null;var m=In[o];if(In[o++]=null,f!==null&&g!==null){var b=f.pending;b===null?g.next=g:(g.next=b.next,b.next=g),f.pending=g}m!==0&&Sm(c,g,m)}}function Cl(r,o,c,f){In[Ar++]=r,In[Ar++]=o,In[Ar++]=c,In[Ar++]=f,bf|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function vf(r,o,c,f){return Cl(r,o,c,f),Ml(r)}function Er(r,o){return Cl(r,null,null,o),Ml(r)}function Sm(r,o,c){r.lanes|=c;var f=r.alternate;f!==null&&(f.lanes|=c);for(var g=!1,m=r.return;m!==null;)m.childLanes|=c,f=m.alternate,f!==null&&(f.childLanes|=c),m.tag===22&&(r=m.stateNode,r===null||r._visibility&1||(g=!0)),r=m,m=m.return;return r.tag===3?(m=r.stateNode,g&&o!==null&&(g=31-Tt(c),r=m.hiddenUpdates,f=r[g],f===null?r[g]=[o]:f.push(o),o.lane=c|536870912),m):null}function Ml(r){if(50<co)throw co=0,Eh=null,Error(i(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var Rr={};function f2(r,o,c,f){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yn(r,o,c,f){return new f2(r,o,c,f)}function xf(r){return r=r.prototype,!(!r||!r.isReactComponent)}function wi(r,o){var c=r.alternate;return c===null?(c=yn(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function wm(r,o){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,o=c.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Pl(r,o,c,f,g,m){var b=0;if(f=r,typeof r=="function")xf(r)&&(b=1);else if(typeof r=="string")b=dS(r,c,ae.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case le:return r=yn(31,c,o,g),r.elementType=le,r.lanes=m,r;case T:return Fs(c.children,g,m,o);case E:b=8,g|=24;break;case R:return r=yn(12,c,o,g|2),r.elementType=R,r.lanes=m,r;case H:return r=yn(13,c,o,g),r.elementType=H,r.lanes=m,r;case J:return r=yn(19,c,o,g),r.elementType=J,r.lanes=m,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case P:case M:b=10;break e;case D:b=9;break e;case L:b=11;break e;case fe:b=14;break e;case de:b=16,f=null;break e}b=29,c=Error(i(130,r===null?"null":typeof r,"")),f=null}return o=yn(b,c,o,g),o.elementType=r,o.type=f,o.lanes=m,o}function Fs(r,o,c,f){return r=yn(7,r,f,o),r.lanes=c,r}function Tf(r,o,c){return r=yn(6,r,null,o),r.lanes=c,r}function Sf(r,o,c){return o=yn(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var Cr=[],Mr=0,Ol=null,Il=0,Nn=[],kn=0,zs=null,Ai=1,Ei="";function Vs(r,o){Cr[Mr++]=Il,Cr[Mr++]=Ol,Ol=r,Il=o}function Am(r,o,c){Nn[kn++]=Ai,Nn[kn++]=Ei,Nn[kn++]=zs,zs=r;var f=Ai;r=Ei;var g=32-Tt(f)-1;f&=~(1<<g),c+=1;var m=32-Tt(o)+g;if(30<m){var b=g-g%5;m=(f&(1<<b)-1).toString(32),f>>=b,g-=b,Ai=1<<32-Tt(o)+g|c<<g|f,Ei=m+r}else Ai=1<<m|c<<g|f,Ei=r}function wf(r){r.return!==null&&(Vs(r,1),Am(r,1,0))}function Af(r){for(;r===Ol;)Ol=Cr[--Mr],Cr[Mr]=null,Il=Cr[--Mr],Cr[Mr]=null;for(;r===zs;)zs=Nn[--kn],Nn[kn]=null,Ei=Nn[--kn],Nn[kn]=null,Ai=Nn[--kn],Nn[kn]=null}var an=null,yt=null,Je=!1,Hs=null,si=!1,Ef=Error(i(519));function js(r){var o=Error(i(418,""));throw Va(On(o,r)),Ef}function Em(r){var o=r.stateNode,c=r.type,f=r.memoizedProps;switch(o[ke]=r,o[St]=f,c){case"dialog":$e("cancel",o),$e("close",o);break;case"iframe":case"object":case"embed":$e("load",o);break;case"video":case"audio":for(c=0;c<fo.length;c++)$e(fo[c],o);break;case"source":$e("error",o);break;case"img":case"image":case"link":$e("error",o),$e("load",o);break;case"details":$e("toggle",o);break;case"input":$e("invalid",o),Vg(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),yl(o);break;case"select":$e("invalid",o);break;case"textarea":$e("invalid",o),jg(o,f.value,f.defaultValue,f.children),yl(o)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||f.suppressHydrationWarning===!0||jy(o.textContent,c)?(f.popover!=null&&($e("beforetoggle",o),$e("toggle",o)),f.onScroll!=null&&$e("scroll",o),f.onScrollEnd!=null&&$e("scrollend",o),f.onClick!=null&&(o.onclick=hc),o=!0):o=!1,o||js(r)}function Rm(r){for(an=r.return;an;)switch(an.tag){case 5:case 13:si=!1;return;case 27:case 3:si=!0;return;default:an=an.return}}function Fa(r){if(r!==an)return!1;if(!Je)return Rm(r),Je=!0,!1;var o=r.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||Hh(r.type,r.memoizedProps)),c=!c),c&&yt&&js(r),Rm(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(o===0){yt=Kn(r.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++;r=r.nextSibling}yt=null}}else o===27?(o=yt,gs(r.type)?(r=Xh,Xh=null,yt=r):yt=o):yt=an?Kn(r.stateNode.nextSibling):null;return!0}function za(){yt=an=null,Je=!1}function Cm(){var r=Hs;return r!==null&&(hn===null?hn=r:hn.push.apply(hn,r),Hs=null),r}function Va(r){Hs===null?Hs=[r]:Hs.push(r)}var Rf=k(null),$s=null,Ri=null;function es(r,o,c){Q(Rf,o._currentValue),o._currentValue=c}function Ci(r){r._currentValue=Rf.current,W(Rf)}function Cf(r,o,c){for(;r!==null;){var f=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),r===c)break;r=r.return}}function Mf(r,o,c,f){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var m=g.dependencies;if(m!==null){var b=g.child;m=m.firstContext;e:for(;m!==null;){var x=m;m=g;for(var O=0;O<o.length;O++)if(x.context===o[O]){m.lanes|=c,x=m.alternate,x!==null&&(x.lanes|=c),Cf(m.return,c,r),f||(b=null);break e}m=x.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(i(341));b.lanes|=c,m=b.alternate,m!==null&&(m.lanes|=c),Cf(b,c,r),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===r){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function Ha(r,o,c,f){r=null;for(var g=o,m=!1;g!==null;){if(!m){if((g.flags&524288)!==0)m=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var x=g.type;_n(g.pendingProps.value,b.value)||(r!==null?r.push(x):r=[x])}}else if(g===Ue.current){if(b=g.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(yo):r=[yo])}g=g.return}r!==null&&Mf(o,r,c,f),o.flags|=262144}function Nl(r){for(r=r.firstContext;r!==null;){if(!_n(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ws(r){$s=r,Ri=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Qt(r){return Mm($s,r)}function kl(r,o){return $s===null&&Ws(r),Mm(r,o)}function Mm(r,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},Ri===null){if(r===null)throw Error(i(308));Ri=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else Ri=Ri.next=o;return c}var h2=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(c,f){r.push(f)}};this.abort=function(){o.aborted=!0,r.forEach(function(c){return c()})}},d2=n.unstable_scheduleCallback,p2=n.unstable_NormalPriority,Nt={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pf(){return{controller:new h2,data:new Map,refCount:0}}function ja(r){r.refCount--,r.refCount===0&&d2(p2,function(){r.controller.abort()})}var $a=null,Of=0,Pr=0,Or=null;function g2(r,o){if($a===null){var c=$a=[];Of=0,Pr=Nh(),Or={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Of++,o.then(Pm,Pm),o}function Pm(){if(--Of===0&&$a!==null){Or!==null&&(Or.status="fulfilled");var r=$a;$a=null,Pr=0,Or=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function m2(r,o){var c=[],f={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){f.status="fulfilled",f.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(f.status="rejected",f.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),f}var Om=S.S;S.S=function(r,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&g2(r,o),Om!==null&&Om(r,o)};var Xs=k(null);function If(){var r=Xs.current;return r!==null?r:dt.pooledCache}function Dl(r,o){o===null?Q(Xs,Xs.current):Q(Xs,o.pool)}function Im(){var r=If();return r===null?null:{parent:Nt._currentValue,pool:r}}var Wa=Error(i(460)),Nm=Error(i(474)),Bl=Error(i(542)),Nf={then:function(){}};function km(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Ul(){}function Dm(r,o,c){switch(c=r[c],c===void 0?r.push(o):c!==o&&(o.then(Ul,Ul),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Um(r),r;default:if(typeof o.status=="string")o.then(Ul,Ul);else{if(r=dt,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=o,r.status="pending",r.then(function(f){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=f}},function(f){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Um(r),r}throw Xa=o,Wa}}var Xa=null;function Bm(){if(Xa===null)throw Error(i(459));var r=Xa;return Xa=null,r}function Um(r){if(r===Wa||r===Bl)throw Error(i(483))}var ts=!1;function kf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Df(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ns(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function is(r,o,c){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,(nt&2)!==0){var g=f.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),f.pending=o,o=Ml(r),Sm(r,null,c),o}return Cl(r,f,o,c),Ml(r)}function Ya(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var f=o.lanes;f&=r.pendingLanes,c|=f,o.lanes=c,he(r,c)}}function Bf(r,o){var c=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var g=null,m=null;if(c=c.firstBaseUpdate,c!==null){do{var b={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};m===null?g=m=b:m=m.next=b,c=c.next}while(c!==null);m===null?g=m=o:m=m.next=o}else g=m=o;c={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:f.shared,callbacks:f.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}var Uf=!1;function qa(){if(Uf){var r=Or;if(r!==null)throw r}}function Ka(r,o,c,f){Uf=!1;var g=r.updateQueue;ts=!1;var m=g.firstBaseUpdate,b=g.lastBaseUpdate,x=g.shared.pending;if(x!==null){g.shared.pending=null;var O=x,q=O.next;O.next=null,b===null?m=q:b.next=q,b=O;var te=r.alternate;te!==null&&(te=te.updateQueue,x=te.lastBaseUpdate,x!==b&&(x===null?te.firstBaseUpdate=q:x.next=q,te.lastBaseUpdate=O))}if(m!==null){var re=g.baseState;b=0,te=q=O=null,x=m;do{var K=x.lane&-536870913,Z=K!==x.lane;if(Z?(qe&K)===K:(f&K)===K){K!==0&&K===Pr&&(Uf=!0),te!==null&&(te=te.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var Ne=r,Pe=x;K=o;var ot=c;switch(Pe.tag){case 1:if(Ne=Pe.payload,typeof Ne=="function"){re=Ne.call(ot,re,K);break e}re=Ne;break e;case 3:Ne.flags=Ne.flags&-65537|128;case 0:if(Ne=Pe.payload,K=typeof Ne=="function"?Ne.call(ot,re,K):Ne,K==null)break e;re=p({},re,K);break e;case 2:ts=!0}}K=x.callback,K!==null&&(r.flags|=64,Z&&(r.flags|=8192),Z=g.callbacks,Z===null?g.callbacks=[K]:Z.push(K))}else Z={lane:K,tag:x.tag,payload:x.payload,callback:x.callback,next:null},te===null?(q=te=Z,O=re):te=te.next=Z,b|=K;if(x=x.next,x===null){if(x=g.shared.pending,x===null)break;Z=x,x=Z.next,Z.next=null,g.lastBaseUpdate=Z,g.shared.pending=null}}while(!0);te===null&&(O=re),g.baseState=O,g.firstBaseUpdate=q,g.lastBaseUpdate=te,m===null&&(g.shared.lanes=0),fs|=b,r.lanes=b,r.memoizedState=re}}function Lm(r,o){if(typeof r!="function")throw Error(i(191,r));r.call(o)}function Fm(r,o){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Lm(c[r],o)}var Ir=k(null),Ll=k(0);function zm(r,o){r=Di,Q(Ll,r),Q(Ir,o),Di=r|o.baseLanes}function Lf(){Q(Ll,Di),Q(Ir,Ir.current)}function Ff(){Di=Ll.current,W(Ir),W(Ll)}var ss=0,Ve=null,rt=null,Ct=null,Fl=!1,Nr=!1,Ys=!1,zl=0,Za=0,kr=null,_2=0;function At(){throw Error(i(321))}function zf(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!_n(r[c],o[c]))return!1;return!0}function Vf(r,o,c,f,g,m){return ss=m,Ve=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,S.H=r===null||r.memoizedState===null?S_:w_,Ys=!1,m=c(f,g),Ys=!1,Nr&&(m=Hm(o,c,f,g)),Vm(r),m}function Vm(r){S.H=Xl;var o=rt!==null&&rt.next!==null;if(ss=0,Ct=rt=Ve=null,Fl=!1,Za=0,kr=null,o)throw Error(i(300));r===null||Lt||(r=r.dependencies,r!==null&&Nl(r)&&(Lt=!0))}function Hm(r,o,c,f){Ve=r;var g=0;do{if(Nr&&(kr=null),Za=0,Nr=!1,25<=g)throw Error(i(301));if(g+=1,Ct=rt=null,r.updateQueue!=null){var m=r.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}S.H=w2,m=o(c,f)}while(Nr);return m}function y2(){var r=S.H,o=r.useState()[0];return o=typeof o.then=="function"?Qa(o):o,r=r.useState()[0],(rt!==null?rt.memoizedState:null)!==r&&(Ve.flags|=1024),o}function Hf(){var r=zl!==0;return zl=0,r}function jf(r,o,c){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~c}function $f(r){if(Fl){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Fl=!1}ss=0,Ct=rt=Ve=null,Nr=!1,Za=zl=0,kr=null}function un(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?Ve.memoizedState=Ct=r:Ct=Ct.next=r,Ct}function Mt(){if(rt===null){var r=Ve.alternate;r=r!==null?r.memoizedState:null}else r=rt.next;var o=Ct===null?Ve.memoizedState:Ct.next;if(o!==null)Ct=o,rt=r;else{if(r===null)throw Ve.alternate===null?Error(i(467)):Error(i(310));rt=r,r={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},Ct===null?Ve.memoizedState=Ct=r:Ct=Ct.next=r}return Ct}function Wf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qa(r){var o=Za;return Za+=1,kr===null&&(kr=[]),r=Dm(kr,r,o),o=Ve,(Ct===null?o.memoizedState:Ct.next)===null&&(o=o.alternate,S.H=o===null||o.memoizedState===null?S_:w_),r}function Vl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Qa(r);if(r.$$typeof===M)return Qt(r)}throw Error(i(438,String(r)))}function Xf(r){var o=null,c=Ve.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var f=Ve.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=Wf(),Ve.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(r),f=0;f<r;f++)c[f]=_e;return o.index++,c}function Mi(r,o){return typeof o=="function"?o(r):o}function Hl(r){var o=Mt();return Yf(o,rt,r)}function Yf(r,o,c){var f=r.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=c;var g=r.baseQueue,m=f.pending;if(m!==null){if(g!==null){var b=g.next;g.next=m.next,m.next=b}o.baseQueue=g=m,f.pending=null}if(m=r.baseState,g===null)r.memoizedState=m;else{o=g.next;var x=b=null,O=null,q=o,te=!1;do{var re=q.lane&-536870913;if(re!==q.lane?(qe&re)===re:(ss&re)===re){var K=q.revertLane;if(K===0)O!==null&&(O=O.next={lane:0,revertLane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),re===Pr&&(te=!0);else if((ss&K)===K){q=q.next,K===Pr&&(te=!0);continue}else re={lane:0,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},O===null?(x=O=re,b=m):O=O.next=re,Ve.lanes|=K,fs|=K;re=q.action,Ys&&c(m,re),m=q.hasEagerState?q.eagerState:c(m,re)}else K={lane:re,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},O===null?(x=O=K,b=m):O=O.next=K,Ve.lanes|=re,fs|=re;q=q.next}while(q!==null&&q!==o);if(O===null?b=m:O.next=x,!_n(m,r.memoizedState)&&(Lt=!0,te&&(c=Or,c!==null)))throw c;r.memoizedState=m,r.baseState=b,r.baseQueue=O,f.lastRenderedState=m}return g===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function qf(r){var o=Mt(),c=o.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=r;var f=c.dispatch,g=c.pending,m=o.memoizedState;if(g!==null){c.pending=null;var b=g=g.next;do m=r(m,b.action),b=b.next;while(b!==g);_n(m,o.memoizedState)||(Lt=!0),o.memoizedState=m,o.baseQueue===null&&(o.baseState=m),c.lastRenderedState=m}return[m,f]}function jm(r,o,c){var f=Ve,g=Mt(),m=Je;if(m){if(c===void 0)throw Error(i(407));c=c()}else c=o();var b=!_n((rt||g).memoizedState,c);b&&(g.memoizedState=c,Lt=!0),g=g.queue;var x=Xm.bind(null,f,g,r);if(Ga(2048,8,x,[r]),g.getSnapshot!==o||b||Ct!==null&&Ct.memoizedState.tag&1){if(f.flags|=2048,Dr(9,jl(),Wm.bind(null,f,g,c,o),null),dt===null)throw Error(i(349));m||(ss&124)!==0||$m(f,o,c)}return c}function $m(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=Ve.updateQueue,o===null?(o=Wf(),Ve.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function Wm(r,o,c,f){o.value=c,o.getSnapshot=f,Ym(o)&&qm(r)}function Xm(r,o,c){return c(function(){Ym(o)&&qm(r)})}function Ym(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!_n(r,c)}catch{return!0}}function qm(r){var o=Er(r,2);o!==null&&Sn(o,r,2)}function Kf(r){var o=un();if(typeof r=="function"){var c=r;if(r=c(),Ys){Wn(!0);try{c()}finally{Wn(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mi,lastRenderedState:r},o}function Km(r,o,c,f){return r.baseState=c,Yf(r,rt,typeof f=="function"?f:Mi)}function b2(r,o,c,f,g){if(Wl(r))throw Error(i(485));if(r=o.action,r!==null){var m={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){m.listeners.push(b)}};S.T!==null?c(!0):m.isTransition=!1,f(m),c=o.pending,c===null?(m.next=o.pending=m,Zm(o,m)):(m.next=c.next,o.pending=c.next=m)}}function Zm(r,o){var c=o.action,f=o.payload,g=r.state;if(o.isTransition){var m=S.T,b={};S.T=b;try{var x=c(g,f),O=S.S;O!==null&&O(b,x),Qm(r,o,x)}catch(q){Zf(r,o,q)}finally{S.T=m}}else try{m=c(g,f),Qm(r,o,m)}catch(q){Zf(r,o,q)}}function Qm(r,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){Gm(r,o,f)},function(f){return Zf(r,o,f)}):Gm(r,o,c)}function Gm(r,o,c){o.status="fulfilled",o.value=c,Jm(o),r.state=c,o=r.pending,o!==null&&(c=o.next,c===o?r.pending=null:(c=c.next,o.next=c,Zm(r,c)))}function Zf(r,o,c){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=c,Jm(o),o=o.next;while(o!==f)}r.action=null}function Jm(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function e_(r,o){return o}function t_(r,o){if(Je){var c=dt.formState;if(c!==null){e:{var f=Ve;if(Je){if(yt){t:{for(var g=yt,m=si;g.nodeType!==8;){if(!m){g=null;break t}if(g=Kn(g.nextSibling),g===null){g=null;break t}}m=g.data,g=m==="F!"||m==="F"?g:null}if(g){yt=Kn(g.nextSibling),f=g.data==="F!";break e}}js(f)}f=!1}f&&(o=c[0])}}return c=un(),c.memoizedState=c.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e_,lastRenderedState:o},c.queue=f,c=v_.bind(null,Ve,f),f.dispatch=c,f=Kf(!1),m=th.bind(null,Ve,!1,f.queue),f=un(),g={state:o,dispatch:null,action:r,pending:null},f.queue=g,c=b2.bind(null,Ve,g,m,c),g.dispatch=c,f.memoizedState=r,[o,c,!1]}function n_(r){var o=Mt();return i_(o,rt,r)}function i_(r,o,c){if(o=Yf(r,o,e_)[0],r=Hl(Mi)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Qa(o)}catch(b){throw b===Wa?Bl:b}else f=o;o=Mt();var g=o.queue,m=g.dispatch;return c!==o.memoizedState&&(Ve.flags|=2048,Dr(9,jl(),v2.bind(null,g,c),null)),[f,m,r]}function v2(r,o){r.action=o}function s_(r){var o=Mt(),c=rt;if(c!==null)return i_(o,c,r);Mt(),o=o.memoizedState,c=Mt();var f=c.queue.dispatch;return c.memoizedState=r,[o,f,!1]}function Dr(r,o,c,f){return r={tag:r,create:c,deps:f,inst:o,next:null},o=Ve.updateQueue,o===null&&(o=Wf(),Ve.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=r.next=r:(f=c.next,c.next=r,r.next=f,o.lastEffect=r),r}function jl(){return{destroy:void 0,resource:void 0}}function r_(){return Mt().memoizedState}function $l(r,o,c,f){var g=un();f=f===void 0?null:f,Ve.flags|=r,g.memoizedState=Dr(1|o,jl(),c,f)}function Ga(r,o,c,f){var g=Mt();f=f===void 0?null:f;var m=g.memoizedState.inst;rt!==null&&f!==null&&zf(f,rt.memoizedState.deps)?g.memoizedState=Dr(o,m,c,f):(Ve.flags|=r,g.memoizedState=Dr(1|o,m,c,f))}function a_(r,o){$l(8390656,8,r,o)}function o_(r,o){Ga(2048,8,r,o)}function l_(r,o){return Ga(4,2,r,o)}function c_(r,o){return Ga(4,4,r,o)}function u_(r,o){if(typeof o=="function"){r=r();var c=o(r);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function f_(r,o,c){c=c!=null?c.concat([r]):null,Ga(4,4,u_.bind(null,o,r),c)}function Qf(){}function h_(r,o){var c=Mt();o=o===void 0?null:o;var f=c.memoizedState;return o!==null&&zf(o,f[1])?f[0]:(c.memoizedState=[r,o],r)}function d_(r,o){var c=Mt();o=o===void 0?null:o;var f=c.memoizedState;if(o!==null&&zf(o,f[1]))return f[0];if(f=r(),Ys){Wn(!0);try{r()}finally{Wn(!1)}}return c.memoizedState=[f,o],f}function Gf(r,o,c){return c===void 0||(ss&1073741824)!==0?r.memoizedState=o:(r.memoizedState=c,r=my(),Ve.lanes|=r,fs|=r,c)}function p_(r,o,c,f){return _n(c,o)?c:Ir.current!==null?(r=Gf(r,c,f),_n(r,o)||(Lt=!0),r):(ss&42)===0?(Lt=!0,r.memoizedState=c):(r=my(),Ve.lanes|=r,fs|=r,o)}function g_(r,o,c,f,g){var m=I.p;I.p=m!==0&&8>m?m:8;var b=S.T,x={};S.T=x,th(r,!1,o,c);try{var O=g(),q=S.S;if(q!==null&&q(x,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var te=m2(O,f);Ja(r,o,te,Tn(r))}else Ja(r,o,f,Tn(r))}catch(re){Ja(r,o,{then:function(){},status:"rejected",reason:re},Tn())}finally{I.p=m,S.T=b}}function x2(){}function Jf(r,o,c,f){if(r.tag!==5)throw Error(i(476));var g=m_(r).queue;g_(r,g,o,N,c===null?x2:function(){return __(r),c(f)})}function m_(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:N,baseState:N,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mi,lastRenderedState:N},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mi,lastRenderedState:c},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function __(r){var o=m_(r).next.queue;Ja(r,o,{},Tn())}function eh(){return Qt(yo)}function y_(){return Mt().memoizedState}function b_(){return Mt().memoizedState}function T2(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var c=Tn();r=ns(c);var f=is(o,r,c);f!==null&&(Sn(f,o,c),Ya(f,o,c)),o={cache:Pf()},r.payload=o;return}o=o.return}}function S2(r,o,c){var f=Tn();c={lane:f,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},Wl(r)?x_(o,c):(c=vf(r,o,c,f),c!==null&&(Sn(c,r,f),T_(c,o,f)))}function v_(r,o,c){var f=Tn();Ja(r,o,c,f)}function Ja(r,o,c,f){var g={lane:f,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(Wl(r))x_(o,g);else{var m=r.alternate;if(r.lanes===0&&(m===null||m.lanes===0)&&(m=o.lastRenderedReducer,m!==null))try{var b=o.lastRenderedState,x=m(b,c);if(g.hasEagerState=!0,g.eagerState=x,_n(x,b))return Cl(r,o,g,0),dt===null&&Rl(),!1}catch{}finally{}if(c=vf(r,o,g,f),c!==null)return Sn(c,r,f),T_(c,o,f),!0}return!1}function th(r,o,c,f){if(f={lane:2,revertLane:Nh(),action:f,hasEagerState:!1,eagerState:null,next:null},Wl(r)){if(o)throw Error(i(479))}else o=vf(r,c,f,2),o!==null&&Sn(o,r,2)}function Wl(r){var o=r.alternate;return r===Ve||o!==null&&o===Ve}function x_(r,o){Nr=Fl=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function T_(r,o,c){if((c&4194048)!==0){var f=o.lanes;f&=r.pendingLanes,c|=f,o.lanes=c,he(r,c)}}var Xl={readContext:Qt,use:Vl,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useLayoutEffect:At,useInsertionEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useSyncExternalStore:At,useId:At,useHostTransitionStatus:At,useFormState:At,useActionState:At,useOptimistic:At,useMemoCache:At,useCacheRefresh:At},S_={readContext:Qt,use:Vl,useCallback:function(r,o){return un().memoizedState=[r,o===void 0?null:o],r},useContext:Qt,useEffect:a_,useImperativeHandle:function(r,o,c){c=c!=null?c.concat([r]):null,$l(4194308,4,u_.bind(null,o,r),c)},useLayoutEffect:function(r,o){return $l(4194308,4,r,o)},useInsertionEffect:function(r,o){$l(4,2,r,o)},useMemo:function(r,o){var c=un();o=o===void 0?null:o;var f=r();if(Ys){Wn(!0);try{r()}finally{Wn(!1)}}return c.memoizedState=[f,o],f},useReducer:function(r,o,c){var f=un();if(c!==void 0){var g=c(o);if(Ys){Wn(!0);try{c(o)}finally{Wn(!1)}}}else g=o;return f.memoizedState=f.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},f.queue=r,r=r.dispatch=S2.bind(null,Ve,r),[f.memoizedState,r]},useRef:function(r){var o=un();return r={current:r},o.memoizedState=r},useState:function(r){r=Kf(r);var o=r.queue,c=v_.bind(null,Ve,o);return o.dispatch=c,[r.memoizedState,c]},useDebugValue:Qf,useDeferredValue:function(r,o){var c=un();return Gf(c,r,o)},useTransition:function(){var r=Kf(!1);return r=g_.bind(null,Ve,r.queue,!0,!1),un().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,c){var f=Ve,g=un();if(Je){if(c===void 0)throw Error(i(407));c=c()}else{if(c=o(),dt===null)throw Error(i(349));(qe&124)!==0||$m(f,o,c)}g.memoizedState=c;var m={value:c,getSnapshot:o};return g.queue=m,a_(Xm.bind(null,f,m,r),[r]),f.flags|=2048,Dr(9,jl(),Wm.bind(null,f,m,c,o),null),c},useId:function(){var r=un(),o=dt.identifierPrefix;if(Je){var c=Ei,f=Ai;c=(f&~(1<<32-Tt(f)-1)).toString(32)+c,o=""+o+"R"+c,c=zl++,0<c&&(o+="H"+c.toString(32)),o+=""}else c=_2++,o=""+o+"r"+c.toString(32)+"";return r.memoizedState=o},useHostTransitionStatus:eh,useFormState:t_,useActionState:t_,useOptimistic:function(r){var o=un();o.memoizedState=o.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=th.bind(null,Ve,!0,c),c.dispatch=o,[r,o]},useMemoCache:Xf,useCacheRefresh:function(){return un().memoizedState=T2.bind(null,Ve)}},w_={readContext:Qt,use:Vl,useCallback:h_,useContext:Qt,useEffect:o_,useImperativeHandle:f_,useInsertionEffect:l_,useLayoutEffect:c_,useMemo:d_,useReducer:Hl,useRef:r_,useState:function(){return Hl(Mi)},useDebugValue:Qf,useDeferredValue:function(r,o){var c=Mt();return p_(c,rt.memoizedState,r,o)},useTransition:function(){var r=Hl(Mi)[0],o=Mt().memoizedState;return[typeof r=="boolean"?r:Qa(r),o]},useSyncExternalStore:jm,useId:y_,useHostTransitionStatus:eh,useFormState:n_,useActionState:n_,useOptimistic:function(r,o){var c=Mt();return Km(c,rt,r,o)},useMemoCache:Xf,useCacheRefresh:b_},w2={readContext:Qt,use:Vl,useCallback:h_,useContext:Qt,useEffect:o_,useImperativeHandle:f_,useInsertionEffect:l_,useLayoutEffect:c_,useMemo:d_,useReducer:qf,useRef:r_,useState:function(){return qf(Mi)},useDebugValue:Qf,useDeferredValue:function(r,o){var c=Mt();return rt===null?Gf(c,r,o):p_(c,rt.memoizedState,r,o)},useTransition:function(){var r=qf(Mi)[0],o=Mt().memoizedState;return[typeof r=="boolean"?r:Qa(r),o]},useSyncExternalStore:jm,useId:y_,useHostTransitionStatus:eh,useFormState:s_,useActionState:s_,useOptimistic:function(r,o){var c=Mt();return rt!==null?Km(c,rt,r,o):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Xf,useCacheRefresh:b_},Br=null,eo=0;function Yl(r){var o=eo;return eo+=1,Br===null&&(Br=[]),Dm(Br,r,o)}function to(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function ql(r,o){throw o.$$typeof===_?Error(i(525)):(r=Object.prototype.toString.call(o),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function A_(r){var o=r._init;return o(r._payload)}function E_(r){function o(j,B){if(r){var Y=j.deletions;Y===null?(j.deletions=[B],j.flags|=16):Y.push(B)}}function c(j,B){if(!r)return null;for(;B!==null;)o(j,B),B=B.sibling;return null}function f(j){for(var B=new Map;j!==null;)j.key!==null?B.set(j.key,j):B.set(j.index,j),j=j.sibling;return B}function g(j,B){return j=wi(j,B),j.index=0,j.sibling=null,j}function m(j,B,Y){return j.index=Y,r?(Y=j.alternate,Y!==null?(Y=Y.index,Y<B?(j.flags|=67108866,B):Y):(j.flags|=67108866,B)):(j.flags|=1048576,B)}function b(j){return r&&j.alternate===null&&(j.flags|=67108866),j}function x(j,B,Y,ie){return B===null||B.tag!==6?(B=Tf(Y,j.mode,ie),B.return=j,B):(B=g(B,Y),B.return=j,B)}function O(j,B,Y,ie){var ve=Y.type;return ve===T?te(j,B,Y.props.children,ie,Y.key):B!==null&&(B.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===de&&A_(ve)===B.type)?(B=g(B,Y.props),to(B,Y),B.return=j,B):(B=Pl(Y.type,Y.key,Y.props,null,j.mode,ie),to(B,Y),B.return=j,B)}function q(j,B,Y,ie){return B===null||B.tag!==4||B.stateNode.containerInfo!==Y.containerInfo||B.stateNode.implementation!==Y.implementation?(B=Sf(Y,j.mode,ie),B.return=j,B):(B=g(B,Y.children||[]),B.return=j,B)}function te(j,B,Y,ie,ve){return B===null||B.tag!==7?(B=Fs(Y,j.mode,ie,ve),B.return=j,B):(B=g(B,Y),B.return=j,B)}function re(j,B,Y){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=Tf(""+B,j.mode,Y),B.return=j,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case y:return Y=Pl(B.type,B.key,B.props,null,j.mode,Y),to(Y,B),Y.return=j,Y;case v:return B=Sf(B,j.mode,Y),B.return=j,B;case de:var ie=B._init;return B=ie(B._payload),re(j,B,Y)}if(Fe(B)||De(B))return B=Fs(B,j.mode,Y,null),B.return=j,B;if(typeof B.then=="function")return re(j,Yl(B),Y);if(B.$$typeof===M)return re(j,kl(j,B),Y);ql(j,B)}return null}function K(j,B,Y,ie){var ve=B!==null?B.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return ve!==null?null:x(j,B,""+Y,ie);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case y:return Y.key===ve?O(j,B,Y,ie):null;case v:return Y.key===ve?q(j,B,Y,ie):null;case de:return ve=Y._init,Y=ve(Y._payload),K(j,B,Y,ie)}if(Fe(Y)||De(Y))return ve!==null?null:te(j,B,Y,ie,null);if(typeof Y.then=="function")return K(j,B,Yl(Y),ie);if(Y.$$typeof===M)return K(j,B,kl(j,Y),ie);ql(j,Y)}return null}function Z(j,B,Y,ie,ve){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return j=j.get(Y)||null,x(B,j,""+ie,ve);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case y:return j=j.get(ie.key===null?Y:ie.key)||null,O(B,j,ie,ve);case v:return j=j.get(ie.key===null?Y:ie.key)||null,q(B,j,ie,ve);case de:var He=ie._init;return ie=He(ie._payload),Z(j,B,Y,ie,ve)}if(Fe(ie)||De(ie))return j=j.get(Y)||null,te(B,j,ie,ve,null);if(typeof ie.then=="function")return Z(j,B,Y,Yl(ie),ve);if(ie.$$typeof===M)return Z(j,B,Y,kl(B,ie),ve);ql(B,ie)}return null}function Ne(j,B,Y,ie){for(var ve=null,He=null,Ae=B,Oe=B=0,zt=null;Ae!==null&&Oe<Y.length;Oe++){Ae.index>Oe?(zt=Ae,Ae=null):zt=Ae.sibling;var Ge=K(j,Ae,Y[Oe],ie);if(Ge===null){Ae===null&&(Ae=zt);break}r&&Ae&&Ge.alternate===null&&o(j,Ae),B=m(Ge,B,Oe),He===null?ve=Ge:He.sibling=Ge,He=Ge,Ae=zt}if(Oe===Y.length)return c(j,Ae),Je&&Vs(j,Oe),ve;if(Ae===null){for(;Oe<Y.length;Oe++)Ae=re(j,Y[Oe],ie),Ae!==null&&(B=m(Ae,B,Oe),He===null?ve=Ae:He.sibling=Ae,He=Ae);return Je&&Vs(j,Oe),ve}for(Ae=f(Ae);Oe<Y.length;Oe++)zt=Z(Ae,j,Oe,Y[Oe],ie),zt!==null&&(r&&zt.alternate!==null&&Ae.delete(zt.key===null?Oe:zt.key),B=m(zt,B,Oe),He===null?ve=zt:He.sibling=zt,He=zt);return r&&Ae.forEach(function(vs){return o(j,vs)}),Je&&Vs(j,Oe),ve}function Pe(j,B,Y,ie){if(Y==null)throw Error(i(151));for(var ve=null,He=null,Ae=B,Oe=B=0,zt=null,Ge=Y.next();Ae!==null&&!Ge.done;Oe++,Ge=Y.next()){Ae.index>Oe?(zt=Ae,Ae=null):zt=Ae.sibling;var vs=K(j,Ae,Ge.value,ie);if(vs===null){Ae===null&&(Ae=zt);break}r&&Ae&&vs.alternate===null&&o(j,Ae),B=m(vs,B,Oe),He===null?ve=vs:He.sibling=vs,He=vs,Ae=zt}if(Ge.done)return c(j,Ae),Je&&Vs(j,Oe),ve;if(Ae===null){for(;!Ge.done;Oe++,Ge=Y.next())Ge=re(j,Ge.value,ie),Ge!==null&&(B=m(Ge,B,Oe),He===null?ve=Ge:He.sibling=Ge,He=Ge);return Je&&Vs(j,Oe),ve}for(Ae=f(Ae);!Ge.done;Oe++,Ge=Y.next())Ge=Z(Ae,j,Oe,Ge.value,ie),Ge!==null&&(r&&Ge.alternate!==null&&Ae.delete(Ge.key===null?Oe:Ge.key),B=m(Ge,B,Oe),He===null?ve=Ge:He.sibling=Ge,He=Ge);return r&&Ae.forEach(function(AS){return o(j,AS)}),Je&&Vs(j,Oe),ve}function ot(j,B,Y,ie){if(typeof Y=="object"&&Y!==null&&Y.type===T&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case y:e:{for(var ve=Y.key;B!==null;){if(B.key===ve){if(ve=Y.type,ve===T){if(B.tag===7){c(j,B.sibling),ie=g(B,Y.props.children),ie.return=j,j=ie;break e}}else if(B.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===de&&A_(ve)===B.type){c(j,B.sibling),ie=g(B,Y.props),to(ie,Y),ie.return=j,j=ie;break e}c(j,B);break}else o(j,B);B=B.sibling}Y.type===T?(ie=Fs(Y.props.children,j.mode,ie,Y.key),ie.return=j,j=ie):(ie=Pl(Y.type,Y.key,Y.props,null,j.mode,ie),to(ie,Y),ie.return=j,j=ie)}return b(j);case v:e:{for(ve=Y.key;B!==null;){if(B.key===ve)if(B.tag===4&&B.stateNode.containerInfo===Y.containerInfo&&B.stateNode.implementation===Y.implementation){c(j,B.sibling),ie=g(B,Y.children||[]),ie.return=j,j=ie;break e}else{c(j,B);break}else o(j,B);B=B.sibling}ie=Sf(Y,j.mode,ie),ie.return=j,j=ie}return b(j);case de:return ve=Y._init,Y=ve(Y._payload),ot(j,B,Y,ie)}if(Fe(Y))return Ne(j,B,Y,ie);if(De(Y)){if(ve=De(Y),typeof ve!="function")throw Error(i(150));return Y=ve.call(Y),Pe(j,B,Y,ie)}if(typeof Y.then=="function")return ot(j,B,Yl(Y),ie);if(Y.$$typeof===M)return ot(j,B,kl(j,Y),ie);ql(j,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,B!==null&&B.tag===6?(c(j,B.sibling),ie=g(B,Y),ie.return=j,j=ie):(c(j,B),ie=Tf(Y,j.mode,ie),ie.return=j,j=ie),b(j)):c(j,B)}return function(j,B,Y,ie){try{eo=0;var ve=ot(j,B,Y,ie);return Br=null,ve}catch(Ae){if(Ae===Wa||Ae===Bl)throw Ae;var He=yn(29,Ae,null,j.mode);return He.lanes=ie,He.return=j,He}finally{}}}var Ur=E_(!0),R_=E_(!1),Dn=k(null),ri=null;function rs(r){var o=r.alternate;Q(kt,kt.current&1),Q(Dn,r),ri===null&&(o===null||Ir.current!==null||o.memoizedState!==null)&&(ri=r)}function C_(r){if(r.tag===22){if(Q(kt,kt.current),Q(Dn,r),ri===null){var o=r.alternate;o!==null&&o.memoizedState!==null&&(ri=r)}}else as()}function as(){Q(kt,kt.current),Q(Dn,Dn.current)}function Pi(r){W(Dn),ri===r&&(ri=null),W(kt)}var kt=k(0);function Kl(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||Wh(c)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function nh(r,o,c,f){o=r.memoizedState,c=c(f,o),c=c==null?o:p({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var ih={enqueueSetState:function(r,o,c){r=r._reactInternals;var f=Tn(),g=ns(f);g.payload=o,c!=null&&(g.callback=c),o=is(r,g,f),o!==null&&(Sn(o,r,f),Ya(o,r,f))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var f=Tn(),g=ns(f);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=is(r,g,f),o!==null&&(Sn(o,r,f),Ya(o,r,f))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=Tn(),f=ns(c);f.tag=2,o!=null&&(f.callback=o),o=is(r,f,c),o!==null&&(Sn(o,r,c),Ya(o,r,c))}};function M_(r,o,c,f,g,m,b){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,m,b):o.prototype&&o.prototype.isPureReactComponent?!Ua(c,f)||!Ua(g,m):!0}function P_(r,o,c,f){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,f),o.state!==r&&ih.enqueueReplaceState(o,o.state,null)}function qs(r,o){var c=o;if("ref"in o){c={};for(var f in o)f!=="ref"&&(c[f]=o[f])}if(r=r.defaultProps){c===o&&(c=p({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}var Zl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function O_(r){Zl(r)}function I_(r){console.error(r)}function N_(r){Zl(r)}function Ql(r,o){try{var c=r.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function k_(r,o,c){try{var f=r.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function sh(r,o,c){return c=ns(c),c.tag=3,c.payload={element:null},c.callback=function(){Ql(r,o)},c}function D_(r){return r=ns(r),r.tag=3,r}function B_(r,o,c,f){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var m=f.value;r.payload=function(){return g(m)},r.callback=function(){k_(o,c,f)}}var b=c.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(r.callback=function(){k_(o,c,f),typeof g!="function"&&(hs===null?hs=new Set([this]):hs.add(this));var x=f.stack;this.componentDidCatch(f.value,{componentStack:x!==null?x:""})})}function A2(r,o,c,f,g){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=c.alternate,o!==null&&Ha(o,c,g,!0),c=Dn.current,c!==null){switch(c.tag){case 13:return ri===null?Ch():c.alternate===null&&bt===0&&(bt=3),c.flags&=-257,c.flags|=65536,c.lanes=g,f===Nf?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([f]):o.add(f),Ph(r,f,g)),!1;case 22:return c.flags|=65536,f===Nf?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([f]):c.add(f)),Ph(r,f,g)),!1}throw Error(i(435,c.tag))}return Ph(r,f,g),Ch(),!1}if(Je)return o=Dn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,f!==Ef&&(r=Error(i(422),{cause:f}),Va(On(r,c)))):(f!==Ef&&(o=Error(i(423),{cause:f}),Va(On(o,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,f=On(f,c),g=sh(r.stateNode,f,g),Bf(r,g),bt!==4&&(bt=2)),!1;var m=Error(i(520),{cause:f});if(m=On(m,c),lo===null?lo=[m]:lo.push(m),bt!==4&&(bt=2),o===null)return!0;f=On(f,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=sh(c.stateNode,f,r),Bf(c,r),!1;case 1:if(o=c.type,m=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(hs===null||!hs.has(m))))return c.flags|=65536,g&=-g,c.lanes|=g,g=D_(g),B_(g,r,c,f),Bf(c,g),!1}c=c.return}while(c!==null);return!1}var U_=Error(i(461)),Lt=!1;function $t(r,o,c,f){o.child=r===null?R_(o,null,c,f):Ur(o,r.child,c,f)}function L_(r,o,c,f,g){c=c.render;var m=o.ref;if("ref"in f){var b={};for(var x in f)x!=="ref"&&(b[x]=f[x])}else b=f;return Ws(o),f=Vf(r,o,c,b,m,g),x=Hf(),r!==null&&!Lt?(jf(r,o,g),Oi(r,o,g)):(Je&&x&&wf(o),o.flags|=1,$t(r,o,f,g),o.child)}function F_(r,o,c,f,g){if(r===null){var m=c.type;return typeof m=="function"&&!xf(m)&&m.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=m,z_(r,o,m,f,g)):(r=Pl(c.type,null,f,o,o.mode,g),r.ref=o.ref,r.return=o,o.child=r)}if(m=r.child,!hh(r,g)){var b=m.memoizedProps;if(c=c.compare,c=c!==null?c:Ua,c(b,f)&&r.ref===o.ref)return Oi(r,o,g)}return o.flags|=1,r=wi(m,f),r.ref=o.ref,r.return=o,o.child=r}function z_(r,o,c,f,g){if(r!==null){var m=r.memoizedProps;if(Ua(m,f)&&r.ref===o.ref)if(Lt=!1,o.pendingProps=f=m,hh(r,g))(r.flags&131072)!==0&&(Lt=!0);else return o.lanes=r.lanes,Oi(r,o,g)}return rh(r,o,c,f,g)}function V_(r,o,c){var f=o.pendingProps,g=f.children,m=r!==null?r.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=m!==null?m.baseLanes|c:c,r!==null){for(g=o.child=r.child,m=0;g!==null;)m=m|g.lanes|g.childLanes,g=g.sibling;o.childLanes=m&~f}else o.childLanes=0,o.child=null;return H_(r,o,f,c)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&Dl(o,m!==null?m.cachePool:null),m!==null?zm(o,m):Lf(),C_(o);else return o.lanes=o.childLanes=536870912,H_(r,o,m!==null?m.baseLanes|c:c,c)}else m!==null?(Dl(o,m.cachePool),zm(o,m),as(),o.memoizedState=null):(r!==null&&Dl(o,null),Lf(),as());return $t(r,o,g,c),o.child}function H_(r,o,c,f){var g=If();return g=g===null?null:{parent:Nt._currentValue,pool:g},o.memoizedState={baseLanes:c,cachePool:g},r!==null&&Dl(o,null),Lf(),C_(o),r!==null&&Ha(r,o,f,!0),null}function Gl(r,o){var c=o.ref;if(c===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(r===null||r.ref!==c)&&(o.flags|=4194816)}}function rh(r,o,c,f,g){return Ws(o),c=Vf(r,o,c,f,void 0,g),f=Hf(),r!==null&&!Lt?(jf(r,o,g),Oi(r,o,g)):(Je&&f&&wf(o),o.flags|=1,$t(r,o,c,g),o.child)}function j_(r,o,c,f,g,m){return Ws(o),o.updateQueue=null,c=Hm(o,f,c,g),Vm(r),f=Hf(),r!==null&&!Lt?(jf(r,o,m),Oi(r,o,m)):(Je&&f&&wf(o),o.flags|=1,$t(r,o,c,m),o.child)}function $_(r,o,c,f,g){if(Ws(o),o.stateNode===null){var m=Rr,b=c.contextType;typeof b=="object"&&b!==null&&(m=Qt(b)),m=new c(f,m),o.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=ih,o.stateNode=m,m._reactInternals=o,m=o.stateNode,m.props=f,m.state=o.memoizedState,m.refs={},kf(o),b=c.contextType,m.context=typeof b=="object"&&b!==null?Qt(b):Rr,m.state=o.memoizedState,b=c.getDerivedStateFromProps,typeof b=="function"&&(nh(o,c,b,f),m.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(b=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),b!==m.state&&ih.enqueueReplaceState(m,m.state,null),Ka(o,f,m,g),qa(),m.state=o.memoizedState),typeof m.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(r===null){m=o.stateNode;var x=o.memoizedProps,O=qs(c,x);m.props=O;var q=m.context,te=c.contextType;b=Rr,typeof te=="object"&&te!==null&&(b=Qt(te));var re=c.getDerivedStateFromProps;te=typeof re=="function"||typeof m.getSnapshotBeforeUpdate=="function",x=o.pendingProps!==x,te||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(x||q!==b)&&P_(o,m,f,b),ts=!1;var K=o.memoizedState;m.state=K,Ka(o,f,m,g),qa(),q=o.memoizedState,x||K!==q||ts?(typeof re=="function"&&(nh(o,c,re,f),q=o.memoizedState),(O=ts||M_(o,c,O,f,K,q,b))?(te||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(o.flags|=4194308)):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=q),m.props=f,m.state=q,m.context=b,f=O):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{m=o.stateNode,Df(r,o),b=o.memoizedProps,te=qs(c,b),m.props=te,re=o.pendingProps,K=m.context,q=c.contextType,O=Rr,typeof q=="object"&&q!==null&&(O=Qt(q)),x=c.getDerivedStateFromProps,(q=typeof x=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(b!==re||K!==O)&&P_(o,m,f,O),ts=!1,K=o.memoizedState,m.state=K,Ka(o,f,m,g),qa();var Z=o.memoizedState;b!==re||K!==Z||ts||r!==null&&r.dependencies!==null&&Nl(r.dependencies)?(typeof x=="function"&&(nh(o,c,x,f),Z=o.memoizedState),(te=ts||M_(o,c,te,f,K,Z,O)||r!==null&&r.dependencies!==null&&Nl(r.dependencies))?(q||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(f,Z,O),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(f,Z,O)),typeof m.componentDidUpdate=="function"&&(o.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof m.componentDidUpdate!="function"||b===r.memoizedProps&&K===r.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&K===r.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=Z),m.props=f,m.state=Z,m.context=O,f=te):(typeof m.componentDidUpdate!="function"||b===r.memoizedProps&&K===r.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&K===r.memoizedState||(o.flags|=1024),f=!1)}return m=f,Gl(r,o),f=(o.flags&128)!==0,m||f?(m=o.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:m.render(),o.flags|=1,r!==null&&f?(o.child=Ur(o,r.child,null,g),o.child=Ur(o,null,c,g)):$t(r,o,c,g),o.memoizedState=m.state,r=o.child):r=Oi(r,o,g),r}function W_(r,o,c,f){return za(),o.flags|=256,$t(r,o,c,f),o.child}var ah={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function oh(r){return{baseLanes:r,cachePool:Im()}}function lh(r,o,c){return r=r!==null?r.childLanes&~c:0,o&&(r|=Bn),r}function X_(r,o,c){var f=o.pendingProps,g=!1,m=(o.flags&128)!==0,b;if((b=m)||(b=r!==null&&r.memoizedState===null?!1:(kt.current&2)!==0),b&&(g=!0,o.flags&=-129),b=(o.flags&32)!==0,o.flags&=-33,r===null){if(Je){if(g?rs(o):as(),Je){var x=yt,O;if(O=x){e:{for(O=x,x=si;O.nodeType!==8;){if(!x){x=null;break e}if(O=Kn(O.nextSibling),O===null){x=null;break e}}x=O}x!==null?(o.memoizedState={dehydrated:x,treeContext:zs!==null?{id:Ai,overflow:Ei}:null,retryLane:536870912,hydrationErrors:null},O=yn(18,null,null,0),O.stateNode=x,O.return=o,o.child=O,an=o,yt=null,O=!0):O=!1}O||js(o)}if(x=o.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return Wh(x)?o.lanes=32:o.lanes=536870912,null;Pi(o)}return x=f.children,f=f.fallback,g?(as(),g=o.mode,x=Jl({mode:"hidden",children:x},g),f=Fs(f,g,c,null),x.return=o,f.return=o,x.sibling=f,o.child=x,g=o.child,g.memoizedState=oh(c),g.childLanes=lh(r,b,c),o.memoizedState=ah,f):(rs(o),ch(o,x))}if(O=r.memoizedState,O!==null&&(x=O.dehydrated,x!==null)){if(m)o.flags&256?(rs(o),o.flags&=-257,o=uh(r,o,c)):o.memoizedState!==null?(as(),o.child=r.child,o.flags|=128,o=null):(as(),g=f.fallback,x=o.mode,f=Jl({mode:"visible",children:f.children},x),g=Fs(g,x,c,null),g.flags|=2,f.return=o,g.return=o,f.sibling=g,o.child=f,Ur(o,r.child,null,c),f=o.child,f.memoizedState=oh(c),f.childLanes=lh(r,b,c),o.memoizedState=ah,o=g);else if(rs(o),Wh(x)){if(b=x.nextSibling&&x.nextSibling.dataset,b)var q=b.dgst;b=q,f=Error(i(419)),f.stack="",f.digest=b,Va({value:f,source:null,stack:null}),o=uh(r,o,c)}else if(Lt||Ha(r,o,c,!1),b=(c&r.childLanes)!==0,Lt||b){if(b=dt,b!==null&&(f=c&-c,f=(f&42)!==0?1:ce(f),f=(f&(b.suspendedLanes|c))!==0?0:f,f!==0&&f!==O.retryLane))throw O.retryLane=f,Er(r,f),Sn(b,r,f),U_;x.data==="$?"||Ch(),o=uh(r,o,c)}else x.data==="$?"?(o.flags|=192,o.child=r.child,o=null):(r=O.treeContext,yt=Kn(x.nextSibling),an=o,Je=!0,Hs=null,si=!1,r!==null&&(Nn[kn++]=Ai,Nn[kn++]=Ei,Nn[kn++]=zs,Ai=r.id,Ei=r.overflow,zs=o),o=ch(o,f.children),o.flags|=4096);return o}return g?(as(),g=f.fallback,x=o.mode,O=r.child,q=O.sibling,f=wi(O,{mode:"hidden",children:f.children}),f.subtreeFlags=O.subtreeFlags&65011712,q!==null?g=wi(q,g):(g=Fs(g,x,c,null),g.flags|=2),g.return=o,f.return=o,f.sibling=g,o.child=f,f=g,g=o.child,x=r.child.memoizedState,x===null?x=oh(c):(O=x.cachePool,O!==null?(q=Nt._currentValue,O=O.parent!==q?{parent:q,pool:q}:O):O=Im(),x={baseLanes:x.baseLanes|c,cachePool:O}),g.memoizedState=x,g.childLanes=lh(r,b,c),o.memoizedState=ah,f):(rs(o),c=r.child,r=c.sibling,c=wi(c,{mode:"visible",children:f.children}),c.return=o,c.sibling=null,r!==null&&(b=o.deletions,b===null?(o.deletions=[r],o.flags|=16):b.push(r)),o.child=c,o.memoizedState=null,c)}function ch(r,o){return o=Jl({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function Jl(r,o){return r=yn(22,r,null,o),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function uh(r,o,c){return Ur(o,r.child,null,c),r=ch(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function Y_(r,o,c){r.lanes|=o;var f=r.alternate;f!==null&&(f.lanes|=o),Cf(r.return,o,c)}function fh(r,o,c,f,g){var m=r.memoizedState;m===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:g}:(m.isBackwards=o,m.rendering=null,m.renderingStartTime=0,m.last=f,m.tail=c,m.tailMode=g)}function q_(r,o,c){var f=o.pendingProps,g=f.revealOrder,m=f.tail;if($t(r,o,f.children,c),f=kt.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Y_(r,c,o);else if(r.tag===19)Y_(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}f&=1}switch(Q(kt,f),g){case"forwards":for(c=o.child,g=null;c!==null;)r=c.alternate,r!==null&&Kl(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),fh(o,!1,g,c,m);break;case"backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(r=g.alternate,r!==null&&Kl(r)===null){o.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}fh(o,!0,c,null,m);break;case"together":fh(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Oi(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),fs|=o.lanes,(c&o.childLanes)===0)if(r!==null){if(Ha(r,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(i(153));if(o.child!==null){for(r=o.child,c=wi(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=wi(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function hh(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&Nl(r)))}function E2(r,o,c){switch(o.tag){case 3:Te(o,o.stateNode.containerInfo),es(o,Nt,r.memoizedState.cache),za();break;case 27:case 5:Qe(o);break;case 4:Te(o,o.stateNode.containerInfo);break;case 10:es(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(rs(o),o.flags|=128,null):(c&o.child.childLanes)!==0?X_(r,o,c):(rs(o),r=Oi(r,o,c),r!==null?r.sibling:null);rs(o);break;case 19:var g=(r.flags&128)!==0;if(f=(c&o.childLanes)!==0,f||(Ha(r,o,c,!1),f=(c&o.childLanes)!==0),g){if(f)return q_(r,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Q(kt,kt.current),f)break;return null;case 22:case 23:return o.lanes=0,V_(r,o,c);case 24:es(o,Nt,r.memoizedState.cache)}return Oi(r,o,c)}function K_(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps)Lt=!0;else{if(!hh(r,c)&&(o.flags&128)===0)return Lt=!1,E2(r,o,c);Lt=(r.flags&131072)!==0}else Lt=!1,Je&&(o.flags&1048576)!==0&&Am(o,Il,o.index);switch(o.lanes=0,o.tag){case 16:e:{r=o.pendingProps;var f=o.elementType,g=f._init;if(f=g(f._payload),o.type=f,typeof f=="function")xf(f)?(r=qs(f,r),o.tag=1,o=$_(null,o,f,r,c)):(o.tag=0,o=rh(null,o,f,r,c));else{if(f!=null){if(g=f.$$typeof,g===L){o.tag=11,o=L_(null,o,f,r,c);break e}else if(g===fe){o.tag=14,o=F_(null,o,f,r,c);break e}}throw o=xe(f)||f,Error(i(306,o,""))}}return o;case 0:return rh(r,o,o.type,o.pendingProps,c);case 1:return f=o.type,g=qs(f,o.pendingProps),$_(r,o,f,g,c);case 3:e:{if(Te(o,o.stateNode.containerInfo),r===null)throw Error(i(387));f=o.pendingProps;var m=o.memoizedState;g=m.element,Df(r,o),Ka(o,f,null,c);var b=o.memoizedState;if(f=b.cache,es(o,Nt,f),f!==m.cache&&Mf(o,[Nt],c,!0),qa(),f=b.element,m.isDehydrated)if(m={element:f,isDehydrated:!1,cache:b.cache},o.updateQueue.baseState=m,o.memoizedState=m,o.flags&256){o=W_(r,o,f,c);break e}else if(f!==g){g=On(Error(i(424)),o),Va(g),o=W_(r,o,f,c);break e}else{switch(r=o.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(yt=Kn(r.firstChild),an=o,Je=!0,Hs=null,si=!0,c=R_(o,null,f,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(za(),f===g){o=Oi(r,o,c);break e}$t(r,o,f,c)}o=o.child}return o;case 26:return Gl(r,o),r===null?(c=Jy(o.type,null,o.pendingProps,null))?o.memoizedState=c:Je||(c=o.type,r=o.pendingProps,f=dc(me.current).createElement(c),f[ke]=o,f[St]=r,Xt(f,c,r),Rt(f),o.stateNode=f):o.memoizedState=Jy(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return Qe(o),r===null&&Je&&(f=o.stateNode=Zy(o.type,o.pendingProps,me.current),an=o,si=!0,g=yt,gs(o.type)?(Xh=g,yt=Kn(f.firstChild)):yt=g),$t(r,o,o.pendingProps.children,c),Gl(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&Je&&((g=f=yt)&&(f=eS(f,o.type,o.pendingProps,si),f!==null?(o.stateNode=f,an=o,yt=Kn(f.firstChild),si=!1,g=!0):g=!1),g||js(o)),Qe(o),g=o.type,m=o.pendingProps,b=r!==null?r.memoizedProps:null,f=m.children,Hh(g,m)?f=null:b!==null&&Hh(g,b)&&(o.flags|=32),o.memoizedState!==null&&(g=Vf(r,o,y2,null,null,c),yo._currentValue=g),Gl(r,o),$t(r,o,f,c),o.child;case 6:return r===null&&Je&&((r=c=yt)&&(c=tS(c,o.pendingProps,si),c!==null?(o.stateNode=c,an=o,yt=null,r=!0):r=!1),r||js(o)),null;case 13:return X_(r,o,c);case 4:return Te(o,o.stateNode.containerInfo),f=o.pendingProps,r===null?o.child=Ur(o,null,f,c):$t(r,o,f,c),o.child;case 11:return L_(r,o,o.type,o.pendingProps,c);case 7:return $t(r,o,o.pendingProps,c),o.child;case 8:return $t(r,o,o.pendingProps.children,c),o.child;case 12:return $t(r,o,o.pendingProps.children,c),o.child;case 10:return f=o.pendingProps,es(o,o.type,f.value),$t(r,o,f.children,c),o.child;case 9:return g=o.type._context,f=o.pendingProps.children,Ws(o),g=Qt(g),f=f(g),o.flags|=1,$t(r,o,f,c),o.child;case 14:return F_(r,o,o.type,o.pendingProps,c);case 15:return z_(r,o,o.type,o.pendingProps,c);case 19:return q_(r,o,c);case 31:return f=o.pendingProps,c=o.mode,f={mode:f.mode,children:f.children},r===null?(c=Jl(f,c),c.ref=o.ref,o.child=c,c.return=o,o=c):(c=wi(r.child,f),c.ref=o.ref,o.child=c,c.return=o,o=c),o;case 22:return V_(r,o,c);case 24:return Ws(o),f=Qt(Nt),r===null?(g=If(),g===null&&(g=dt,m=Pf(),g.pooledCache=m,m.refCount++,m!==null&&(g.pooledCacheLanes|=c),g=m),o.memoizedState={parent:f,cache:g},kf(o),es(o,Nt,g)):((r.lanes&c)!==0&&(Df(r,o),Ka(o,null,null,c),qa()),g=r.memoizedState,m=o.memoizedState,g.parent!==f?(g={parent:f,cache:f},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),es(o,Nt,f)):(f=m.cache,es(o,Nt,f),f!==g.cache&&Mf(o,[Nt],c,!0))),$t(r,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(i(156,o.tag))}function Ii(r){r.flags|=4}function Z_(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!s0(o)){if(o=Dn.current,o!==null&&((qe&4194048)===qe?ri!==null:(qe&62914560)!==qe&&(qe&536870912)===0||o!==ri))throw Xa=Nf,Nm;r.flags|=8192}}function ec(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?vi():536870912,r.lanes|=o,Vr|=o)}function no(r,o){if(!Je)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function mt(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,f=0;if(o)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags&65011712,f|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=f,r.childLanes=c,o}function R2(r,o,c){var f=o.pendingProps;switch(Af(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mt(o),null;case 1:return mt(o),null;case 3:return c=o.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Ci(Nt),ze(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Fa(o)?Ii(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Cm())),mt(o),null;case 26:return c=o.memoizedState,r===null?(Ii(o),c!==null?(mt(o),Z_(o,c)):(mt(o),o.flags&=-16777217)):c?c!==r.memoizedState?(Ii(o),mt(o),Z_(o,c)):(mt(o),o.flags&=-16777217):(r.memoizedProps!==f&&Ii(o),mt(o),o.flags&=-16777217),null;case 27:Ut(o),c=me.current;var g=o.type;if(r!==null&&o.stateNode!=null)r.memoizedProps!==f&&Ii(o);else{if(!f){if(o.stateNode===null)throw Error(i(166));return mt(o),null}r=ae.current,Fa(o)?Em(o):(r=Zy(g,f,c),o.stateNode=r,Ii(o))}return mt(o),null;case 5:if(Ut(o),c=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==f&&Ii(o);else{if(!f){if(o.stateNode===null)throw Error(i(166));return mt(o),null}if(r=ae.current,Fa(o))Em(o);else{switch(g=dc(me.current),r){case 1:r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof f.is=="string"?g.createElement("select",{is:f.is}):g.createElement("select"),f.multiple?r.multiple=!0:f.size&&(r.size=f.size);break;default:r=typeof f.is=="string"?g.createElement(c,{is:f.is}):g.createElement(c)}}r[ke]=o,r[St]=f;e:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)r.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break e;for(;g.sibling===null;){if(g.return===null||g.return===o)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=r;e:switch(Xt(r,c,f),c){case"button":case"input":case"select":case"textarea":r=!!f.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Ii(o)}}return mt(o),o.flags&=-16777217,null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==f&&Ii(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(i(166));if(r=me.current,Fa(o)){if(r=o.stateNode,c=o.memoizedProps,f=null,g=an,g!==null)switch(g.tag){case 27:case 5:f=g.memoizedProps}r[ke]=o,r=!!(r.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||jy(r.nodeValue,c)),r||js(o)}else r=dc(r).createTextNode(f),r[ke]=o,o.stateNode=r}return mt(o),null;case 13:if(f=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Fa(o),f!==null&&f.dehydrated!==null){if(r===null){if(!g)throw Error(i(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[ke]=o}else za(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;mt(o),g=!1}else g=Cm(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Pi(o),o):(Pi(o),null)}if(Pi(o),(o.flags&128)!==0)return o.lanes=c,o;if(c=f!==null,r=r!==null&&r.memoizedState!==null,c){f=o.child,g=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(g=f.alternate.memoizedState.cachePool.pool);var m=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(m=f.memoizedState.cachePool.pool),m!==g&&(f.flags|=2048)}return c!==r&&c&&(o.child.flags|=8192),ec(o,o.updateQueue),mt(o),null;case 4:return ze(),r===null&&Uh(o.stateNode.containerInfo),mt(o),null;case 10:return Ci(o.type),mt(o),null;case 19:if(W(kt),g=o.memoizedState,g===null)return mt(o),null;if(f=(o.flags&128)!==0,m=g.rendering,m===null)if(f)no(g,!1);else{if(bt!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(m=Kl(r),m!==null){for(o.flags|=128,no(g,!1),r=m.updateQueue,o.updateQueue=r,ec(o,r),o.subtreeFlags=0,r=c,c=o.child;c!==null;)wm(c,r),c=c.sibling;return Q(kt,kt.current&1|2),o.child}r=r.sibling}g.tail!==null&&rn()>ic&&(o.flags|=128,f=!0,no(g,!1),o.lanes=4194304)}else{if(!f)if(r=Kl(m),r!==null){if(o.flags|=128,f=!0,r=r.updateQueue,o.updateQueue=r,ec(o,r),no(g,!0),g.tail===null&&g.tailMode==="hidden"&&!m.alternate&&!Je)return mt(o),null}else 2*rn()-g.renderingStartTime>ic&&c!==536870912&&(o.flags|=128,f=!0,no(g,!1),o.lanes=4194304);g.isBackwards?(m.sibling=o.child,o.child=m):(r=g.last,r!==null?r.sibling=m:o.child=m,g.last=m)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=rn(),o.sibling=null,r=kt.current,Q(kt,f?r&1|2:r&1),o):(mt(o),null);case 22:case 23:return Pi(o),Ff(),f=o.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(c&536870912)!==0&&(o.flags&128)===0&&(mt(o),o.subtreeFlags&6&&(o.flags|=8192)):mt(o),c=o.updateQueue,c!==null&&ec(o,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==c&&(o.flags|=2048),r!==null&&W(Xs),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),Ci(Nt),mt(o),null;case 25:return null;case 30:return null}throw Error(i(156,o.tag))}function C2(r,o){switch(Af(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Ci(Nt),ze(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Ut(o),null;case 13:if(Pi(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(i(340));za()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return W(kt),null;case 4:return ze(),null;case 10:return Ci(o.type),null;case 22:case 23:return Pi(o),Ff(),r!==null&&W(Xs),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return Ci(Nt),null;case 25:return null;default:return null}}function Q_(r,o){switch(Af(o),o.tag){case 3:Ci(Nt),ze();break;case 26:case 27:case 5:Ut(o);break;case 4:ze();break;case 13:Pi(o);break;case 19:W(kt);break;case 10:Ci(o.type);break;case 22:case 23:Pi(o),Ff(),r!==null&&W(Xs);break;case 24:Ci(Nt)}}function io(r,o){try{var c=o.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var g=f.next;c=g;do{if((c.tag&r)===r){f=void 0;var m=c.create,b=c.inst;f=m(),b.destroy=f}c=c.next}while(c!==g)}}catch(x){ft(o,o.return,x)}}function os(r,o,c){try{var f=o.updateQueue,g=f!==null?f.lastEffect:null;if(g!==null){var m=g.next;f=m;do{if((f.tag&r)===r){var b=f.inst,x=b.destroy;if(x!==void 0){b.destroy=void 0,g=o;var O=c,q=x;try{q()}catch(te){ft(g,O,te)}}}f=f.next}while(f!==m)}}catch(te){ft(o,o.return,te)}}function G_(r){var o=r.updateQueue;if(o!==null){var c=r.stateNode;try{Fm(o,c)}catch(f){ft(r,r.return,f)}}}function J_(r,o,c){c.props=qs(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(f){ft(r,o,f)}}function so(r,o){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof c=="function"?r.refCleanup=c(f):c.current=f}}catch(g){ft(r,o,g)}}function ai(r,o){var c=r.ref,f=r.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(g){ft(r,o,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){ft(r,o,g)}else c.current=null}function ey(r){var o=r.type,c=r.memoizedProps,f=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(g){ft(r,r.return,g)}}function dh(r,o,c){try{var f=r.stateNode;K2(f,r.type,c,o),f[St]=o}catch(g){ft(r,r.return,g)}}function ty(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&gs(r.type)||r.tag===4}function ph(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ty(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&gs(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function gh(r,o,c){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(r),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=hc));else if(f!==4&&(f===27&&gs(r.type)&&(c=r.stateNode,o=null),r=r.child,r!==null))for(gh(r,o,c),r=r.sibling;r!==null;)gh(r,o,c),r=r.sibling}function tc(r,o,c){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(f!==4&&(f===27&&gs(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(tc(r,o,c),r=r.sibling;r!==null;)tc(r,o,c),r=r.sibling}function ny(r){var o=r.stateNode,c=r.memoizedProps;try{for(var f=r.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);Xt(o,f,c),o[ke]=r,o[St]=c}catch(m){ft(r,r.return,m)}}var Ni=!1,Et=!1,mh=!1,iy=typeof WeakSet=="function"?WeakSet:Set,Ft=null;function M2(r,o){if(r=r.containerInfo,zh=bc,r=pm(r),pf(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var g=f.anchorOffset,m=f.focusNode;f=f.focusOffset;try{c.nodeType,m.nodeType}catch{c=null;break e}var b=0,x=-1,O=-1,q=0,te=0,re=r,K=null;t:for(;;){for(var Z;re!==c||g!==0&&re.nodeType!==3||(x=b+g),re!==m||f!==0&&re.nodeType!==3||(O=b+f),re.nodeType===3&&(b+=re.nodeValue.length),(Z=re.firstChild)!==null;)K=re,re=Z;for(;;){if(re===r)break t;if(K===c&&++q===g&&(x=b),K===m&&++te===f&&(O=b),(Z=re.nextSibling)!==null)break;re=K,K=re.parentNode}re=Z}c=x===-1||O===-1?null:{start:x,end:O}}else c=null}c=c||{start:0,end:0}}else c=null;for(Vh={focusedElem:r,selectionRange:c},bc=!1,Ft=o;Ft!==null;)if(o=Ft,r=o.child,(o.subtreeFlags&1024)!==0&&r!==null)r.return=o,Ft=r;else for(;Ft!==null;){switch(o=Ft,m=o.alternate,r=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&m!==null){r=void 0,c=o,g=m.memoizedProps,m=m.memoizedState,f=c.stateNode;try{var Ne=qs(c.type,g,c.elementType===c.type);r=f.getSnapshotBeforeUpdate(Ne,m),f.__reactInternalSnapshotBeforeUpdate=r}catch(Pe){ft(c,c.return,Pe)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,c=r.nodeType,c===9)$h(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":$h(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=o.sibling,r!==null){r.return=o.return,Ft=r;break}Ft=o.return}}function sy(r,o,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ls(r,c),f&4&&io(5,c);break;case 1:if(ls(r,c),f&4)if(r=c.stateNode,o===null)try{r.componentDidMount()}catch(b){ft(c,c.return,b)}else{var g=qs(c.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(g,o,r.__reactInternalSnapshotBeforeUpdate)}catch(b){ft(c,c.return,b)}}f&64&&G_(c),f&512&&so(c,c.return);break;case 3:if(ls(r,c),f&64&&(r=c.updateQueue,r!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Fm(r,o)}catch(b){ft(c,c.return,b)}}break;case 27:o===null&&f&4&&ny(c);case 26:case 5:ls(r,c),o===null&&f&4&&ey(c),f&512&&so(c,c.return);break;case 12:ls(r,c);break;case 13:ls(r,c),f&4&&oy(r,c),f&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=L2.bind(null,c),nS(r,c))));break;case 22:if(f=c.memoizedState!==null||Ni,!f){o=o!==null&&o.memoizedState!==null||Et,g=Ni;var m=Et;Ni=f,(Et=o)&&!m?cs(r,c,(c.subtreeFlags&8772)!==0):ls(r,c),Ni=g,Et=m}break;case 30:break;default:ls(r,c)}}function ry(r){var o=r.alternate;o!==null&&(r.alternate=null,ry(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&mn(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var pt=null,fn=!1;function ki(r,o,c){for(c=c.child;c!==null;)ay(r,o,c),c=c.sibling}function ay(r,o,c){if(st&&typeof st.onCommitFiberUnmount=="function")try{st.onCommitFiberUnmount(ln,c)}catch{}switch(c.tag){case 26:Et||ai(c,o),ki(r,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Et||ai(c,o);var f=pt,g=fn;gs(c.type)&&(pt=c.stateNode,fn=!1),ki(r,o,c),po(c.stateNode),pt=f,fn=g;break;case 5:Et||ai(c,o);case 6:if(f=pt,g=fn,pt=null,ki(r,o,c),pt=f,fn=g,pt!==null)if(fn)try{(pt.nodeType===9?pt.body:pt.nodeName==="HTML"?pt.ownerDocument.body:pt).removeChild(c.stateNode)}catch(m){ft(c,o,m)}else try{pt.removeChild(c.stateNode)}catch(m){ft(c,o,m)}break;case 18:pt!==null&&(fn?(r=pt,qy(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),To(r)):qy(pt,c.stateNode));break;case 4:f=pt,g=fn,pt=c.stateNode.containerInfo,fn=!0,ki(r,o,c),pt=f,fn=g;break;case 0:case 11:case 14:case 15:Et||os(2,c,o),Et||os(4,c,o),ki(r,o,c);break;case 1:Et||(ai(c,o),f=c.stateNode,typeof f.componentWillUnmount=="function"&&J_(c,o,f)),ki(r,o,c);break;case 21:ki(r,o,c);break;case 22:Et=(f=Et)||c.memoizedState!==null,ki(r,o,c),Et=f;break;default:ki(r,o,c)}}function oy(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{To(r)}catch(c){ft(o,o.return,c)}}function P2(r){switch(r.tag){case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new iy),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new iy),o;default:throw Error(i(435,r.tag))}}function _h(r,o){var c=P2(r);o.forEach(function(f){var g=F2.bind(null,r,f);c.has(f)||(c.add(f),f.then(g,g))})}function bn(r,o){var c=o.deletions;if(c!==null)for(var f=0;f<c.length;f++){var g=c[f],m=r,b=o,x=b;e:for(;x!==null;){switch(x.tag){case 27:if(gs(x.type)){pt=x.stateNode,fn=!1;break e}break;case 5:pt=x.stateNode,fn=!1;break e;case 3:case 4:pt=x.stateNode.containerInfo,fn=!0;break e}x=x.return}if(pt===null)throw Error(i(160));ay(m,b,g),pt=null,fn=!1,m=g.alternate,m!==null&&(m.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)ly(o,r),o=o.sibling}var qn=null;function ly(r,o){var c=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:bn(o,r),vn(r),f&4&&(os(3,r,r.return),io(3,r),os(5,r,r.return));break;case 1:bn(o,r),vn(r),f&512&&(Et||c===null||ai(c,c.return)),f&64&&Ni&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var g=qn;if(bn(o,r),vn(r),f&512&&(Et||c===null||ai(c,c.return)),f&4){var m=c!==null?c.memoizedState:null;if(f=r.memoizedState,c===null)if(f===null)if(r.stateNode===null){e:{f=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(f){case"title":m=g.getElementsByTagName("title")[0],(!m||m[wt]||m[ke]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=g.createElement(f),g.head.insertBefore(m,g.querySelector("head > title"))),Xt(m,f,c),m[ke]=r,Rt(m),f=m;break e;case"link":var b=n0("link","href",g).get(f+(c.href||""));if(b){for(var x=0;x<b.length;x++)if(m=b[x],m.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&m.getAttribute("rel")===(c.rel==null?null:c.rel)&&m.getAttribute("title")===(c.title==null?null:c.title)&&m.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){b.splice(x,1);break t}}m=g.createElement(f),Xt(m,f,c),g.head.appendChild(m);break;case"meta":if(b=n0("meta","content",g).get(f+(c.content||""))){for(x=0;x<b.length;x++)if(m=b[x],m.getAttribute("content")===(c.content==null?null:""+c.content)&&m.getAttribute("name")===(c.name==null?null:c.name)&&m.getAttribute("property")===(c.property==null?null:c.property)&&m.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&m.getAttribute("charset")===(c.charSet==null?null:c.charSet)){b.splice(x,1);break t}}m=g.createElement(f),Xt(m,f,c),g.head.appendChild(m);break;default:throw Error(i(468,f))}m[ke]=r,Rt(m),f=m}r.stateNode=f}else i0(g,r.type,r.stateNode);else r.stateNode=t0(g,f,r.memoizedProps);else m!==f?(m===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):m.count--,f===null?i0(g,r.type,r.stateNode):t0(g,f,r.memoizedProps)):f===null&&r.stateNode!==null&&dh(r,r.memoizedProps,c.memoizedProps)}break;case 27:bn(o,r),vn(r),f&512&&(Et||c===null||ai(c,c.return)),c!==null&&f&4&&dh(r,r.memoizedProps,c.memoizedProps);break;case 5:if(bn(o,r),vn(r),f&512&&(Et||c===null||ai(c,c.return)),r.flags&32){g=r.stateNode;try{br(g,"")}catch(Z){ft(r,r.return,Z)}}f&4&&r.stateNode!=null&&(g=r.memoizedProps,dh(r,g,c!==null?c.memoizedProps:g)),f&1024&&(mh=!0);break;case 6:if(bn(o,r),vn(r),f&4){if(r.stateNode===null)throw Error(i(162));f=r.memoizedProps,c=r.stateNode;try{c.nodeValue=f}catch(Z){ft(r,r.return,Z)}}break;case 3:if(mc=null,g=qn,qn=pc(o.containerInfo),bn(o,r),qn=g,vn(r),f&4&&c!==null&&c.memoizedState.isDehydrated)try{To(o.containerInfo)}catch(Z){ft(r,r.return,Z)}mh&&(mh=!1,cy(r));break;case 4:f=qn,qn=pc(r.stateNode.containerInfo),bn(o,r),vn(r),qn=f;break;case 12:bn(o,r),vn(r);break;case 13:bn(o,r),vn(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Sh=rn()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,_h(r,f)));break;case 22:g=r.memoizedState!==null;var O=c!==null&&c.memoizedState!==null,q=Ni,te=Et;if(Ni=q||g,Et=te||O,bn(o,r),Et=te,Ni=q,vn(r),f&8192)e:for(o=r.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||O||Ni||Et||Ks(r)),c=null,o=r;;){if(o.tag===5||o.tag===26){if(c===null){O=c=o;try{if(m=O.stateNode,g)b=m.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{x=O.stateNode;var re=O.memoizedProps.style,K=re!=null&&re.hasOwnProperty("display")?re.display:null;x.style.display=K==null||typeof K=="boolean"?"":(""+K).trim()}}catch(Z){ft(O,O.return,Z)}}}else if(o.tag===6){if(c===null){O=o;try{O.stateNode.nodeValue=g?"":O.memoizedProps}catch(Z){ft(O,O.return,Z)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=r.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,_h(r,c))));break;case 19:bn(o,r),vn(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,_h(r,f)));break;case 30:break;case 21:break;default:bn(o,r),vn(r)}}function vn(r){var o=r.flags;if(o&2){try{for(var c,f=r.return;f!==null;){if(ty(f)){c=f;break}f=f.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var g=c.stateNode,m=ph(r);tc(r,m,g);break;case 5:var b=c.stateNode;c.flags&32&&(br(b,""),c.flags&=-33);var x=ph(r);tc(r,x,b);break;case 3:case 4:var O=c.stateNode.containerInfo,q=ph(r);gh(r,q,O);break;default:throw Error(i(161))}}catch(te){ft(r,r.return,te)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function cy(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;cy(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function ls(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)sy(r,o.alternate,o),o=o.sibling}function Ks(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:os(4,o,o.return),Ks(o);break;case 1:ai(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&J_(o,o.return,c),Ks(o);break;case 27:po(o.stateNode);case 26:case 5:ai(o,o.return),Ks(o);break;case 22:o.memoizedState===null&&Ks(o);break;case 30:Ks(o);break;default:Ks(o)}r=r.sibling}}function cs(r,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,g=r,m=o,b=m.flags;switch(m.tag){case 0:case 11:case 15:cs(g,m,c),io(4,m);break;case 1:if(cs(g,m,c),f=m,g=f.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(q){ft(f,f.return,q)}if(f=m,g=f.updateQueue,g!==null){var x=f.stateNode;try{var O=g.shared.hiddenCallbacks;if(O!==null)for(g.shared.hiddenCallbacks=null,g=0;g<O.length;g++)Lm(O[g],x)}catch(q){ft(f,f.return,q)}}c&&b&64&&G_(m),so(m,m.return);break;case 27:ny(m);case 26:case 5:cs(g,m,c),c&&f===null&&b&4&&ey(m),so(m,m.return);break;case 12:cs(g,m,c);break;case 13:cs(g,m,c),c&&b&4&&oy(g,m);break;case 22:m.memoizedState===null&&cs(g,m,c),so(m,m.return);break;case 30:break;default:cs(g,m,c)}o=o.sibling}}function yh(r,o){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&ja(c))}function bh(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&ja(r))}function oi(r,o,c,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)uy(r,o,c,f),o=o.sibling}function uy(r,o,c,f){var g=o.flags;switch(o.tag){case 0:case 11:case 15:oi(r,o,c,f),g&2048&&io(9,o);break;case 1:oi(r,o,c,f);break;case 3:oi(r,o,c,f),g&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&ja(r)));break;case 12:if(g&2048){oi(r,o,c,f),r=o.stateNode;try{var m=o.memoizedProps,b=m.id,x=m.onPostCommit;typeof x=="function"&&x(b,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(O){ft(o,o.return,O)}}else oi(r,o,c,f);break;case 13:oi(r,o,c,f);break;case 23:break;case 22:m=o.stateNode,b=o.alternate,o.memoizedState!==null?m._visibility&2?oi(r,o,c,f):ro(r,o):m._visibility&2?oi(r,o,c,f):(m._visibility|=2,Lr(r,o,c,f,(o.subtreeFlags&10256)!==0)),g&2048&&yh(b,o);break;case 24:oi(r,o,c,f),g&2048&&bh(o.alternate,o);break;default:oi(r,o,c,f)}}function Lr(r,o,c,f,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var m=r,b=o,x=c,O=f,q=b.flags;switch(b.tag){case 0:case 11:case 15:Lr(m,b,x,O,g),io(8,b);break;case 23:break;case 22:var te=b.stateNode;b.memoizedState!==null?te._visibility&2?Lr(m,b,x,O,g):ro(m,b):(te._visibility|=2,Lr(m,b,x,O,g)),g&&q&2048&&yh(b.alternate,b);break;case 24:Lr(m,b,x,O,g),g&&q&2048&&bh(b.alternate,b);break;default:Lr(m,b,x,O,g)}o=o.sibling}}function ro(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=r,f=o,g=f.flags;switch(f.tag){case 22:ro(c,f),g&2048&&yh(f.alternate,f);break;case 24:ro(c,f),g&2048&&bh(f.alternate,f);break;default:ro(c,f)}o=o.sibling}}var ao=8192;function Fr(r){if(r.subtreeFlags&ao)for(r=r.child;r!==null;)fy(r),r=r.sibling}function fy(r){switch(r.tag){case 26:Fr(r),r.flags&ao&&r.memoizedState!==null&&gS(qn,r.memoizedState,r.memoizedProps);break;case 5:Fr(r);break;case 3:case 4:var o=qn;qn=pc(r.stateNode.containerInfo),Fr(r),qn=o;break;case 22:r.memoizedState===null&&(o=r.alternate,o!==null&&o.memoizedState!==null?(o=ao,ao=16777216,Fr(r),ao=o):Fr(r));break;default:Fr(r)}}function hy(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function oo(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];Ft=f,py(f,r)}hy(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)dy(r),r=r.sibling}function dy(r){switch(r.tag){case 0:case 11:case 15:oo(r),r.flags&2048&&os(9,r,r.return);break;case 3:oo(r);break;case 12:oo(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,nc(r)):oo(r);break;default:oo(r)}}function nc(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];Ft=f,py(f,r)}hy(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:os(8,o,o.return),nc(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,nc(o));break;default:nc(o)}r=r.sibling}}function py(r,o){for(;Ft!==null;){var c=Ft;switch(c.tag){case 0:case 11:case 15:os(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:ja(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Ft=f;else e:for(c=r;Ft!==null;){f=Ft;var g=f.sibling,m=f.return;if(ry(f),f===c){Ft=null;break e}if(g!==null){g.return=m,Ft=g;break e}Ft=m}}}var O2={getCacheForType:function(r){var o=Qt(Nt),c=o.data.get(r);return c===void 0&&(c=r(),o.data.set(r,c)),c}},I2=typeof WeakMap=="function"?WeakMap:Map,nt=0,dt=null,je=null,qe=0,it=0,xn=null,us=!1,zr=!1,vh=!1,Di=0,bt=0,fs=0,Zs=0,xh=0,Bn=0,Vr=0,lo=null,hn=null,Th=!1,Sh=0,ic=1/0,sc=null,hs=null,Wt=0,ds=null,Hr=null,jr=0,wh=0,Ah=null,gy=null,co=0,Eh=null;function Tn(){if((nt&2)!==0&&qe!==0)return qe&-qe;if(S.T!==null){var r=Pr;return r!==0?r:Nh()}return Ce()}function my(){Bn===0&&(Bn=(qe&536870912)===0||Je?dl():536870912);var r=Dn.current;return r!==null&&(r.flags|=32),Bn}function Sn(r,o,c){(r===dt&&(it===2||it===9)||r.cancelPendingCommit!==null)&&($r(r,0),ps(r,qe,Bn,!1)),we(r,c),((nt&2)===0||r!==dt)&&(r===dt&&((nt&2)===0&&(Zs|=c),bt===4&&ps(r,qe,Bn,!1)),li(r))}function _y(r,o,c){if((nt&6)!==0)throw Error(i(327));var f=!c&&(o&124)===0&&(o&r.expiredLanes)===0||Ds(r,o),g=f?D2(r,o):Mh(r,o,!0),m=f;do{if(g===0){zr&&!f&&ps(r,o,0,!1);break}else{if(c=r.current.alternate,m&&!N2(c)){g=Mh(r,o,!1),m=!1;continue}if(g===2){if(m=o,r.errorRecoveryDisabledLanes&m)var b=0;else b=r.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){o=b;e:{var x=r;g=lo;var O=x.current.memoizedState.isDehydrated;if(O&&($r(x,b).flags|=256),b=Mh(x,b,!1),b!==2){if(vh&&!O){x.errorRecoveryDisabledLanes|=m,Zs|=m,g=4;break e}m=hn,hn=g,m!==null&&(hn===null?hn=m:hn.push.apply(hn,m))}g=b}if(m=!1,g!==2)continue}}if(g===1){$r(r,0),ps(r,o,0,!0);break}e:{switch(f=r,m=g,m){case 0:case 1:throw Error(i(345));case 4:if((o&4194048)!==o)break;case 6:ps(f,o,Bn,!us);break e;case 2:hn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((o&62914560)===o&&(g=Sh+300-rn(),10<g)){if(ps(f,o,Bn,!us),Ki(f,0,!0)!==0)break e;f.timeoutHandle=Xy(yy.bind(null,f,c,hn,sc,Th,o,Bn,Zs,Vr,us,m,2,-0,0),g);break e}yy(f,c,hn,sc,Th,o,Bn,Zs,Vr,us,m,0,-0,0)}}break}while(!0);li(r)}function yy(r,o,c,f,g,m,b,x,O,q,te,re,K,Z){if(r.timeoutHandle=-1,re=o.subtreeFlags,(re&8192||(re&16785408)===16785408)&&(_o={stylesheets:null,count:0,unsuspend:pS},fy(o),re=mS(),re!==null)){r.cancelPendingCommit=re(Ay.bind(null,r,o,m,c,f,g,b,x,O,te,1,K,Z)),ps(r,m,b,!q);return}Ay(r,o,m,c,f,g,b,x,O)}function N2(r){for(var o=r;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var g=c[f],m=g.getSnapshot;g=g.value;try{if(!_n(m(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ps(r,o,c,f){o&=~xh,o&=~Zs,r.suspendedLanes|=o,r.pingedLanes&=~o,f&&(r.warmLanes|=o),f=r.expirationTimes;for(var g=o;0<g;){var m=31-Tt(g),b=1<<m;f[m]=-1,g&=~b}c!==0&&pe(r,c,o)}function rc(){return(nt&6)===0?(uo(0),!1):!0}function Rh(){if(je!==null){if(it===0)var r=je.return;else r=je,Ri=$s=null,$f(r),Br=null,eo=0,r=je;for(;r!==null;)Q_(r.alternate,r),r=r.return;je=null}}function $r(r,o){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,Q2(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),Rh(),dt=r,je=c=wi(r.current,null),qe=o,it=0,xn=null,us=!1,zr=Ds(r,o),vh=!1,Vr=Bn=xh=Zs=fs=bt=0,hn=lo=null,Th=!1,(o&8)!==0&&(o|=o&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=o;0<f;){var g=31-Tt(f),m=1<<g;o|=r[g],f&=~m}return Di=o,Rl(),c}function by(r,o){Ve=null,S.H=Xl,o===Wa||o===Bl?(o=Bm(),it=3):o===Nm?(o=Bm(),it=4):it=o===U_?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,xn=o,je===null&&(bt=1,Ql(r,On(o,r.current)))}function vy(){var r=S.H;return S.H=Xl,r===null?Xl:r}function xy(){var r=S.A;return S.A=O2,r}function Ch(){bt=4,us||(qe&4194048)!==qe&&Dn.current!==null||(zr=!0),(fs&134217727)===0&&(Zs&134217727)===0||dt===null||ps(dt,qe,Bn,!1)}function Mh(r,o,c){var f=nt;nt|=2;var g=vy(),m=xy();(dt!==r||qe!==o)&&(sc=null,$r(r,o)),o=!1;var b=bt;e:do try{if(it!==0&&je!==null){var x=je,O=xn;switch(it){case 8:Rh(),b=6;break e;case 3:case 2:case 9:case 6:Dn.current===null&&(o=!0);var q=it;if(it=0,xn=null,Wr(r,x,O,q),c&&zr){b=0;break e}break;default:q=it,it=0,xn=null,Wr(r,x,O,q)}}k2(),b=bt;break}catch(te){by(r,te)}while(!0);return o&&r.shellSuspendCounter++,Ri=$s=null,nt=f,S.H=g,S.A=m,je===null&&(dt=null,qe=0,Rl()),b}function k2(){for(;je!==null;)Ty(je)}function D2(r,o){var c=nt;nt|=2;var f=vy(),g=xy();dt!==r||qe!==o?(sc=null,ic=rn()+500,$r(r,o)):zr=Ds(r,o);e:do try{if(it!==0&&je!==null){o=je;var m=xn;t:switch(it){case 1:it=0,xn=null,Wr(r,o,m,1);break;case 2:case 9:if(km(m)){it=0,xn=null,Sy(o);break}o=function(){it!==2&&it!==9||dt!==r||(it=7),li(r)},m.then(o,o);break e;case 3:it=7;break e;case 4:it=5;break e;case 7:km(m)?(it=0,xn=null,Sy(o)):(it=0,xn=null,Wr(r,o,m,7));break;case 5:var b=null;switch(je.tag){case 26:b=je.memoizedState;case 5:case 27:var x=je;if(!b||s0(b)){it=0,xn=null;var O=x.sibling;if(O!==null)je=O;else{var q=x.return;q!==null?(je=q,ac(q)):je=null}break t}}it=0,xn=null,Wr(r,o,m,5);break;case 6:it=0,xn=null,Wr(r,o,m,6);break;case 8:Rh(),bt=6;break e;default:throw Error(i(462))}}B2();break}catch(te){by(r,te)}while(!0);return Ri=$s=null,S.H=f,S.A=g,nt=c,je!==null?0:(dt=null,qe=0,Rl(),bt)}function B2(){for(;je!==null&&!Xe();)Ty(je)}function Ty(r){var o=K_(r.alternate,r,Di);r.memoizedProps=r.pendingProps,o===null?ac(r):je=o}function Sy(r){var o=r,c=o.alternate;switch(o.tag){case 15:case 0:o=j_(c,o,o.pendingProps,o.type,void 0,qe);break;case 11:o=j_(c,o,o.pendingProps,o.type.render,o.ref,qe);break;case 5:$f(o);default:Q_(c,o),o=je=wm(o,Di),o=K_(c,o,Di)}r.memoizedProps=r.pendingProps,o===null?ac(r):je=o}function Wr(r,o,c,f){Ri=$s=null,$f(o),Br=null,eo=0;var g=o.return;try{if(A2(r,g,o,c,qe)){bt=1,Ql(r,On(c,r.current)),je=null;return}}catch(m){if(g!==null)throw je=g,m;bt=1,Ql(r,On(c,r.current)),je=null;return}o.flags&32768?(Je||f===1?r=!0:zr||(qe&536870912)!==0?r=!1:(us=r=!0,(f===2||f===9||f===3||f===6)&&(f=Dn.current,f!==null&&f.tag===13&&(f.flags|=16384))),wy(o,r)):ac(o)}function ac(r){var o=r;do{if((o.flags&32768)!==0){wy(o,us);return}r=o.return;var c=R2(o.alternate,o,Di);if(c!==null){je=c;return}if(o=o.sibling,o!==null){je=o;return}je=o=r}while(o!==null);bt===0&&(bt=5)}function wy(r,o){do{var c=C2(r.alternate,r);if(c!==null){c.flags&=32767,je=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(r=r.sibling,r!==null)){je=r;return}je=r=c}while(r!==null);bt=6,je=null}function Ay(r,o,c,f,g,m,b,x,O){r.cancelPendingCommit=null;do oc();while(Wt!==0);if((nt&6)!==0)throw Error(i(327));if(o!==null){if(o===r.current)throw Error(i(177));if(m=o.lanes|o.childLanes,m|=bf,ye(r,c,m,b,x,O),r===dt&&(je=dt=null,qe=0),Hr=o,ds=r,jr=c,wh=m,Ah=g,gy=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,z2(Yi,function(){return Py(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=S.T,S.T=null,g=I.p,I.p=2,b=nt,nt|=4;try{M2(r,o,c)}finally{nt=b,I.p=g,S.T=f}}Wt=1,Ey(),Ry(),Cy()}}function Ey(){if(Wt===1){Wt=0;var r=ds,o=Hr,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=S.T,S.T=null;var f=I.p;I.p=2;var g=nt;nt|=4;try{ly(o,r);var m=Vh,b=pm(r.containerInfo),x=m.focusedElem,O=m.selectionRange;if(b!==x&&x&&x.ownerDocument&&dm(x.ownerDocument.documentElement,x)){if(O!==null&&pf(x)){var q=O.start,te=O.end;if(te===void 0&&(te=q),"selectionStart"in x)x.selectionStart=q,x.selectionEnd=Math.min(te,x.value.length);else{var re=x.ownerDocument||document,K=re&&re.defaultView||window;if(K.getSelection){var Z=K.getSelection(),Ne=x.textContent.length,Pe=Math.min(O.start,Ne),ot=O.end===void 0?Pe:Math.min(O.end,Ne);!Z.extend&&Pe>ot&&(b=ot,ot=Pe,Pe=b);var j=hm(x,Pe),B=hm(x,ot);if(j&&B&&(Z.rangeCount!==1||Z.anchorNode!==j.node||Z.anchorOffset!==j.offset||Z.focusNode!==B.node||Z.focusOffset!==B.offset)){var Y=re.createRange();Y.setStart(j.node,j.offset),Z.removeAllRanges(),Pe>ot?(Z.addRange(Y),Z.extend(B.node,B.offset)):(Y.setEnd(B.node,B.offset),Z.addRange(Y))}}}}for(re=[],Z=x;Z=Z.parentNode;)Z.nodeType===1&&re.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<re.length;x++){var ie=re[x];ie.element.scrollLeft=ie.left,ie.element.scrollTop=ie.top}}bc=!!zh,Vh=zh=null}finally{nt=g,I.p=f,S.T=c}}r.current=o,Wt=2}}function Ry(){if(Wt===2){Wt=0;var r=ds,o=Hr,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=S.T,S.T=null;var f=I.p;I.p=2;var g=nt;nt|=4;try{sy(r,o.alternate,o)}finally{nt=g,I.p=f,S.T=c}}Wt=3}}function Cy(){if(Wt===4||Wt===3){Wt=0,Ye();var r=ds,o=Hr,c=jr,f=gy;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Wt=5:(Wt=0,Hr=ds=null,My(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(hs=null),be(c),o=o.stateNode,st&&typeof st.onCommitFiberRoot=="function")try{st.onCommitFiberRoot(ln,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=S.T,g=I.p,I.p=2,S.T=null;try{for(var m=r.onRecoverableError,b=0;b<f.length;b++){var x=f[b];m(x.value,{componentStack:x.stack})}}finally{S.T=o,I.p=g}}(jr&3)!==0&&oc(),li(r),g=r.pendingLanes,(c&4194090)!==0&&(g&42)!==0?r===Eh?co++:(co=0,Eh=r):co=0,uo(0)}}function My(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,ja(o)))}function oc(r){return Ey(),Ry(),Cy(),Py()}function Py(){if(Wt!==5)return!1;var r=ds,o=wh;wh=0;var c=be(jr),f=S.T,g=I.p;try{I.p=32>c?32:c,S.T=null,c=Ah,Ah=null;var m=ds,b=jr;if(Wt=0,Hr=ds=null,jr=0,(nt&6)!==0)throw Error(i(331));var x=nt;if(nt|=4,dy(m.current),uy(m,m.current,b,c),nt=x,uo(0,!1),st&&typeof st.onPostCommitFiberRoot=="function")try{st.onPostCommitFiberRoot(ln,m)}catch{}return!0}finally{I.p=g,S.T=f,My(r,o)}}function Oy(r,o,c){o=On(c,o),o=sh(r.stateNode,o,2),r=is(r,o,2),r!==null&&(we(r,2),li(r))}function ft(r,o,c){if(r.tag===3)Oy(r,r,c);else for(;o!==null;){if(o.tag===3){Oy(o,r,c);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(hs===null||!hs.has(f))){r=On(c,r),c=D_(2),f=is(o,c,2),f!==null&&(B_(c,f,o,r),we(f,2),li(f));break}}o=o.return}}function Ph(r,o,c){var f=r.pingCache;if(f===null){f=r.pingCache=new I2;var g=new Set;f.set(o,g)}else g=f.get(o),g===void 0&&(g=new Set,f.set(o,g));g.has(c)||(vh=!0,g.add(c),r=U2.bind(null,r,o,c),o.then(r,r))}function U2(r,o,c){var f=r.pingCache;f!==null&&f.delete(o),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,dt===r&&(qe&c)===c&&(bt===4||bt===3&&(qe&62914560)===qe&&300>rn()-Sh?(nt&2)===0&&$r(r,0):xh|=c,Vr===qe&&(Vr=0)),li(r)}function Iy(r,o){o===0&&(o=vi()),r=Er(r,o),r!==null&&(we(r,o),li(r))}function L2(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),Iy(r,c)}function F2(r,o){var c=0;switch(r.tag){case 13:var f=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(o),Iy(r,c)}function z2(r,o){return pn(r,o)}var lc=null,Xr=null,Oh=!1,cc=!1,Ih=!1,Qs=0;function li(r){r!==Xr&&r.next===null&&(Xr===null?lc=Xr=r:Xr=Xr.next=r),cc=!0,Oh||(Oh=!0,H2())}function uo(r,o){if(!Ih&&cc){Ih=!0;do for(var c=!1,f=lc;f!==null;){if(r!==0){var g=f.pendingLanes;if(g===0)var m=0;else{var b=f.suspendedLanes,x=f.pingedLanes;m=(1<<31-Tt(42|r)+1)-1,m&=g&~(b&~x),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(c=!0,By(f,m))}else m=qe,m=Ki(f,f===dt?m:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(m&3)===0||Ds(f,m)||(c=!0,By(f,m));f=f.next}while(c);Ih=!1}}function V2(){Ny()}function Ny(){cc=Oh=!1;var r=0;Qs!==0&&(Z2()&&(r=Qs),Qs=0);for(var o=rn(),c=null,f=lc;f!==null;){var g=f.next,m=ky(f,o);m===0?(f.next=null,c===null?lc=g:c.next=g,g===null&&(Xr=c)):(c=f,(r!==0||(m&3)!==0)&&(cc=!0)),f=g}uo(r)}function ky(r,o){for(var c=r.suspendedLanes,f=r.pingedLanes,g=r.expirationTimes,m=r.pendingLanes&-62914561;0<m;){var b=31-Tt(m),x=1<<b,O=g[b];O===-1?((x&c)===0||(x&f)!==0)&&(g[b]=hl(x,o)):O<=o&&(r.expiredLanes|=x),m&=~x}if(o=dt,c=qe,c=Ki(r,r===o?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,c===0||r===o&&(it===2||it===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&ii(f),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Ds(r,c)){if(o=c&-c,o===r.callbackPriority)return o;switch(f!==null&&ii(f),be(c)){case 2:case 8:c=Ma;break;case 32:c=Yi;break;case 268435456:c=yi;break;default:c=Yi}return f=Dy.bind(null,r),c=pn(c,f),r.callbackPriority=o,r.callbackNode=c,o}return f!==null&&f!==null&&ii(f),r.callbackPriority=2,r.callbackNode=null,2}function Dy(r,o){if(Wt!==0&&Wt!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(oc()&&r.callbackNode!==c)return null;var f=qe;return f=Ki(r,r===dt?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(_y(r,f,o),ky(r,rn()),r.callbackNode!=null&&r.callbackNode===c?Dy.bind(null,r):null)}function By(r,o){if(oc())return null;_y(r,o,!0)}function H2(){G2(function(){(nt&6)!==0?pn(Xi,V2):Ny()})}function Nh(){return Qs===0&&(Qs=dl()),Qs}function Uy(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:vl(""+r)}function Ly(r,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,r.id&&c.setAttribute("form",r.id),o.parentNode.insertBefore(c,o),r=new FormData(r),c.parentNode.removeChild(c),r}function j2(r,o,c,f,g){if(o==="submit"&&c&&c.stateNode===g){var m=Uy((g[St]||null).action),b=f.submitter;b&&(o=(o=b[St]||null)?Uy(o.formAction):b.getAttribute("formAction"),o!==null&&(m=o,b=null));var x=new wl("action","action",null,f,g);r.push({event:x,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Qs!==0){var O=b?Ly(g,b):new FormData(g);Jf(c,{pending:!0,data:O,method:g.method,action:m},null,O)}}else typeof m=="function"&&(x.preventDefault(),O=b?Ly(g,b):new FormData(g),Jf(c,{pending:!0,data:O,method:g.method,action:m},m,O))},currentTarget:g}]})}}for(var kh=0;kh<yf.length;kh++){var Dh=yf[kh],$2=Dh.toLowerCase(),W2=Dh[0].toUpperCase()+Dh.slice(1);Yn($2,"on"+W2)}Yn(_m,"onAnimationEnd"),Yn(ym,"onAnimationIteration"),Yn(bm,"onAnimationStart"),Yn("dblclick","onDoubleClick"),Yn("focusin","onFocus"),Yn("focusout","onBlur"),Yn(l2,"onTransitionRun"),Yn(c2,"onTransitionStart"),Yn(u2,"onTransitionCancel"),Yn(vm,"onTransitionEnd"),Gi("onMouseEnter",["mouseout","mouseover"]),Gi("onMouseLeave",["mouseout","mouseover"]),Gi("onPointerEnter",["pointerout","pointerover"]),Gi("onPointerLeave",["pointerout","pointerover"]),xi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xi("onBeforeInput",["compositionend","keypress","textInput","paste"]),xi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),X2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fo));function Fy(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var f=r[c],g=f.event;f=f.listeners;e:{var m=void 0;if(o)for(var b=f.length-1;0<=b;b--){var x=f[b],O=x.instance,q=x.currentTarget;if(x=x.listener,O!==m&&g.isPropagationStopped())break e;m=x,g.currentTarget=q;try{m(g)}catch(te){Zl(te)}g.currentTarget=null,m=O}else for(b=0;b<f.length;b++){if(x=f[b],O=x.instance,q=x.currentTarget,x=x.listener,O!==m&&g.isPropagationStopped())break e;m=x,g.currentTarget=q;try{m(g)}catch(te){Zl(te)}g.currentTarget=null,m=O}}}}function $e(r,o){var c=o[Ht];c===void 0&&(c=o[Ht]=new Set);var f=r+"__bubble";c.has(f)||(zy(o,r,2,!1),c.add(f))}function Bh(r,o,c){var f=0;o&&(f|=4),zy(c,r,f,o)}var uc="_reactListening"+Math.random().toString(36).slice(2);function Uh(r){if(!r[uc]){r[uc]=!0,pl.forEach(function(c){c!=="selectionchange"&&(X2.has(c)||Bh(c,!1,r),Bh(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[uc]||(o[uc]=!0,Bh("selectionchange",!1,o))}}function zy(r,o,c,f){switch(u0(o)){case 2:var g=bS;break;case 8:g=vS;break;default:g=Qh}c=g.bind(null,o,c,r),g=void 0,!rf||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),f?g!==void 0?r.addEventListener(o,c,{capture:!0,passive:g}):r.addEventListener(o,c,!0):g!==void 0?r.addEventListener(o,c,{passive:g}):r.addEventListener(o,c,!1)}function Lh(r,o,c,f,g){var m=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var b=f.tag;if(b===3||b===4){var x=f.stateNode.containerInfo;if(x===g)break;if(b===4)for(b=f.return;b!==null;){var O=b.tag;if((O===3||O===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;x!==null;){if(b=Zt(x),b===null)return;if(O=b.tag,O===5||O===6||O===26||O===27){f=m=b;continue e}x=x.parentNode}}f=f.return}Yg(function(){var q=m,te=nf(c),re=[];e:{var K=xm.get(r);if(K!==void 0){var Z=wl,Ne=r;switch(r){case"keypress":if(Tl(c)===0)break e;case"keydown":case"keyup":Z=z1;break;case"focusin":Ne="focus",Z=cf;break;case"focusout":Ne="blur",Z=cf;break;case"beforeblur":case"afterblur":Z=cf;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Zg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=C1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=j1;break;case _m:case ym:case bm:Z=O1;break;case vm:Z=W1;break;case"scroll":case"scrollend":Z=E1;break;case"wheel":Z=Y1;break;case"copy":case"cut":case"paste":Z=N1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Gg;break;case"toggle":case"beforetoggle":Z=K1}var Pe=(o&4)!==0,ot=!Pe&&(r==="scroll"||r==="scrollend"),j=Pe?K!==null?K+"Capture":null:K;Pe=[];for(var B=q,Y;B!==null;){var ie=B;if(Y=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||Y===null||j===null||(ie=Pa(B,j),ie!=null&&Pe.push(ho(B,ie,Y))),ot)break;B=B.return}0<Pe.length&&(K=new Z(K,Ne,null,c,te),re.push({event:K,listeners:Pe}))}}if((o&7)===0){e:{if(K=r==="mouseover"||r==="pointerover",Z=r==="mouseout"||r==="pointerout",K&&c!==tf&&(Ne=c.relatedTarget||c.fromElement)&&(Zt(Ne)||Ne[Ze]))break e;if((Z||K)&&(K=te.window===te?te:(K=te.ownerDocument)?K.defaultView||K.parentWindow:window,Z?(Ne=c.relatedTarget||c.toElement,Z=q,Ne=Ne?Zt(Ne):null,Ne!==null&&(ot=a(Ne),Pe=Ne.tag,Ne!==ot||Pe!==5&&Pe!==27&&Pe!==6)&&(Ne=null)):(Z=null,Ne=q),Z!==Ne)){if(Pe=Zg,ie="onMouseLeave",j="onMouseEnter",B="mouse",(r==="pointerout"||r==="pointerover")&&(Pe=Gg,ie="onPointerLeave",j="onPointerEnter",B="pointer"),ot=Z==null?K:Cn(Z),Y=Ne==null?K:Cn(Ne),K=new Pe(ie,B+"leave",Z,c,te),K.target=ot,K.relatedTarget=Y,ie=null,Zt(te)===q&&(Pe=new Pe(j,B+"enter",Ne,c,te),Pe.target=Y,Pe.relatedTarget=ot,ie=Pe),ot=ie,Z&&Ne)t:{for(Pe=Z,j=Ne,B=0,Y=Pe;Y;Y=Yr(Y))B++;for(Y=0,ie=j;ie;ie=Yr(ie))Y++;for(;0<B-Y;)Pe=Yr(Pe),B--;for(;0<Y-B;)j=Yr(j),Y--;for(;B--;){if(Pe===j||j!==null&&Pe===j.alternate)break t;Pe=Yr(Pe),j=Yr(j)}Pe=null}else Pe=null;Z!==null&&Vy(re,K,Z,Pe,!1),Ne!==null&&ot!==null&&Vy(re,ot,Ne,Pe,!0)}}e:{if(K=q?Cn(q):window,Z=K.nodeName&&K.nodeName.toLowerCase(),Z==="select"||Z==="input"&&K.type==="file")var ve=am;else if(sm(K))if(om)ve=r2;else{ve=i2;var He=n2}else Z=K.nodeName,!Z||Z.toLowerCase()!=="input"||K.type!=="checkbox"&&K.type!=="radio"?q&&ef(q.elementType)&&(ve=am):ve=s2;if(ve&&(ve=ve(r,q))){rm(re,ve,c,te);break e}He&&He(r,K,q),r==="focusout"&&q&&K.type==="number"&&q.memoizedProps.value!=null&&Ju(K,"number",K.value)}switch(He=q?Cn(q):window,r){case"focusin":(sm(He)||He.contentEditable==="true")&&(Sr=He,gf=q,La=null);break;case"focusout":La=gf=Sr=null;break;case"mousedown":mf=!0;break;case"contextmenu":case"mouseup":case"dragend":mf=!1,gm(re,c,te);break;case"selectionchange":if(o2)break;case"keydown":case"keyup":gm(re,c,te)}var Ae;if(ff)e:{switch(r){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else Tr?nm(r,c)&&(Oe="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Oe="onCompositionStart");Oe&&(Jg&&c.locale!=="ko"&&(Tr||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&Tr&&(Ae=qg()):(Ji=te,af="value"in Ji?Ji.value:Ji.textContent,Tr=!0)),He=fc(q,Oe),0<He.length&&(Oe=new Qg(Oe,r,null,c,te),re.push({event:Oe,listeners:He}),Ae?Oe.data=Ae:(Ae=im(c),Ae!==null&&(Oe.data=Ae)))),(Ae=Q1?G1(r,c):J1(r,c))&&(Oe=fc(q,"onBeforeInput"),0<Oe.length&&(He=new Qg("onBeforeInput","beforeinput",null,c,te),re.push({event:He,listeners:Oe}),He.data=Ae)),j2(re,r,q,c,te)}Fy(re,o)})}function ho(r,o,c){return{instance:r,listener:o,currentTarget:c}}function fc(r,o){for(var c=o+"Capture",f=[];r!==null;){var g=r,m=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||m===null||(g=Pa(r,c),g!=null&&f.unshift(ho(r,g,m)),g=Pa(r,o),g!=null&&f.push(ho(r,g,m))),r.tag===3)return f;r=r.return}return[]}function Yr(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Vy(r,o,c,f,g){for(var m=o._reactName,b=[];c!==null&&c!==f;){var x=c,O=x.alternate,q=x.stateNode;if(x=x.tag,O!==null&&O===f)break;x!==5&&x!==26&&x!==27||q===null||(O=q,g?(q=Pa(c,m),q!=null&&b.unshift(ho(c,q,O))):g||(q=Pa(c,m),q!=null&&b.push(ho(c,q,O)))),c=c.return}b.length!==0&&r.push({event:o,listeners:b})}var Y2=/\r\n?/g,q2=/\u0000|\uFFFD/g;function Hy(r){return(typeof r=="string"?r:""+r).replace(Y2,`
`).replace(q2,"")}function jy(r,o){return o=Hy(o),Hy(r)===o}function hc(){}function at(r,o,c,f,g,m){switch(c){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||br(r,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&br(r,""+f);break;case"className":_l(r,"class",f);break;case"tabIndex":_l(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":_l(r,c,f);break;case"style":Wg(r,f,m);break;case"data":if(o!=="object"){_l(r,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||c!=="href")){r.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(c);break}f=vl(""+f),r.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(c==="formAction"?(o!=="input"&&at(r,o,"name",g.name,g,null),at(r,o,"formEncType",g.formEncType,g,null),at(r,o,"formMethod",g.formMethod,g,null),at(r,o,"formTarget",g.formTarget,g,null)):(at(r,o,"encType",g.encType,g,null),at(r,o,"method",g.method,g,null),at(r,o,"target",g.target,g,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(c);break}f=vl(""+f),r.setAttribute(c,f);break;case"onClick":f!=null&&(r.onclick=hc);break;case"onScroll":f!=null&&$e("scroll",r);break;case"onScrollEnd":f!=null&&$e("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}c=vl(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,""+f):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":f===!0?r.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,f):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(c,f):r.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(c):r.setAttribute(c,f);break;case"popover":$e("beforetoggle",r),$e("toggle",r),ml(r,"popover",f);break;case"xlinkActuate":Ti(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Ti(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Ti(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Ti(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Ti(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Ti(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Ti(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Ti(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Ti(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":ml(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=w1.get(c)||c,ml(r,c,f))}}function Fh(r,o,c,f,g,m){switch(c){case"style":Wg(r,f,m);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"children":typeof f=="string"?br(r,f):(typeof f=="number"||typeof f=="bigint")&&br(r,""+f);break;case"onScroll":f!=null&&$e("scroll",r);break;case"onScrollEnd":f!=null&&$e("scrollend",r);break;case"onClick":f!=null&&(r.onclick=hc);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!gl.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),m=r[St]||null,m=m!=null?m[c]:null,typeof m=="function"&&r.removeEventListener(o,m,g),typeof f=="function")){typeof m!="function"&&m!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(o,f,g);break e}c in r?r[c]=f:f===!0?r.setAttribute(c,""):ml(r,c,f)}}}function Xt(r,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$e("error",r),$e("load",r);var f=!1,g=!1,m;for(m in c)if(c.hasOwnProperty(m)){var b=c[m];if(b!=null)switch(m){case"src":f=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:at(r,o,m,b,c,null)}}g&&at(r,o,"srcSet",c.srcSet,c,null),f&&at(r,o,"src",c.src,c,null);return;case"input":$e("invalid",r);var x=m=b=g=null,O=null,q=null;for(f in c)if(c.hasOwnProperty(f)){var te=c[f];if(te!=null)switch(f){case"name":g=te;break;case"type":b=te;break;case"checked":O=te;break;case"defaultChecked":q=te;break;case"value":m=te;break;case"defaultValue":x=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(i(137,o));break;default:at(r,o,f,te,c,null)}}Vg(r,m,x,O,q,b,g,!1),yl(r);return;case"select":$e("invalid",r),f=b=m=null;for(g in c)if(c.hasOwnProperty(g)&&(x=c[g],x!=null))switch(g){case"value":m=x;break;case"defaultValue":b=x;break;case"multiple":f=x;default:at(r,o,g,x,c,null)}o=m,c=b,r.multiple=!!f,o!=null?yr(r,!!f,o,!1):c!=null&&yr(r,!!f,c,!0);return;case"textarea":$e("invalid",r),m=g=f=null;for(b in c)if(c.hasOwnProperty(b)&&(x=c[b],x!=null))switch(b){case"value":f=x;break;case"defaultValue":g=x;break;case"children":m=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:at(r,o,b,x,c,null)}jg(r,f,g,m),yl(r);return;case"option":for(O in c)if(c.hasOwnProperty(O)&&(f=c[O],f!=null))switch(O){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:at(r,o,O,f,c,null)}return;case"dialog":$e("beforetoggle",r),$e("toggle",r),$e("cancel",r),$e("close",r);break;case"iframe":case"object":$e("load",r);break;case"video":case"audio":for(f=0;f<fo.length;f++)$e(fo[f],r);break;case"image":$e("error",r),$e("load",r);break;case"details":$e("toggle",r);break;case"embed":case"source":case"link":$e("error",r),$e("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in c)if(c.hasOwnProperty(q)&&(f=c[q],f!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:at(r,o,q,f,c,null)}return;default:if(ef(o)){for(te in c)c.hasOwnProperty(te)&&(f=c[te],f!==void 0&&Fh(r,o,te,f,c,void 0));return}}for(x in c)c.hasOwnProperty(x)&&(f=c[x],f!=null&&at(r,o,x,f,c,null))}function K2(r,o,c,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,m=null,b=null,x=null,O=null,q=null,te=null;for(Z in c){var re=c[Z];if(c.hasOwnProperty(Z)&&re!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":O=re;default:f.hasOwnProperty(Z)||at(r,o,Z,null,f,re)}}for(var K in f){var Z=f[K];if(re=c[K],f.hasOwnProperty(K)&&(Z!=null||re!=null))switch(K){case"type":m=Z;break;case"name":g=Z;break;case"checked":q=Z;break;case"defaultChecked":te=Z;break;case"value":b=Z;break;case"defaultValue":x=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,o));break;default:Z!==re&&at(r,o,K,Z,f,re)}}Gu(r,b,x,O,q,te,m,g);return;case"select":Z=b=x=K=null;for(m in c)if(O=c[m],c.hasOwnProperty(m)&&O!=null)switch(m){case"value":break;case"multiple":Z=O;default:f.hasOwnProperty(m)||at(r,o,m,null,f,O)}for(g in f)if(m=f[g],O=c[g],f.hasOwnProperty(g)&&(m!=null||O!=null))switch(g){case"value":K=m;break;case"defaultValue":x=m;break;case"multiple":b=m;default:m!==O&&at(r,o,g,m,f,O)}o=x,c=b,f=Z,K!=null?yr(r,!!c,K,!1):!!f!=!!c&&(o!=null?yr(r,!!c,o,!0):yr(r,!!c,c?[]:"",!1));return;case"textarea":Z=K=null;for(x in c)if(g=c[x],c.hasOwnProperty(x)&&g!=null&&!f.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:at(r,o,x,null,f,g)}for(b in f)if(g=f[b],m=c[b],f.hasOwnProperty(b)&&(g!=null||m!=null))switch(b){case"value":K=g;break;case"defaultValue":Z=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==m&&at(r,o,b,g,f,m)}Hg(r,K,Z);return;case"option":for(var Ne in c)if(K=c[Ne],c.hasOwnProperty(Ne)&&K!=null&&!f.hasOwnProperty(Ne))switch(Ne){case"selected":r.selected=!1;break;default:at(r,o,Ne,null,f,K)}for(O in f)if(K=f[O],Z=c[O],f.hasOwnProperty(O)&&K!==Z&&(K!=null||Z!=null))switch(O){case"selected":r.selected=K&&typeof K!="function"&&typeof K!="symbol";break;default:at(r,o,O,K,f,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pe in c)K=c[Pe],c.hasOwnProperty(Pe)&&K!=null&&!f.hasOwnProperty(Pe)&&at(r,o,Pe,null,f,K);for(q in f)if(K=f[q],Z=c[q],f.hasOwnProperty(q)&&K!==Z&&(K!=null||Z!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(i(137,o));break;default:at(r,o,q,K,f,Z)}return;default:if(ef(o)){for(var ot in c)K=c[ot],c.hasOwnProperty(ot)&&K!==void 0&&!f.hasOwnProperty(ot)&&Fh(r,o,ot,void 0,f,K);for(te in f)K=f[te],Z=c[te],!f.hasOwnProperty(te)||K===Z||K===void 0&&Z===void 0||Fh(r,o,te,K,f,Z);return}}for(var j in c)K=c[j],c.hasOwnProperty(j)&&K!=null&&!f.hasOwnProperty(j)&&at(r,o,j,null,f,K);for(re in f)K=f[re],Z=c[re],!f.hasOwnProperty(re)||K===Z||K==null&&Z==null||at(r,o,re,K,f,Z)}var zh=null,Vh=null;function dc(r){return r.nodeType===9?r:r.ownerDocument}function $y(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Wy(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function Hh(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var jh=null;function Z2(){var r=window.event;return r&&r.type==="popstate"?r===jh?!1:(jh=r,!0):(jh=null,!1)}var Xy=typeof setTimeout=="function"?setTimeout:void 0,Q2=typeof clearTimeout=="function"?clearTimeout:void 0,Yy=typeof Promise=="function"?Promise:void 0,G2=typeof queueMicrotask=="function"?queueMicrotask:typeof Yy<"u"?function(r){return Yy.resolve(null).then(r).catch(J2)}:Xy;function J2(r){setTimeout(function(){throw r})}function gs(r){return r==="head"}function qy(r,o){var c=o,f=0,g=0;do{var m=c.nextSibling;if(r.removeChild(c),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(0<f&&8>f){c=f;var b=r.ownerDocument;if(c&1&&po(b.documentElement),c&2&&po(b.body),c&4)for(c=b.head,po(c),b=c.firstChild;b;){var x=b.nextSibling,O=b.nodeName;b[wt]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&b.rel.toLowerCase()==="stylesheet"||c.removeChild(b),b=x}}if(g===0){r.removeChild(m),To(o);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:f=c.charCodeAt(0)-48;else f=0;c=m}while(c);To(o)}function $h(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":$h(c),mn(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function eS(r,o,c,f){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[wt])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(m=r.getAttribute("rel"),m==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(m!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(m=r.getAttribute("src"),(m!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&m&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var m=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===m)return r}else return r;if(r=Kn(r.nextSibling),r===null)break}return null}function tS(r,o,c){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=Kn(r.nextSibling),r===null))return null;return r}function Wh(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function nS(r,o){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")o();else{var f=function(){o(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function Kn(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return r}var Xh=null;function Ky(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return r;o--}else c==="/$"&&o++}r=r.previousSibling}return null}function Zy(r,o,c){switch(o=dc(c),r){case"html":if(r=o.documentElement,!r)throw Error(i(452));return r;case"head":if(r=o.head,!r)throw Error(i(453));return r;case"body":if(r=o.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function po(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);mn(r)}var Un=new Map,Qy=new Set;function pc(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Bi=I.d;I.d={f:iS,r:sS,D:rS,C:aS,L:oS,m:lS,X:uS,S:cS,M:fS};function iS(){var r=Bi.f(),o=rc();return r||o}function sS(r){var o=Zi(r);o!==null&&o.tag===5&&o.type==="form"?__(o):Bi.r(r)}var qr=typeof document>"u"?null:document;function Gy(r,o,c){var f=qr;if(f&&typeof o=="string"&&o){var g=Pn(o);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),Qy.has(g)||(Qy.add(g),r={rel:r,crossOrigin:c,href:o},f.querySelector(g)===null&&(o=f.createElement("link"),Xt(o,"link",r),Rt(o),f.head.appendChild(o)))}}function rS(r){Bi.D(r),Gy("dns-prefetch",r,null)}function aS(r,o){Bi.C(r,o),Gy("preconnect",r,o)}function oS(r,o,c){Bi.L(r,o,c);var f=qr;if(f&&r&&o){var g='link[rel="preload"][as="'+Pn(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+Pn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+Pn(c.imageSizes)+'"]')):g+='[href="'+Pn(r)+'"]';var m=g;switch(o){case"style":m=Kr(r);break;case"script":m=Zr(r)}Un.has(m)||(r=p({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:r,as:o},c),Un.set(m,r),f.querySelector(g)!==null||o==="style"&&f.querySelector(go(m))||o==="script"&&f.querySelector(mo(m))||(o=f.createElement("link"),Xt(o,"link",r),Rt(o),f.head.appendChild(o)))}}function lS(r,o){Bi.m(r,o);var c=qr;if(c&&r){var f=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+Pn(f)+'"][href="'+Pn(r)+'"]',m=g;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Zr(r)}if(!Un.has(m)&&(r=p({rel:"modulepreload",href:r},o),Un.set(m,r),c.querySelector(g)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(mo(m)))return}f=c.createElement("link"),Xt(f,"link",r),Rt(f),c.head.appendChild(f)}}}function cS(r,o,c){Bi.S(r,o,c);var f=qr;if(f&&r){var g=Qi(f).hoistableStyles,m=Kr(r);o=o||"default";var b=g.get(m);if(!b){var x={loading:0,preload:null};if(b=f.querySelector(go(m)))x.loading=5;else{r=p({rel:"stylesheet",href:r,"data-precedence":o},c),(c=Un.get(m))&&Yh(r,c);var O=b=f.createElement("link");Rt(O),Xt(O,"link",r),O._p=new Promise(function(q,te){O.onload=q,O.onerror=te}),O.addEventListener("load",function(){x.loading|=1}),O.addEventListener("error",function(){x.loading|=2}),x.loading|=4,gc(b,o,f)}b={type:"stylesheet",instance:b,count:1,state:x},g.set(m,b)}}}function uS(r,o){Bi.X(r,o);var c=qr;if(c&&r){var f=Qi(c).hoistableScripts,g=Zr(r),m=f.get(g);m||(m=c.querySelector(mo(g)),m||(r=p({src:r,async:!0},o),(o=Un.get(g))&&qh(r,o),m=c.createElement("script"),Rt(m),Xt(m,"link",r),c.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},f.set(g,m))}}function fS(r,o){Bi.M(r,o);var c=qr;if(c&&r){var f=Qi(c).hoistableScripts,g=Zr(r),m=f.get(g);m||(m=c.querySelector(mo(g)),m||(r=p({src:r,async:!0,type:"module"},o),(o=Un.get(g))&&qh(r,o),m=c.createElement("script"),Rt(m),Xt(m,"link",r),c.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},f.set(g,m))}}function Jy(r,o,c,f){var g=(g=me.current)?pc(g):null;if(!g)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=Kr(c.href),c=Qi(g).hoistableStyles,f=c.get(o),f||(f={type:"style",instance:null,count:0,state:null},c.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=Kr(c.href);var m=Qi(g).hoistableStyles,b=m.get(r);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(r,b),(m=g.querySelector(go(r)))&&!m._p&&(b.instance=m,b.state.loading=5),Un.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Un.set(r,c),m||hS(g,r,c,b.state))),o&&f===null)throw Error(i(528,""));return b}if(o&&f!==null)throw Error(i(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Zr(c),c=Qi(g).hoistableScripts,f=c.get(o),f||(f={type:"script",instance:null,count:0,state:null},c.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Kr(r){return'href="'+Pn(r)+'"'}function go(r){return'link[rel="stylesheet"]['+r+"]"}function e0(r){return p({},r,{"data-precedence":r.precedence,precedence:null})}function hS(r,o,c,f){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=r.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Xt(o,"link",c),Rt(o),r.head.appendChild(o))}function Zr(r){return'[src="'+Pn(r)+'"]'}function mo(r){return"script[async]"+r}function t0(r,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var f=r.querySelector('style[data-href~="'+Pn(c.href)+'"]');if(f)return o.instance=f,Rt(f),f;var g=p({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),Rt(f),Xt(f,"style",g),gc(f,c.precedence,r),o.instance=f;case"stylesheet":g=Kr(c.href);var m=r.querySelector(go(g));if(m)return o.state.loading|=4,o.instance=m,Rt(m),m;f=e0(c),(g=Un.get(g))&&Yh(f,g),m=(r.ownerDocument||r).createElement("link"),Rt(m);var b=m;return b._p=new Promise(function(x,O){b.onload=x,b.onerror=O}),Xt(m,"link",f),o.state.loading|=4,gc(m,c.precedence,r),o.instance=m;case"script":return m=Zr(c.src),(g=r.querySelector(mo(m)))?(o.instance=g,Rt(g),g):(f=c,(g=Un.get(m))&&(f=p({},c),qh(f,g)),r=r.ownerDocument||r,g=r.createElement("script"),Rt(g),Xt(g,"link",f),r.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(i(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,gc(f,c.precedence,r));return o.instance}function gc(r,o,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=f.length?f[f.length-1]:null,m=g,b=0;b<f.length;b++){var x=f[b];if(x.dataset.precedence===o)m=x;else if(m!==g)break}m?m.parentNode.insertBefore(r,m.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(r,o.firstChild))}function Yh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function qh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var mc=null;function n0(r,o,c){if(mc===null){var f=new Map,g=mc=new Map;g.set(c,f)}else g=mc,f=g.get(c),f||(f=new Map,g.set(c,f));if(f.has(r))return f;for(f.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var m=c[g];if(!(m[wt]||m[ke]||r==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var b=m.getAttribute(o)||"";b=r+b;var x=f.get(b);x?x.push(m):f.set(b,[m])}}return f}function i0(r,o,c){r=r.ownerDocument||r,r.head.insertBefore(c,o==="title"?r.querySelector("head > title"):null)}function dS(r,o,c){if(c===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function s0(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var _o=null;function pS(){}function gS(r,o,c){if(_o===null)throw Error(i(475));var f=_o;if(o.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=Kr(c.href),m=r.querySelector(go(g));if(m){r=m._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(f.count++,f=_c.bind(f),r.then(f,f)),o.state.loading|=4,o.instance=m,Rt(m);return}m=r.ownerDocument||r,c=e0(c),(g=Un.get(g))&&Yh(c,g),m=m.createElement("link"),Rt(m);var b=m;b._p=new Promise(function(x,O){b.onload=x,b.onerror=O}),Xt(m,"link",c),o.instance=m}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=_c.bind(f),r.addEventListener("load",o),r.addEventListener("error",o))}}function mS(){if(_o===null)throw Error(i(475));var r=_o;return r.stylesheets&&r.count===0&&Kh(r,r.stylesheets),0<r.count?function(o){var c=setTimeout(function(){if(r.stylesheets&&Kh(r,r.stylesheets),r.unsuspend){var f=r.unsuspend;r.unsuspend=null,f()}},6e4);return r.unsuspend=o,function(){r.unsuspend=null,clearTimeout(c)}}:null}function _c(){if(this.count--,this.count===0){if(this.stylesheets)Kh(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var yc=null;function Kh(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,yc=new Map,o.forEach(_S,r),yc=null,_c.call(r))}function _S(r,o){if(!(o.state.loading&4)){var c=yc.get(r);if(c)var f=c.get(null);else{c=new Map,yc.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<g.length;m++){var b=g[m];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(c.set(b.dataset.precedence,b),f=b)}f&&c.set(null,f)}g=o.instance,b=g.getAttribute("data-precedence"),m=c.get(b)||f,m===f&&c.set(null,g),c.set(b,g),this.count++,f=_c.bind(this),g.addEventListener("load",f),g.addEventListener("error",f),m?m.parentNode.insertBefore(g,m.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),o.state.loading|=4}}var yo={$$typeof:M,Provider:null,Consumer:null,_currentValue:N,_currentValue2:N,_threadCount:0};function yS(r,o,c,f,g,m,b,x){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ee(0),this.hiddenUpdates=ee(null),this.identifierPrefix=f,this.onUncaughtError=g,this.onCaughtError=m,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function r0(r,o,c,f,g,m,b,x,O,q,te,re){return r=new yS(r,o,c,b,x,O,q,re),o=1,m===!0&&(o|=24),m=yn(3,null,null,o),r.current=m,m.stateNode=r,o=Pf(),o.refCount++,r.pooledCache=o,o.refCount++,m.memoizedState={element:f,isDehydrated:c,cache:o},kf(m),r}function a0(r){return r?(r=Rr,r):Rr}function o0(r,o,c,f,g,m){g=a0(g),f.context===null?f.context=g:f.pendingContext=g,f=ns(o),f.payload={element:c},m=m===void 0?null:m,m!==null&&(f.callback=m),c=is(r,f,o),c!==null&&(Sn(c,r,o),Ya(c,r,o))}function l0(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function Zh(r,o){l0(r,o),(r=r.alternate)&&l0(r,o)}function c0(r){if(r.tag===13){var o=Er(r,67108864);o!==null&&Sn(o,r,67108864),Zh(r,67108864)}}var bc=!0;function bS(r,o,c,f){var g=S.T;S.T=null;var m=I.p;try{I.p=2,Qh(r,o,c,f)}finally{I.p=m,S.T=g}}function vS(r,o,c,f){var g=S.T;S.T=null;var m=I.p;try{I.p=8,Qh(r,o,c,f)}finally{I.p=m,S.T=g}}function Qh(r,o,c,f){if(bc){var g=Gh(f);if(g===null)Lh(r,o,f,vc,c),f0(r,f);else if(TS(g,r,o,c,f))f.stopPropagation();else if(f0(r,f),o&4&&-1<xS.indexOf(r)){for(;g!==null;){var m=Zi(g);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var b=Xn(m.pendingLanes);if(b!==0){var x=m;for(x.pendingLanes|=2,x.entangledLanes|=2;b;){var O=1<<31-Tt(b);x.entanglements[1]|=O,b&=~O}li(m),(nt&6)===0&&(ic=rn()+500,uo(0))}}break;case 13:x=Er(m,2),x!==null&&Sn(x,m,2),rc(),Zh(m,2)}if(m=Gh(f),m===null&&Lh(r,o,f,vc,c),m===g)break;g=m}g!==null&&f.stopPropagation()}else Lh(r,o,f,null,c)}}function Gh(r){return r=nf(r),Jh(r)}var vc=null;function Jh(r){if(vc=null,r=Zt(r),r!==null){var o=a(r);if(o===null)r=null;else{var c=o.tag;if(c===13){if(r=l(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return vc=r,null}function u0(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Yu()){case Xi:return 2;case Ma:return 8;case Yi:case fl:return 32;case yi:return 268435456;default:return 32}default:return 32}}var ed=!1,ms=null,_s=null,ys=null,bo=new Map,vo=new Map,bs=[],xS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function f0(r,o){switch(r){case"focusin":case"focusout":ms=null;break;case"dragenter":case"dragleave":_s=null;break;case"mouseover":case"mouseout":ys=null;break;case"pointerover":case"pointerout":bo.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":vo.delete(o.pointerId)}}function xo(r,o,c,f,g,m){return r===null||r.nativeEvent!==m?(r={blockedOn:o,domEventName:c,eventSystemFlags:f,nativeEvent:m,targetContainers:[g]},o!==null&&(o=Zi(o),o!==null&&c0(o)),r):(r.eventSystemFlags|=f,o=r.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),r)}function TS(r,o,c,f,g){switch(o){case"focusin":return ms=xo(ms,r,o,c,f,g),!0;case"dragenter":return _s=xo(_s,r,o,c,f,g),!0;case"mouseover":return ys=xo(ys,r,o,c,f,g),!0;case"pointerover":var m=g.pointerId;return bo.set(m,xo(bo.get(m)||null,r,o,c,f,g)),!0;case"gotpointercapture":return m=g.pointerId,vo.set(m,xo(vo.get(m)||null,r,o,c,f,g)),!0}return!1}function h0(r){var o=Zt(r.target);if(o!==null){var c=a(o);if(c!==null){if(o=c.tag,o===13){if(o=l(c),o!==null){r.blockedOn=o,Me(r.priority,function(){if(c.tag===13){var f=Tn();f=ce(f);var g=Er(c,f);g!==null&&Sn(g,c,f),Zh(c,f)}});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function xc(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=Gh(r.nativeEvent);if(c===null){c=r.nativeEvent;var f=new c.constructor(c.type,c);tf=f,c.target.dispatchEvent(f),tf=null}else return o=Zi(c),o!==null&&c0(o),r.blockedOn=c,!1;o.shift()}return!0}function d0(r,o,c){xc(r)&&c.delete(o)}function SS(){ed=!1,ms!==null&&xc(ms)&&(ms=null),_s!==null&&xc(_s)&&(_s=null),ys!==null&&xc(ys)&&(ys=null),bo.forEach(d0),vo.forEach(d0)}function Tc(r,o){r.blockedOn===o&&(r.blockedOn=null,ed||(ed=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,SS)))}var Sc=null;function p0(r){Sc!==r&&(Sc=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Sc===r&&(Sc=null);for(var o=0;o<r.length;o+=3){var c=r[o],f=r[o+1],g=r[o+2];if(typeof f!="function"){if(Jh(f||c)===null)continue;break}var m=Zi(c);m!==null&&(r.splice(o,3),o-=3,Jf(m,{pending:!0,data:g,method:c.method,action:f},f,g))}}))}function To(r){function o(O){return Tc(O,r)}ms!==null&&Tc(ms,r),_s!==null&&Tc(_s,r),ys!==null&&Tc(ys,r),bo.forEach(o),vo.forEach(o);for(var c=0;c<bs.length;c++){var f=bs[c];f.blockedOn===r&&(f.blockedOn=null)}for(;0<bs.length&&(c=bs[0],c.blockedOn===null);)h0(c),c.blockedOn===null&&bs.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var g=c[f],m=c[f+1],b=g[St]||null;if(typeof m=="function")b||p0(c);else if(b){var x=null;if(m&&m.hasAttribute("formAction")){if(g=m,b=m[St]||null)x=b.formAction;else if(Jh(g)!==null)continue}else x=b.action;typeof x=="function"?c[f+1]=x:(c.splice(f,3),f-=3),p0(c)}}}function td(r){this._internalRoot=r}wc.prototype.render=td.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(i(409));var c=o.current,f=Tn();o0(c,f,r,o,null,null)},wc.prototype.unmount=td.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;o0(r.current,2,null,r,null,null),rc(),o[Ze]=null}};function wc(r){this._internalRoot=r}wc.prototype.unstable_scheduleHydration=function(r){if(r){var o=Ce();r={blockedOn:null,target:r,priority:o};for(var c=0;c<bs.length&&o!==0&&o<bs[c].priority;c++);bs.splice(c,0,r),c===0&&h0(r)}};var g0=e.version;if(g0!=="19.1.0")throw Error(i(527,g0,"19.1.0"));I.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=h(o),r=r!==null?d(r):null,r=r===null?null:r.stateNode,r};var wS={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:S,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ac.isDisabled&&Ac.supportsFiber)try{ln=Ac.inject(wS),st=Ac}catch{}}return wo.createRoot=function(r,o){if(!s(r))throw Error(i(299));var c=!1,f="",g=O_,m=I_,b=N_,x=null;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(m=o.onCaughtError),o.onRecoverableError!==void 0&&(b=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(x=o.unstable_transitionCallbacks)),o=r0(r,1,!1,null,null,c,f,g,m,b,x,null),r[Ze]=o.current,Uh(r),new td(o)},wo.hydrateRoot=function(r,o,c){if(!s(r))throw Error(i(299));var f=!1,g="",m=O_,b=I_,x=N_,O=null,q=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(m=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(x=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(O=c.unstable_transitionCallbacks),c.formState!==void 0&&(q=c.formState)),o=r0(r,1,!0,o,c??null,f,g,m,b,x,O,q),o.context=a0(null),c=o.current,f=Tn(),f=ce(f),g=ns(f),g.callback=null,is(c,g,f),c=f,o.current.lanes=c,we(o,c),li(o),r[Ze]=o.current,Uh(r),new wc(o)},wo.version="19.1.0",wo}var A0;function kS(){if(A0)return id.exports;A0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),id.exports=NS(),id.exports}var DS=kS();const BS=hx(DS);var V=Bp();/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var E0="popstate";function US(n={}){function e(i,s){let{pathname:a,search:l,hash:u}=i.location;return Qd("",{pathname:a,search:l,hash:u},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(i,s){return typeof s=="string"?s:Yo(s)}return FS(e,t,null,n)}function _t(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function pi(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function LS(){return Math.random().toString(36).substring(2,10)}function R0(n,e){return{usr:n.state,key:n.key,idx:e}}function Qd(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Ea(e):e,state:t,key:e&&e.key||i||LS()}}function Yo({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Ea(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function FS(n,e,t,i={}){let{window:s=document.defaultView,v5Compat:a=!1}=i,l=s.history,u="POP",h=null,d=p();d==null&&(d=0,l.replaceState({...l.state,idx:d},""));function p(){return(l.state||{idx:null}).idx}function _(){u="POP";let R=p(),P=R==null?null:R-d;d=R,h&&h({action:u,location:E.location,delta:P})}function y(R,P){u="PUSH";let D=Qd(E.location,R,P);d=p()+1;let M=R0(D,d),L=E.createHref(D);try{l.pushState(M,"",L)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;s.location.assign(L)}a&&h&&h({action:u,location:E.location,delta:1})}function v(R,P){u="REPLACE";let D=Qd(E.location,R,P);d=p();let M=R0(D,d),L=E.createHref(D);l.replaceState(M,"",L),a&&h&&h({action:u,location:E.location,delta:0})}function T(R){return zS(R)}let E={get action(){return u},get location(){return n(s,l)},listen(R){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(E0,_),h=R,()=>{s.removeEventListener(E0,_),h=null}},createHref(R){return e(s,R)},createURL:T,encodeLocation(R){let P=T(R);return{pathname:P.pathname,search:P.search,hash:P.hash}},push:y,replace:v,go(R){return l.go(R)}};return E}function zS(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),_t(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:Yo(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function dx(n,e,t="/"){return VS(n,e,t,!1)}function VS(n,e,t,i){let s=typeof e=="string"?Ea(e):e,a=Vi(s.pathname||"/",t);if(a==null)return null;let l=px(n);HS(l);let u=null;for(let h=0;u==null&&h<l.length;++h){let d=JS(a);u=QS(l[h],d,i)}return u}function px(n,e=[],t=[],i="",s=!1){let a=(l,u,h=s,d)=>{let p={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&h)return;_t(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let _=zi([i,p.relativePath]),y=t.concat(p);l.children&&l.children.length>0&&(_t(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${_}".`),px(l.children,e,y,_,h)),!(l.path==null&&!l.index)&&e.push({path:_,score:KS(_,l.index),routesMeta:y})};return n.forEach((l,u)=>{if(l.path===""||!l.path?.includes("?"))a(l,u);else for(let h of gx(l.path))a(l,u,!0,h)}),e}function gx(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,s=t.endsWith("?"),a=t.replace(/\?$/,"");if(i.length===0)return s?[a,""]:[a];let l=gx(i.join("/")),u=[];return u.push(...l.map(h=>h===""?a:[a,h].join("/"))),s&&u.push(...l),u.map(h=>n.startsWith("/")&&h===""?"/":h)}function HS(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:ZS(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var jS=/^:[\w-]+$/,$S=3,WS=2,XS=1,YS=10,qS=-2,C0=n=>n==="*";function KS(n,e){let t=n.split("/"),i=t.length;return t.some(C0)&&(i+=qS),e&&(i+=WS),t.filter(s=>!C0(s)).reduce((s,a)=>s+(jS.test(a)?$S:a===""?XS:YS),i)}function ZS(n,e){return n.length===e.length&&n.slice(0,-1).every((i,s)=>i===e[s])?n[n.length-1]-e[e.length-1]:0}function QS(n,e,t=!1){let{routesMeta:i}=n,s={},a="/",l=[];for(let u=0;u<i.length;++u){let h=i[u],d=u===i.length-1,p=a==="/"?e:e.slice(a.length)||"/",_=au({path:h.relativePath,caseSensitive:h.caseSensitive,end:d},p),y=h.route;if(!_&&d&&t&&!i[i.length-1].route.index&&(_=au({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!_)return null;Object.assign(s,_.params),l.push({params:s,pathname:zi([a,_.pathname]),pathnameBase:iw(zi([a,_.pathnameBase])),route:y}),_.pathnameBase!=="/"&&(a=zi([a,_.pathnameBase]))}return l}function au(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=GS(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let a=s[0],l=a.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:i.reduce((d,{paramName:p,isOptional:_},y)=>{if(p==="*"){let T=u[y]||"";l=a.slice(0,a.length-T.length).replace(/(.)\/+$/,"$1")}const v=u[y];return _&&!v?d[p]=void 0:d[p]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:l,pattern:n}}function GS(n,e=!1,t=!0){pi(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,h)=>(i.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(i.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),i]}function JS(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return pi(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Vi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function ew(n,e="/"){let{pathname:t,search:i="",hash:s=""}=typeof n=="string"?Ea(n):n;return{pathname:t?t.startsWith("/")?t:tw(t,e):e,search:sw(i),hash:rw(s)}}function tw(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function ld(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function nw(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function mx(n){let e=nw(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function _x(n,e,t,i=!1){let s;typeof n=="string"?s=Ea(n):(s={...n},_t(!s.pathname||!s.pathname.includes("?"),ld("?","pathname","search",s)),_t(!s.pathname||!s.pathname.includes("#"),ld("#","pathname","hash",s)),_t(!s.search||!s.search.includes("#"),ld("#","search","hash",s)));let a=n===""||s.pathname==="",l=a?"/":s.pathname,u;if(l==null)u=t;else{let _=e.length-1;if(!i&&l.startsWith("..")){let y=l.split("/");for(;y[0]==="..";)y.shift(),_-=1;s.pathname=y.join("/")}u=_>=0?e[_]:"/"}let h=ew(s,u),d=l&&l!=="/"&&l.endsWith("/"),p=(a||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(d||p)&&(h.pathname+="/"),h}var zi=n=>n.join("/").replace(/\/\/+/g,"/"),iw=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),sw=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,rw=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function aw(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var yx=["POST","PUT","PATCH","DELETE"];new Set(yx);var ow=["GET",...yx];new Set(ow);var Ra=V.createContext(null);Ra.displayName="DataRouter";var Iu=V.createContext(null);Iu.displayName="DataRouterState";V.createContext(!1);var bx=V.createContext({isTransitioning:!1});bx.displayName="ViewTransition";var lw=V.createContext(new Map);lw.displayName="Fetchers";var cw=V.createContext(null);cw.displayName="Await";var _i=V.createContext(null);_i.displayName="Navigation";var el=V.createContext(null);el.displayName="Location";var $i=V.createContext({outlet:null,matches:[],isDataRoute:!1});$i.displayName="Route";var Up=V.createContext(null);Up.displayName="RouteError";function uw(n,{relative:e}={}){_t(tl(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=V.useContext(_i),{hash:s,pathname:a,search:l}=nl(n,{relative:e}),u=a;return t!=="/"&&(u=a==="/"?t:zi([t,a])),i.createHref({pathname:u,search:l,hash:s})}function tl(){return V.useContext(el)!=null}function ur(){return _t(tl(),"useLocation() may be used only in the context of a <Router> component."),V.useContext(el).location}var vx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function xx(n){V.useContext(_i).static||V.useLayoutEffect(n)}function fw(){let{isDataRoute:n}=V.useContext($i);return n?ww():hw()}function hw(){_t(tl(),"useNavigate() may be used only in the context of a <Router> component.");let n=V.useContext(Ra),{basename:e,navigator:t}=V.useContext(_i),{matches:i}=V.useContext($i),{pathname:s}=ur(),a=JSON.stringify(mx(i)),l=V.useRef(!1);return xx(()=>{l.current=!0}),V.useCallback((h,d={})=>{if(pi(l.current,vx),!l.current)return;if(typeof h=="number"){t.go(h);return}let p=_x(h,JSON.parse(a),s,d.relative==="path");n==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:zi([e,p.pathname])),(d.replace?t.replace:t.push)(p,d.state,d)},[e,t,a,s,n])}V.createContext(null);function nl(n,{relative:e}={}){let{matches:t}=V.useContext($i),{pathname:i}=ur(),s=JSON.stringify(mx(t));return V.useMemo(()=>_x(n,JSON.parse(s),i,e==="path"),[n,s,i,e])}function dw(n,e){return Tx(n,e)}function Tx(n,e,t,i,s){_t(tl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=V.useContext(_i),{matches:l}=V.useContext($i),u=l[l.length-1],h=u?u.params:{},d=u?u.pathname:"/",p=u?u.pathnameBase:"/",_=u&&u.route;{let D=_&&_.path||"";Sx(d,!_||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let y=ur(),v;if(e){let D=typeof e=="string"?Ea(e):e;_t(p==="/"||D.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${D.pathname}" was given in the \`location\` prop.`),v=D}else v=y;let T=v.pathname||"/",E=T;if(p!=="/"){let D=p.replace(/^\//,"").split("/");E="/"+T.replace(/^\//,"").split("/").slice(D.length).join("/")}let R=dx(n,{pathname:E});pi(_||R!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),pi(R==null||R[R.length-1].route.element!==void 0||R[R.length-1].route.Component!==void 0||R[R.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let P=yw(R&&R.map(D=>Object.assign({},D,{params:Object.assign({},h,D.params),pathname:zi([p,a.encodeLocation?a.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?p:zi([p,a.encodeLocation?a.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),l,t,i,s);return e&&P?V.createElement(el.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},P):P}function pw(){let n=Sw(),e=aw(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},a={padding:"2px 4px",backgroundColor:i},l=null;return console.error("Error handled by React Router default ErrorBoundary:",n),l=V.createElement(V.Fragment,null,V.createElement("p",null," Hey developer "),V.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",V.createElement("code",{style:a},"ErrorBoundary")," or"," ",V.createElement("code",{style:a},"errorElement")," prop on your route.")),V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},e),t?V.createElement("pre",{style:s},t):null,l)}var gw=V.createElement(pw,null),mw=class extends V.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?V.createElement($i.Provider,{value:this.props.routeContext},V.createElement(Up.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function _w({routeContext:n,match:e,children:t}){let i=V.useContext(Ra);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),V.createElement($i.Provider,{value:n},t)}function yw(n,e=[],t=null,i=null,s=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,l=t?.errors;if(l!=null){let d=a.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);_t(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),a=a.slice(0,Math.min(a.length,d+1))}let u=!1,h=-1;if(t)for(let d=0;d<a.length;d++){let p=a[d];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=d),p.route.id){let{loaderData:_,errors:y}=t,v=p.route.loader&&!_.hasOwnProperty(p.route.id)&&(!y||y[p.route.id]===void 0);if(p.route.lazy||v){u=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}return a.reduceRight((d,p,_)=>{let y,v=!1,T=null,E=null;t&&(y=l&&p.route.id?l[p.route.id]:void 0,T=p.route.errorElement||gw,u&&(h<0&&_===0?(Sx("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,E=null):h===_&&(v=!0,E=p.route.hydrateFallbackElement||null)));let R=e.concat(a.slice(0,_+1)),P=()=>{let D;return y?D=T:v?D=E:p.route.Component?D=V.createElement(p.route.Component,null):p.route.element?D=p.route.element:D=d,V.createElement(_w,{match:p,routeContext:{outlet:d,matches:R,isDataRoute:t!=null},children:D})};return t&&(p.route.ErrorBoundary||p.route.errorElement||_===0)?V.createElement(mw,{location:t.location,revalidation:t.revalidation,component:T,error:y,children:P(),routeContext:{outlet:null,matches:R,isDataRoute:!0},unstable_onError:i}):P()},null)}function Lp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bw(n){let e=V.useContext(Ra);return _t(e,Lp(n)),e}function vw(n){let e=V.useContext(Iu);return _t(e,Lp(n)),e}function xw(n){let e=V.useContext($i);return _t(e,Lp(n)),e}function Fp(n){let e=xw(n),t=e.matches[e.matches.length-1];return _t(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function Tw(){return Fp("useRouteId")}function Sw(){let n=V.useContext(Up),e=vw("useRouteError"),t=Fp("useRouteError");return n!==void 0?n:e.errors?.[t]}function ww(){let{router:n}=bw("useNavigate"),e=Fp("useNavigate"),t=V.useRef(!1);return xx(()=>{t.current=!0}),V.useCallback(async(s,a={})=>{pi(t.current,vx),t.current&&(typeof s=="number"?n.navigate(s):await n.navigate(s,{fromRouteId:e,...a}))},[n,e])}var M0={};function Sx(n,e,t){!e&&!M0[n]&&(M0[n]=!0,pi(!1,t))}V.memo(Aw);function Aw({routes:n,future:e,state:t,unstable_onError:i}){return Tx(n,void 0,t,i,e)}function Gd(n){_t(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ew({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:s,static:a=!1}){_t(!tl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=n.replace(/^\/*/,"/"),u=V.useMemo(()=>({basename:l,navigator:s,static:a,future:{}}),[l,s,a]);typeof t=="string"&&(t=Ea(t));let{pathname:h="/",search:d="",hash:p="",state:_=null,key:y="default"}=t,v=V.useMemo(()=>{let T=Vi(h,l);return T==null?null:{location:{pathname:T,search:d,hash:p,state:_,key:y},navigationType:i}},[l,h,d,p,_,y,i]);return pi(v!=null,`<Router basename="${l}"> is not able to match the URL "${h}${d}${p}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:V.createElement(_i.Provider,{value:u},V.createElement(el.Provider,{children:e,value:v}))}function Rw({children:n,location:e}){return dw(Jd(n),e)}function Jd(n,e=[]){let t=[];return V.Children.forEach(n,(i,s)=>{if(!V.isValidElement(i))return;let a=[...e,s];if(i.type===V.Fragment){t.push.apply(t,Jd(i.props.children,a));return}_t(i.type===Gd,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),_t(!i.props.index||!i.props.children,"An index route cannot have child routes.");let l={id:i.props.id||a.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(l.children=Jd(i.props.children,a)),t.push(l)}),t}var Xc="get",Yc="application/x-www-form-urlencoded";function Nu(n){return n!=null&&typeof n.tagName=="string"}function Cw(n){return Nu(n)&&n.tagName.toLowerCase()==="button"}function Mw(n){return Nu(n)&&n.tagName.toLowerCase()==="form"}function Pw(n){return Nu(n)&&n.tagName.toLowerCase()==="input"}function Ow(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Iw(n,e){return n.button===0&&(!e||e==="_self")&&!Ow(n)}var Ec=null;function Nw(){if(Ec===null)try{new FormData(document.createElement("form"),0),Ec=!1}catch{Ec=!0}return Ec}var kw=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cd(n){return n!=null&&!kw.has(n)?(pi(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Yc}"`),null):n}function Dw(n,e){let t,i,s,a,l;if(Mw(n)){let u=n.getAttribute("action");i=u?Vi(u,e):null,t=n.getAttribute("method")||Xc,s=cd(n.getAttribute("enctype"))||Yc,a=new FormData(n)}else if(Cw(n)||Pw(n)&&(n.type==="submit"||n.type==="image")){let u=n.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||u.getAttribute("action");if(i=h?Vi(h,e):null,t=n.getAttribute("formmethod")||u.getAttribute("method")||Xc,s=cd(n.getAttribute("formenctype"))||cd(u.getAttribute("enctype"))||Yc,a=new FormData(u,n),!Nw()){let{name:d,type:p,value:_}=n;if(p==="image"){let y=d?`${d}.`:"";a.append(`${y}x`,"0"),a.append(`${y}y`,"0")}else d&&a.append(d,_)}}else{if(Nu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Xc,i=null,s=Yc,l=n}return a&&s==="text/plain"&&(l=a,a=void 0),{action:i,method:t.toLowerCase(),encType:s,formData:a,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function zp(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Bw(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&Vi(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function Uw(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Lw(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Fw(n,e,t){let i=await Promise.all(n.map(async s=>{let a=e.routes[s.route.id];if(a){let l=await Uw(a,t);return l.links?l.links():[]}return[]}));return jw(i.flat(1).filter(Lw).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function P0(n,e,t,i,s,a){let l=(h,d)=>t[d]?h.route.id!==t[d].route.id:!0,u=(h,d)=>t[d].pathname!==h.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==h.params["*"];return a==="assets"?e.filter((h,d)=>l(h,d)||u(h,d)):a==="data"?e.filter((h,d)=>{let p=i.routes[h.route.id];if(!p||!p.hasLoader)return!1;if(l(h,d)||u(h,d))return!0;if(h.route.shouldRevalidate){let _=h.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof _=="boolean")return _}return!0}):[]}function zw(n,e,{includeHydrateFallback:t}={}){return Vw(n.map(i=>{let s=e.routes[i.route.id];if(!s)return[];let a=[s.module];return s.clientActionModule&&(a=a.concat(s.clientActionModule)),s.clientLoaderModule&&(a=a.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(a=a.concat(s.hydrateFallbackModule)),s.imports&&(a=a.concat(s.imports)),a}).flat(1))}function Vw(n){return[...new Set(n)]}function Hw(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function jw(n,e){let t=new Set;return new Set(e),n.reduce((i,s)=>{let a=JSON.stringify(Hw(s));return t.has(a)||(t.add(a),i.push({key:a,link:s})),i},[])}function wx(){let n=V.useContext(Ra);return zp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function $w(){let n=V.useContext(Iu);return zp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Vp=V.createContext(void 0);Vp.displayName="FrameworkContext";function Ax(){let n=V.useContext(Vp);return zp(n,"You must render this element inside a <HydratedRouter> element"),n}function Ww(n,e){let t=V.useContext(Vp),[i,s]=V.useState(!1),[a,l]=V.useState(!1),{onFocus:u,onBlur:h,onMouseEnter:d,onMouseLeave:p,onTouchStart:_}=e,y=V.useRef(null);V.useEffect(()=>{if(n==="render"&&l(!0),n==="viewport"){let E=P=>{P.forEach(D=>{l(D.isIntersecting)})},R=new IntersectionObserver(E,{threshold:.5});return y.current&&R.observe(y.current),()=>{R.disconnect()}}},[n]),V.useEffect(()=>{if(i){let E=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(E)}}},[i]);let v=()=>{s(!0)},T=()=>{s(!1),l(!1)};return t?n!=="intent"?[a,y,{}]:[a,y,{onFocus:Ao(u,v),onBlur:Ao(h,T),onMouseEnter:Ao(d,v),onMouseLeave:Ao(p,T),onTouchStart:Ao(_,v)}]:[!1,y,{}]}function Ao(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function Xw({page:n,...e}){let{router:t}=wx(),i=V.useMemo(()=>dx(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?V.createElement(qw,{page:n,matches:i,...e}):null}function Yw(n){let{manifest:e,routeModules:t}=Ax(),[i,s]=V.useState([]);return V.useEffect(()=>{let a=!1;return Fw(n,e,t).then(l=>{a||s(l)}),()=>{a=!0}},[n,e,t]),i}function qw({page:n,matches:e,...t}){let i=ur(),{manifest:s,routeModules:a}=Ax(),{basename:l}=wx(),{loaderData:u,matches:h}=$w(),d=V.useMemo(()=>P0(n,e,h,s,i,"data"),[n,e,h,s,i]),p=V.useMemo(()=>P0(n,e,h,s,i,"assets"),[n,e,h,s,i]),_=V.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let T=new Set,E=!1;if(e.forEach(P=>{let D=s.routes[P.route.id];!D||!D.hasLoader||(!d.some(M=>M.route.id===P.route.id)&&P.route.id in u&&a[P.route.id]?.shouldRevalidate||D.hasClientLoader?E=!0:T.add(P.route.id))}),T.size===0)return[];let R=Bw(n,l,"data");return E&&T.size>0&&R.searchParams.set("_routes",e.filter(P=>T.has(P.route.id)).map(P=>P.route.id).join(",")),[R.pathname+R.search]},[l,u,i,s,d,e,n,a]),y=V.useMemo(()=>zw(p,s),[p,s]),v=Yw(p);return V.createElement(V.Fragment,null,_.map(T=>V.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...t})),y.map(T=>V.createElement("link",{key:T,rel:"modulepreload",href:T,...t})),v.map(({key:T,link:E})=>V.createElement("link",{key:T,nonce:t.nonce,...E})))}function Kw(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Ex=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Ex&&(window.__reactRouterVersion="7.9.3")}catch{}function Zw({basename:n,children:e,window:t}){let i=V.useRef();i.current==null&&(i.current=US({window:t,v5Compat:!0}));let s=i.current,[a,l]=V.useState({action:s.action,location:s.location}),u=V.useCallback(h=>{V.startTransition(()=>l(h))},[l]);return V.useLayoutEffect(()=>s.listen(u),[s,u]),V.createElement(Ew,{basename:n,children:e,location:a.location,navigationType:a.action,navigator:s})}var Rx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cx=V.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:s,reloadDocument:a,replace:l,state:u,target:h,to:d,preventScrollReset:p,viewTransition:_,...y},v){let{basename:T}=V.useContext(_i),E=typeof d=="string"&&Rx.test(d),R,P=!1;if(typeof d=="string"&&E&&(R=d,Ex))try{let le=new URL(window.location.href),_e=d.startsWith("//")?new URL(le.protocol+d):new URL(d),Se=Vi(_e.pathname,T);_e.origin===le.origin&&Se!=null?d=Se+_e.search+_e.hash:P=!0}catch{pi(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let D=uw(d,{relative:s}),[M,L,H]=Ww(i,y),J=eA(d,{replace:l,state:u,target:h,preventScrollReset:p,relative:s,viewTransition:_});function fe(le){e&&e(le),le.defaultPrevented||J(le)}let de=V.createElement("a",{...y,...H,href:R||D,onClick:P||a?e:fe,ref:Kw(v,L),target:h,"data-discover":!E&&t==="render"?"true":void 0});return M&&!E?V.createElement(V.Fragment,null,de,V.createElement(Xw,{page:D})):de});Cx.displayName="Link";var Qw=V.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:s=!1,style:a,to:l,viewTransition:u,children:h,...d},p){let _=nl(l,{relative:d.relative}),y=ur(),v=V.useContext(Iu),{navigator:T,basename:E}=V.useContext(_i),R=v!=null&&rA(_)&&u===!0,P=T.encodeLocation?T.encodeLocation(_).pathname:_.pathname,D=y.pathname,M=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(D=D.toLowerCase(),M=M?M.toLowerCase():null,P=P.toLowerCase()),M&&E&&(M=Vi(M,E)||M);const L=P!=="/"&&P.endsWith("/")?P.length-1:P.length;let H=D===P||!s&&D.startsWith(P)&&D.charAt(L)==="/",J=M!=null&&(M===P||!s&&M.startsWith(P)&&M.charAt(P.length)==="/"),fe={isActive:H,isPending:J,isTransitioning:R},de=H?e:void 0,le;typeof i=="function"?le=i(fe):le=[i,H?"active":null,J?"pending":null,R?"transitioning":null].filter(Boolean).join(" ");let _e=typeof a=="function"?a(fe):a;return V.createElement(Cx,{...d,"aria-current":de,className:le,ref:p,style:_e,to:l,viewTransition:u},typeof h=="function"?h(fe):h)});Qw.displayName="NavLink";var Gw=V.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:s,state:a,method:l=Xc,action:u,onSubmit:h,relative:d,preventScrollReset:p,viewTransition:_,...y},v)=>{let T=iA(),E=sA(u,{relative:d}),R=l.toLowerCase()==="get"?"get":"post",P=typeof u=="string"&&Rx.test(u),D=M=>{if(h&&h(M),M.defaultPrevented)return;M.preventDefault();let L=M.nativeEvent.submitter,H=L?.getAttribute("formmethod")||l;T(L||M.currentTarget,{fetcherKey:e,method:H,navigate:t,replace:s,state:a,relative:d,preventScrollReset:p,viewTransition:_})};return V.createElement("form",{ref:v,method:R,action:E,onSubmit:i?h:D,...y,"data-discover":!P&&n==="render"?"true":void 0})});Gw.displayName="Form";function Jw(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Mx(n){let e=V.useContext(Ra);return _t(e,Jw(n)),e}function eA(n,{target:e,replace:t,state:i,preventScrollReset:s,relative:a,viewTransition:l}={}){let u=fw(),h=ur(),d=nl(n,{relative:a});return V.useCallback(p=>{if(Iw(p,e)){p.preventDefault();let _=t!==void 0?t:Yo(h)===Yo(d);u(n,{replace:_,state:i,preventScrollReset:s,relative:a,viewTransition:l})}},[h,u,d,t,i,e,n,s,a,l])}var tA=0,nA=()=>`__${String(++tA)}__`;function iA(){let{router:n}=Mx("useSubmit"),{basename:e}=V.useContext(_i),t=Tw();return V.useCallback(async(i,s={})=>{let{action:a,method:l,encType:u,formData:h,body:d}=Dw(i,e);if(s.navigate===!1){let p=s.fetcherKey||nA();await n.fetch(p,t,s.action||a,{preventScrollReset:s.preventScrollReset,formData:h,body:d,formMethod:s.method||l,formEncType:s.encType||u,flushSync:s.flushSync})}else await n.navigate(s.action||a,{preventScrollReset:s.preventScrollReset,formData:h,body:d,formMethod:s.method||l,formEncType:s.encType||u,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,e,t])}function sA(n,{relative:e}={}){let{basename:t}=V.useContext(_i),i=V.useContext($i);_t(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),a={...nl(n||".",{relative:e})},l=ur();if(n==null){a.search=l.search;let u=new URLSearchParams(a.search),h=u.getAll("index");if(h.some(p=>p==="")){u.delete("index"),h.filter(_=>_).forEach(_=>u.append("index",_));let p=u.toString();a.search=p?`?${p}`:""}}return(!n||n===".")&&s.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:zi([t,a.pathname])),Yo(a)}function rA(n,{relative:e}={}){let t=V.useContext(bx);_t(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=Mx("useViewTransitionState"),s=nl(n,{relative:e});if(!t.isTransitioning)return!1;let a=Vi(t.currentLocation.pathname,i)||t.currentLocation.pathname,l=Vi(t.nextLocation.pathname,i)||t.nextLocation.pathname;return au(s.pathname,l)!=null||au(s.pathname,a)!=null}function ou(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Hp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),O0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O0&&parseFloat(O0[1]);const I0=globalThis,N0=globalThis.process||{},aA=globalThis.navigator||{};function Px(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function fr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Px()}function oA(n){return fr()?Px()?"Electron":(aA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Ox="4.1.0";function lA(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class cA{constructor(e,t,i="sessionStorage"){this.storage=lA(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function uA(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function fA(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var lu;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(lu||(lu={}));const hA=10;function k0(n){return typeof n!="string"?n:(n=n.toUpperCase(),lu[n]||lu.WHITE)}function dA(n,e,t){return!fr&&typeof n=="string"&&(e&&(n=`\x1B[${k0(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${k0(t)+hA}m${n}\x1B[49m`)),n}function pA(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const a of i){const l=s[a];typeof l=="function"&&(e.find(u=>a===u)||(s[a]=l.bind(n)))}}function jp(n,e){if(!n)throw new Error("Assertion failed")}function Qr(){let n;if(fr()&&I0.performance)n=I0?.performance?.now?.();else if("hrtime"in N0){const e=N0?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const Gr={debug:fr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},gA={enabled:!0,level:0};function Jr(){}const D0={},B0={once:!0};class il{constructor({id:e}={id:""}){this.VERSION=Ox,this._startTs=Qr(),this._deltaTs=Qr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new cA(`__probe-${this.id}__`,gA),this.timeStamp(`${this.id} started`),pA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Qr()-this._startTs).toPrecision(10))}getDelta(){return Number((Qr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Gr.warn,arguments,B0)}error(e){return this._getLogFunction(0,e,Gr.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Gr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Gr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Gr.debug||Gr.info,arguments,B0)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Jr,i&&[i],{tag:_A(t)}):Jr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Jr)}group(e,t,i={collapsed:!1}){const s=U0({logLevel:e,message:t,opts:i}),{collapsed:a}=i;return s.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Jr)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Ix(e)}_getLogFunction(e,t,i,s,a){if(this._shouldLog(e)){a=U0({logLevel:e,message:t,args:s,opts:a}),i=i||a.method,jp(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Qr();const l=a.tag||a.message;if(a.once&&l)if(!D0[l])D0[l]=Qr();else return Jr;return t=mA(this.id,a.message,a),i.bind(console,t,...a.args)}return Jr}}il.VERSION=Ox;function Ix(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return jp(Number.isFinite(e)&&e>=0),e}function U0(n){const{logLevel:e,message:t}=n;n.logLevel=Ix(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return jp(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function mA(n,e,t){if(typeof e=="string"){const i=t.time?fA(uA(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=dA(e,t.color,t.background)}return e}function _A(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const ud="4.3.3",yA=ud[0]>="0"&&ud[0]<="9"?`v${ud}`:"";function bA(){const n=new il({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=yA,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const vA=bA();function xA(n,e){return Nx(n||{},e)}function Nx(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?i[s]=Nx(i[s]||{},e[s],t+1):i[s]=e[s];return i}const TA="latest";function SA(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const wA=SA();function ks(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const ir=typeof process!="object"||String(process)!=="[object process]"||process.browser,AA=typeof window<"u"&&typeof window.orientation<"u",L0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);L0&&parseFloat(L0[1]);class EA{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ks(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ks(this.isRunning),this.isRunning=!1,this._reject(e)}}class fd{terminate(){}}const hd=new Map;function RA(n){ks(n.source&&!n.url||!n.source&&n.url);let e=hd.get(n.source||n.url);return e||(n.url&&(e=CA(n.url),hd.set(n.url,e)),n.source&&(e=kx(n.source),hd.set(n.source,e))),ks(e),e}function CA(n){if(!n.startsWith("http"))return n;const e=MA(n);return kx(e)}function kx(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function MA(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Dx(n,e=!0,t){const i=t||new Set;if(n){if(F0(n))i.add(n);else if(F0(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)Dx(n[s],e,i)}}return t===void 0?Array.from(i):[]}function F0(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const dd=()=>{};class ep{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&ir||typeof fd<"u"&&!ir}constructor(e){const{name:t,source:i,url:s}=e;ks(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=dd,this.onError=a=>console.log(a),this.worker=ir?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=dd,this.onError=dd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||Dx(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=RA({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new fd(i,{eval:!1})}else if(this.source)e=new fd(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class PA{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return ep.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,a,l)=>s.done(l),i=(s,a)=>s.error(a)){const s=new Promise(a=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:a}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new EA(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!ir||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ep({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return AA?this.maxMobileConcurrency:this.maxConcurrency}}const OA={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Es{props;workerPools=new Map;static _workerFarm;static isSupported(){return ep.isSupported()}static getWorkerFarm(e={}){return Es._workerFarm=Es._workerFarm||new Es({}),Es._workerFarm.setProps(e),Es._workerFarm}constructor(e){this.props={...OA},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let a=this.workerPools.get(t);return a||(a=new PA({name:t,source:i,url:s}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function IA(n,e={}){const t=e[n.id]||{},i=ir?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(ir?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let a=n.version;a==="latest"&&(a=TA);const l=a?`@${a}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return ks(s),s}function NA(n,e=wA){ks(n,"no worker provided");const t=n.version;return!(!e||!t)}function kA(n,e){return!Es.isSupported()||!ir&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function DA(n,e,t,i,s){const a=n.id,l=IA(n,t),h=Es.getWorkerFarm(t).getWorkerPool({name:a,url:l});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await h.startJob("process-on-worker",BA.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function BA(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:a,options:l}=i;try{const u=await n(a,l);e.postMessage("done",{id:s,result:u})}catch(u){const h=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:s,error:h})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function UA(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==s[a])return!1;return!0}function LA(...n){return FA(n)}function FA(n){const e=n.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),t=e.reduce((a,l)=>a+l.byteLength,0),i=new Uint8Array(t);let s=0;for(const a of e)i.set(a,s),s+=a.byteLength;return i.buffer}async function zA(n){const e=[];for await(const t of n)e.push(t);return LA(...e)}function z0(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class V0{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=z0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(z0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ku{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof V0?s=e:s=new V0(t,i),this.stats[t]=s),s}}let VA="";const H0={};function HA(n){for(const e in H0)if(n.startsWith(e)){const t=H0[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${VA}${n}`),n}function jA(n){return n&&typeof n=="object"&&n.isBuffer}function Bx(n){if(jA(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Ux(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function $A(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const WA=n=>typeof n=="boolean",Lo=n=>typeof n=="function",sl=n=>n!==null&&typeof n=="object",j0=n=>sl(n)&&n.constructor==={}.constructor,XA=n=>!!n&&typeof n[Symbol.iterator]=="function",YA=n=>n&&typeof n[Symbol.asyncIterator]=="function",hr=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,dr=n=>typeof Blob<"u"&&n instanceof Blob,qA=n=>n&&typeof n=="object"&&n.isBuffer,KA=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||sl(n)&&Lo(n.tee)&&Lo(n.cancel)&&Lo(n.getReader),ZA=n=>sl(n)&&Lo(n.read)&&Lo(n.pipe)&&WA(n.readable),Lx=n=>KA(n)||ZA(n);class QA extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const GA=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,JA=/^([-\w.]+\/[-\w.+]+)/;function $0(n,e){return n.toLowerCase()===e.toLowerCase()}function eE(n){const e=JA.exec(n);return e?e[1]:n}function W0(n){const e=GA.exec(n);return e?e[1]:""}const Fx=/\?.*/;function tE(n){const e=n.match(Fx);return e&&e[0]}function $p(n){return n.replace(Fx,"")}function nE(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Du(n){return hr(n)?n.url:dr(n)?n.name||"":typeof n=="string"?n:""}function Wp(n){if(hr(n)){const e=n,t=e.headers.get("content-type")||"",i=$p(e.url);return eE(t)||W0(i)}return dr(n)?n.type||"":typeof n=="string"?W0(n):""}function iE(n){return hr(n)?n.headers["content-length"]||-1:dr(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function zx(n){if(hr(n))return n;const e={},t=iE(n);t>=0&&(e["content-length"]=String(t));const i=Du(n),s=Wp(n);s&&(e["content-type"]=s);const a=await aE(n);a&&(e["x-first-bytes"]=a),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function sE(n){if(!n.ok)throw await rE(n)}async function rE(n){const e=nE(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&s?.includes("application/json")?await n.json():await n.text()}catch{}return new QA(t,i)}async function aE(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=a=>i(a?.target?.result),s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${oE(t)}`}return null}function oE(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function lE(n){return!cE(n)&&!uE(n)}function cE(n){return n.startsWith("http:")||n.startsWith("https:")}function uE(n){return n.startsWith("data:")}async function X0(n,e){if(typeof n=="string"){const t=HA(n);return lE(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await zx(n)}const Y0=new il({id:"loaders.gl"});class fE{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class hE{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const Vx={fetch:null,mimeType:void 0,nothrow:!1,log:new hE,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Hp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},dE={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Hx(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function jx(){const n=Hx();return n.globalOptions=n.globalOptions||{...Vx},n.globalOptions}function pE(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],gE(n,t),_E(e,n,i)}function gE(n,e){q0(n,null,Vx,dE,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},a=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};q0(i,t.id,s,a,e)}}function q0(n,e,t,i,s){const a=e||"Top level",l=e?`${e}.`:"";for(const u in n){const h=!e&&sl(n[u]),d=u==="baseUri"&&!e,p=u==="workerUrl"&&e;if(!(u in t)&&!d&&!p){if(u in i)Y0.warn(`${a} loader option '${l}${u}' no longer supported, use '${i[u]}'`)();else if(!h){const _=mE(u,s);Y0.warn(`${a} loader option '${l}${u}' not recognized. ${_}`)()}}}}function mE(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const a in s.options){if(n===a)return`Did you mean '${s.id}.${a}'?`;const l=a.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(i=i||`Did you mean '${s.id}.${a}'?`)}return i}function _E(n,e,t){const s={...n.options||{}};return yE(s,t),s.log===null&&(s.log=new fE),K0(s,jx()),K0(s,e),s}function K0(n,e){for(const t in e)if(t in e){const i=e[t];j0(i)&&j0(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function yE(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Xp(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function Yp(n){ou(n,"null loader"),ou(Xp(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const $x=()=>{const n=Hx();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function bE(n){const e=$x();n=Array.isArray(n)?n:[n];for(const t of n){const i=Yp(t);e.find(s=>i===s)||e.unshift(i)}}function vE(){return $x()}const xE=/\.([^.]+)$/;async function TE(n,e=[],t,i){if(!Wx(n))return null;let s=Z0(n,e,{...t,nothrow:!0},i);if(s)return s;if(dr(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Z0(n,e,t,i)),!s&&!t?.nothrow)throw new Error(Xx(n));return s}function Z0(n,e=[],t,i){if(!Wx(n))return null;if(e&&!Array.isArray(e))return Yp(e);let s=[];e&&(s=s.concat(e)),t?.ignoreRegisteredLoaders||s.push(...vE()),wE(s);const a=SE(n,s,t,i);if(!a&&!t?.nothrow)throw new Error(Xx(n));return a}function SE(n,e,t,i){const s=Du(n),a=Wp(n),l=$p(s)||i?.url;let u=null,h="";return t?.mimeType&&(u=pd(e,t?.mimeType),h=`match forced by supplied MIME type ${t?.mimeType}`),u=u||AE(e,l),h=h||(u?`matched url ${l}`:""),u=u||pd(e,a),h=h||(u?`matched MIME type ${a}`:""),u=u||RE(e,n),h=h||(u?`matched initial data ${Yx(n)}`:""),t?.fallbackMimeType&&(u=u||pd(e,t?.fallbackMimeType),h=h||(u?`matched fallback MIME type ${a}`:"")),h&&vA.log(1,`selectLoader selected ${u?.name}: ${h}.`),u}function Wx(n){return!(n instanceof Response&&n.status===204)}function Xx(n){const e=Du(n),t=Wp(n);let i="No valid loader found (";i+=e?`${Ux(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?Yx(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function wE(n){for(const e of n)Yp(e)}function AE(n,e){const t=e&&xE.exec(e),i=t&&t[1];return i?EE(n,i):null}function EE(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function pd(n,e){for(const t of n)if(t.mimeTypes?.some(i=>$0(e,i))||$0(e,`application/x.${t.id}`))return t;return null}function RE(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(CE(e,t))return t}else if(ArrayBuffer.isView(e)){if(Q0(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Q0(e,0,t))return t;return null}function CE(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function Q0(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>ME(n,e,t,s))}function ME(n,e,t,i){if(i instanceof ArrayBuffer)return UA(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=tp(n,e,i.length);return i===s;default:return!1}}function Yx(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?tp(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?tp(n,0,e):""}function tp(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let a=0;a<t;a++)s+=String.fromCharCode(i.getUint8(e+a));return s}const PE=256*1024;function*OE(n,e){const t=e?.chunkSize||PE;let i=0;const s=new TextEncoder;for(;i<n.length;){const a=Math.min(n.length-i,t),l=n.slice(i,i+a);i+=a,yield s.encode(l)}}const IE=256*1024;function*NE(n,e={}){const{chunkSize:t=IE}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),a=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(a).set(l),i+=s,yield a}}const kE=1024*1024;async function*DE(n,e){const t=e?.chunkSize||kE;let i=0;for(;i<n.size;){const s=i+t,a=await n.slice(i,s).arrayBuffer();i=s,yield a}}function G0(n,e){return Hp?BE(n,e):UE(n)}async function*BE(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:a,value:l}=await s;if(a)return;yield Bx(l)}}catch{t.releaseLock()}}async function*UE(n,e){for await(const t of n)yield Bx(t)}function LE(n,e){if(typeof n=="string")return OE(n,e);if(n instanceof ArrayBuffer)return NE(n,e);if(dr(n))return DE(n,e);if(Lx(n))return G0(n,e);if(hr(n))return G0(n.body,e);throw new Error("makeIterator")}const qx="Cannot convert supplied data type";function FE(n,e,t){if(e.text&&typeof n=="string")return n;if(qA(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(qx)}async function zE(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return FE(n,e);if(dr(n)&&(n=await zx(n)),hr(n)){const s=n;return await sE(s),e.binary?await s.arrayBuffer():await s.text()}if(Lx(n)&&(n=LE(n,t)),XA(n)||YA(n))return zA(n);throw new Error(qx)}function Kx(n,e){const t=jx(),i=n||t;return typeof i.fetch=="function"?i.fetch:sl(i.fetch)?s=>X0(s,i.fetch):e?.fetch?e?.fetch:X0}function VE(n,e,t){if(t)return t;const i={fetch:Kx(e,n),...n};if(i.url){const s=$p(i.url);i.baseUrl=s,i.queryString=tE(i.url),i.filename=Ux(s),i.baseUrl=$A(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function HE(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function cu(n,e,t,i){e&&!Array.isArray(e)&&!Xp(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=Du(n),l=HE(e,i),u=await TE(n,l,t);return u?(t=pE(t,u,l,s),i=VE({url:s,_parse:cu,loaders:l},t,i||null),await jE(u,n,t,i)):null}async function jE(n,e,t,i){if(NA(n),t=xA(n.options,t),hr(e)){const a=e,{ok:l,redirected:u,status:h,statusText:d,type:p,url:_}=a,y=Object.fromEntries(a.headers.entries());i.response={headers:y,ok:l,redirected:u,status:h,statusText:d,type:p,url:_}}e=await zE(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(kA(n,t))return await DA(n,e,t,i,cu);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw ks(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function uu(n,e,t,i){let s,a;!Array.isArray(e)&&!Xp(e)?(s=[],a=e):(s=e,a=t);const l=Kx(a);let u=n;return typeof n=="string"&&(u=await l(n)),dr(n)&&(u=await l(n)),Array.isArray(s)?await cu(u,s,a):await cu(u,s,a)}const $E="4.3.3",WE=globalThis.loaders?.parseImageNode,np=typeof Image<"u",ip=typeof ImageBitmap<"u",XE=!!WE,sp=Hp?!0:XE;function YE(n){switch(n){case"auto":return ip||np||sp;case"imagebitmap":return ip;case"image":return np;case"data":return sp;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function qE(){if(ip)return"imagebitmap";if(np)return"image";if(sp)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function KE(n){const e=QE(n);if(!e)throw new Error("Not an image");return e}function ZE(n){switch(KE(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function QE(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const GE=/^data:image\/svg\+xml/,JE=/\.svg((\?|#).*)?$/;function qp(n){return n&&(GE.test(n)||JE.test(n))}function eR(n,e){if(qp(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return Zx(n,e)}function Zx(n,e){if(qp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Qx(n,e,t){const i=eR(n,t),s=self.URL||self.webkitURL,a=typeof i!="string"&&s.createObjectURL(i);try{return await tR(a||i,e)}finally{a&&s.revokeObjectURL(a)}}async function tR(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=a=>{const l=a instanceof Error?a.message:"error";s(new Error(l))}}catch(a){s(a)}})}const nR={};let J0=!0;async function iR(n,e,t){let i;qp(t)?i=await Qx(n,e,t):i=Zx(n,t);const s=e&&e.imagebitmap;return await sR(i,s)}async function sR(n,e=null){if((rR(e)||!J0)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),J0=!1}return await createImageBitmap(n)}function rR(n){for(const e in n||nR)return!1;return!0}function aR(n){return!uR(n,"ftyp",4)||(n[8]&96)===0?null:oR(n)}function oR(n){switch(lR(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function lR(n,e,t){return String.fromCharCode(...n.slice(e,t))}function cR(n){return[...n].map(e=>e.charCodeAt(0))}function uR(n,e,t=0){const i=cR(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const hi=!1,Fo=!0;function Gx(n){const e=rl(n);return hR(e)||gR(e)||dR(e)||pR(e)||fR(e)}function fR(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=aR(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function hR(n){const e=rl(n);return e.byteLength>=24&&e.getUint32(0,hi)===2303741511?{mimeType:"image/png",width:e.getUint32(16,hi),height:e.getUint32(20,hi)}:null}function dR(n){const e=rl(n);return e.byteLength>=10&&e.getUint32(0,hi)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Fo),height:e.getUint16(8,Fo)}:null}function pR(n){const e=rl(n);return e.byteLength>=14&&e.getUint16(0,hi)===16973&&e.getUint32(2,Fo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Fo),height:e.getUint32(22,Fo)}:null}function gR(n){const e=rl(n);if(!(e.byteLength>=3&&e.getUint16(0,hi)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=mR();let a=2;for(;a+9<e.byteLength;){const l=e.getUint16(a,hi);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(a+5,hi),width:e.getUint16(a+7,hi)};if(!i.has(l))return null;a+=2,a+=e.getUint16(a,hi)}return null}function mR(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function rl(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function _R(n,e){const{mimeType:t}=Gx(n)||{},i=globalThis.loaders?.parseImageNode;return ou(i),await i(n,t)}async function yR(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:a}=t||{},l=bR(s);let u;switch(l){case"imagebitmap":u=await iR(n,e,a);break;case"image":u=await Qx(n,e,a);break;case"data":u=await _R(n);break;default:ou(!1)}return s==="data"&&(u=ZE(u)),u}function bR(n){switch(n){case"auto":case"data":return qE();default:return YE(n),n}}const vR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],xR=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],TR={image:{type:"auto",decode:!0}},SR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:$E,mimeTypes:xR,extensions:vR,parse:yR,tests:[n=>!!Gx(new DataView(n))],options:TR},We=new il({id:"deck"});let rp={};function wR(n){rp=n}function nn(n,e,t,i){We.level>0&&rp[n]&&rp[n].call(null,e,t,i)}function AR(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const ER={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:AR,parseTextSync:JSON.parse};function RR(){const n="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(We.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:We,_registerLoggers:wR},bE([ER,[SR,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const CR=RR();function Kp(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const gd={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function MR(n){const e={};for(const[t,i]of Object.entries(n))e[t]=PR(i);return e}function PR(n){let e=eb(n);if(e!=="object")return{value:n,...gd[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...gd[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=eb(n.value),{...n,...gd[e],type:e}):{type:"object",value:null};throw new Error("props")}function eb(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const OR=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,IR=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,NR={vertex:OR,fragment:IR},tb=/void\s+main\s*\([^)]*\)\s*\{\n?/,nb=/}\n?[^{}]*$/,md=[],qc="__LUMA_INJECT_DECLARATIONS__";function kR(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=DR(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function DR(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function fu(n,e,t,i=!1){const s=e==="vertex";for(const a in t){const l=t[a];l.sort((h,d)=>h.order-d.order),md.length=l.length;for(let h=0,d=l.length;h<d;++h)md[h]=l[h].injection;const u=`${md.join(`
`)}
`;switch(a){case"vs:#decl":s&&(n=n.replace(qc,u));break;case"vs:#main-start":s&&(n=n.replace(tb,h=>h+u));break;case"vs:#main-end":s&&(n=n.replace(nb,h=>u+h));break;case"fs:#decl":s||(n=n.replace(qc,u));break;case"fs:#main-start":s||(n=n.replace(tb,h=>h+u));break;case"fs:#main-end":s||(n=n.replace(nb,h=>u+h));break;default:n=n.replace(a,h=>h+u)}}return n=n.replace(qc,""),i&&(n=n.replace(/\}\s*$/,a=>a+NR[e])),n}function hu(n){n.map(e=>BR(e))}function BR(n){if(n.instance)return;hu(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:kR(i),parsedDeprecations:UR(t)};e&&(s.propValidators=MR(e)),n.instance=s;let a={};e&&(a=Object.entries(e).reduce((l,[u,h])=>{const d=h?.value;return d&&(l[u]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...a}}function Jx(n,e,t){n.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function UR(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function Zp(n){hu(n);const e={},t={};e3({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,a)=>t[a]-t[s]).map(s=>e[s]);return hu(i),i}function e3(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(s[a.name]===void 0||s[a.name]<t)&&(s[a.name]=t);for(const a of e)a.dependencies&&e3({modules:a.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function LR(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function FR(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=ib(n,zR),n;case"fragment":return n=ib(n,VR),n;default:throw new Error(e)}}const t3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],zR=[...t3,[ap("attribute"),"in $1"],[ap("varying"),"out $1"]],VR=[...t3,[ap("varying"),"in $1"]];function ib(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function ap(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function n3(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const a=e[i];a.sort((l,u)=>l.order-u.order);for(const l of a)t+=`  ${l.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function i3(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[a,l]=s.split(":"),u=s.replace(/\(.+/,""),h=Object.assign(i,{signature:l});switch(a){case"vs":e.vertex[u]=h;break;case"fs":e.fragment[u]=h;break;default:throw new Error(a)}}return e}function HR(n,e){return{name:jR(n,e),language:"glsl",version:$R(n)}}function jR(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function $R(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const s3=`

${qc}
`,WR=`precision highp float;
`;function XR(n){const e=Zp(n.modules||[]);return{source:qR(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:r3(e)}}function YR(n){const{vs:e,fs:t}=n,i=Zp(n.modules||[]);return{vs:sb(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:sb(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:r3(i)}}function qR(n,e){const{source:t,stage:i,modules:s,hookFunctions:a=[],inject:l={},log:u}=e;Kp(typeof t=="string","shader source must be a string");const h=t;let d="";const p=i3(a),_={},y={},v={};for(const E in l){const R=typeof l[E]=="string"?{injection:l[E],order:0}:l[E],P=/^(v|f)s:(#)?([\w-]+)$/.exec(E);if(P){const D=P[2],M=P[3];D?M==="decl"?y[E]=[R]:v[E]=[R]:_[E]=[R]}else v[E]=[R]}const T=s;for(const E of T){u&&Jx(E,h,u);const R=a3(E,"wgsl");d+=R;const P=E.injections?.[i]||{};for(const D in P){const M=/^(v|f)s:#([\w-]+)$/.exec(D);if(M){const H=M[2]==="decl"?y:v;H[D]=H[D]||[],H[D].push(P[D])}else _[D]=_[D]||[],_[D].push(P[D])}}return d+=s3,d=fu(d,i,y),d+=n3(p[i],_),d+=h,d=fu(d,i,v),d}function sb(n,e){const{id:t,source:i,stage:s,language:a="glsl",modules:l,defines:u={},hookFunctions:h=[],inject:d={},prologue:p=!0,log:_}=e;Kp(typeof i=="string","shader source must be a string");const y=a==="glsl"?HR(i).version:-1,v=n.shaderLanguageVersion,T=y===100?"#version 100":"#version 300 es",R=i.split(`
`).slice(1).join(`
`),P={};l.forEach(fe=>{Object.assign(P,fe.defines)}),Object.assign(P,u);let D="";switch(a){case"wgsl":break;case"glsl":D=p?`${T}

// ----- PROLOGUE -------------------------
${KR({id:t,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${LR(n)}
${s==="fragment"?WR:""}

// ----- APPLICATION DEFINES -------------------------

${ZR(P)}

`:`${T}
`;break}const M=i3(h),L={},H={},J={};for(const fe in d){const de=typeof d[fe]=="string"?{injection:d[fe],order:0}:d[fe],le=/^(v|f)s:(#)?([\w-]+)$/.exec(fe);if(le){const _e=le[2],Se=le[3];_e?Se==="decl"?H[fe]=[de]:J[fe]=[de]:L[fe]=[de]}else J[fe]=[de]}for(const fe of l){_&&Jx(fe,R,_);const de=a3(fe,s);D+=de;const le=fe.instance?.normalizedInjections[s]||{};for(const _e in le){const Se=/^(v|f)s:#([\w-]+)$/.exec(_e);if(Se){const Ee=Se[2]==="decl"?H:J;Ee[_e]=Ee[_e]||[],Ee[_e].push(le[_e])}else L[_e]=L[_e]||[],L[_e].push(le[_e])}}return D+="// ----- MAIN SHADER SOURCE -------------------------",D+=s3,D=fu(D,s,H),D+=n3(M[s],L),D+=R,D=fu(D,s,J),a==="glsl"&&y!==v&&(D=FR(D,s)),D.trim()}function r3(n){return function(t){const i={};for(const s of n){const a=s.getUniforms?.(t,i);Object.assign(i,a)}return i}}function KR(n){const{id:e,source:t,stage:i}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function ZR(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function a3(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:Kp(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const QR=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,GR=/^\s*\#\s*endif\s*$/;function JR(n,e){const t=n.split(`
`),i=[];let s=!0,a=null;for(const l of t){const u=l.match(QR),h=l.match(GR);u?(a=u[1],s=!!e?.defines?.[a]):h?s=!0:s&&i.push(l)}return i.join(`
`)}class tr{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return tr.defaultShaderAssembler=tr.defaultShaderAssembler||new tr,tr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:a}=XR({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?JR(s):s,getUniforms:a,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...YR({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let a=0,l=this._defaultModules.length;a<l;++a){const u=this._defaultModules[a],h=u.name;t[s++]=u,i[h]=!0}for(let a=0,l=e.length;a<l;++a){const u=e[a],h=u.name;i[h]||(t[s++]=u,i[h]=!0)}return t.length=s,hu(t),t}}const eC=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,tC=`#version 300 es
${eC}`;function nC(n){const{input:e,inputChannels:t,output:i}={};if(!e)return tC;if(!t)throw new Error("inputChannels");const s=iC(t),a=sC(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${a};
}`}function iC(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function sC(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class rC{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ku({id:e})),this.stats.get(e)}}const o3=new rC,oe=new il({id:"luma.gl"}),_d={};function Bu(n="id"){_d[n]=_d[n]||1;const e=_d[n]++;return`${n}-${e}`}let ut=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=aC(t,i);const s=this.props.id!=="undefined"?this.props.id:Bu(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function aC(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}class ht extends ut{static defaultProps={...ut.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&ht.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,ht.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const s=ArrayBuffer.isView(e)?e.buffer:e,a=Math.min(e?e.byteLength:i,ht.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(a):t===0&&i===s.byteLength?this.debugData=s.slice(0,a):this.debugData=s.slice(t,t+a)}}function l3(n){const e=rb[n],t=oC(e),i=n.includes("norm"),s=!i&&!n.startsWith("float"),a=n.startsWith("s");return{dataType:rb[n],byteLength:t,integer:s,signed:a,normalized:i}}function oC(n){return lC[n]}const rb={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},lC={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Jt="texture-compression-bc",lt="texture-compression-astc",ci="texture-compression-etc2",cC="texture-compression-etc1-webgl",Rc="texture-compression-pvrtc-webgl",yd="texture-compression-atc-webgl",Cc="float32-renderable-webgl",bd="float16-renderable-webgl",uC="rgb9e5ufloat-renderable-webgl",vd="snorm8-renderable-webgl",Eo="norm16-renderable-webgl",xd="snorm16-renderable-webgl",Mc="float32-filterable",ab="float16-filterable-webgl";function c3(n){const e=fC[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const fC={r8unorm:{},r8snorm:{render:vd},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:vd},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:bd,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Eo},"r16snorm-webgl":{f:xd},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:vd},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:bd,filter:ab},"rg16unorm-webgl":{render:Eo},"rg16snorm-webgl":{render:xd},r32uint:{},r32sint:{},r32float:{render:Cc,filter:Mc},rgb9e5ufloat:{channels:"rgb",packed:!0,render:uC},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Cc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Eo},"rgb16snorm-webgl":{f:Eo},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Mc},rgba16uint:{},rgba16sint:{},rgba16float:{render:bd,filter:ab},"rgba16unorm-webgl":{render:Eo},"rgba16snorm-webgl":{render:xd},"rgb32float-webgl":{render:Cc,filter:Mc},rgba32uint:{},rgba32sint:{},rgba32float:{render:Cc,filter:Mc},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Jt},"bc1-rgb-unorm-srgb-webgl":{f:Jt},"bc1-rgba-unorm":{f:Jt},"bc1-rgba-unorm-srgb":{f:Jt},"bc2-rgba-unorm":{f:Jt},"bc2-rgba-unorm-srgb":{f:Jt},"bc3-rgba-unorm":{f:Jt},"bc3-rgba-unorm-srgb":{f:Jt},"bc4-r-unorm":{f:Jt},"bc4-r-snorm":{f:Jt},"bc5-rg-unorm":{f:Jt},"bc5-rg-snorm":{f:Jt},"bc6h-rgb-ufloat":{f:Jt},"bc6h-rgb-float":{f:Jt},"bc7-rgba-unorm":{f:Jt},"bc7-rgba-unorm-srgb":{f:Jt},"etc2-rgb8unorm":{f:ci},"etc2-rgb8unorm-srgb":{f:ci},"etc2-rgb8a1unorm":{f:ci},"etc2-rgb8a1unorm-srgb":{f:ci},"etc2-rgba8unorm":{f:ci},"etc2-rgba8unorm-srgb":{f:ci},"eac-r11unorm":{f:ci},"eac-r11snorm":{f:ci},"eac-rg11unorm":{f:ci},"eac-rg11snorm":{f:ci},"astc-4x4-unorm":{f:lt},"astc-4x4-unorm-srgb":{f:lt},"astc-5x4-unorm":{f:lt},"astc-5x4-unorm-srgb":{f:lt},"astc-5x5-unorm":{f:lt},"astc-5x5-unorm-srgb":{f:lt},"astc-6x5-unorm":{f:lt},"astc-6x5-unorm-srgb":{f:lt},"astc-6x6-unorm":{f:lt},"astc-6x6-unorm-srgb":{f:lt},"astc-8x5-unorm":{f:lt},"astc-8x5-unorm-srgb":{f:lt},"astc-8x6-unorm":{f:lt},"astc-8x6-unorm-srgb":{f:lt},"astc-8x8-unorm":{f:lt},"astc-8x8-unorm-srgb":{f:lt},"astc-10x5-unorm":{f:lt},"astc-10x5-unorm-srgb":{f:lt},"astc-10x6-unorm":{f:lt},"astc-10x6-unorm-srgb":{f:lt},"astc-10x8-unorm":{f:lt},"astc-10x8-unorm-srgb":{f:lt},"astc-10x10-unorm":{f:lt},"astc-10x10-unorm-srgb":{f:lt},"astc-12x10-unorm":{f:lt},"astc-12x10-unorm-srgb":{f:lt},"astc-12x12-unorm":{f:lt},"astc-12x12-unorm-srgb":{f:lt},"pvrtc-rgb4unorm-webgl":{f:Rc},"pvrtc-rgba4unorm-webgl":{f:Rc},"pvrtc-rbg2unorm-webgl":{f:Rc},"pvrtc-rgba2unorm-webgl":{f:Rc},"etc1-rbg-unorm-webgl":{f:cC},"atc-rgb-unorm-webgl":{f:yd},"atc-rgba-unorm-webgl":{f:yd},"atc-rgbai-unorm-webgl":{f:yd}},hC=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],dC=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function u3(n){return hC.some(e=>n.startsWith(e))}function Qp(n){let e=pC(n);if(u3(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=gC(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=dC.exec(n);if(t){const[,i,s,a,l,u]=t,h=`${a}${s}`,d=l3(h),p=d.byteLength*8,_=i.length,y=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:n,attachment:e.attachment,dataType:d.dataType,components:_,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function pC(n){const e=c3(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function gC(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function mC(n){const e=c3(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=Qp(n),s=n.startsWith("depth")||n.startsWith("stencil"),a=i?.signed,l=i?.integer,u=i?.webgl;return t.render&&=!a,t.filter&&=!s&&!a&&!l&&!u,t}class _C{}class yC{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Os{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>oe.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:oe.get("debug")||void 0,debugShaders:oe.get("debug-shaders")||void 0,debugFramebuffers:!!oe.get("debug-framebuffers"),debugWebGL:!!oe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Os.defaultProps,...e},this.id=this.props.id||Bu(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=o3;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=mC(e),i=l=>(typeof l=="string"?this.features.has(l):l)??!0,s=i(t.create),a={format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(a)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return u3(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&ht.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":oe.warn("indices buffer content must be of integer type")()),t}}const bC=fr()&&typeof document<"u",vC=()=>bC&&document.readyState==="complete",xC="set luma.log.level=1 (or higher) to trace rendering",ob="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class sa{static defaultProps={...Os.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=TC().then(()=>{oe.probe(2,"DOM is loaded")()});stats=o3;log=oe;VERSION="9.1.10";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw oe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),oe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");oe.error("This version of luma.gl has already been initialized")()}oe.log(1,`${this.VERSION} - ${xC}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(sa.defaultProps,e)}async createDevice(e={}){e={...sa.defaultProps,...e},e.waitForPageLoad&&await sa.pageLoaded;const t=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const l=await(this.getAdapterMap(e.adapters)||t).get(i)?.create?.(e);if(l)return l;throw new Error(ob)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await sa.pageLoaded,e.handle===null&&(i="unknown");const a=await t.get(i)?.attach?.(null);if(a)return a;throw new Error(ob)}enforceWebGL2(e=!0,t=[]){const s=this.getAdapterMap(t).get("webgl");s||oe.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}registerDevices(e){oe.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}}const op=new sa;function TC(){return vC()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class SC{}class Gp{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Gp.defaultProps,...e},e=this.props,!fr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=AC(e.canvas):this.canvas=e.canvas;else{const t=EC(e),i=wC(e?.container||null);i.insertBefore(t,i.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,a]=this.getDrawingBufferSize();return RC(e,i,s,a,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!s)&&(oe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const a=this._canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==s||a.devicePixelRatio!==e){let l=e;const u=Math.floor(i*l),h=Math.floor(s*l);if(this.htmlCanvas.width=u,this.htmlCanvas.height=h,this.device.gl){const[p,_]=this.getDrawingBufferSize();(p!==u||_!==h)&&(l=Math.min(p/i,_/s),this.htmlCanvas.width=Math.floor(i*l),this.htmlCanvas.height=Math.floor(s*l),oe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function wC(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function AC(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function EC(n){const{width:e,height:t}=n,i=document.createElement("canvas");return i.id=Bu("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function RC(n,e,t,i,s){const a=n,l=lb(a[0],e,t);let u=cb(a[1],e,i,s),h=lb(a[0]+1,e,t);const d=h===t-1?h:h-1;h=cb(a[1]+1,e,i,s);let p;return s?(h=h===0?h:h+1,p=u,u=h):p=h===i-1?h:h-1,{x:l,y:u,width:Math.max(d-l+1,1),height:Math.max(p-u+1,1)}}function lb(n,e,t){return Math.min(Math.round(n*e),t-1)}function cb(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class ct extends ut{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...ut.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=ct.normalizeProps(e,t),super(e,t,ct.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=ct.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?ct.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return ct.getTextureDataSize(e[0]);if(ct.isExternalImage(e))return ct.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const i={...t},s=e?.props?._resourceDefaults?.texture||{};Object.assign(i,s);const{width:a,height:l}=i;return typeof a=="number"&&(i.width=Math.max(1,Math.ceil(a))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}}class Uu extends ut{static defaultProps={...ut.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Uu.defaultProps)}}function CC(n,e,t){let i="";const s=e.split(/\r?\n/),a=n.slice().sort((l,u)=>l.lineNum-u.lineNum);switch(t?.showSourceCode||"no"){case"all":let l=0;for(let u=1;u<=s.length;u++)for(i+=f3(s[u-1],u,t);a.length>l&&a[l].lineNum===u;){const h=a[l++];i+=ub(h,s,h.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const u of n)i+=ub(u,s,u.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function ub(n,e,t,i){if(i?.inlineSource){const a=MC(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${a}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function MC(n,e,t){let i="";for(let s=e-2;s<=e;s++){const a=n[s-1];a!==void 0&&(i+=f3(a,e,t))}return i}function f3(n,e,t){const i=t?.html?OC(n):n;return`${PC(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function PC(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function OC(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Lu extends ut{static defaultProps={...ut.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:IC(t),...t},Lu.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const t=h3(this.source),i=`${this.stage} ${t}`;let s=CC(e,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}}function IC(n){return h3(n.source)||n.id||Bu(`unnamed ${n.stage}-shader`)}function h3(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}class qo extends ut{static defaultProps={...ut.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=qo.normalizeProps(e,t),super(e,t,qo.defaultProps)}static normalizeProps(e,t){const i=e?.props?._resourceDefaults?.sampler||{};return{...t,...i}}}class Fu extends ut{static defaultProps={...ut.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,Fu.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(s=>s.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||i!==this.width,this.width=i,this.height=s}t&&(oe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const s=this.createColorTexture(t,i);return this.attachResource(s),s.view}return t instanceof ct?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof ct?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:ct.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ct.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}}class pa extends ut{static defaultProps={...ut.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,pa.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class er extends ut{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...ut.defaultProps,framebuffer:null,parameters:void 0,clearColor:er.defaultClearColor,clearColors:void 0,clearDepth:er.defaultClearDepth,clearStencil:er.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=er.normalizeProps(e,t),super(e,t,er.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}class du extends ut{static defaultProps={...ut.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,du.defaultProps),this.shaderLayout=t.shaderLayout}}class Jp extends ut{static defaultProps={...ut.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Jp.defaultProps)}}class eg extends ut{static defaultProps={...ut.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,eg.defaultProps)}}function NC(n){const[e,t]=DC[n],i=e==="i32"||e==="u32",s=e!=="u32",a=BC[e]*t,l=kC(e,t);return{dataType:e,components:t,defaultVertexFormat:l,byteLength:a,integer:i,signed:s}}function kC(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const DC={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},BC={f32:4,f16:2,i32:4,u32:4};function d3(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,a=i?parseInt(i):1,l=l3(s),u={type:s,components:a,byteLength:l.byteLength*a,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(u.webglOnly=!0),u}function p3(n,e){const t={};for(const i of n.attributes){const s=LC(n,e,i.name);s&&(t[i.name]=s)}return t}function UC(n,e,t=16){const i=p3(n,e),s=new Array(t).fill(null);for(const a of Object.values(i))s[a.location]=a;return s}function LC(n,e,t){const i=FC(n,t),s=zC(e,t);if(!i)return null;const a=NC(i.type),l=s?.vertexFormat||a.defaultVertexFormat,u=d3(l);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:a.dataType,shaderComponents:a.components,vertexFormat:l,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:a.integer,stepMode:s?.stepMode||i.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function FC(n,e){const t=n.attributes.find(i=>i.name===e);return t||oe.warn(`shader layout attribute "${e}" not present in shader`),t||null}function zC(n,e){VC(n);let t=HC(n,e);return t||(t=jC(n,e),t)?t:(oe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function VC(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&oe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function HC(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function jC(n,e){for(const t of n){let i=t.byteStride;if(typeof t.byteStride!="number")for(const a of t.attributes||[]){const l=d3(a.format);i+=l.byteLength}const s=t.attributes?.find(a=>a.attribute===e);if(s)return{attributeName:s.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}class tg extends ut{static defaultProps={...ut.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,tg.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=t.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=UC(i,s,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}class ng extends ut{static defaultProps={...ut.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,ng.defaultProps)}}class ig extends ut{static defaultProps={...ut.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,ig.defaultProps)}}const $C={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function WC(n){return $C[n]}function XC(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let Pc;function g3(n){return(!Pc||Pc.byteLength<n)&&(Pc=new ArrayBuffer(n)),Pc}function YC(n,e){const t=g3(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function qC(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function pu(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":qC(n)}const fb=1024;class KC{layout={};byteLength;constructor(e){let t=0;for(const[s,a]of Object.entries(e)){const l=WC(a),{type:u,components:h}=l;t=XC(t,h);const d=t;t+=h,this.layout[s]={type:u,size:h,offset:d}}t+=(4-t%4)%4;const i=t*4;this.byteLength=Math.max(i,fb)}getData(e){const t=Math.max(this.byteLength,fb),i=g3(t),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[a,l]of Object.entries(e)){const u=this.layout[a];if(!u){oe.warn(`Supplied uniform value ${a} not present in uniform block layout`)();continue}const{type:h,size:d,offset:p}=u,_=s[h];if(d===1){if(typeof l!="number"&&typeof l!="boolean"){oe.warn(`Supplied value for single component uniform ${a} is not a number: ${l}`)();continue}_[p]=Number(l)}else{if(!pu(l)){oe.warn(`Supplied value for multi component / array uniform ${a} is not a numeric array: ${l}`)();continue}_.set(l,p)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function ZC(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!pu(i))return!1;if(pu(s)&&i.length===s.length){for(let a=0;a<i.length;++a)if(s[a]!==i[a])return!1}return!0}function QC(n){return pu(n)?n.slice():n}class GC{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){ZC(this.uniforms[e],t)||(this.uniforms[e]=QC(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class JC{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const s=t,a=new KC(i.uniformTypes||{});this.uniformBufferLayouts.set(s,a);const l=new GC({name:t});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),a=e.createBuffer({usage:ht.UNIFORM|ht.COPY_DST,byteLength:s}),l=this.getUniformBufferData(t);return a.write(l),a}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:ht.UNIFORM|ht.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&oe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&t?.needsRedraw){s||=t.needsRedraw;const a=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(a);const l=this.uniformBlocks.get(e)?.getAllUniforms();oe.log(4,`Writing to uniform buffer ${String(e)}`,a,l)()}return s}}function m3(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function _3(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function eM(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let s=m3(n);if(s==="uint8"&&t&&i===1)return"unorm8-webgl";if(s==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}class Td{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const a=i.findIndex(l=>l.name===s.name);a<0?i.push(s):i[a]=s}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&oe.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function tM(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=e.slice();return i.sort((s,a)=>{const l=s.attributes?s.attributes.map(p=>p.attribute):[s.name],u=a.attributes?a.attributes.map(p=>p.attribute):[a.name],h=Math.min(...l.map(p=>t[p])),d=Math.min(...u.map(p=>t[p]));return h-d}),i}class zn{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class hb{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Rs extends zn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Is extends zn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class lp extends zn{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class or extends zn{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var As;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(As||(As={}));class Oc{constructor(e,t,i,s,a,l,u){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=a,this.resourceType=l,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class nM{constructor(e,t){this.name=e,this.type=t}}class iM{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}}class db{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}}class sM{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}class rM{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class aM{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class oM{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function lM(n){var e=(32768&n)>>15,t=(31744&n)>>10,i=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const y3=new Float32Array(1),cM=new Int32Array(y3.buffer),en=new Uint16Array(1);function uM(n){y3[0]=n;const e=cM[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return en[0]=t<<15|31744|(s!==0?512:0),en[0];if(i===0){if(s===0)return en[0]=t<<15,en[0];s|=8388608;let a=113;for(;!(8388608&s);)s<<=1,a--;return i=127-a,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),en[0]=t<<15|i<<10|s>>13,en[0]):(en[0]=t<<15,en[0])}return i=i-127+15,i>=31?(en[0]=t<<15|31744,en[0]):i<=0?i<-10?(en[0]=t<<15,en[0]):(s=(8388608|s)>>1-i,en[0]=t<<15|s>>13,en[0]):(s>>=13,en[0]=t<<15|i<<10|s,en[0])}const sg=new Uint32Array(1),b3=new Float32Array(sg.buffer,0,1);function pb(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return sg[0]=e,b3[0]}function fM(n,e,t,i,s,a,l,u,h){const d=i*(l>>=s)*(a>>=s)+t*l+e*u;switch(h){case"r8unorm":return[et(n,d,"8unorm",1)[0]];case"r8snorm":return[et(n,d,"8snorm",1)[0]];case"r8uint":return[et(n,d,"8uint",1)[0]];case"r8sint":return[et(n,d,"8sint",1)[0]];case"rg8unorm":{const p=et(n,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=et(n,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=et(n,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=et(n,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=et(n,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=et(n,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=et(n,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=et(n,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=et(n,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[et(n,d,"16uint",1)[0]];case"r16sint":return[et(n,d,"16sint",1)[0]];case"r16float":return[et(n,d,"16float",1)[0]];case"rg16uint":{const p=et(n,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=et(n,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=et(n,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=et(n,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=et(n,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=et(n,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[et(n,d,"32uint",1)[0]];case"r32sint":return[et(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[et(n,d,"32float",1)[0]];case"rg32uint":{const p=et(n,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=et(n,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=et(n,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=et(n,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=et(n,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=et(n,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,d,1)[0],_=(4192256&p)>>11,y=(4290772992&p)>>22;return[pb(2047&p),pb(_),(function(v){const T=112+(v>>5&31)<<23|(31&v)<<18;return sg[0]=T,b3[0]})(y),1]}}return null}function et(n,e,t,i){const s=[0,0,0,0];for(let a=0;a<i;++a)switch(t){case"8unorm":s[a]=n[e]/255,e++;break;case"8snorm":s[a]=n[e]/255*2-1,e++;break;case"8uint":s[a]=n[e],e++;break;case"8sint":s[a]=n[e]-127,e++;break;case"16uint":s[a]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[a]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[a]=lM(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":s[a]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[a]=new Float32Array(n.buffer,e,1)[0],e+=4}return s}function tt(n,e,t,i,s){for(let a=0;a<i;++a)switch(t){case"8unorm":n[e]=255*s[a],e++;break;case"8snorm":n[e]=.5*(s[a]+1)*255,e++;break;case"8uint":n[e]=s[a],e++;break;case"8sint":n[e]=s[a]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16float":{const l=uM(s[a]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[a],e+=4}return s}const Sd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class $n{constructor(){this.id=$n._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(gu.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(mu.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}$n._id=0;class gu extends $n{}gu.instance=new gu;class mu extends $n{}mu.instance=new mu;const v3=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class gt extends $n{constructor(){super()}}class Ko extends gt{constructor(e,t,i,s,a,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=a,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class hM extends gt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class x3 extends gt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class cp extends gt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class T3 extends gt{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class Fi extends gt{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class rg extends gt{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class zo extends gt{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Kc extends gt{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var ra,Io,X,F;(n=>{n.increment="++",n.decrement="--"})(ra||(ra={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(ra||(ra={}));class S3 extends gt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Io||(Io={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Io||(Io={}));class w3 extends gt{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ag extends gt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return v3.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class A3 extends gt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class E3 extends gt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class R3 extends gt{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class C3 extends gt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class dM extends gt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class pM extends gt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class M3 extends gt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class og extends gt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class gM extends gt{constructor(){super()}get astNodeType(){return"discard"}}class P3 extends gt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class O3 extends gt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class se extends gt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=se._priority.get(t.name);se._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?se.i32:t}getTypeName(){return this.name}}se.x32=new se("x32"),se.f32=new se("f32"),se.i32=new se("i32"),se.u32=new se("u32"),se.f16=new se("f16"),se.bool=new se("bool"),se.void=new se("void"),se._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class gb extends se{constructor(e){super(e)}}class Ui extends se{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class $ extends se{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}$.vec2f=new $("vec2",se.f32,null),$.vec3f=new $("vec3",se.f32,null),$.vec4f=new $("vec4",se.f32,null),$.vec2i=new $("vec2",se.i32,null),$.vec3i=new $("vec3",se.i32,null),$.vec4i=new $("vec4",se.i32,null),$.vec2u=new $("vec2",se.u32,null),$.vec3u=new $("vec3",se.u32,null),$.vec4u=new $("vec4",se.u32,null),$.vec2h=new $("vec2",se.f16,null),$.vec3h=new $("vec3",se.f16,null),$.vec4h=new $("vec4",se.f16,null),$.vec2b=new $("vec2",se.bool,null),$.vec3b=new $("vec3",se.bool,null),$.vec4b=new $("vec4",se.bool,null),$.mat2x2f=new $("mat2x2",se.f32,null),$.mat2x3f=new $("mat2x3",se.f32,null),$.mat2x4f=new $("mat2x4",se.f32,null),$.mat3x2f=new $("mat3x2",se.f32,null),$.mat3x3f=new $("mat3x3",se.f32,null),$.mat3x4f=new $("mat3x4",se.f32,null),$.mat4x2f=new $("mat4x2",se.f32,null),$.mat4x3f=new $("mat4x3",se.f32,null),$.mat4x4f=new $("mat4x4",se.f32,null),$.mat2x2h=new $("mat2x2",se.f16,null),$.mat2x3h=new $("mat2x3",se.f16,null),$.mat2x4h=new $("mat2x4",se.f16,null),$.mat3x2h=new $("mat3x2",se.f16,null),$.mat3x3h=new $("mat3x3",se.f16,null),$.mat3x4h=new $("mat3x4",se.f16,null),$.mat4x2h=new $("mat4x2",se.f16,null),$.mat4x3h=new $("mat4x3",se.f16,null),$.mat4x4h=new $("mat4x4",se.f16,null),$.mat2x2i=new $("mat2x2",se.i32,null),$.mat2x3i=new $("mat2x3",se.i32,null),$.mat2x4i=new $("mat2x4",se.i32,null),$.mat3x2i=new $("mat3x2",se.i32,null),$.mat3x3i=new $("mat3x3",se.i32,null),$.mat3x4i=new $("mat3x4",se.i32,null),$.mat4x2i=new $("mat4x2",se.i32,null),$.mat4x3i=new $("mat4x3",se.i32,null),$.mat4x4i=new $("mat4x4",se.i32,null),$.mat2x2u=new $("mat2x2",se.u32,null),$.mat2x3u=new $("mat2x3",se.u32,null),$.mat2x4u=new $("mat2x4",se.u32,null),$.mat3x2u=new $("mat3x2",se.u32,null),$.mat3x3u=new $("mat3x3",se.u32,null),$.mat3x4u=new $("mat3x4",se.u32,null),$.mat4x2u=new $("mat4x2",se.u32,null),$.mat4x3u=new $("mat4x3",se.u32,null),$.mat4x4u=new $("mat4x4",se.u32,null);class Zc extends se{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class Vo extends se{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class No extends se{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class ni extends $n{constructor(){super(),this.postfix=null}}class lr extends ni{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class fi extends ni{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class lg extends ni{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return v3.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Rn extends ni{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class I3 extends ni{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class Dt extends ni{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof U}get isVector(){return this.value instanceof C||this.value instanceof Ie}get scalarValue(){return this.value instanceof U?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof C||this.value instanceof Ie?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class N3 extends ni{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class ga extends ni{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class k3 extends ni{constructor(){super()}}class Ot extends k3{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Qn extends k3{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?se.f32:e.name==="u32"||t.name==="u32"?se.u32:se.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class D3 extends $n{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Qc extends ni{constructor(){super()}get astNodeType(){return"default"}}class B3 extends D3{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class U3 extends D3{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class mb extends $n{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class mM extends $n{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class _b extends $n{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class L3 extends $n{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class jn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=jn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}jn._id=0;class up extends jn{constructor(){super(new zn("void",null),null)}toString(){return"void"}}up.void=new up;class ea extends jn{constructor(e){super(new lp("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class U extends jn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new U(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new U(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new U(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof U))return void console.error("SetDataValue: Invalid value",t);let a=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?a=Math.floor(a):this.typeInfo.name==="bool"&&(a=a?1:0),this.data[0]=a}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function _M(n,e,t){const i=e.length;return i===2?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new C(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new C(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new C(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new C(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class C extends jn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new C(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new C(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new C(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof lr?console.error("TODO: Set vector postfix"):t instanceof C?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof or)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let a=this;for(;t!==null&&a!==null;){if(t instanceof ga){const l=t.index;let u=-1;if(l instanceof Dt){if(!(l.value instanceof U))return console.error(`GetSubData: Invalid array index ${l.value}`),null;u=l.value.value}else{const h=e.evalExpression(l,i);if(!(h instanceof U))return console.error("GetSubData: Unknown index type",l),null;u=h.value}if(u<0||u>=a.data.length)return console.error("GetSubData: Index out of range",u),null;if(a.data instanceof Float32Array){const h=new Float32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new U(h,s)}if(a.data instanceof Int32Array){const h=new Int32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new U(h,s)}if(a.data instanceof Uint32Array){const h=new Uint32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new U(h,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof lr))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let h=0;if(l==="x"||l==="r")h=0;else if(l==="y"||l==="g")h=1;else if(l==="z"||l==="b")h=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;h=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new U(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new U(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new U(d,s,this)}}const u=[];for(const h of l)h==="x"||h==="r"?u.push(this.data[0]):h==="y"||h==="g"?u.push(this.data[1]):h==="z"||h==="b"?u.push(this.data[2]):h==="w"||h==="a"?u.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);a=_M(e,u,s.name)}t=t.postfix}return a}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ie extends jn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Ie(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof lr?console.error("TODO: Set matrix postfix"):t instanceof Ie?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof or)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof ga){const a=t.index;let l=-1;if(a instanceof Dt){if(!(a.value instanceof U))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;l=a.value.value}else{const d=e.evalExpression(a,i);if(!(d instanceof U))return console.error("GetDataValue: Unknown index type",a),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const u=s.endsWith("h")?"h":"f";let h;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")h=new C(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${u}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")h=new C(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${u}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;h=new C(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${u}`))}return t.postfix?h.getSubData(e,t.postfix,i):h}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class xt extends jn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new xt(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let a=this.offset,l=this.typeInfo;for(;i;){if(i instanceof ga)if(l instanceof Is){const u=i.index;if(u instanceof Dt){if(!(u.value instanceof U))return void console.error(`SetDataValue: Invalid index type ${u.value}`);a+=u.value.value*l.stride}else{const h=e.evalExpression(u,s);if(!(h instanceof U))return void console.error("SetDataValue: Unknown index type",u);a+=h.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof lr))return void console.error("SetDataValue: Unknown postfix type",i);{const u=i.value;if(l instanceof Rs){let h=!1;for(const d of l.members)if(d.name===u){a+=d.offset,l=d.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${u} not found`)}else if(l instanceof zn){const h=l.getTypeName();let d=0;if(u==="x"||u==="r")d=0;else if(u==="y"||u==="g")d=1;else if(u==="z"||u==="b")d=2;else{if(u!=="w"&&u!=="a")return void console.error(`SetDataValue: Unknown member ${u}`);d=3}if(!(t instanceof U))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return h==="vec2f"?void(new Float32Array(this.buffer,a,2)[d]=p):h==="vec3f"?void(new Float32Array(this.buffer,a,3)[d]=p):h==="vec4f"?void(new Float32Array(this.buffer,a,4)[d]=p):h==="vec2i"?void(new Int32Array(this.buffer,a,2)[d]=p):h==="vec3i"?void(new Int32Array(this.buffer,a,3)[d]=p):h==="vec4i"?void(new Int32Array(this.buffer,a,4)[d]=p):h==="vec2u"?void(new Uint32Array(this.buffer,a,2)[d]=p):h==="vec3u"?void(new Uint32Array(this.buffer,a,3)[d]=p):h==="vec4u"?void(new Uint32Array(this.buffer,a,4)[d]=p):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(e,t,l,a,s)}setData(e,t,i,s,a){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool"){if(l==="vec2f"||l==="vec2h"){const u=new Float32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3f"||l==="vec3h"){const u=new Float32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4f"||l==="vec4h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2i"){const u=new Int32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3i"){const u=new Int32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4i"){const u=new Int32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2u"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3u"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4u"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2b"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3b"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4b"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof C?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="mat2x2f"||l==="mat2x2h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="mat2x3f"||l==="mat2x3h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(l==="mat2x4f"||l==="mat2x4h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(l==="mat3x2f"||l==="mat3x2h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(l==="mat3x3f"||l==="mat3x3h"){const u=new Float32Array(this.buffer,s,9);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8]))}if(l==="mat3x4f"||l==="mat3x4h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(l==="mat4x2f"||l==="mat4x2h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(l==="mat4x3f"||l==="mat4x3h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(l==="mat4x4f"||l==="mat4x4h"){const u=new Float32Array(this.buffer,s,16);return void(t instanceof Ie?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11],u[12]=t.data[12],u[13]=t.data[13],u[14]=t.data[14],u[15]=t.data[15]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11],u[12]=t[12],u[13]=t[13],u[14]=t[14],u[15]=t[15]))}if(t instanceof xt){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`)}else t instanceof U&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof U&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,a,l;if(t===null)return this;let u=this.offset,h=this.typeInfo;for(;t;){if(t instanceof ga){const p=t.index,_=p instanceof ni?e.evalExpression(p,i):p;let y=0;if(_ instanceof U?y=_.value:typeof _=="number"?y=_:console.error("GetDataValue: Invalid index type",p),h instanceof Is)u+=y*h.stride,h=h.format;else{const v=h.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(u+=16*y,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(t instanceof lr))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(h instanceof Rs){let _=!1;for(const y of h.members)if(y.name===p){u+=y.offset,h=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${p} not found`),null}else if(h instanceof zn){const _=h.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(p.length>0&&p.length<5){let y="f";const v=[];for(let T=0;T<p.length;++T){const E=p[T].toLowerCase();let R=0;if(E==="x"||E==="r")R=0;else if(E==="y"||E==="g")R=1;else if(E==="z"||E==="b")R=2;else{if(E!=="w"&&E!=="a")return console.error(`Unknown member ${p}`),null;R=3}if(p.length===1){if(_.endsWith("f"))return this.buffer.byteLength<u+4*R+4?(console.log("Insufficient buffer data"),null):new U(new Float32Array(this.buffer,u+4*R,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new U(new Float32Array(this.buffer,u+4*R,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new U(new Int32Array(this.buffer,u+4*R,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new U(new Int32Array(this.buffer,u+4*R,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new U(new Uint32Array(this.buffer,u+4*R,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")v.push(new Float32Array(this.buffer,u,2)[R]);else if(_==="vec3f"){if(u+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const P=new Float32Array(this.buffer,u,3);v.push(P[R])}else if(_==="vec4f")v.push(new Float32Array(this.buffer,u,4)[R]);else if(_==="vec2i")y="i",v.push(new Int32Array(this.buffer,u,2)[R]);else if(_==="vec3i")y="i",v.push(new Int32Array(this.buffer,u,3)[R]);else if(_==="vec4i")y="i",v.push(new Int32Array(this.buffer,u,4)[R]);else if(_==="vec2u"){y="u";const P=new Uint32Array(this.buffer,u,2);v.push(P[R])}else _==="vec3u"?(y="u",v.push(new Uint32Array(this.buffer,u,3)[R])):_==="vec4u"&&(y="u",v.push(new Uint32Array(this.buffer,u,4)[R]))}return v.length===2?h=e.getTypeInfo(`vec2${y}`):v.length===3?h=e.getTypeInfo(`vec3${y}`):v.length===4?h=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new C(v,h,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}t=t.postfix}const d=h.getTypeName();return d==="f32"?new U(new Float32Array(this.buffer,u,1),h,this):d==="i32"?new U(new Int32Array(this.buffer,u,1),h,this):d==="u32"?new U(new Uint32Array(this.buffer,u,1),h,this):d==="vec2f"?new C(new Float32Array(this.buffer,u,2),h,this):d==="vec3f"?new C(new Float32Array(this.buffer,u,3),h,this):d==="vec4f"?new C(new Float32Array(this.buffer,u,4),h,this):d==="vec2i"?new C(new Int32Array(this.buffer,u,2),h,this):d==="vec3i"?new C(new Int32Array(this.buffer,u,3),h,this):d==="vec4i"?new C(new Int32Array(this.buffer,u,4),h,this):d==="vec2u"?new C(new Uint32Array(this.buffer,u,2),h,this):d==="vec3u"?new C(new Uint32Array(this.buffer,u,3),h,this):d==="vec4u"?new C(new Uint32Array(this.buffer,u,4),h,this):h instanceof or&&h.name==="atomic"?((s=h.format)===null||s===void 0?void 0:s.name)==="u32"?new U(new Uint32Array(this.buffer,u,1)[0],h.format,this):((a=h.format)===null||a===void 0?void 0:a.name)==="i32"?new U(new Int32Array(this.buffer,u,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=h.format)===null||l===void 0?void 0:l.name}`),null):new xt(this.buffer,h,u,this)}toString(){let e="";if(this.typeInfo instanceof Is)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof Rs?e+="{...}":e="[...]";return e}}class Li extends jn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new Li(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=Sd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Sd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Sd[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,a=this.depthOrArrayLayers,l=this.dimension;return i/t.blockWidth*(l==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*a}getPixel(e,t,i=0,s=0){const a=this.texelByteSize,l=this.bytesPerRow,u=this.height,h=this.data[s];return fM(new Uint8Array(h),e,t,i,s,u,l,a,this.format)}setPixel(e,t,i,s,a){const l=this.texelByteSize,u=this.bytesPerRow,h=this.height,d=this.data[s];(function(p,_,y,v,T,E,R,P,D,M){const L=v*(R>>=T)*(E>>=T)+y*R+_*P;switch(D){case"r8unorm":return void tt(p,L,"8unorm",1,M);case"r8snorm":return void tt(p,L,"8snorm",1,M);case"r8uint":return void tt(p,L,"8uint",1,M);case"r8sint":return void tt(p,L,"8sint",1,M);case"rg8unorm":return void tt(p,L,"8unorm",2,M);case"rg8snorm":return void tt(p,L,"8snorm",2,M);case"rg8uint":return void tt(p,L,"8uint",2,M);case"rg8sint":return void tt(p,L,"8sint",2,M);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void tt(p,L,"8unorm",4,M);case"rgba8snorm":return void tt(p,L,"8snorm",4,M);case"rgba8uint":return void tt(p,L,"8uint",4,M);case"rgba8sint":return void tt(p,L,"8sint",4,M);case"r16uint":return void tt(p,L,"16uint",1,M);case"r16sint":return void tt(p,L,"16sint",1,M);case"r16float":return void tt(p,L,"16float",1,M);case"rg16uint":return void tt(p,L,"16uint",2,M);case"rg16sint":return void tt(p,L,"16sint",2,M);case"rg16float":return void tt(p,L,"16float",2,M);case"rgba16uint":return void tt(p,L,"16uint",4,M);case"rgba16sint":return void tt(p,L,"16sint",4,M);case"rgba16float":return void tt(p,L,"16float",4,M);case"r32uint":return void tt(p,L,"32uint",1,M);case"r32sint":return void tt(p,L,"32sint",1,M);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void tt(p,L,"32float",1,M);case"rg32uint":return void tt(p,L,"32uint",2,M);case"rg32sint":return void tt(p,L,"32sint",2,M);case"rg32float":return void tt(p,L,"32float",2,M);case"rgba32uint":return void tt(p,L,"32uint",4,M);case"rgba32sint":return void tt(p,L,"32sint",4,M);case"rgba32float":return void tt(p,L,"32float",4,M);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,h,u,l,this.format,a)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(F||(F={}));class z{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class A{}X=A,A.none=new z("",F.reserved,""),A.eof=new z("EOF",F.token,""),A.reserved={asm:new z("asm",F.reserved,"asm"),bf16:new z("bf16",F.reserved,"bf16"),do:new z("do",F.reserved,"do"),enum:new z("enum",F.reserved,"enum"),f16:new z("f16",F.reserved,"f16"),f64:new z("f64",F.reserved,"f64"),handle:new z("handle",F.reserved,"handle"),i8:new z("i8",F.reserved,"i8"),i16:new z("i16",F.reserved,"i16"),i64:new z("i64",F.reserved,"i64"),mat:new z("mat",F.reserved,"mat"),premerge:new z("premerge",F.reserved,"premerge"),regardless:new z("regardless",F.reserved,"regardless"),typedef:new z("typedef",F.reserved,"typedef"),u8:new z("u8",F.reserved,"u8"),u16:new z("u16",F.reserved,"u16"),u64:new z("u64",F.reserved,"u64"),unless:new z("unless",F.reserved,"unless"),using:new z("using",F.reserved,"using"),vec:new z("vec",F.reserved,"vec"),void:new z("void",F.reserved,"void")},A.keywords={array:new z("array",F.keyword,"array"),atomic:new z("atomic",F.keyword,"atomic"),bool:new z("bool",F.keyword,"bool"),f32:new z("f32",F.keyword,"f32"),i32:new z("i32",F.keyword,"i32"),mat2x2:new z("mat2x2",F.keyword,"mat2x2"),mat2x3:new z("mat2x3",F.keyword,"mat2x3"),mat2x4:new z("mat2x4",F.keyword,"mat2x4"),mat3x2:new z("mat3x2",F.keyword,"mat3x2"),mat3x3:new z("mat3x3",F.keyword,"mat3x3"),mat3x4:new z("mat3x4",F.keyword,"mat3x4"),mat4x2:new z("mat4x2",F.keyword,"mat4x2"),mat4x3:new z("mat4x3",F.keyword,"mat4x3"),mat4x4:new z("mat4x4",F.keyword,"mat4x4"),ptr:new z("ptr",F.keyword,"ptr"),sampler:new z("sampler",F.keyword,"sampler"),sampler_comparison:new z("sampler_comparison",F.keyword,"sampler_comparison"),struct:new z("struct",F.keyword,"struct"),texture_1d:new z("texture_1d",F.keyword,"texture_1d"),texture_2d:new z("texture_2d",F.keyword,"texture_2d"),texture_2d_array:new z("texture_2d_array",F.keyword,"texture_2d_array"),texture_3d:new z("texture_3d",F.keyword,"texture_3d"),texture_cube:new z("texture_cube",F.keyword,"texture_cube"),texture_cube_array:new z("texture_cube_array",F.keyword,"texture_cube_array"),texture_multisampled_2d:new z("texture_multisampled_2d",F.keyword,"texture_multisampled_2d"),texture_storage_1d:new z("texture_storage_1d",F.keyword,"texture_storage_1d"),texture_storage_2d:new z("texture_storage_2d",F.keyword,"texture_storage_2d"),texture_storage_2d_array:new z("texture_storage_2d_array",F.keyword,"texture_storage_2d_array"),texture_storage_3d:new z("texture_storage_3d",F.keyword,"texture_storage_3d"),texture_depth_2d:new z("texture_depth_2d",F.keyword,"texture_depth_2d"),texture_depth_2d_array:new z("texture_depth_2d_array",F.keyword,"texture_depth_2d_array"),texture_depth_cube:new z("texture_depth_cube",F.keyword,"texture_depth_cube"),texture_depth_cube_array:new z("texture_depth_cube_array",F.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new z("texture_depth_multisampled_2d",F.keyword,"texture_depth_multisampled_2d"),texture_external:new z("texture_external",F.keyword,"texture_external"),u32:new z("u32",F.keyword,"u32"),vec2:new z("vec2",F.keyword,"vec2"),vec3:new z("vec3",F.keyword,"vec3"),vec4:new z("vec4",F.keyword,"vec4"),bitcast:new z("bitcast",F.keyword,"bitcast"),block:new z("block",F.keyword,"block"),break:new z("break",F.keyword,"break"),case:new z("case",F.keyword,"case"),continue:new z("continue",F.keyword,"continue"),continuing:new z("continuing",F.keyword,"continuing"),default:new z("default",F.keyword,"default"),diagnostic:new z("diagnostic",F.keyword,"diagnostic"),discard:new z("discard",F.keyword,"discard"),else:new z("else",F.keyword,"else"),enable:new z("enable",F.keyword,"enable"),fallthrough:new z("fallthrough",F.keyword,"fallthrough"),false:new z("false",F.keyword,"false"),fn:new z("fn",F.keyword,"fn"),for:new z("for",F.keyword,"for"),function:new z("function",F.keyword,"function"),if:new z("if",F.keyword,"if"),let:new z("let",F.keyword,"let"),const:new z("const",F.keyword,"const"),loop:new z("loop",F.keyword,"loop"),while:new z("while",F.keyword,"while"),private:new z("private",F.keyword,"private"),read:new z("read",F.keyword,"read"),read_write:new z("read_write",F.keyword,"read_write"),return:new z("return",F.keyword,"return"),requires:new z("requires",F.keyword,"requires"),storage:new z("storage",F.keyword,"storage"),switch:new z("switch",F.keyword,"switch"),true:new z("true",F.keyword,"true"),alias:new z("alias",F.keyword,"alias"),type:new z("type",F.keyword,"type"),uniform:new z("uniform",F.keyword,"uniform"),var:new z("var",F.keyword,"var"),override:new z("override",F.keyword,"override"),workgroup:new z("workgroup",F.keyword,"workgroup"),write:new z("write",F.keyword,"write"),r8unorm:new z("r8unorm",F.keyword,"r8unorm"),r8snorm:new z("r8snorm",F.keyword,"r8snorm"),r8uint:new z("r8uint",F.keyword,"r8uint"),r8sint:new z("r8sint",F.keyword,"r8sint"),r16uint:new z("r16uint",F.keyword,"r16uint"),r16sint:new z("r16sint",F.keyword,"r16sint"),r16float:new z("r16float",F.keyword,"r16float"),rg8unorm:new z("rg8unorm",F.keyword,"rg8unorm"),rg8snorm:new z("rg8snorm",F.keyword,"rg8snorm"),rg8uint:new z("rg8uint",F.keyword,"rg8uint"),rg8sint:new z("rg8sint",F.keyword,"rg8sint"),r32uint:new z("r32uint",F.keyword,"r32uint"),r32sint:new z("r32sint",F.keyword,"r32sint"),r32float:new z("r32float",F.keyword,"r32float"),rg16uint:new z("rg16uint",F.keyword,"rg16uint"),rg16sint:new z("rg16sint",F.keyword,"rg16sint"),rg16float:new z("rg16float",F.keyword,"rg16float"),rgba8unorm:new z("rgba8unorm",F.keyword,"rgba8unorm"),rgba8unorm_srgb:new z("rgba8unorm_srgb",F.keyword,"rgba8unorm_srgb"),rgba8snorm:new z("rgba8snorm",F.keyword,"rgba8snorm"),rgba8uint:new z("rgba8uint",F.keyword,"rgba8uint"),rgba8sint:new z("rgba8sint",F.keyword,"rgba8sint"),bgra8unorm:new z("bgra8unorm",F.keyword,"bgra8unorm"),bgra8unorm_srgb:new z("bgra8unorm_srgb",F.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new z("rgb10a2unorm",F.keyword,"rgb10a2unorm"),rg11b10float:new z("rg11b10float",F.keyword,"rg11b10float"),rg32uint:new z("rg32uint",F.keyword,"rg32uint"),rg32sint:new z("rg32sint",F.keyword,"rg32sint"),rg32float:new z("rg32float",F.keyword,"rg32float"),rgba16uint:new z("rgba16uint",F.keyword,"rgba16uint"),rgba16sint:new z("rgba16sint",F.keyword,"rgba16sint"),rgba16float:new z("rgba16float",F.keyword,"rgba16float"),rgba32uint:new z("rgba32uint",F.keyword,"rgba32uint"),rgba32sint:new z("rgba32sint",F.keyword,"rgba32sint"),rgba32float:new z("rgba32float",F.keyword,"rgba32float"),static_assert:new z("static_assert",F.keyword,"static_assert")},A.tokens={decimal_float_literal:new z("decimal_float_literal",F.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new z("hex_float_literal",F.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new z("int_literal",F.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new z("uint_literal",F.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new z("name",F.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new z("ident",F.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new z("and",F.token,"&"),and_and:new z("and_and",F.token,"&&"),arrow:new z("arrow ",F.token,"->"),attr:new z("attr",F.token,"@"),forward_slash:new z("forward_slash",F.token,"/"),bang:new z("bang",F.token,"!"),bracket_left:new z("bracket_left",F.token,"["),bracket_right:new z("bracket_right",F.token,"]"),brace_left:new z("brace_left",F.token,"{"),brace_right:new z("brace_right",F.token,"}"),colon:new z("colon",F.token,":"),comma:new z("comma",F.token,","),equal:new z("equal",F.token,"="),equal_equal:new z("equal_equal",F.token,"=="),not_equal:new z("not_equal",F.token,"!="),greater_than:new z("greater_than",F.token,">"),greater_than_equal:new z("greater_than_equal",F.token,">="),shift_right:new z("shift_right",F.token,">>"),less_than:new z("less_than",F.token,"<"),less_than_equal:new z("less_than_equal",F.token,"<="),shift_left:new z("shift_left",F.token,"<<"),modulo:new z("modulo",F.token,"%"),minus:new z("minus",F.token,"-"),minus_minus:new z("minus_minus",F.token,"--"),period:new z("period",F.token,"."),plus:new z("plus",F.token,"+"),plus_plus:new z("plus_plus",F.token,"++"),or:new z("or",F.token,"|"),or_or:new z("or_or",F.token,"||"),paren_left:new z("paren_left",F.token,"("),paren_right:new z("paren_right",F.token,")"),semicolon:new z("semicolon",F.token,";"),star:new z("star",F.token,"*"),tilde:new z("tilde",F.token,"~"),underscore:new z("underscore",F.token,"_"),xor:new z("xor",F.token,"^"),plus_equal:new z("plus_equal",F.token,"+="),minus_equal:new z("minus_equal",F.token,"-="),times_equal:new z("times_equal",F.token,"*="),division_equal:new z("division_equal",F.token,"/="),modulo_equal:new z("modulo_equal",F.token,"%="),and_equal:new z("and_equal",F.token,"&="),or_equal:new z("or_equal",F.token,"|="),xor_equal:new z("xor_equal",F.token,"^="),shift_right_equal:new z("shift_right_equal",F.token,">>="),shift_left_equal:new z("shift_left_equal",F.token,"<<=")},A.simpleTokens={"@":X.tokens.attr,"{":X.tokens.brace_left,"}":X.tokens.brace_right,":":X.tokens.colon,",":X.tokens.comma,"(":X.tokens.paren_left,")":X.tokens.paren_right,";":X.tokens.semicolon},A.literalTokens={"&":X.tokens.and,"&&":X.tokens.and_and,"->":X.tokens.arrow,"/":X.tokens.forward_slash,"!":X.tokens.bang,"[":X.tokens.bracket_left,"]":X.tokens.bracket_right,"=":X.tokens.equal,"==":X.tokens.equal_equal,"!=":X.tokens.not_equal,">":X.tokens.greater_than,">=":X.tokens.greater_than_equal,">>":X.tokens.shift_right,"<":X.tokens.less_than,"<=":X.tokens.less_than_equal,"<<":X.tokens.shift_left,"%":X.tokens.modulo,"-":X.tokens.minus,"--":X.tokens.minus_minus,".":X.tokens.period,"+":X.tokens.plus,"++":X.tokens.plus_plus,"|":X.tokens.or,"||":X.tokens.or_or,"*":X.tokens.star,"~":X.tokens.tilde,_:X.tokens.underscore,"^":X.tokens.xor,"+=":X.tokens.plus_equal,"-=":X.tokens.minus_equal,"*=":X.tokens.times_equal,"/=":X.tokens.division_equal,"%=":X.tokens.modulo_equal,"&=":X.tokens.and_equal,"|=":X.tokens.or_equal,"^=":X.tokens.xor_equal,">>=":X.tokens.shift_right_equal,"<<=":X.tokens.shift_left_equal},A.regexTokens={decimal_float_literal:X.tokens.decimal_float_literal,hex_float_literal:X.tokens.hex_float_literal,int_literal:X.tokens.int_literal,uint_literal:X.tokens.uint_literal,ident:X.tokens.ident},A.storage_class=[X.keywords.function,X.keywords.private,X.keywords.workgroup,X.keywords.uniform,X.keywords.storage],A.access_mode=[X.keywords.read,X.keywords.write,X.keywords.read_write],A.sampler_type=[X.keywords.sampler,X.keywords.sampler_comparison],A.sampled_texture_type=[X.keywords.texture_1d,X.keywords.texture_2d,X.keywords.texture_2d_array,X.keywords.texture_3d,X.keywords.texture_cube,X.keywords.texture_cube_array],A.multisampled_texture_type=[X.keywords.texture_multisampled_2d],A.storage_texture_type=[X.keywords.texture_storage_1d,X.keywords.texture_storage_2d,X.keywords.texture_storage_2d_array,X.keywords.texture_storage_3d],A.depth_texture_type=[X.keywords.texture_depth_2d,X.keywords.texture_depth_2d_array,X.keywords.texture_depth_cube,X.keywords.texture_depth_cube_array,X.keywords.texture_depth_multisampled_2d],A.texture_external_type=[X.keywords.texture_external],A.any_texture_type=[...X.sampled_texture_type,...X.multisampled_texture_type,...X.storage_texture_type,...X.depth_texture_type,...X.texture_external_type],A.texel_format=[X.keywords.r8unorm,X.keywords.r8snorm,X.keywords.r8uint,X.keywords.r8sint,X.keywords.r16uint,X.keywords.r16sint,X.keywords.r16float,X.keywords.rg8unorm,X.keywords.rg8snorm,X.keywords.rg8uint,X.keywords.rg8sint,X.keywords.r32uint,X.keywords.r32sint,X.keywords.r32float,X.keywords.rg16uint,X.keywords.rg16sint,X.keywords.rg16float,X.keywords.rgba8unorm,X.keywords.rgba8unorm_srgb,X.keywords.rgba8snorm,X.keywords.rgba8uint,X.keywords.rgba8sint,X.keywords.bgra8unorm,X.keywords.bgra8unorm_srgb,X.keywords.rgb10a2unorm,X.keywords.rg11b10float,X.keywords.rg32uint,X.keywords.rg32sint,X.keywords.rg32float,X.keywords.rgba16uint,X.keywords.rgba16sint,X.keywords.rgba16float,X.keywords.rgba32uint,X.keywords.rgba32sint,X.keywords.rgba32float],A.const_literal=[X.tokens.int_literal,X.tokens.uint_literal,X.tokens.decimal_float_literal,X.tokens.hex_float_literal,X.keywords.true,X.keywords.false],A.literal_or_ident=[X.tokens.ident,X.tokens.int_literal,X.tokens.uint_literal,X.tokens.decimal_float_literal,X.tokens.hex_float_literal,X.tokens.name],A.element_count_expression=[X.tokens.int_literal,X.tokens.uint_literal,X.tokens.ident],A.template_types=[X.keywords.vec2,X.keywords.vec3,X.keywords.vec4,X.keywords.mat2x2,X.keywords.mat2x3,X.keywords.mat2x4,X.keywords.mat3x2,X.keywords.mat3x3,X.keywords.mat3x4,X.keywords.mat4x2,X.keywords.mat4x3,X.keywords.mat4x4,X.keywords.atomic,X.keywords.bitcast,...X.any_texture_type],A.attribute_name=[X.tokens.ident,X.keywords.block,X.keywords.diagnostic],A.assignment_operators=[X.tokens.equal,X.tokens.plus_equal,X.tokens.minus_equal,X.tokens.times_equal,X.tokens.division_equal,X.tokens.modulo_equal,X.tokens.and_equal,X.tokens.or_equal,X.tokens.xor_equal,X.tokens.shift_right_equal,X.tokens.shift_left_equal],A.increment_operators=[X.tokens.plus_plus,X.tokens.minus_minus];class yb{constructor(e,t,i,s,a){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=a}toString(){return this.lexeme}isTemplateType(){return A.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==A.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class yM{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new yb(A.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=A.simpleTokens[e];if(t)return this._addToken(t),!0;let i=A.none;const s=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(s){const l=A.keywords[e];if(l)return this._addToken(l),!0}if(s||a)return this._addToken(A.tokens.ident),!0;for(;;){let l=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(A.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(A.tokens.minus_minus),!0;const h=this._tokens.length-1;if((A.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==A.tokens.paren_right)&&u!=">")return this._addToken(l),!0}if(e==">"&&(u==">"||u=="=")){let h=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&A.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===A.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(l),!0}if(l===A.none){let h=e,d=0;const p=2;for(let _=0;_<p;++_)if(h+=this._peekAhead(_),l=this._findType(h),l!==A.none){d=_;break}if(l===A.none)return i!==A.none&&(this._current--,this._addToken(i),!0);e=h,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==A.none&&(this._addToken(i),!0)}_findType(e){for(const i in A.regexTokens){const s=A.regexTokens[i];if(this._match(e,s.rule))return s}return A.literalTokens[e]||A.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new yb(e,t,this._line,this._start,this._current))}}function ge(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const _u=new Float32Array(1),bM=new Uint32Array(_u.buffer),vM=new Uint32Array(_u.buffer),yu=new Int32Array(1),xM=new Float32Array(yu.buffer),TM=new Uint32Array(yu.buffer),bu=new Uint32Array(1),SM=new Float32Array(bu.buffer),wM=new Int32Array(bu.buffer);function bb(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return _u[0]=n,bM[0];if(t==="u32")return _u[0]=n,vM[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return yu[0]=n,xM[0];if(t==="u32")return yu[0]=n,TM[0]}else if(e==="u32"){if(t==="f32")return bu[0]=n,SM[0];if(t==="i32"||t==="x32")return bu[0]=n,wM[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class AM{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Ic{constructor(e,t){this.align=e,this.size=t}}class di{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new oM,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Ko&&this._functions.set(t.name,new AM(t));for(const t of e)if(t instanceof Ui){const i=this.getTypeInfo(t,null);i instanceof Rs&&this.structs.push(i)}for(const t of e)if(t instanceof og)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof rg){const i=t,s=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new sM(i.name,a,i.attributes,s));continue}if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new Oc(i.name,l,s,a,i.attributes,As.Uniform,i.access);u.access||(u.access="read"),this.uniforms.push(u);continue}if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),h=new Oc(i.name,l,s,a,i.attributes,u?As.StorageTexture:As.Storage,i.access);h.access||(h.access="read"),this.storage.push(h);continue}if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),h=new Oc(i.name,l,s,a,i.attributes,u?As.StorageTexture:As.Texture,i.access);h.access||(h.access="read"),u?this.storage.push(h):this.textures.push(h);continue}if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new Oc(i.name,l,s,a,i.attributes,As.Sampler,i.access);this.samplers.push(u);continue}}for(const t of e)if(t instanceof Ko){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),a=this._getAttribute(t,"compute"),l=i||s||a,u=new aM(t.name,l?.name,t.attributes);u.attributes=t.attributes,u.startLine=t.startLine,u.endLine=t.endLine,this.functions.push(u),this._functions.get(t.name).info=u,l&&(this._functions.get(t.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(t,!!l),u.inputs=this._getInputs(t.args),u.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(u)),u.arguments=t.args.map(h=>new rM(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),u.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,a,l;if(i instanceof L3){if(i.value)if(ge(i.value))for(const u of i.value)for(const h of this.overrides)u===h.name&&((s=t.info)===null||s===void 0||s.overrides.push(h));else for(const u of this.overrides)i.value===u.name&&((a=t.info)===null||a===void 0||a.overrides.push(u))}else if(i instanceof Rn)for(const u of this.overrides)i.name===u.name&&((l=t.info)===null||l===void 0||l.overrides.push(u))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const a=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;a&&t.add(a)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.vertex)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.fragment)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,a=[];return e.search(l=>{if(l instanceof gu)a.push({});else if(l instanceof mu)a.pop();else if(l instanceof Fi){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),a.length>0&&(a[a.length-1][u.name]=u)}else if(l instanceof fi){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type)}else if(l instanceof zo){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),a.length>0&&(a[a.length-1][u.name]=u)}else if(l instanceof Rn){const u=l;if(a.length>0&&a[a.length-1][u.name])return;const h=s._findResource(u.name);h&&i.push(h)}else if(l instanceof lg){const u=l,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}else if(l instanceof ag){const u=l,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Ui)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof Ui)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const a=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),u=new db(i.name,a,s.name,l);t.push(u)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new db("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof Ui)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof Ui)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),a=this._parseInt(t.value),l=new iM(e.name,s,t.name,a);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new nM(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Zc){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,a=new lp(e.name,s,t);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Vo){const s=e,a=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new Is(s.name,t);return l.format=a,l.count=s.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof Ui){const s=e,a=new Rs(s.name,t);a.startLine=s.startLine,a.endLine=s.endLine;for(const l of s.members){const u=this.getTypeInfo(l.type,l.attributes);a.members.push(new hb(l.name,u,l.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof No){const s=e,a=s.format instanceof se,l=s.format?a?this.getTypeInfo(s.format,null):new zn(s.format,null):null,u=new or(s.name,l,t,s.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof $){const s=e,a=s.format?this.getTypeInfo(s.format,null):null,l=new or(s.name,a,t,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new zn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const a=this._getTypeSize(e);if(e.size=(t=a?.size)!==null&&t!==void 0?t:0,e instanceof Is&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l?.size)!==null&&i!==void 0?i:0,(s=l?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof lp&&this._updateTypeInfo(e.format),e instanceof Rs&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,a=0,l=0;for(let u=0,h=e.members.length;u<h;++u){const d=e.members[u],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const _=p.align,y=p.size;i=this._roundUp(_,i+s),s=y,a=i,l=Math.max(l,_),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,a+s),e.align=l}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof hb&&(e=e.type),e instanceof zn){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=di._typeInfo[e.name];if(l!==void 0){const u=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Ic(Math.max(a,l.align/u),Math.max(s,l.size/u))}}{const l=di._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const u=e.name[e.name.length-1]==="h"?2:1;return new Ic(Math.max(a,l.align/u),Math.max(s,l.size/u))}}if(e instanceof Is){let l=e,u=8,h=8;const d=this._getTypeSize(l.format);return d!==null&&(h=d.size,u=d.align),h=l.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(u,h)),s&&(h=s),new Ic(Math.max(a,u),Math.max(s,h))}if(e instanceof Rs){let l=0,u=0,h=0,d=0,p=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),h=this._roundUp(y.align,h+d),d=y.size,p=h)}return u=this._roundUp(l,p+d),new Ic(Math.max(a,l),Math.max(s,u))}return null}_isUniformVar(e){return e instanceof Fi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Fi&&e.storage=="storage"}_isTextureVar(e){return e instanceof Fi&&e.type!==null&&di._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Fi&&e.type!==null&&di._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let a of s)if(a.name==t)return a;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let a=s!==null&&s.value!==null?s.value:i;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}di._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},di._textureTypes=A.any_texture_type.map(n=>n.name),di._samplerTypes=A.sampler_type.map(n=>n.name);let cg=0;class ug{constructor(e,t,i){this.id=cg++,this.name=e,this.value=t,this.node=i}clone(){return new ug(this.name,this.value,this.node)}}class fg{constructor(e){this.id=cg++,this.name=e.name,this.node=e}clone(){return new fg(this.node)}}class hg{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=cg++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new ug(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new hg(this)}}class EM{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class RM{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof C)return i.data.forEach(a=>{a||(s=!1)}),new U(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){const s=i.data.some(a=>a);return new U(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof U))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof xt&&s.typeInfo.size===0){const a=s.typeInfo,l=s.buffer.byteLength/a.stride;return new U(l,this.getTypeInfo("u32"))}return new U(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.abs(a)),i.typeInfo);const s=i;return new U(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.acos(a)),i.typeInfo);const s=i;return new U(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.acosh(a)),i.typeInfo);const s=i;return new U(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.asin(a)),i.typeInfo);const s=i;return new U(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.asinh(a)),i.typeInfo);const s=i;return new U(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.atan(a)),i.typeInfo);const s=i;return new U(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.atanh(a)),i.typeInfo);const s=i;return new U(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,h)=>Math.atan2(u,s.data[h])),i.typeInfo);const a=i,l=s;return new U(Math.atan2(a.value,l.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.ceil(a)),i.typeInfo);const s=i;return new U(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C)return new C(i.data.map((d,p)=>this._clamp(d,s.data[p],a.data[p])),i.typeInfo);const l=i,u=s,h=a;return new U(this._clamp(l.value,u.value,h.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.cos(a)),i.typeInfo);const s=i;return new U(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.cosh(a)),i.typeInfo);const s=i;return new U(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.clz32(a)),i.typeInfo);const s=i;return new U(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._countOneBits(a)),i.typeInfo);const s=i;return new U(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._countTrailingZeros(a)),i.typeInfo);const s=i;return new U(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const a=i.data,l=s.data;return new C([a[1]*l[2]-l[1]*a[2],a[2]*l[0]-l[2]*a[0],a[0]*l[1]-l[0]*a[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof C?new C(i.data.map(a=>a*s),i.typeInfo):new U(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Ie){const s=i.data,a=i.typeInfo.getTypeName(),l=a.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h")return new U(s[0]*s[3]-s[1]*s[2],l);if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h")return new U(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(a==="mat2x4"||a==="mat2x4f"||a==="mat2x4h")console.error(`TODO: Determinant for ${a}`);else if(a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h")console.error(`TODO: Determinant for ${a}`);else{if(a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h")return new U(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);a==="mat3x4"||a==="mat3x4f"||a==="mat3x4h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h"?console.error(`TODO: Determinant for ${a}`):a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h"||console.error(`TODO: Determinant for ${a}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){let u=0;for(let h=0;h<i.data.length;++h)u+=(i.data[h]-s.data[h])*(i.data[h]-s.data[h]);return new U(Math.sqrt(u),this.getTypeInfo("f32"))}const a=i,l=s;return new U(Math.abs(a.value-l.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof C&&s instanceof C?new U(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.exp(a)),i.typeInfo);const s=i;return new U(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.pow(2,a)),i.typeInfo);const s=i;return new U(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=s.value,u=a.value;if(i instanceof C)return new C(i.data.map(d=>d>>l&(1<<u)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=i.value;return new U(h>>l&(1<<u)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C){const l=this._dot(s.data,a.data);return new C(l<0?Array.from(i.data):i.data.map(u=>-u),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._firstLeadingBit(a)),i.typeInfo);const s=i;return new U(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>this._firstTrailingBit(a)),i.typeInfo);const s=i;return new U(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.floor(a)),i.typeInfo);const s=i;return new U(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C)return i.data.length!==s.data.length||i.data.length!==a.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new C(i.data.map((d,p)=>d*s.data[p]+a.data[p]),i.typeInfo);const l=i,u=s,h=a;return new U(l.value*u.value+h.value,l.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>a-Math.floor(a)),i.typeInfo);const s=i;return new U(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const u=a.value,h=(1<<l.value)-1<<u,d=~h;if(i instanceof C&&s instanceof C)return new C(i.data.map((y,v)=>y&d|s.data[v]<<u&h),i.typeInfo);const p=i.value,_=s.value;return new U(p&d|_<<u&h,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>1/Math.sqrt(a)),i.typeInfo);const s=i;return new U(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){let a=0;return i.data.forEach(l=>{a+=l*l}),new U(Math.sqrt(a),this.getTypeInfo("f32"))}const s=i;return new U(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.log(a)),i.typeInfo);const s=i;return new U(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.log2(a)),i.typeInfo);const s=i;return new U(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,h)=>Math.max(u,s.data[h])),i.typeInfo);const a=i,l=s;return new U(Math.max(a.value,l.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,h)=>Math.min(u,s.data[h])),i.typeInfo);const a=i,l=s;return new U(Math.min(a.value,l.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof C)return new C(i.data.map((h,d)=>i.data[d]*(1-a.data[d])+s.data[d]*a.data[d]),i.typeInfo);const l=s,u=a;return new U(i.value*(1-u.value)+l.value*u.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((l,u)=>l%s.data[u]),i.typeInfo);const a=s;return new U(i.value%a.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C){const s=this.Length(e,t).value;return new C(i.data.map(a=>a/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C)return new C(i.data.map((u,h)=>Math.pow(u,s.data[h])),i.typeInfo);const a=i,l=s;return new U(Math.pow(a.value,l.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof C?new C(i.data.map(s=>s),i.typeInfo):new U(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof C?new C(i.data.map(s=>s*Math.PI/180),i.typeInfo):new U(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof C&&s instanceof C){const a=this._dot(i.data,s.data);return new C(i.data.map((l,u)=>l-2*a*s.data[u]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof C&&s instanceof C&&a instanceof U){const l=this._dot(s.data,i.data);return new C(i.data.map((u,h)=>{const d=1-a.value*a.value*(1-l*l);if(d<0)return 0;const p=Math.sqrt(d);return a.value*u-(a.value*l+p)*s.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.round(a)),i.typeInfo);const s=i;return new U(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.min(Math.max(a,0),1)),i.typeInfo);const s=i;return new U(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sign(a)),i.typeInfo);const s=i;return new U(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sin(a)),i.typeInfo);const s=i;return new U(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sinh(a)),i.typeInfo);const s=i;return new U(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(a instanceof C&&i instanceof C&&s instanceof C)return new C(a.data.map((d,p)=>this._smoothstep(i.data[p],s.data[p],d)),a.typeInfo);const l=i,u=s,h=a;return new U(this._smoothstep(l.value,u.value,h.value),a.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.sqrt(a)),i.typeInfo);const s=i;return new U(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof C&&i instanceof C)return new C(s.data.map((l,u)=>l<i.data[u]?0:1),s.typeInfo);const a=i;return new U(s.value<a.value?0:1,a.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.tan(a)),i.typeInfo);const s=i;return new U(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.tanh(a)),i.typeInfo);const s=i;return new U(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof Ie))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const a=i.data;return new Ie([a[0],a[2],a[1],a[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const a=i.data;return new Ie([a[0],a[3],a[6],a[1],a[4],a[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const a=i.data;return new Ie([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const a=i.data;return new Ie([a[0],a[3],a[1],a[4],a[2],a[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const a=i.data;return new Ie([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const a=i.data;return new Ie([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const a=i.data;return new Ie([a[0],a[4],a[1],a[5],a[2],a[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const a=i.data;return new Ie([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const a=i.data;return new Ie([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof C)return new C(i.data.map(a=>Math.trunc(a)),i.typeInfo);const s=i;return new U(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof Rn){const a=i.name,l=t.getVariableValue(a);if(l instanceof Li){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const u=l.getMipLevelSize(s),h=l.dimension;return h==="1d"?new U(u[0],this.getTypeInfo("u32")):h==="3d"?new C(u,this.getTypeInfo("vec3u")):h==="2d"?new C(u.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof C)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof Rn){const l=i.name,u=t.getVariableValue(l);if(u instanceof Li){const h=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(h<0||h>=u.width||d<0||d>=u.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=u.getPixel(h,d,0,a);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new C(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof Rn){const s=i.name,a=t.getVariableValue(s);return a instanceof Li?new U(a.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof Rn){const s=i.name,a=t.getVariableValue(s);return a instanceof Li?new U(a.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof Rn){const s=i.name,a=t.getVariableValue(s);return a instanceof Li?new U(a.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof C)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof Rn){const u=i.name,h=t.getVariableValue(u);if(h instanceof Li){const d=h.getMipLevelSize(0),p=Math.floor(s.data[0]),_=Math.floor(s.data[1]);return p<0||p>=d[0]||_<0||_>=d[1]?(console.error(`Texture ${u} out of bounds. Line ${e.line}`),null):(h.setPixel(p,_,0,a,Array.from(l)),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t);return h instanceof U&&u instanceof U&&(h.value=u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value+=u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value-=u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value=Math.max(h.value,u.value)),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value=Math.min(h.value,u.value)),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value=h.value&u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value=h.value|u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value=h.value^u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new U(h.value,h.typeInfo);return h instanceof U&&u instanceof U&&(h.value=u.value),a.value instanceof xt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const wd={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},on={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class tn extends EM{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new di,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new hg,this.builtins=new RM(this),this.typeInfo={bool:this.getTypeInfo(se.bool),i32:this.getTypeInfo(se.i32),u32:this.getTypeInfo(se.u32),f32:this.getTypeInfo(se.f32),f16:this.getTypeInfo(se.f16),vec2f:this.getTypeInfo($.vec2f),vec2u:this.getTypeInfo($.vec2u),vec2i:this.getTypeInfo($.vec2i),vec2h:this.getTypeInfo($.vec2h),vec3f:this.getTypeInfo($.vec3f),vec3u:this.getTypeInfo($.vec3u),vec3i:this.getTypeInfo($.vec3i),vec3h:this.getTypeInfo($.vec3h),vec4f:this.getTypeInfo($.vec4f),vec4u:this.getTypeInfo($.vec4u),vec4i:this.getTypeInfo($.vec4i),vec4h:this.getTypeInfo($.vec4h),mat2x2f:this.getTypeInfo($.mat2x2f),mat2x3f:this.getTypeInfo($.mat2x3f),mat2x4f:this.getTypeInfo($.mat2x4f),mat3x2f:this.getTypeInfo($.mat3x2f),mat3x3f:this.getTypeInfo($.mat3x3f),mat3x4f:this.getTypeInfo($.mat3x4f),mat4x2f:this.getTypeInfo($.mat4x2f),mat4x3f:this.getTypeInfo($.mat4x3f),mat4x4f:this.getTypeInfo($.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof U)return s.value;if(s instanceof C||s instanceof Ie)return Array.from(s.data);if(s instanceof xt&&s.typeInfo instanceof Is){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const a=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,a),this._execStatements(this.ast,a);const l=a.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const u=t[0],h=t[1],d=t[2],p=this.getTypeInfo("vec3u");a.setVariable("@num_workgroups",new C(t,p));const _=this.reflection.getFunctionInfo(e);_===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const v in i[y]){const T=i[y][v];a.variables.forEach(E=>{var R;const P=E.node;if(P?.attributes){let D=null,M=null;for(const L of P.attributes)L.name==="binding"?D=L.value:L.name==="group"&&(M=L.value);if(v==D&&y==M){let L=!1;for(const H of _.resources)if(H.name===E.name&&H.group===parseInt(y)&&H.binding===parseInt(v)){L=!0;break}if(L)if(T.texture!==void 0&&T.descriptor!==void 0){const H=new Li(T.texture,this.getTypeInfo(P.type),T.descriptor,(R=T.texture.view)!==null&&R!==void 0?R:null);E.value=H}else T.uniform!==void 0?E.value=new xt(T.uniform,this.getTypeInfo(P.type)):E.value=new xt(T,this.getTypeInfo(P.type))}}})}for(let y=0;y<d;++y)for(let v=0;v<h;++v)for(let T=0;T<u;++T)a.setVariable("@workgroup_id",new C([T,v,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[T,v,y],a)}execStatement(e,t){if(e instanceof C3)return this.evalExpression(e.value,t);if(e instanceof P3){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof U))throw new Error("Invalid break-if condition");if(!i.value)return null}return tn._breakObj}if(e instanceof O3)return tn._continueObj;if(e instanceof zo)this._let(e,t);else if(e instanceof Fi)this._var(e,t);else if(e instanceof Kc)this._const(e,t);else if(e instanceof Ko)this._function(e,t);else{if(e instanceof R3)return this._if(e,t);if(e instanceof E3)return this._switch(e,t);if(e instanceof T3)return this._for(e,t);if(e instanceof x3)return this._while(e,t);if(e instanceof A3)return this._loop(e,t);if(e instanceof cp){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof w3)this._assign(e,t);else if(e instanceof S3)this._increment(e,t);else{if(e instanceof Ui)return null;if(e instanceof rg){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new U(0,this.getTypeInfo("u32")))}else if(e instanceof ag)this._call(e,t);else{if(e instanceof M3||e instanceof og)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Qn?this._evalBinaryOp(e,t):e instanceof Dt?this._evalLiteral(e,t):e instanceof Rn?this._evalVariable(e,t):e instanceof lg?this._evalCall(e,t):e instanceof fi?this._evalCreate(e,t):e instanceof I3?this._evalConst(e,t):e instanceof N3?this._evalBitcast(e,t):e instanceof Ot?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof se){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],a=this.reflection.getOverrideInfo(i);a!==null?(a.type===null&&(a.type=this.getTypeInfo("u32")),a.type.name==="u32"||a.type.name==="i32"||a.type.name==="f32"||a.type.name==="f16"?t.setVariable(i,new U(s,a.type)):a.type.name==="bool"?t.setVariable(i,new U(s?1:0,a.type)):a.type.name==="vec2"||a.type.name==="vec3"||a.type.name==="vec4"||a.type.name==="vec2f"||a.type.name==="vec3f"||a.type.name==="vec4f"||a.type.name==="vec2i"||a.type.name==="vec3i"||a.type.name==="vec4i"||a.type.name==="vec2u"||a.type.name==="vec3u"||a.type.name==="vec4u"||a.type.name==="vec2h"||a.type.name==="vec3h"||a.type.name==="vec4h"?t.setVariable(i,new C(s,a.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=i.getVariableValue(p.value[0]);s[0]=_ instanceof U?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=i.getVariableValue(p.value[1]);s[1]=_ instanceof U?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=i.getVariableValue(p.value[2]);s[2]=_ instanceof U?_.value:parseInt(p.value[2])}}const a=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new C(s,a));const u=s[0],h=s[1],d=s[2];for(let p=0,_=0;p<d;++p)for(let y=0;y<h;++y)for(let v=0;v<u;++v,++_){const T=[v,y,p],E=[v+t[0]*s[0],y+t[1]*s[1],p+t[2]*s[2]];i.setVariable("@local_invocation_id",new C(T,a)),i.setVariable("@global_invocation_id",new C(E,a)),i.setVariable("@local_invocation_index",new U(_,l)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const a=`@${s.value}`,l=t.getVariable(a);l!==void 0&&t.variables.set(i.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Ot;)e=e.right;return e instanceof Rn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const a=t.clone(),l=this._execStatements(i,a);if(l)return l;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],u=this.evalExpression(e.args[a],i);i.setVariable(l.name,u,l)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof U?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof U?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Rn){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof Ot){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof ea?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new ea(i)}}return null}_assign(e,t){let i=null,s="<var>",a=null;if(e.variable instanceof Ot){const h=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(h instanceof U||h instanceof C||h instanceof Ie){if(d instanceof U||d instanceof C||d instanceof Ie&&h.data.length===d.data.length)return void h.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof xt&&d instanceof xt&&h.buffer.byteLength-h.offset>=d.buffer.byteLength-d.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return h instanceof U||h instanceof C||h instanceof Ie?d instanceof U||d instanceof C||d instanceof Ie?void h.data.set(d.data.map((_,y)=>h.data[y]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(h instanceof U||h instanceof C||h instanceof Ie)&&(d instanceof U||d instanceof C||d instanceof Ie)?void h.data.set(d.data.map((_,y)=>h.data[y]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Ot){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const h=t.getVariable(s);if(!(h&&h.value instanceof ea))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=h.value.reference;let d=e.variable.postfix;if(!d){let p=e.variable.right;for(;p instanceof Ot;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(i=i.getSubData(this,d,t))}}else{a=e.variable.postfix,s=this.getVariableName(e.variable,t);const h=t.getVariable(s);if(h===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=h.value}if(i instanceof ea&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),u=e.operator;if(u!=="="){const h=i.getSubData(this,a,t);if(h instanceof C&&l instanceof U){const d=h.data,p=l.value;if(u==="+=")for(let _=0;_<d.length;++_)d[_]+=p;else if(u==="-=")for(let _=0;_<d.length;++_)d[_]-=p;else if(u==="*=")for(let _=0;_<d.length;++_)d[_]*=p;else if(u==="/=")for(let _=0;_<d.length;++_)d[_]/=p;else if(u==="%=")for(let _=0;_<d.length;++_)d[_]%=p;else if(u==="&=")for(let _=0;_<d.length;++_)d[_]&=p;else if(u==="|=")for(let _=0;_<d.length;++_)d[_]|=p;else if(u==="^=")for(let _=0;_<d.length;++_)d[_]^=p;else if(u==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p;else if(u===">>=")for(let _=0;_<d.length;++_)d[_]>>=p;else console.error(`Invalid operator ${u}. Line ${e.line}`)}else if(h instanceof C&&l instanceof C){const d=h.data,p=l.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(u==="+=")for(let _=0;_<d.length;++_)d[_]+=p[_];else if(u==="-=")for(let _=0;_<d.length;++_)d[_]-=p[_];else if(u==="*=")for(let _=0;_<d.length;++_)d[_]*=p[_];else if(u==="/=")for(let _=0;_<d.length;++_)d[_]/=p[_];else if(u==="%=")for(let _=0;_<d.length;++_)d[_]%=p[_];else if(u==="&=")for(let _=0;_<d.length;++_)d[_]&=p[_];else if(u==="|=")for(let _=0;_<d.length;++_)d[_]|=p[_];else if(u==="^=")for(let _=0;_<d.length;++_)d[_]^=p[_];else if(u==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p[_];else if(u===">>=")for(let _=0;_<d.length;++_)d[_]>>=p[_];else console.error(`Invalid operator ${u}. Line ${e.line}`)}else{if(!(h instanceof U&&l instanceof U))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);u==="+="?h.value+=l.value:u==="-="?h.value-=l.value:u==="*="?h.value*=l.value:u==="/="?h.value/=l.value:u==="%="?h.value%=l.value:u==="&="?h.value&=l.value:u==="|="?h.value|=l.value:u==="^="?h.value^=l.value:u==="<<="?h.value<<=l.value:u===">>="?h.value>>=l.value:console.error(`Invalid operator ${u}. Line ${e.line}`)}return void(i instanceof xt&&i.setDataValue(this,h,a,t))}if(i instanceof xt)i.setDataValue(this,l,a,t);else if(a){if(!(i instanceof C||i instanceof Ie))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(a instanceof ga){const h=this.evalExpression(a.index,t).value;if(i instanceof C){if(!(l instanceof U))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[h]=l.value}else{if(!(i instanceof Ie))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(a.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l instanceof C))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(a instanceof lr){const h=a.value;if(!(i instanceof C))return void console.error(`Invalid assignment to ${h}. Variable ${s} is not a vector. Line ${e.line}`);if(l instanceof U){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);if(h==="x")i.data[0]=l.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[1]=l.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[2]=l.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof C))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(h.length!==l.data.length)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);for(let d=0;d<h.length;++d){const p=h[d];if(p==="x"||p==="r")i.data[0]=l.data[d];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[1]=l.data[d]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[2]=l.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[3]=l.data[d]}}}}}else i instanceof U&&l instanceof U?i.value=l.value:i instanceof C&&l instanceof C||i instanceof Ie&&l instanceof Ie?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`)}_function(e,t){const i=new fg(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ot||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const a=new fi(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ot||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Vo||e.type instanceof Ui||e.type instanceof $){const a=new fi(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const a of e.cases)if(a instanceof B3)for(const l of a.selectors){if(l instanceof Qc){s=a;continue}const u=this.evalExpression(l,t);if(!(u instanceof U))return console.error(`Invalid case selector. Line ${e.line}`),null;if(u.value===i.value)return this._execStatements(a.body,t)}else a instanceof U3&&(s=a);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const a=this.evalExpression(s.condition,t);if(!(a instanceof U))return console.error(`Invalid if condition. Line ${e.line}`),null;if(a.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof U?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===tn._breakObj)break;if(i!==null&&i!==tn._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===tn._breakObj)break;if(i===tn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===tn._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===tn._breakObj)break;if(i!==tn._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof U){const a=bb(i.value,i.typeInfo.name,s.name);return new U(a,this.getTypeInfo(s))}if(i instanceof C){const a=i.typeInfo.getTypeName();let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;l="f16"}const u=s.getTypeName();let h="";if(u.endsWith("f"))h="f32";else if(u.endsWith("i"))h="i32";else if(u.endsWith("u"))h="u32";else if(u.endsWith("b"))h="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const d=(function(p,_,y){if(_===y)return p;const v=new Array(p.length);for(let T=0;T<p.length;T++)v[T]=bb(p[T],_,y);return v})(Array.from(i.data),l,h);return new C(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof fi){if(e.type===null)return up.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof fi?e.type.name:e.name,a=e instanceof fi?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(a===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(a.size===0)return null;const l=new xt(new ArrayBuffer(a.size),a,0);if(a instanceof Rs){if(e.args)for(let u=0;u<e.args.length;++u){const h=a.members[u],d=e.args[u],p=this.evalExpression(d,t);l.setData(this,p,h.type,h.offset,t)}}else if(a instanceof Is){let u=0;if(e.args)for(let h=0;h<e.args.length;++h){const d=e.args[h],p=this.evalExpression(d,t);a.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?a.format=this.getTypeInfo("i32"):a.format=p.typeInfo),l.setData(this,p,a.format,u,t),u+=a.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof fi?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new U(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=tn._priority.get(t.name);tn._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new ea(i);if(e.operator==="*")return i instanceof ea?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof U?i.value:i instanceof C?Array.from(i.data):null;switch(e.operator){case"+":{if(ge(s)){const u=s.map((h,d)=>+h);return new C(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(+a,l)}case"-":{if(ge(s)){const u=s.map((h,d)=>-h);return new C(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(-a,l)}case"!":{if(ge(s)){const u=s.map((h,d)=>h?0:1);return new C(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(a?0:1,l)}case"~":{if(ge(s)){const u=s.map((h,d)=>~h);return new C(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new U(~a,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),a=i instanceof U?i.value:i instanceof C||i instanceof Ie?Array.from(i.data):null,l=s instanceof U?s.value:s instanceof C||s instanceof Ie?Array.from(s.data):null;switch(e.operator){case"+":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v+_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y+p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p+y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u+h,d)}case"-":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v-_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y-p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p-y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u-h,d)}case"*":{if(ge(a)&&ge(l)){const p=a,_=l;if(i instanceof Ie&&s instanceof Ie){const y=(function(R,P,D,M){if(on[P.name]===void 0||on[M.name]===void 0)return null;const L=on[P.name][0],H=on[P.name][1],J=on[M.name][0];if(L!==on[M.name][1])return null;const fe=new Array(J*H);for(let de=0;de<H;de++)for(let le=0;le<J;le++){let _e=0;for(let Se=0;Se<L;Se++)_e+=R[Se*H+de]*D[le*L+Se];fe[de*J+le]=_e}return fe})(p,i.typeInfo,_,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const v=on[s.typeInfo.name][0],T=on[i.typeInfo.name][1],E=this.getTypeInfo(`mat${v}x${T}f`);return new Ie(y,E)}if(i instanceof Ie&&s instanceof C){const y=(function(v,T,E,R){if(on[T.name]===void 0||wd[R.name]===void 0)return null;const P=on[T.name][0],D=on[T.name][1];if(P!==E.length)return null;const M=new Array(D);for(let L=0;L<D;L++){let H=0;for(let J=0;J<P;J++)H+=v[J*D+L]*E[J];M[L]=H}return M})(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new C(y,s.typeInfo)}if(i instanceof C&&s instanceof Ie){const y=(function(v,T,E,R){if(wd[T.name]===void 0||on[R.name]===void 0)return null;const P=on[R.name][0],D=on[R.name][1];if(D!==v.length)return null;const M=[];for(let L=0;L<P;L++){let H=0;for(let J=0;J<D;J++)H+=v[J]*E[J*P+L];M[L]=H}return M})(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new C(y,i.typeInfo)}{if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v*_[T]);return new C(y,i.typeInfo)}}if(ge(a)){const p=l,_=a.map((y,v)=>y*p);return i instanceof Ie?new Ie(_,i.typeInfo):new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p*y);return s instanceof Ie?new Ie(_,s.typeInfo):new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u*h,d)}case"%":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v%_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y%p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p%y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u%h,d)}case"/":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v/_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y/p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p/y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u/h,d)}case"&":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v&_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y&p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p&y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u&h,d)}case"|":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v|_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y|p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p|y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u|h,d)}case"^":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v^_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y^p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p^y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u^h,d)}case"<<":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v<<_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y<<p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p<<y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u<<h,d)}case">>":{if(ge(a)&&ge(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,T)=>v>>_[T]);return new C(y,i.typeInfo)}if(ge(a)){const p=l,_=a.map((y,v)=>y>>p);return new C(_,i.typeInfo)}if(ge(l)){const p=a,_=l.map((y,v)=>p>>y);return new C(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new U(u>>h,d)}case">":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p>h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d>u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u>d?1:0);return new C(h,s.typeInfo)}return new U(a>l?1:0,this.getTypeInfo("bool"));case"<":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p<h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d<u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u<d?1:0);return new C(h,s.typeInfo)}return new U(a<l?1:0,this.getTypeInfo("bool"));case"==":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p===h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d==u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u==d?1:0);return new C(h,s.typeInfo)}return new U(a===l?1:0,this.getTypeInfo("bool"));case"!=":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p!==h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d!==u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u!==d?1:0);return new C(h,s.typeInfo)}return new U(a!==l?1:0,this.getTypeInfo("bool"));case">=":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p>=h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d>=u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u>=d?1:0);return new C(h,s.typeInfo)}return new U(a>=l?1:0,this.getTypeInfo("bool"));case"<=":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p<=h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d<=u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u<=d?1:0);return new C(h,s.typeInfo)}return new U(a<=l?1:0,this.getTypeInfo("bool"));case"&&":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p&&h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d&&u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u&&d?1:0);return new C(h,s.typeInfo)}return new U(a&&l?1:0,this.getTypeInfo("bool"));case"||":if(ge(a)&&ge(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p||h[_]?1:0);return new C(d,i.typeInfo)}if(ge(a)){const u=l,h=a.map((d,p)=>d||u?1:0);return new C(h,i.typeInfo)}if(ge(l)){const u=a,h=l.map((d,p)=>u||d?1:0);return new C(h,s.typeInfo)}return new U(a||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],u=this.evalExpression(e.args[a],i);i.createVariable(l.name,u,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let a=0;a<i.node.args.length;++a){const l=i.node.args[a],u=this.evalExpression(e.args[a],s);s.setVariable(l.name,u,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new U(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=wd[s];if(a===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof Dt)if(e.isVector){const u=e.vectorValue;for(const h of u)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);if(h instanceof C){const d=h.data;for(let p=0;p<d.length;++p){let _=d[p];l.push(_)}}else if(h instanceof U){let d=h.value;l.push(d)}}if(e.type instanceof $&&e.type.format===null&&(e.type.format=$.f32),l.length===0){const u=new Array(a).fill(0);return new C(u,i).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<a;)l.push(l[0]);return l.length<a?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new C(l.length>a?l.slice(0,a):l,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=on[s];if(a===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof Dt)if(e.isVector){const u=e.vectorValue;for(const h of u)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);h instanceof C?l.push(...h.data):h instanceof U?l.push(h.value):h instanceof Ie&&l.push(...h.data)}if(i instanceof or&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const u=new Array(a[2]).fill(0);return new Ie(u,i).getSubData(this,e.postfix,t)}return l.length!==a[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Ie(l,i).getSubData(this,e.postfix,t)}}tn._breakObj=new jn(new zn("BREAK",null),null),tn._continueObj=new jn(new zn("CONTINUE",null),null),tn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class CM{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class MM{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new CM,this._exec=new tn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,a=i.countNode;if(a instanceof Rn){const l=a.name,u=this._context.constants.get(l);if(u)try{const h=u.constEvaluate(this._exec);s.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof _b||s instanceof Zc?s.type=this._forwardType(s.type):s instanceof Vo?s.format=this._forwardType(s.format):s instanceof Fi||s instanceof zo||s instanceof Kc?s.type=this._forwardType(s.type):s instanceof Ko?s.returnType=this._forwardType(s.returnType):s instanceof mb&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof gb){const t=this._getType(e.name);if(t)return t}else e instanceof Zc?e.type=this._forwardType(e.type):e instanceof Vo&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new yM(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==A.eof}_match(e){if(e instanceof z)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const a of e){if(i===a)return!0;a===A.tokens.name&&(s=!0)}if(s){const a=A.tokens.name.rule.exec(t.lexeme);if(a&&a.index==0&&a[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===A.tokens.name){const i=A.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(A.tokens.semicolon)&&!this._isAtEnd(););if(this._match(A.keywords.alias)){const t=this._type_alias();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(A.keywords.diagnostic)){const t=this._diagnostic();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(A.keywords.requires)){const t=this._requires_directive();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(A.keywords.enable)){const t=this._enable_directive();return this._consume(A.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(A.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(A.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(A.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(A.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(A.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(A.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(A.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(A.keywords.fn))return null;const e=this._currentLine,t=this._consume(A.tokens.ident,"Expected function name.").toString();this._consume(A.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(A.tokens.paren_right))do{if(this._check(A.tokens.paren_right))break;const u=this._attribute(),h=this._consume(A.tokens.name,"Expected argument name.").toString();this._consume(A.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(this._updateNode(new mb(h,p,u))))}while(this._match(A.tokens.comma));this._consume(A.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(A.tokens.arrow)){const u=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=u)}const a=this._compound_statement(),l=this._currentLine;return this._updateNode(new Ko(t,i,s,a,e,l),e)}_compound_statement(){const e=[];for(this._consume(A.tokens.brace_left,"Expected '{' for block.");!this._check(A.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(A.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(A.tokens.semicolon)&&!this._isAtEnd(););if(this._check(A.tokens.attr)&&this._attribute(),this._check(A.keywords.if))return this._if_statement();if(this._check(A.keywords.switch))return this._switch_statement();if(this._check(A.keywords.loop))return this._loop_statement();if(this._check(A.keywords.for))return this._for_statement();if(this._check(A.keywords.while))return this._while_statement();if(this._check(A.keywords.continuing))return this._continuing_statement();if(this._check(A.keywords.static_assert))return this._static_assert_statement();if(this._check(A.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(A.keywords.return))e=this._return_statement();else if(this._check([A.keywords.var,A.keywords.let,A.keywords.const]))e=this._variable_statement();else if(this._match(A.keywords.discard))e=this._updateNode(new gM);else if(this._match(A.keywords.break)){const t=this._updateNode(new P3);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(A.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(A.keywords.continue)){const t=this._updateNode(new O3);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(A.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(A.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new hM(t),e)}_while_statement(){if(!this._match(A.keywords.while))return null;const e=this._updateNode(new x3(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(A.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(A.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new cp(i,e),t)}_for_statement(){if(!this._match(A.keywords.for))return null;this._consume(A.tokens.paren_left,"Expected '('.");const e=this._updateNode(new T3(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(A.tokens.semicolon)?null:this._for_init(),this._consume(A.tokens.semicolon,"Expected ';'."),e.condition=this._check(A.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(A.tokens.semicolon,"Expected ';'."),e.increment=this._check(A.tokens.paren_right)?null:this._for_increment(),this._consume(A.tokens.paren_right,"Expected ')'."),this._check(A.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(A.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(A.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Fi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(A.keywords.let)){const e=this._currentLine,t=this._consume(A.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(A.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(A.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new zo(t,i,null,null,s),e)}if(this._match(A.keywords.const)){const e=this._currentLine,t=this._consume(A.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(A.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(A.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof Dt&&(i=s.type),this._updateNode(new Kc(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(A.increment_operators))return this._current=e,null;const i=this._consume(A.increment_operators,"Expected increment operator");return this._updateNode(new S3(i.type===A.tokens.plus_plus?ra.increment:ra.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(A.tokens.brace_right))return null;let i=this._match(A.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(A.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return this._updateNode(new w3(Io.parse(s.lexeme),e,a),t)}_func_call_statement(){if(!this._check(A.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(A.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new ag(i.lexeme,s),e)}_loop_statement(){if(!this._match(A.keywords.loop))return null;this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new A3([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof cp){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(A.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(A.keywords.switch))return null;const e=this._updateNode(new E3(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(A.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([A.keywords.default,A.keywords.case]);){if(this._match(A.keywords.case)){const i=this._case_selectors();for(const a of i)if(a instanceof Qc){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(A.tokens.colon),this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(A.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new B3(i,s)))}if(this._match(A.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(A.tokens.colon),this._check(A.tokens.attr)&&this._attribute(),this._consume(A.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(A.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new U3(i)))}}return e}_case_selectors(){const e=[];for(this._match(A.keywords.default)?e.push(this._updateNode(new Qc)):e.push(this._shift_expression());this._match(A.tokens.comma);)this._match(A.keywords.default)?e.push(this._updateNode(new Qc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(A.keywords.fallthrough))return this._consume(A.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(A.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(A.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(A.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let a=null;return this._match(A.keywords.else)&&(this._check(A.tokens.attr)&&this._attribute(),a=this._compound_statement()),this._updateNode(new R3(t,i,s,a),e)}_match_elseif(){return this._tokens[this._current].type===A.keywords.else&&this._tokens[this._current+1].type===A.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new mM(t,i))),this._match_elseif()&&(this._check(A.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(A.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new C3(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(A.tokens.or_or);)e=this._updateNode(new Qn(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(A.tokens.and_and);)e=this._updateNode(new Qn(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(A.tokens.or);)e=this._updateNode(new Qn(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(A.tokens.xor);)e=this._updateNode(new Qn(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(A.tokens.and);)e=this._updateNode(new Qn(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([A.tokens.equal_equal,A.tokens.not_equal])?this._updateNode(new Qn(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([A.tokens.less_than,A.tokens.greater_than,A.tokens.less_than_equal,A.tokens.greater_than_equal]);)e=this._updateNode(new Qn(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([A.tokens.shift_left,A.tokens.shift_right]);)e=this._updateNode(new Qn(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([A.tokens.plus,A.tokens.minus]);)e=this._updateNode(new Qn(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([A.tokens.star,A.tokens.forward_slash,A.tokens.modulo]);)e=this._updateNode(new Qn(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([A.tokens.minus,A.tokens.bang,A.tokens.tilde,A.tokens.star,A.tokens.and])?this._updateNode(new Ot(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(A.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(A.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new ga(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(A.tokens.period)){const e=this._consume(A.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new lr(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return se.void;case"bool":return se.bool;case"i32":return se.i32;case"u32":return se.u32;case"f32":return se.f32;case"f16":return se.f16;case"vec2f":return $.vec2f;case"vec3f":return $.vec3f;case"vec4f":return $.vec4f;case"vec2i":return $.vec2i;case"vec3i":return $.vec3i;case"vec4i":return $.vec4i;case"vec2u":return $.vec2u;case"vec3u":return $.vec3u;case"vec4u":return $.vec4u;case"vec2h":return $.vec2h;case"vec3h":return $.vec3h;case"vec4h":return $.vec4h;case"mat2x2f":return $.mat2x2f;case"mat2x3f":return $.mat2x3f;case"mat2x4f":return $.mat2x4f;case"mat3x2f":return $.mat3x2f;case"mat3x3f":return $.mat3x3f;case"mat3x4f":return $.mat3x4f;case"mat4x2f":return $.mat4x2f;case"mat4x3f":return $.mat4x3f;case"mat4x4f":return $.mat4x4f;case"mat2x2h":return $.mat2x2h;case"mat2x3h":return $.mat2x3h;case"mat2x4h":return $.mat2x4h;case"mat3x2h":return $.mat3x2h;case"mat3x3h":return $.mat3x3h;case"mat3x4h":return $.mat3x4h;case"mat4x2h":return $.mat4x2h;case"mat4x3h":return $.mat4x3h;case"mat4x4h":return $.mat4x4h;case"mat2x2i":return $.mat2x2i;case"mat2x3i":return $.mat2x3i;case"mat2x4i":return $.mat2x4i;case"mat3x2i":return $.mat3x2i;case"mat3x3i":return $.mat3x3i;case"mat3x4i":return $.mat3x4i;case"mat4x2i":return $.mat4x2i;case"mat4x3i":return $.mat4x3i;case"mat4x4i":return $.mat4x4i;case"mat2x2u":return $.mat2x2u;case"mat2x3u":return $.mat2x3u;case"mat2x4u":return $.mat2x4u;case"mat3x2u":return $.mat3x2u;case"mat3x3u":return $.mat3x3u;case"mat3x4u":return $.mat3x4u;case"mat4x2u":return $.mat4x2u;case"mat4x3u":return $.mat4x3u;case"mat4x4u":return $.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(A.tokens.ident)){const i=this._previous().toString();if(this._check(A.tokens.paren_left)){const s=this._argument_expression_list(),a=this._getType(i);return a!==null?this._updateNode(new fi(a,s)):this._updateNode(new lg(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new I3(i,s.value))}return this._updateNode(new Rn(i))}if(this._match(A.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?se.i32:i.endsWith("u")||i.endsWith("U")?se.u32:se.x32;const a=parseInt(i);return this._validateTypeRange(a,s),this._updateNode(new Dt(new U(a,this._exec.getTypeInfo(s)),s))}if(this._match(A.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,se.u32),this._updateNode(new Dt(new U(i,this._exec.getTypeInfo(se.u32)),se.u32))}if(this._match([A.tokens.decimal_float_literal,A.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const a=parseFloat(i);this._validateTypeRange(a,s?se.f16:se.f32);const l=s?se.f16:se.f32;return this._updateNode(new Dt(new U(a,this._exec.getTypeInfo(l)),l))}if(this._match([A.keywords.true,A.keywords.false])){let i=this._previous().toString()===A.keywords.true.rule;return this._updateNode(new Dt(new U(i?1:0,this._exec.getTypeInfo(se.bool)),se.bool))}if(this._check(A.tokens.paren_left))return this._paren_expression();if(this._match(A.keywords.bitcast)){this._consume(A.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(A.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new N3(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new fi(e,t))}_argument_expression_list(){if(!this._match(A.tokens.paren_left))return null;const e=[];do{if(this._check(A.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(A.tokens.comma));return this._consume(A.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(A.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(A.tokens.paren_right),e}_paren_expression(){this._consume(A.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(A.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(A.keywords.struct))return null;const e=this._currentLine,t=this._consume(A.tokens.ident,"Expected name for struct.").toString();this._consume(A.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(A.tokens.brace_right);){const l=this._attribute(),u=this._consume(A.tokens.name,"Expected variable name.").toString();this._consume(A.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h),this._check(A.tokens.brace_right)?this._match(A.tokens.comma):this._consume(A.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new _b(u,d,l)))}this._consume(A.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,a=this._updateNode(new Ui(t,i,e,s),e);return this._context.structs.set(t,a),a}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(A.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Dt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Dt&&(e.type=e.value.type.name==="x32"?se.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(A.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(A.keywords.const))return null;const t=this._consume(A.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(A.tokens.colon)){const h=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=h)}let a=null;this._consume(A.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let h=[se.f32],d=l.constEvaluate(this._exec,h);d instanceof U&&this._validateTypeRange(d.value,h[0]),h[0]instanceof $&&h[0].format===null&&d.typeInfo instanceof or&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?h[0].format=se.f16:d.typeInfo.format.name==="f32"?h[0].format=se.f32:d.typeInfo.format.name==="i32"?h[0].format=se.i32:d.typeInfo.format.name==="u32"?h[0].format=se.u32:d.typeInfo.format.name==="bool"?h[0].format=se.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),a=this._updateNode(new Dt(d,h[0])),this._exec.context.setVariable(t.toString(),d)}catch{a=l}if(s!==null&&a instanceof Dt){if(a.type.name!=="x32"&&s.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${s.name}. Line:${this._currentLine}`);a.type=s,a.isScalar&&this._validateTypeRange(a.scalarValue,a.type)}else s===null&&a instanceof Dt&&(s=(e=a?.type)!==null&&e!==void 0?e:se.f32,s===se.x32&&(s=se.i32));const u=this._updateNode(new Kc(t.toString(),s,"","",a),i);return this._context.constants.set(u.name,u),u}_global_let_decl(){if(!this._match(A.keywords.let))return null;const e=this._currentLine,t=this._consume(A.tokens.name,"Expected variable name");let i=null;if(this._match(A.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let s=null;if(this._match(A.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof Dt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof Dt&&(i=s.type.name==="x32"?se.i32:s.type);return s instanceof Dt&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new zo(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(A.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(A.tokens.less_than)&&(t=this._consume(A.storage_class,"Expected storage_class.").toString(),this._match(A.tokens.comma)&&(i=this._consume(A.access_mode,"Expected access_mode.").toString()),this._consume(A.tokens.greater_than,"Expected '>'."));const s=this._consume(A.tokens.name,"Expected variable name");let a=null;if(this._match(A.tokens.colon)){const l=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=l)}return this._updateNode(new Fi(s.toString(),a,t,i,null),e)}_override_decl(){if(!this._match(A.keywords.override))return null;const e=this._consume(A.tokens.name,"Expected variable name");let t=null;if(this._match(A.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new rg(e.toString(),t,null))}_diagnostic(){this._consume(A.tokens.paren_left,"Expected '('");const e=this._consume(A.tokens.ident,"Expected severity control name.");this._consume(A.tokens.comma,"Expected ','");let t=this._consume(A.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(A.tokens.period)&&(t+=`.${this._consume(A.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(A.tokens.paren_right,"Expected ')'"),this._updateNode(new M3(e.toString(),t))}_enable_directive(){const e=this._consume(A.tokens.ident,"identity expected.");return this._updateNode(new dM(e.toString()))}_requires_directive(){const e=[this._consume(A.tokens.ident,"identity expected.").toString()];for(;this._match(A.tokens.comma);){const t=this._consume(A.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new pM(e))}_type_alias(){const e=this._consume(A.tokens.ident,"identity expected.");this._consume(A.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new og(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([A.tokens.ident,...A.texel_format,A.keywords.bool,A.keywords.f32,A.keywords.i32,A.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new gb(i));return this._forwardTypeCount++,s}return this._updateNode(new se(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(A.template_types)){let i=this._advance().toString(),s=null,a=null;return this._match(A.tokens.less_than)&&(s=this._type_decl(),a=null,this._match(A.tokens.comma)&&(a=this._consume(A.access_mode,"Expected access_mode for pointer").toString()),this._consume(A.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new $(i,s,a))}if(this._match(A.keywords.ptr)){let i=this._previous().toString();this._consume(A.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(A.storage_class,"Expected storage_class for pointer");this._consume(A.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let l=null;return this._match(A.tokens.comma)&&(l=this._consume(A.access_mode,"Expected access_mode for pointer").toString()),this._consume(A.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Zc(i,s.toString(),a,l))}const t=this._attribute();if(this._match(A.keywords.array)){let i=null,s=-1;const a=this._previous();let l=null;if(this._match(A.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(A.tokens.comma)){l=this._shift_expression();try{h=l.constEvaluate(this._exec).toString(),l=null}catch{h="1"}}this._consume(A.tokens.greater_than,"Expected '>' for array."),s=h?parseInt(h):0}const u=this._updateNode(new Vo(a.toString(),t,i,s));return l&&this._deferArrayCountEval.push({arrayType:u,countNode:l}),u}return null}_texture_sampler_types(){if(this._match(A.sampler_type))return this._updateNode(new No(this._previous().toString(),null,null));if(this._match(A.depth_texture_type))return this._updateNode(new No(this._previous().toString(),null,null));if(this._match(A.sampled_texture_type)||this._match(A.multisampled_texture_type)){const e=this._previous();this._consume(A.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(A.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new No(e.toString(),t,null))}if(this._match(A.storage_texture_type)){const e=this._previous();this._consume(A.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(A.texel_format,"Invalid texel format.").toString();this._consume(A.tokens.comma,"Expected ',' after texel format.");const i=this._consume(A.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(A.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new No(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(A.tokens.attr);){const t=this._consume(A.attribute_name,"Expected attribute name"),i=this._updateNode(new L3(t.toString(),null));if(this._match(A.tokens.paren_left)){if(i.value=this._consume(A.literal_or_ident,"Expected attribute value").toString(),this._check(A.tokens.comma)){this._advance();do{const s=this._consume(A.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(A.tokens.comma))}this._consume(A.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class PM extends di{constructor(e){super(),e&&this.update(e)}update(e){const t=new MM().parse(e);this.updateAST(t)}}function OM(n){const e={attributes:[],bindings:[]};let t;try{t=IM(n)}catch(a){return oe.error(a.message)(),e}for(const a of t.uniforms){const l=[];for(const u of a.type?.members||[])l.push({name:u.name,type:vb(u.type)});e.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:l})}for(const a of t.textures)e.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of t.samplers)e.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const i=t.entry.vertex[0],s=i?.inputs.length||0;for(let a=0;a<s;a++){const l=i.inputs[a];if(l.locationType==="location"){const u=vb(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function vb(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function IM(n){try{return new PM(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const NM={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...NM}};const Vn=globalThis.mathgl.config;function kM(n,{precision:e=Vn.precision}={}){return n=DM(n),`${parseFloat(n.toPrecision(e))}`}function ma(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Cs(n,e,t){return UM(n,i=>Math.max(e,Math.min(t,i)))}function vu(n,e,t){return ma(n)?n.map((i,s)=>vu(i,e[s],t)):t*e+(1-t)*n}function Zo(n,e,t){const i=Vn.EPSILON;try{if(n===e)return!0;if(ma(n)&&ma(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!Zo(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Vn.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Vn.EPSILON=i}}function DM(n){return Math.round(n/Vn.EPSILON)*Vn.EPSILON}function BM(n){return n.clone?n.clone():new Array(n.length)}function UM(n,e,t){if(ma(n)){const i=n;t=t||BM(i);for(let s=0;s<t.length&&s<i.length;++s){const a=typeof n=="number"?n:n[s];t[s]=e(a,s,t)}return t}return e(n)}class F3 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ma(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Vn)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+kM(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Zo(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const a=e[s],l=typeof t=="number"?t:t[s];this[s]=a+i*(l-a)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Vn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function LM(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function En(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Ad(n,e,t=""){if(Vn.debug&&!LM(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function xb(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class FM extends F3{get x(){return this[0]}set x(e){this[0]=En(e)}get y(){return this[1]}set y(e){this[1]=En(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return En(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return En(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return xb(e>=0&&e<this.ELEMENTS,"index is out of range"),En(this[e])}setComponent(e,t){return xb(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Gc=1e-6;let _a=typeof Float32Array<"u"?Float32Array:Array;function zM(){const n=new _a(2);return _a!=Float32Array&&(n[0]=0,n[1]=0),n}function Tb(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function VM(n,e){return n[0]=-e[0],n[1]=-e[1],n}function z3(n,e,t,i){const s=e[0],a=e[1];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n}function HM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}(function(){const n=zM();return function(e,t,i,s,a,l){let u,h;for(t||(t=2),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],a(n,n,l),e[u]=n[0],e[u+1]=n[1];return e}})();function jM(n,e,t){const i=e[0],s=e[1],a=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/a,n[1]=(t[1]*i+t[5]*s)/a,n}function V3(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[3]*i+t[7]*s+t[11]*a||1;return n[0]=(t[0]*i+t[4]*s+t[8]*a)/l,n[1]=(t[1]*i+t[5]*s+t[9]*a)/l,n[2]=(t[2]*i+t[6]*s+t[10]*a)/l,n}function $M(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function WM(){const n=new _a(3);return _a!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function XM(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function YM(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function qM(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function KM(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[0],u=t[1],h=t[2];return n[0]=s*h-a*u,n[1]=a*l-i*h,n[2]=i*u-s*l,n}function H3(n,e,t){const i=e[0],s=e[1],a=e[2];let l=t[3]*i+t[7]*s+t[11]*a+t[15];return l=l||1,n[0]=(t[0]*i+t[4]*s+t[8]*a+t[12])/l,n[1]=(t[1]*i+t[5]*s+t[9]*a+t[13])/l,n[2]=(t[2]*i+t[6]*s+t[10]*a+t[14])/l,n}function ZM(n,e,t){const i=e[0],s=e[1],a=e[2];return n[0]=i*t[0]+s*t[3]+a*t[6],n[1]=i*t[1]+s*t[4]+a*t[7],n[2]=i*t[2]+s*t[5]+a*t[8],n}function QM(n,e,t){const i=t[0],s=t[1],a=t[2],l=t[3],u=e[0],h=e[1],d=e[2];let p=s*d-a*h,_=a*u-i*d,y=i*h-s*u,v=s*y-a*_,T=a*p-i*y,E=i*_-s*p;const R=l*2;return p*=R,_*=R,y*=R,v*=2,T*=2,E*=2,n[0]=u+p+v,n[1]=h+_+T,n[2]=d+y+E,n}function GM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0],a[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),a[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function JM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),a[1]=s[1],a[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function eP(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),a[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),a[2]=s[2],n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function tP(n,e){const t=n[0],i=n[1],s=n[2],a=e[0],l=e[1],u=e[2],h=Math.sqrt((t*t+i*i+s*s)*(a*a+l*l+u*u)),d=h&&qM(n,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))}const nP=XM;(function(){const n=WM();return function(e,t,i,s,a,l){let u,h;for(t||(t=3),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],a(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2];return e}})();const Ed=[0,0,0];let Nc;class gi extends FM{static get ZERO(){return Nc||(Nc=new gi(0,0,0),Object.freeze(Nc)),Nc}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&ma(e)?this.copy(e):(Vn.debug&&(En(e),En(t),En(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Vn.debug&&(En(e.x),En(e.y),En(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=En(e)}angle(e){return tP(this,e)}cross(e){return KM(this,this,e),this.check()}rotateX({radians:e,origin:t=Ed}){return GM(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Ed}){return JM(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Ed}){return eP(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return H3(this,this,e),this.check()}transformAsVector(e){return V3(this,this,e),this.check()}transformByMatrix3(e){return ZM(this,this,e),this.check()}transformByMatrix2(e){return $M(this,this,e),this.check()}transformByQuaternion(e){return QM(this,this,e),this.check()}}class iP extends F3{toString(){let e="[";if(Vn.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=En(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function sP(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function rP(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],a=e[6],l=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=a,n[11]=e[14],n[12]=s,n[13]=l,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function fp(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=e[4],u=e[5],h=e[6],d=e[7],p=e[8],_=e[9],y=e[10],v=e[11],T=e[12],E=e[13],R=e[14],P=e[15],D=t*u-i*l,M=t*h-s*l,L=t*d-a*l,H=i*h-s*u,J=i*d-a*u,fe=s*d-a*h,de=p*E-_*T,le=p*R-y*T,_e=p*P-v*T,Se=_*R-y*E,De=_*P-v*E,Ee=y*P-v*R;let xe=D*Ee-M*De+L*Se+H*_e-J*le+fe*de;return xe?(xe=1/xe,n[0]=(u*Ee-h*De+d*Se)*xe,n[1]=(s*De-i*Ee-a*Se)*xe,n[2]=(E*fe-R*J+P*H)*xe,n[3]=(y*J-_*fe-v*H)*xe,n[4]=(h*_e-l*Ee-d*le)*xe,n[5]=(t*Ee-s*_e+a*le)*xe,n[6]=(R*L-T*fe-P*M)*xe,n[7]=(p*fe-y*L+v*M)*xe,n[8]=(l*De-u*_e+d*de)*xe,n[9]=(i*_e-t*De-a*de)*xe,n[10]=(T*J-E*L+P*D)*xe,n[11]=(_*L-p*J-v*D)*xe,n[12]=(u*le-l*Se-h*de)*xe,n[13]=(t*Se-i*le+s*de)*xe,n[14]=(E*M-T*H-R*D)*xe,n[15]=(p*H-_*M+y*D)*xe,n):null}function aP(n){const e=n[0],t=n[1],i=n[2],s=n[3],a=n[4],l=n[5],u=n[6],h=n[7],d=n[8],p=n[9],_=n[10],y=n[11],v=n[12],T=n[13],E=n[14],R=n[15],P=e*l-t*a,D=e*u-i*a,M=t*u-i*l,L=d*T-p*v,H=d*E-_*v,J=p*E-_*T,fe=e*J-t*H+i*L,de=a*J-l*H+u*L,le=d*M-p*D+_*P,_e=v*M-T*D+E*P;return h*fe-s*de+R*le-y*_e}function sr(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],u=e[4],h=e[5],d=e[6],p=e[7],_=e[8],y=e[9],v=e[10],T=e[11],E=e[12],R=e[13],P=e[14],D=e[15];let M=t[0],L=t[1],H=t[2],J=t[3];return n[0]=M*i+L*u+H*_+J*E,n[1]=M*s+L*h+H*y+J*R,n[2]=M*a+L*d+H*v+J*P,n[3]=M*l+L*p+H*T+J*D,M=t[4],L=t[5],H=t[6],J=t[7],n[4]=M*i+L*u+H*_+J*E,n[5]=M*s+L*h+H*y+J*R,n[6]=M*a+L*d+H*v+J*P,n[7]=M*l+L*p+H*T+J*D,M=t[8],L=t[9],H=t[10],J=t[11],n[8]=M*i+L*u+H*_+J*E,n[9]=M*s+L*h+H*y+J*R,n[10]=M*a+L*d+H*v+J*P,n[11]=M*l+L*p+H*T+J*D,M=t[12],L=t[13],H=t[14],J=t[15],n[12]=M*i+L*u+H*_+J*E,n[13]=M*s+L*h+H*y+J*R,n[14]=M*a+L*d+H*v+J*P,n[15]=M*l+L*p+H*T+J*D,n}function xu(n,e,t){const i=t[0],s=t[1],a=t[2];let l,u,h,d,p,_,y,v,T,E,R,P;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*a+e[12],n[13]=e[1]*i+e[5]*s+e[9]*a+e[13],n[14]=e[2]*i+e[6]*s+e[10]*a+e[14],n[15]=e[3]*i+e[7]*s+e[11]*a+e[15]):(l=e[0],u=e[1],h=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],E=e[9],R=e[10],P=e[11],n[0]=l,n[1]=u,n[2]=h,n[3]=d,n[4]=p,n[5]=_,n[6]=y,n[7]=v,n[8]=T,n[9]=E,n[10]=R,n[11]=P,n[12]=l*i+p*s+T*a+e[12],n[13]=u*i+_*s+E*a+e[13],n[14]=h*i+y*s+R*a+e[14],n[15]=d*i+v*s+P*a+e[15]),n}function dg(n,e,t){const i=t[0],s=t[1],a=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*a,n[9]=e[9]*a,n[10]=e[10]*a,n[11]=e[11]*a,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function oP(n,e,t,i){let s=i[0],a=i[1],l=i[2],u=Math.sqrt(s*s+a*a+l*l),h,d,p,_,y,v,T,E,R,P,D,M,L,H,J,fe,de,le,_e,Se,De,Ee,xe,Fe;return u<Gc?null:(u=1/u,s*=u,a*=u,l*=u,d=Math.sin(t),h=Math.cos(t),p=1-h,_=e[0],y=e[1],v=e[2],T=e[3],E=e[4],R=e[5],P=e[6],D=e[7],M=e[8],L=e[9],H=e[10],J=e[11],fe=s*s*p+h,de=a*s*p+l*d,le=l*s*p-a*d,_e=s*a*p-l*d,Se=a*a*p+h,De=l*a*p+s*d,Ee=s*l*p+a*d,xe=a*l*p-s*d,Fe=l*l*p+h,n[0]=_*fe+E*de+M*le,n[1]=y*fe+R*de+L*le,n[2]=v*fe+P*de+H*le,n[3]=T*fe+D*de+J*le,n[4]=_*_e+E*Se+M*De,n[5]=y*_e+R*Se+L*De,n[6]=v*_e+P*Se+H*De,n[7]=T*_e+D*Se+J*De,n[8]=_*Ee+E*xe+M*Fe,n[9]=y*Ee+R*xe+L*Fe,n[10]=v*Ee+P*xe+H*Fe,n[11]=T*Ee+D*xe+J*Fe,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function j3(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[4],l=e[5],u=e[6],h=e[7],d=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=a*s+d*i,n[5]=l*s+p*i,n[6]=u*s+_*i,n[7]=h*s+y*i,n[8]=d*s-a*i,n[9]=p*s-l*i,n[10]=_*s-u*i,n[11]=y*s-h*i,n}function lP(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],u=e[2],h=e[3],d=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s-d*i,n[1]=l*s-p*i,n[2]=u*s-_*i,n[3]=h*s-y*i,n[8]=a*i+d*s,n[9]=l*i+p*s,n[10]=u*i+_*s,n[11]=h*i+y*s,n}function $3(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],u=e[2],h=e[3],d=e[4],p=e[5],_=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s+d*i,n[1]=l*s+p*i,n[2]=u*s+_*i,n[3]=h*s+y*i,n[4]=d*s-a*i,n[5]=p*s-l*i,n[6]=_*s-u*i,n[7]=y*s-h*i,n}function cP(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=t+t,u=i+i,h=s+s,d=t*l,p=i*l,_=i*u,y=s*l,v=s*u,T=s*h,E=a*l,R=a*u,P=a*h;return n[0]=1-_-T,n[1]=p+P,n[2]=y-R,n[3]=0,n[4]=p-P,n[5]=1-d-T,n[6]=v+E,n[7]=0,n[8]=y+R,n[9]=v-E,n[10]=1-d-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function uP(n,e,t,i,s,a,l){const u=1/(t-e),h=1/(s-i),d=1/(a-l);return n[0]=a*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(s+i)*h,n[10]=(l+a)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*a*2*d,n[15]=0,n}function fP(n,e,t,i,s){const a=1/Math.tan(e/2);if(n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const hP=fP;function dP(n,e,t,i,s,a,l){const u=1/(e-t),h=1/(i-s),d=1/(a-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*u,n[13]=(s+i)*h,n[14]=(l+a)*d,n[15]=1,n}const pP=dP;function gP(n,e,t,i){let s,a,l,u,h,d,p,_,y,v;const T=e[0],E=e[1],R=e[2],P=i[0],D=i[1],M=i[2],L=t[0],H=t[1],J=t[2];return Math.abs(T-L)<Gc&&Math.abs(E-H)<Gc&&Math.abs(R-J)<Gc?sP(n):(_=T-L,y=E-H,v=R-J,s=1/Math.sqrt(_*_+y*y+v*v),_*=s,y*=s,v*=s,a=D*v-M*y,l=M*_-P*v,u=P*y-D*_,s=Math.sqrt(a*a+l*l+u*u),s?(s=1/s,a*=s,l*=s,u*=s):(a=0,l=0,u=0),h=y*u-v*l,d=v*a-_*u,p=_*l-y*a,s=Math.sqrt(h*h+d*d+p*p),s?(s=1/s,h*=s,d*=s,p*=s):(h=0,d=0,p=0),n[0]=a,n[1]=h,n[2]=_,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=u,n[9]=p,n[10]=v,n[11]=0,n[12]=-(a*T+l*E+u*R),n[13]=-(h*T+d*E+p*R),n[14]=-(_*T+y*E+v*R),n[15]=1,n)}function mP(){const n=new _a(4);return _a!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function _P(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function al(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*a+t[12]*l,n[1]=t[1]*i+t[5]*s+t[9]*a+t[13]*l,n[2]=t[2]*i+t[6]*s+t[10]*a+t[14]*l,n[3]=t[3]*i+t[7]*s+t[11]*a+t[15]*l,n}(function(){const n=mP();return function(e,t,i,s,a,l){let u,h;for(t||(t=4),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],n[3]=e[u+3],a(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2],e[u+3]=n[3];return e}})();var hp;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(hp||(hp={}));const yP=45*Math.PI/180,bP=1,Rd=.1,Cd=500,vP=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class mi extends iP{static get IDENTITY(){return TP()}static get ZERO(){return xP()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return hp}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,a,l,u,h,d,p,_,y,v,T,E,R){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=a,this[5]=l,this[6]=u,this[7]=h,this[8]=d,this[9]=p,this[10]=_,this[11]=y,this[12]=v,this[13]=T,this[14]=E,this[15]=R,this.check()}setRowMajor(e,t,i,s,a,l,u,h,d,p,_,y,v,T,E,R){return this[0]=e,this[1]=a,this[2]=d,this[3]=v,this[4]=t,this[5]=l,this[6]=p,this[7]=T,this[8]=i,this[9]=u,this[10]=_,this[11]=E,this[12]=s,this[13]=h,this[14]=y,this[15]=R,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(vP)}fromObject(e){return this.check()}fromQuaternion(e){return cP(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:a,near:l=Rd,far:u=Cd}=e;return u===1/0?SP(this,t,i,s,a,l):uP(this,t,i,s,a,l,u),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return gP(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:a,near:l=Rd,far:u=Cd}=e;return pP(this,t,i,s,a,l,u),this.check()}orthographic(e){const{fovy:t=yP,aspect:i=bP,focalDistance:s=1,near:a=Rd,far:l=Cd}=e;Sb(t);const u=t/2,h=s*Math.tan(u),d=h*i;return this.ortho({left:-d,right:d,bottom:-h,top:h,near:a,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:a=500}=e;return Sb(t),hP(this,t,i,s,a),this.check()}determinant(){return aP(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*a,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*a,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*a,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*a,e[8]=this[10]*l,e}transpose(){return rP(this,this),this.check()}invert(){return fp(this,this),this.check()}multiplyLeft(e){return sr(this,e,this),this.check()}multiplyRight(e){return sr(this,this,e),this.check()}rotateX(e){return j3(this,this,e),this.check()}rotateY(e){return lP(this,this,e),this.check()}rotateZ(e){return $3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return oP(this,this,e,t),this.check()}scale(e){return dg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return xu(this,this,e),this.check()}transform(e,t){return e.length===4?(t=al(t||[-0,-0,-0,-0],e,this),Ad(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=HM(t||[-0,-0],e,this);break;case 3:s=H3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ad(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=jM(t||[-0,-0],e,this);break;case 3:i=V3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ad(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let kc,Dc;function xP(){return kc||(kc=new mi([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(kc)),kc}function TP(){return Dc||(Dc=new mi,Object.freeze(Dc)),Dc}function Sb(n){if(n>Math.PI*2)throw Error("expected radians")}function SP(n,e,t,i,s,a){const l=2*a/(t-e),u=2*a/(s-i),h=(t+e)/(t-e),d=(s+i)/(s-i),p=-1,_=-1,y=-2*a;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=h,n[9]=d,n[10]=p,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function W3(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function wP(n){return n-Math.fround(n)}function AP(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;W3(n[i*4+t],e,s*2)}return e}const EP=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,RP={name:"fp32",vs:EP},CP=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,MP={ONE:1},PP={name:"fp64arithmetic",vs:CP,defaultUniforms:MP,uniformTypes:{ONE:"f32"},fp64ify:W3,fp64LowPart:wP,fp64ifyMatrix4:AP},OP=[0,1,1,1],IP=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,NP=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,wb={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:OP},vs:IP,fs:NP,getUniforms:kP};function kP(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const Ab=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,DP=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,X3=3,BP=255;var Qo;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(Qo||(Qo={}));const Jc={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:X3},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Qo.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:DP,vs:Ab,fs:Ab,getUniforms:UP};function UP(n,e={}){if(n=n&&{...n},!n)return{...Jc.defaultUniforms};n.lights&&(n={...n,...FP(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:s}=n||{};if(!(t||i&&i.length>0||s&&s.length>0))return{...Jc.defaultUniforms,enabled:0};const l={...Jc.defaultUniforms,...e,...LP({ambientLight:t,pointLights:i,directionalLights:s})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function LP({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientLightColor=Md(n);let s=0;for(const a of e){i.lightType=Qo.POINT;const l=s;i[`lightColor${l}`]=Md(a),i[`lightPosition${l}`]=a.position,i[`lightAttenuation${l}`]=a.attenuation||[1,0,0],s++}for(const a of t){i.lightType=Qo.DIRECTIONAL;const l=s;i[`lightColor${l}`]=Md(a),i[`lightDirection${l}`]=a.direction,s++}return s>X3&&oe.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function FP(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function Md(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/BP)}const zP=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,VP=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,HP=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Y3={props:{},name:"gouraudMaterial",vs:VP.replace("phongMaterial","gouraudMaterial"),fs:zP.replace("phongMaterial","gouraudMaterial"),source:HP.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Jc],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Y3.defaultUniforms,...e}}},Eb=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,jP={name:"layer",vs:Eb,fs:Eb,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},$P=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,q3="#define SMOOTH_EDGE_RADIUS 0.5",WP=`${q3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,XP=`${q3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,K3={name:"geometry",source:$P,vs:WP,fs:XP},YP=25;var It;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(It||(It={}));var Bt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Bt||(Bt={}));var Be;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Be||(Be={}));const qP="compute",KP="auto",dp="manipulation",eu="none",pp="pan-x",gp="pan-y";function ZP(n){if(n.includes(eu))return eu;const e=n.includes(pp),t=n.includes(gp);return e&&t?eu:e||t?e?pp:gp:n.includes(dp)?dp:KP}class QP{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===qP&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return ZP(e.join(" "))}}function Tu(n){return n.trim().split(/\s+/g)}function Pd(n,e,t){if(n)for(const i of Tu(e))n.addEventListener(i,t,!1)}function Od(n,e,t){if(n)for(const i of Tu(e))n.removeEventListener(i,t,!1)}function Rb(n){return(n.ownerDocument||n).defaultView}function GP(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Z3(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function Cb(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:Z3(e),deltaX:n.deltaX,deltaY:n.deltaY}}function Q3(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function Mb(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function JP(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function Pb(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function G3(n,e){return n===e?Bt.None:Math.abs(n)>=Math.abs(e)?n<0?Bt.Left:Bt.Right:e<0?Bt.Up:Bt.Down}function eO(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const a=n.prevInput;return(e.eventType===It.Start||a?.eventType===It.End)&&(s=n.prevDelta={x:a?.deltaX||0,y:a?.deltaY||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function J3(n,e,t){return{x:e/n||0,y:t/n||0}}function tO(n,e){return Mb(e[0],e[1])/Mb(n[0],n[1])}function nO(n,e){return Pb(e[1],e[0])-Pb(n[1],n[0])}function iO(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,a,l,u;if(e.eventType!==It.Cancel&&(i>YP||t.velocity===void 0)){const h=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=J3(i,h,d);a=p.x,l=p.y,s=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,u=G3(h,d),n.lastInterval=e}else s=t.velocity,a=t.velocityX,l=t.velocityY,u=t.direction;e.velocity=s,e.velocityX=a,e.velocityY=l,e.direction=u}function sO(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=Cb(e)),s>1&&!t.firstMultiple?t.firstMultiple=Cb(e):s===1&&(t.firstMultiple=!1);const{firstInput:a,firstMultiple:l}=t,u=l?l.center:a.center,h=e.center=Z3(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=JP(u,h),e.distance=Q3(u,h);const{deltaX:d,deltaY:p}=eO(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=G3(e.deltaX,e.deltaY);const _=J3(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?tO(l.pointers,i):1,e.rotation=l?nO(l.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return GP(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,iO(t,e),e}function rO(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,a=e&It.Start&&i-s===0,l=e&(It.End|It.Cancel)&&i-s===0;t.isFirst=!!a,t.isFinal=!!l,a&&(n.session={}),t.eventType=e;const u=sO(n,t);n.emit("hammer.input",u),n.recognize(u),n.session.prevInput=u}let aO=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){rO(this.manager,e,t)}init(){Pd(this.element,this.evEl,this.domHandler),Pd(this.target,this.evTarget,this.domHandler),Pd(Rb(this.element),this.evWin,this.domHandler)}destroy(){Od(this.element,this.evEl,this.domHandler),Od(this.target,this.evTarget,this.domHandler),Od(Rb(this.element),this.evWin,this.domHandler)}};const oO={pointerdown:It.Start,pointermove:It.Move,pointerup:It.End,pointercancel:It.Cancel,pointerout:It.Cancel},lO="pointerdown",cO="pointermove pointerup pointercancel";class uO extends aO{constructor(e){super(e),this.evEl=lO,this.evWin=cO,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=oO[e.type],a=e.pointerType,l=a==="touch";let u=t.findIndex(h=>h.pointerId===e.pointerId);s&It.Start&&(e.buttons||l)?u<0&&(t.push(e),u=t.length-1):s&(It.End|It.Cancel)&&(i=!0),!(u<0)&&(t[u]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:a,srcEvent:e}),i&&t.splice(u,1))}}const fO=["","webkit","Moz","MS","ms","o"];function hO(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of fO){const s=i?i+t:e;if(s in n)return s}}const dO=1,Ob=2,Ib={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class pO{constructor(e,t){this.options={...Ib,...t,cssProps:{...Ib.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new uO(this),this.touchAction=new QP(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Ob:dO}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:a}=t;(!a||a&&a.state&Be.Recognized)&&(a=t.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],t.stopped!==Ob&&(!a||i===a||i.canRecognizeWith(a))?i.recognize(e):i.reset(),!a&&i.state&(Be.Began|Be.Changed|Be.Ended)&&(a=t.curRecognizer=i),l++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of Tu(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of Tu(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let a=0;for(;a<i.length;)i[a](s),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const a=hO(t.style,i);e?(this.oldCssProps[a]=t.style[a],t.style[a]=s):t.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let gO=1;function mO(){return gO++}function Nb(n){return n&Be.Cancelled?"cancel":n&Be.Ended?"end":n&Be.Changed?"move":n&Be.Began?"start":""}class eT{constructor(e){this.options=e,this.id=mO(),this.state=Be.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Be.Ended&&this.manager.emit(this.options.event+Nb(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Be.Ended&&this.manager.emit(this.options.event+Nb(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Be.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Be.Failed|Be.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Be.Failed;return}this.state&(Be.Recognized|Be.Cancelled|Be.Failed)&&(this.state=Be.Possible),this.state=this.process(t),this.state&(Be.Began|Be.Changed|Be.Ended|Be.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class tT extends eT{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(Be.Began|Be.Changed),a=this.attrTest(e);return s&&(i&It.Cancel||!a)?t|Be.Cancelled:s||a?i&It.End?t|Be.Ended:t&Be.Began?t|Be.Changed:Be.Began:Be.Failed}}class kb extends eT{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[dp]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&It.Start&&this.count===0)return this.failTimeout();if(s&&a&&i){if(e.eventType!==It.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,u=!this.pCenter||Q3(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Be.Recognized,this.tryEmit(this._input)},t.interval),Be.Began):Be.Recognized}return Be.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Be.Failed},this.options.interval),Be.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Be.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const _O=["","start","move","end","cancel","up","down","left","right"];class Db extends tT{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Bt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Bt.Horizontal&&t.push(gp),e&Bt.Vertical&&t.push(pp),t}getEventNames(){return _O.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:a}=e;const l=e.deltaX,u=e.deltaY;return a&t.direction||(t.direction&Bt.Horizontal?(a=l===0?Bt.None:l<0?Bt.Left:Bt.Right,i=l!==this.pX,s=Math.abs(e.deltaX)):(a=u===0?Bt.None:u<0?Bt.Up:Bt.Down,i=u!==this.pY,s=Math.abs(e.deltaY))),e.direction=a,i&&s>t.threshold&&!!(a&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Be.Began)||!(this.state&Be.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Bt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const yO=["","start","move","end","cancel","in","out"];class bO extends tT{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[eu]}getEventNames(){return yO.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Be.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class zu{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const vO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",xO=vO.indexOf("firefox")!==-1,Bb=4.000244140625,TO=40,SO=.25;class wO extends zu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let a=s.deltaY;globalThis.WheelEvent&&(xO&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=TO)),a!==0&&a%Bb===0&&(a=Math.floor(a/Bb)),s.shiftKey&&a&&(a=a*SO),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-a,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Ub=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class AO extends zu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Ub.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){Ub.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Lb=["keydown","keyup"];class EO extends zu{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const a=s.target||s.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Lb.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Lb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class RO extends zu{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const Fb=1,mp=2,zb=4,CO={pointerdown:Fb,pointermove:mp,pointerup:zb,mousedown:Fb,mousemove:mp,mouseup:zb},MO=0,PO=1,OO=2,IO=1,NO=2,kO=4;function DO(n){const e=CO[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,a=!1,l=!1;return e===mp?(s=!!(t&IO),a=!!(t&kO),l=!!(t&NO)):(s=i===MO,a=i===PO,l=i===OO),{leftButton:s,middleButton:a,rightButton:l}}function BO(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,l={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/a};return{center:t,offsetCenter:l}}const UO={srcElement:"root",priority:0};class LO{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let a=i.srcEvent.target;for(;a&&a!==s.rootElement;){if(this._emit(s,a),s.handled)return;a=a.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,a=!1){const{handlers:l,handlersByElement:u}=this,h={...UO,...i};let d=u.get(h.srcElement);d||(d=[],u.set(h.srcElement,d));const p={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};s&&(p.once=!0),a&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=p.priority);)_--;d.splice(_+1,0,p)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.type===e&&l.handler===t){i.splice(a,1);const u=s.get(l.srcElement);u.splice(u.indexOf(l),1),u.length===0&&s.delete(l.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const a=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},u=[];for(let h=0;h<i.length;h++){const{type:d,handler:p,once:_}=i[h];if(p({...e,type:d,stopPropagation:a,stopImmediatePropagation:l}),_&&u.push(i[h]),s)break}for(let h=0;h<u.length;h++){const{type:d,handler:p}=u[h];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...DO(e),...BO(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function FO(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class zO{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new pO(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:a,requireFailure:l}=FO(i);this.manager.add(s),a&&s.recognizeWith(a),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new wO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new AO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new EO(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new RO(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,s,a){if(typeof e!="string"){i=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,i,s,a);return}const{manager:l,events:u}=this;if(!l)return;let h=u.get(e);if(!h){const d=this._getRecognizerName(e)||e;h=new LO(this,d),u.set(e,h),l&&l.on(e,h.handleEvent)}h.add(e,t,i,s,a),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[a,l]of Object.entries(e))this._removeEventHandler(a,l);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:a}=s;let l=!1;for(const u of i.values())if(u.recognizerName===a&&!u.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Ke={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ke,"IDENTITY",{get:()=>(We.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Fn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Hi={common:0,meters:1,pixels:2},_p={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Vb={multipan:[Db,{threshold:10,direction:Bt.Vertical,pointers:2}],pinch:[bO,{},null,["multipan"]],pan:[Db,{threshold:1},["pinch"],["multipan"]],dblclick:[kb,{event:"dblclick",taps:2}],click:[kb,{event:"click"},null,["dblclick"]]};function VO(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function ol(n){let e={},t;return i=>{for(const s in i)if(!VO(i[s],e[s])){t=n(i),e=i;break}return t}}const Hb=[0,0,0,0],HO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],nT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jO=[0,0,0],iT=[0,0,0],$O=ol(YO);function sT(n,e,t=iT){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,a=!0;switch(e===Ke.LNGLAT_OFFSETS||e===Ke.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Fn.WEB_MERCATOR:(e===Ke.LNGLAT||e===Ke.CARTESIAN)&&(s=[0,0,0],a=!1);break;case Fn.WEB_MERCATOR_AUTO_OFFSET:e===Ke.LNGLAT?i=s:e===Ke.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Fn.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case Fn.GLOBE:a=!1,s=null;break;default:a=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:a}}function WO(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:a,viewProjectionMatrix:l}=n,u=Hb,h=Hb,d=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=sT(n,e,t);return y&&(h=n.projectPosition(p||_),d=[d[0]-h[0],d[1]-h[1],d[2]-h[2]],h[3]=1,u=al([],h,l),a=i||a,l=sr([],s,a),l=sr([],l,HO)),{viewMatrix:a,viewProjectionMatrix:l,projectionCenter:u,originCommon:h,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:p}}function XO({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Ke.DEFAULT,coordinateOrigin:s=iT,autoWrapLongitude:a=!1}){i===Ke.DEFAULT&&(i=n.isGeospatial?Ke.LNGLAT:Ke.CARTESIAN);const l=$O({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=a,l.modelMatrix=t||nT,l}function YO({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:a,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:d}=WO(n,t,i),p=n.getDistanceScales(),_=[n.width*e,n.height*e],y=al([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,v={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:h,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:jO,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:nT,cameraPosition:u};if(d){const T=n.getDistanceScales(d);switch(t){case Ke.METER_OFFSETS:v.commonUnitsPerWorldUnit=T.unitsPerMeter,v.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case Ke.LNGLAT:case Ke.LNGLAT_OFFSETS:n._pseudoMeters||(v.commonUnitsPerMeter=T.unitsPerMeter),v.commonUnitsPerWorldUnit=T.unitsPerDegree,v.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case Ke.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return v}const qO=Object.keys(Ke).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Ke[n]};`).join(""),KO=Object.keys(Fn).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Fn[n]};`).join(""),ZO=Object.keys(Hi).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Hi[n]};`).join(""),QO=`${qO}
${KO}
${ZO}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,GO=`${QO}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,JO=Object.keys(Ke).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ke[n]};`).join(""),eI=Object.keys(Fn).map(n=>`const int PROJECTION_MODE_${n} = ${Fn[n]};`).join(""),tI=Object.keys(Hi).map(n=>`const int UNIT_${n.toUpperCase()} = ${Hi[n]};`).join(""),nI=`${JO}
${eI}
${tI}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,iI={};function sI(n=iI){return"viewport"in n?XO(n):{}}const pg={name:"project",dependencies:[RP,K3],source:GO,vs:nI,getUniforms:sI,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},rI=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,aI=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ll={name:"project32",dependencies:[pg],source:rI,vs:aI};function oI(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fa(n,e){const t=al([],e,n);return _P(t,t,1/t[3]),t}function jb(n,e){const t=n%e;return t<0?e+t:t}function yp(n,e,t){return n<e?e:n>t?t:n}function lI(n){return Math.log(n)*Math.LOG2E}const gg=Math.log2||lI;function ji(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Gn=Math.PI,rT=Gn/4,Hn=Gn/180,bp=180/Gn,ya=512,Su=4003e4,Bc=85.051129,cI=1.5;function uI(n){return gg(n)}function wu(n){const[e,t]=n;ji(Number.isFinite(e)),ji(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*Hn,s=t*Hn,a=ya*(i+Gn)/(2*Gn),l=ya*(Gn+Math.log(Math.tan(rT+s*.5)))/(2*Gn);return[a,l]}function ba(n){const[e,t]=n,i=e/ya*(2*Gn)-Gn,s=2*(Math.atan(Math.exp(t/ya*(2*Gn)-Gn))-rT);return[i*bp,s*bp]}function fI(n){const{latitude:e}=n;ji(Number.isFinite(e));const t=Math.cos(e*Hn);return uI(Su*t)-9}function Id(n){const e=Math.cos(n*Hn);return ya/Su/e}function vp(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;ji(Number.isFinite(e)&&Number.isFinite(t));const s=ya,a=Math.cos(e*Hn),l=s/360,u=l/a,h=s/Su/a,d={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[l,u,h],degreesPerUnit:[1/l,1/u,1/h]};if(i){const p=Hn*Math.tan(e*Hn)/a,_=l*p/2,y=s/Su*p,v=y/u*h;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[v,0,v]}return d}function aT(n,e){const[t,i,s]=n,[a,l,u]=e,{unitsPerMeter:h,unitsPerMeter2:d}=vp({longitude:t,latitude:i,highPrecision:!0}),p=wu(n);p[0]+=a*(h[0]+d[0]*l),p[1]+=l*(h[1]+d[1]*l);const _=ba(p),y=(s||0)+(u||0);return Number.isFinite(s)||Number.isFinite(u)?[_[0],_[1],y]:_}function hI(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:a,center:l}=n,u=oI();xu(u,u,[0,0,-s]),j3(u,u,-t*Hn),$3(u,u,i*Hn);const h=a/e;return dg(u,u,[h,h,h]),l&&xu(u,u,YM([],l)),u}function dI(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:a,center:l,scale:u,nearZMultiplier:h=1,farZMultiplier:d=1}=n;let{fovy:p=Au(cI)}=n;i!==void 0&&(p=Au(i));const _=p*Hn,y=s*Hn,v=oT(p);let T=v;l&&(T+=l[2]*u/Math.cos(y)/t);const E=_*(.5+(a?a[1]:0)/t),R=Math.sin(E)*T/Math.sin(yp(Math.PI/2-y-E,.01,Math.PI-.01)),P=Math.sin(y)*R+T,D=T*10,M=Math.min(P*d,D);return{fov:_,aspect:e/t,focalDistance:v,near:h,far:M}}function Au(n){return 2*Math.atan(.5/n)*bp}function oT(n){return .5/Math.tan(.5*n*Hn)}function lT(n,e){const[t,i,s=0]=n;return ji(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),fa(e,[t,i,s,1])}function mg(n,e,t=0){const[i,s,a]=n;if(ji(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(a))return fa(e,[i,s,a,1]);const l=fa(e,[i,s,0,1]),u=fa(e,[i,s,1,1]),h=l[2],d=u[2],p=h===d?0:((t||0)-h)/(d-h);return z3([],l,u,p)}function pI(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:a=24,offset:l=[0,0]}=n,[[u,h],[d,p]]=i,_=gI(n.padding),y=wu([u,yp(p,-Bc,Bc)]),v=wu([d,yp(h,-Bc,Bc)]),T=[Math.max(Math.abs(v[0]-y[0]),s),Math.max(Math.abs(v[1]-y[1]),s)],E=[e-_.left-_.right-Math.abs(l[0])*2,t-_.top-_.bottom-Math.abs(l[1])*2];ji(E[0]>0&&E[1]>0);const R=E[0]/T[0],P=E[1]/T[1],D=(_.right-_.left)/2/R,M=(_.top-_.bottom)/2/P,L=[(v[0]+y[0])/2+D,(v[1]+y[1])/2+M],H=ba(L),J=Math.min(a,gg(Math.abs(Math.min(R,P))));return ji(Number.isFinite(J)),{longitude:H[0],latitude:H[1],zoom:J}}function gI(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(ji(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const $b=Math.PI/180;function mI(n,e=0){const{width:t,height:i,unproject:s}=n,a={targetZ:e},l=s([0,i],a),u=s([t,i],a);let h,d;const p=n.fovy?.5*n.fovy*$b:Math.atan(.5/n.altitude),_=(90-n.pitch)*$b;return p>_-.01?(h=Wb(n,0,e),d=Wb(n,t,e)):(h=s([0,0],a),d=s([t,0],a)),[l,u,d,h]}function Wb(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=fa(i,[e,0,1,1]),a=fa(i,[e,n.height,1,1]),u=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(a[2]-s[2]),h=z3([],s,a,u),d=ba(h);return d.push(t),d}const Xb=512;function _I(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:a,zoom:l,bearing:u=0}=n;(s<-180||s>180)&&(s=jb(s+180,360)-180),(u<-180||u>180)&&(u=jb(u+180,360)-180);const h=gg(t/Xb);if(l<=h)l=h,a=0;else{const d=t/2/Math.pow(2,l),p=ba([0,d])[1];if(a<p)a=p;else{const _=ba([0,Xb-d])[1];a>_&&(a=_)}}return{width:e,height:t,longitude:s,latitude:a,zoom:l,pitch:i,bearing:u}}const cT=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,yI=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,bI=`
${cT}
${yI}
`,vI=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,xI=`
${cT}
${vI}
`,TI=ol(RI),SI=ol(CI),wI=[0,0,0,1],AI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function EI(n,e){const[t,i,s]=n,a=mg([t,i,s],e);return Number.isFinite(s)?a:[a[0],a[1],0]}function RI({viewport:n,center:e}){return new mi(n.viewProjectionMatrix).invert().transform(e)}function CI({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,a=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>EI(l,i));for(const l of e){const u=l.clone().translate(new gi(n.center).negate()),h=a.map(p=>u.transform(p)),d=new mi().ortho({left:Math.min(...h.map(p=>p[0])),right:Math.max(...h.map(p=>p[0])),bottom:Math.min(...h.map(p=>p[1])),top:Math.max(...h.map(p=>p[1])),near:Math.min(...h.map(p=>-p[2])),far:Math.max(...h.map(p=>-p[2]))});t.push(d.multiplyRight(l))}return t}function MI(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=pg.getUniforms(t),s=TI({viewport:t.viewport,center:i.center}),a=[],l=SI({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let h=0;h<n.shadowMatrices.length;h++){const d=l[h],p=d.clone().translate(new gi(t.viewport.center).negate());i.coordinateSystem===Ke.LNGLAT&&i.projectionMode===Fn.WEB_MERCATOR?(l[h]=p,a[h]=s):(l[h]=d.clone().multiplyRight(AI),a[h]=p.transform(s))}const u={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||wI,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let h=0;h<l.length;h++)u[`viewProjectionMatrix${h}`]=l[h],u[`projectCenter${h}`]=a[h];for(let h=0;h<2;h++)u[`shadow_uShadowMap${h}`]=n.shadowMaps&&n.shadowMaps[h]||n.dummyShadowMap;return u}const Yb={name:"shadow",dependencies:[pg],vs:bI,fs:xI,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:MI,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},cl={...wb,defaultUniforms:{...wb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},PI=[K3],OI=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],II=[];function NI(n){const e=tr.getDefaultShaderAssembler();for(const i of PI)e.addDefaultModule(i);const t=n==="glsl"?OI:II;for(const i of t)e.addShaderHook(i);return e}const kI=[255,255,255],DI=1;let BI=0;class UI{constructor(e={}){this.type="ambient";const{color:t=kI}=e,{intensity:i=DI}=e;this.id=e.id||`ambient-${BI++}`,this.color=t,this.intensity=i}}const LI=[255,255,255],FI=1,zI=[0,0,-1];let VI=0;class qb{constructor(e={}){this.type="directional";const{color:t=LI}=e,{intensity:i=FI}=e,{direction:s=zI}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${VI++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new gi(s).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class HI{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class _g extends HI{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,a=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,u=s?0:!1,h=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=h),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:a,clearDepth:l,clearStencil:u});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:a,views:l,onViewportActive:u,clearStack:h=!0}=t;t.pass=t.pass||"unknown",h&&(this._lastRenderIndex=-1);const d=[];for(const p of a){const _=l&&l[p.id];u?.(p);const y=this._getDrawLayerParams(p,t),v=p.subViewports||[p];for(const T of v){const E=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:T,view:_,pass:t.pass,layers:t.layers},y);d.push(E)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:a,cullRect:l,effects:u,shaderModuleProps:h},d=!1){const p=[],_=uT(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:l},v={};for(let T=0;T<t.length;T++){const E=t[T],R=this._shouldDrawLayer(E,y,a,v),P={shouldDrawLayer:R};R&&!d&&(P.shouldDrawLayer=!0,P.layerRenderIndex=_(E,R),P.shaderModuleProps=this._getShaderModuleProps(E,u,i,h),P.layerParameters={...E.context.deck?.props.parameters,...this.getLayerParameters(E,T,e)}),p[T]=P}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:a,viewport:l,view:u},h){const d=jI(this.device,{shaderModuleProps:i,target:a,viewport:l});if(u&&u.props.clear){const _=u.props.clear===!0?{color:!0,depth:!0}:u.props.clear;this.device.beginRenderPass({framebuffer:a,parameters:{viewport:d,scissorRect:d},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let _=0;_<t.length;_++){const y=t[_],v=h[_],{shouldDrawLayer:T}=v;if(T&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:E,shaderModuleProps:R,layerParameters:P}=v;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),R.project&&(R.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:R,uniforms:{layerIndex:E},parameters:P})}catch(D){y.raiseError(D,`drawing ${y} to ${s}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(i){const u=t.layer.id;if(u in s||(s[u]=i(t)),!s[u])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){const a=this.device.canvasContext.cssToDeviceRatio(),l=e.internalState?.propsInTransition||e.props,u={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const h of t)Kb(u,h.getShaderModuleProps?.(e,u));return Kb(u,this.getShaderModuleProps(e,t,u),s)}}function uT(n=0,e={}){const t={},i=(s,a)=>{const l=s.props._offset,u=s.id,h=s.parent&&s.parent.id;let d;if(h&&!(h in e)&&i(s.parent,!1),h in t){const p=t[h]=t[h]||uT(e[h],e);d=p(s,a),t[u]=p}else Number.isFinite(l)?(d=l+(e[h]||0),t[u]=null):d=n;return a&&d>=n&&(n=d+1),e[u]=d,d};return i}function jI(n,{shaderModuleProps:e,target:t,viewport:i}){const s=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,a]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:a,u=i;return[u.x*s,l-(u.y+u.height)*s,u.width*s,u.height*s]}function Kb(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class $I extends _g{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],a=s.width*i,l=s.height*i,u=[1,1,1,1];(a!==t.width||l!==t.height)&&t.resize({width:a,height:l}),super.render({...e,clearColor:u,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const WI={color:[255,255,255],intensity:1},Zb=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],XI=[0,0,0,200/255];class fT{constructor(e={}){this.id="lighting-effect",this.shadowColor=XI,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(Yb),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:i,lighting:s,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Yb))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new mi().lookAt({eye:new gi(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new $I(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new UI(WI),this.directionalLights.push(new qb(Zb[0]),new qb(Zb[1])))}}class YI{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:a=0,copy:l=!1,initialize:u=!1,maxCount:h}){const d=s||e&&e.constructor||Float32Array,p=t*i+a;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let _=1/0;h&&(_=h*i+a);const y=this._allocate(d,p,u,_);return e&&l?y.set(e):u||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let a=Math.max(Math.ceil(t*this.opts.overAlloc),1);a>s&&(a=s);const l=this._pool,u=e.BYTES_PER_ELEMENT*a,h=l.findIndex(d=>d.byteLength>=u);if(h>=0){const d=new e(l.splice(h,1)[0],0,a);return i&&d.fill(0),d}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,a=t.findIndex(l=>l.byteLength>=s);a<0?t.push(i):(a>0||t.length<this.opts.poolSize)&&t.splice(a,0,i),t.length>this.opts.poolSize&&t.shift()}}const va=new YI;function ko(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function qI(n){return[n[12],n[13],n[14]]}function KI(n){return{left:ta(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:ta(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:ta(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:ta(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:ta(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:ta(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Qb=new gi;function ta(n,e,t,i){Qb.set(n,e,t);const s=Qb.len();return{distance:i/s,normal:new gi(-n/s,-e/s,-t/s)}}function ZI(n){return n-Math.fround(n)}let Ro;function Nd(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,a=(s-i)/t;Ro=va.allocate(Ro,a,{type:Float32Array,size:t*2});let l=i,u=0;for(;l<s;){for(let h=0;h<t;h++){const d=n[l++];Ro[u+h]=d,Ro[u+h+t]=ZI(d)}u+=t*2}return Ro.subarray(0,a*t*2)}function QI(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const GI=Math.PI/180,JI=ko(),Gb=[0,0,0],e4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function t4({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:a,near:l,far:u}){const h=n/e,d=t?new mi().orthographic({fovy:i,aspect:h,focalDistance:s,near:l,far:u}):new mi().perspective({fovy:i,aspect:h,near:l,far:u});if(a){const{left:p=0,right:_=0,top:y=0,bottom:v=0}=a,T=Cs((p+n-_)/2,0,n)-n/2,E=Cs((y+e-v)/2,0,e)-e/2;d[8]-=T*2/n,d[9]+=E*2/e}return d}class ul{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||e4,this.focalDistance=e.focalDistance||1,this.position=e.position||Gb,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Fn.WEB_MERCATOR:Fn.WEB_MERCATOR_AUTO_OFFSET:Fn.IDENTITY}equals(e){return e instanceof ul?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Zo(e.projectionMatrix,this.projectionMatrix)&&Zo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=lT(i,this.pixelProjectionMatrix),[a,l]=s,u=t?l:this.height-l;return e.length===2?[a,u]:[a,u,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,a,l]=e,u=t?a:this.height-a,h=i&&i*this.distanceScales.unitsPerMeter[2],d=mg([s,u,l],this.pixelUnprojectionMatrix,h),[p,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,_,y]:Number.isFinite(i)?[p,_,i]:[p,_]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=wu(e);return t[1]=Cs(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ba(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),a=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],a[0],l[0]),Math.min(i[1],s[1],a[1],l[1]),Math.max(i[0],s[0],a[0],l[0]),Math.max(i[1],s[1],a[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?vp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,KI(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=fI({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||vp({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:a,modelMatrix:l}=e;let u=Gb;if(a&&(u=l?new mi(l).transformAsVector(a,[]):a),this.isGeospatial){const h=this.projectPosition([t,i,0]);this.center=new gi(u).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:t=JI,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:a,fovy:l=75,near:u=.1,far:h=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new mi().multiplyRight(t).translate(new gi(this.center).negate()),this.projectionMatrix=i||t4({width:this.width,height:this.height,orthographic:s,fovyRadians:a||l*GI,focalDistance:p,padding:d,near:u,far:h});const _=ko();sr(_,_,this.projectionMatrix),sr(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=fp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=qI(this.viewMatrixInverse);const y=ko(),v=ko();dg(y,y,[this.width/2,-this.height/2,1]),xu(y,y,[1,-1,0]),sr(v,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=fp(ko(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||We.warn("Pixel project matrix not invertible")()}}ul.displayName="Viewport";class xa extends ul{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:a=0,bearing:l=0,nearZMultiplier:u=.1,farZMultiplier:h=1.01,nearZ:d,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:v=!1,worldOffset:T=0,position:E,padding:R,legacyMeterSizes:P=!1}=e;let{width:D,height:M,altitude:L=1.5}=e;const H=Math.pow(2,s);D=D||1,M=M||1;let J,fe=null;if(y)L=y[5]/2,J=Au(L);else{e.fovy?(J=e.fovy,L=oT(J)):J=Au(L);let le;if(R){const{top:_e=0,bottom:Se=0}=R;le=[0,Cs((_e+M-Se)/2,0,M)-M/2]}fe=dI({width:D,height:M,scale:H,center:E&&[0,0,E[2]*Id(t)],offset:le,pitch:a,fovy:J,nearZMultiplier:u,farZMultiplier:h}),Number.isFinite(d)&&(fe.near=d),Number.isFinite(p)&&(fe.far=p)}let de=hI({height:M,pitch:a,bearing:l,scale:H,altitude:L});T&&(de=new mi().translate([512*T,0,0]).multiplyLeft(de)),super({...e,width:D,height:M,viewMatrix:de,longitude:i,latitude:t,zoom:s,...fe,fovy:J,focalDistance:L}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=a,this.bearing=l,this.altitude=L,this.fovy=J,this.orthographic=_,this._subViewports=v?[]:null,this._pseudoMeters=P,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const a=s?new xa({...this,worldOffset:s}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*Id(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/Id(i);return[t,i,s]}addMetersToLngLat(e,t){return aT(e,t)}panByPosition(e,t){const i=mg(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),a=Tb([],s,VM([],i)),l=Tb([],this.center,a),[u,h]=this.unprojectFlat(l);return{longitude:u,latitude:h}}getBounds(e={}){const t=mI(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:a,latitude:l,zoom:u}=pI({width:i,height:s,bounds:e,...t});return new xa({width:i,height:s,longitude:a,latitude:l,zoom:u})}}xa.displayName="WebMercatorViewport";const Jb=[0,0,0];function kd(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof xa){const[s,a,l=0]=n,u=e.getDistanceScales([s,a]);i[2]=l*u.unitsPerMeter[2]}return i}function n4(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:a,fromCoordinateOrigin:l}=n;return s===Ke.DEFAULT&&(s=e.isGeospatial?Ke.LNGLAT:Ke.CARTESIAN),a===void 0&&(a=s),l===void 0&&(l=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:a,fromCoordinateOrigin:l}}function hT(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}){let[l,u,h=0]=n;switch(t&&([l,u,h]=al([],[l,u,h,1],t)),i){case Ke.LNGLAT:return kd([l,u,h],e,a);case Ke.LNGLAT_OFFSETS:return kd([l+s[0],u+s[1],h+(s[2]||0)],e,a);case Ke.METER_OFFSETS:return kd(aT(s,[l,u,h]),e,a);case Ke.CARTESIAN:default:return e.isGeospatial?[l+s[0],u+s[1],h+s[2]]:e.projectPosition([l,u,h])}}function i4(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:a,fromCoordinateSystem:l,fromCoordinateOrigin:u}=n4(e),{autoOffset:h=!0}=e,{geospatialOrigin:d=Jb,shaderCoordinateOrigin:p=Jb,offsetMode:_=!1}=h?sT(t,i,s):{},y=hT(n,{viewport:t,modelMatrix:a,coordinateSystem:l,coordinateOrigin:u,offsetMode:_});if(_){const v=t.projectPosition(d||p);nP(y,y,v)}return y}let s4=1,r4=1;class dT{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:a=1}=e,l=s4++,u={time:0,delay:t,duration:i,rate:s,repeat:a};return this._setChannelTime(u,this.time),this.channels.set(l,u),l}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:a,channel:l}=s;a.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=r4++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function a4(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function o4(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let l4=0;const c4={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:op.stats.get(`animation-loop-${l4++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class u4{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...c4,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new ku({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=a4(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(o4(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const s=this.device?.canvasContext?.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Dd={};function Vu(n="id"){Dd[n]=Dd[n]||1;const e=Dd[n]++;return`${n}-${e}`}class ev{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Vu("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ht.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function f4(n,e){if(e instanceof ev)return e;const t=h4(n,e),{attributes:i,bufferLayout:s}=d4(n,e);return new ev({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function h4(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:ht.INDEX,data:t})}function d4(n,e){const t=[],i={};for(const[a,l]of Object.entries(e.attributes)){let u=a;switch(a){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(l){i[u]=n.createBuffer({data:l.value,id:`${a}-buffer`});const{value:h,size:d,normalized:p}=l;t.push({name:u,format:eM(h,d,p)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}class yg{static defaultProps={...pa.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new yg(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...pa.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const t={...du.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const t=e.hash,i=e instanceof du?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",a=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${s}BL${a}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${s}T${e.topology}P${l}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class bg{static defaultProps={...Lu.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new bg(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let i=this._cache[t];if(!i){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(e){const t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function p4(n,e){const t={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of n.attributes)if(s){const a=`${s.location} ${s.name}: ${s.type}`;t[`in ${a}`]={[i]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const a=`${s.location} ${s.name}`;t[`out ${a}`]={[i]:JSON.stringify(s)}}return t}let Vt=null,Bd=null;function g4(n,{id:e,minimap:t,opaque:i,top:s="0",left:a="0",rgbaScale:l=1}){Vt||(Vt=document.createElement("canvas"),Vt.id=e,Vt.title=e,Vt.style.zIndex="100",Vt.style.position="absolute",Vt.style.top=s,Vt.style.left=a,Vt.style.border="blue 5px solid",Vt.style.transform="scaleY(-1)",document.body.appendChild(Vt),Bd=Vt.getContext("2d")),(Vt.width!==n.width||Vt.height!==n.height)&&(Vt.width=n.width/2,Vt.height=n.height/2,Vt.style.width="400px",Vt.style.height="400px");const u=n.device.readPixelsToArrayWebGL(n),h=Bd?.createImageData(n.width,n.height);if(h){for(let p=0;p<u.length;p+=4)h.data[0+p+0]=u[p+0]*l,h.data[0+p+1]=u[p+1]*l,h.data[0+p+2]=u[p+2]*l,h.data[0+p+3]=i?255:u[p+3]*l;Bd?.putImageData(h,0,0)}}function xp(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!xp(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!xp(n[a],e[a],t-1))return!1;return!0}return!1}function m4(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function _4(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function pT(n){return m4(n)||_4(n)}function y4(n){return pT(n)||typeof n=="number"||typeof n=="boolean"}function gT(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];y4(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class b4{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=Zp(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;oe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,a]of Object.entries(e))this._addModule(a),a.name&&s!==a.name&&!this.options.disableWarnings&&oe.warn(`Module name: ${s} vs ${a.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,s=e[i]||{},a=this.modules[i];if(!a){this.options.disableWarnings||oe.warn(`Module ${t} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],h=a.getUniforms?.(s,l)||s,{uniforms:d,bindings:p}=gT(h);this.moduleUniforms[i]={...l,...d},this.moduleBindings[i]={...u,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[s,a]of Object.entries(i))e[`${t}.${s}`]={type:this.modules[t].uniformTypes?.[s],value:String(a)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let v4="";async function x4(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:v4+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Ud{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||Vu("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:x4(t.data)}),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(t)}async initAsync(e){const t=e.data;let i;try{i=await mT(t)}catch(a){this.rejectReady(a)}if(this.destroyed)return;const s={...e,data:i};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function mT(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(mT));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let a=0;a<i.length;a++)s[i[a]]=t[a];return s}return n}const Gs=2,T4=1e4;class ti{static defaultProps={...pa.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:tr.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...ti.defaultProps,...t},t=this.props,this.id=t.id||Vu("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]),s=t.shaderInputs||new b4(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const a=w4(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:h,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:a,...this.props,modules:l});this.source=h,this._getModuleUniforms=d,this.props.shaderLayout||=OM(this.source)}else{const{vs:h,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:a,...this.props,modules:l});this.vs=h,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||yg.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||bg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return oe.info(Gs,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),Tp(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:a}=this.vertexArray,l=a?a.byteLength/(a.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&f4(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new Td(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Td(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){xp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new JC(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(S4(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&oe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=tM(this.pipeline.shaderLayout,this.bufferLayout);const s=new Td(this.bufferLayout);for(const[a,l]of Object.entries(e)){const u=s.getBufferLayout(a);if(!u){i||oe.warn(`Model(${this.id}): Missing layout for buffer "${a}".`)();continue}const h=s.getAttributeNamesForBuffer(u);let d=!1;for(const p of h){const _=this._attributeInfos[p];if(_){const y=this.device.type==="webgpu"?s.getBufferIndex(_.bufferName):_.location;this.vertexArray.setBuffer(y,l),d=!0}}!d&&!i&&oe.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${a}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const a=this._attributeInfos[i];a?this.vertexArray.setConstantWebGL(a.location,s):(t?.disableWarnings??this.props.disableWarnings)||oe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Tp(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:i}=gT(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Ud&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Ud?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Uu?e=Math.max(e,t.texture.updateTimestamp):t instanceof ht||t instanceof ct?e=Math.max(e,t.updateTimestamp):t instanceof Ud?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof qo||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(oe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=p3(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=oe.level>3?0:T4;oe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,oe.group(Gs,`>>> DRAWING MODEL ${this.id}`,{collapsed:oe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=p4(this.pipeline.shaderLayout,this.id);oe.table(Gs,e)();const t=this.shaderInputs.getDebugTable();for(const[s,a]of Object.entries(this.uniforms))t[s]={value:a};oe.table(Gs,t)();const i=this._getAttributeDebugTable();oe.table(Gs,this._attributeInfos)(),oe.table(Gs,i)(),oe.groupEnd(Gs)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&g4(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=_3(t);return(e instanceof ht?new i(e.debugData):e).toString()}}function S4(n){return!!(n.uniformTypes&&!Tp(n.uniformTypes))}function w4(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Tp(n){for(const e in n)return!1;return!0}class Ta{device;model;transformFeedback;static defaultProps={...ti.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Ta.defaultProps){if(!Ta.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new ti(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||nC(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof ht)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:a=i.byteLength}=t;return i.readAsync(s,a)}}class Sa{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||Vu("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[a,l]of Object.entries(t)){const u=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(a)}: must be typed array or object with value as typed array`);if((a==="POSITION"||a==="positions")&&!u.size&&(u.size=3),a==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[a]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:a,size:l,constant:u}=s;!u&&a&&l!==void 0&&l>=1&&(i=Math.min(i,a.length/l))}return i}}const A4={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class _T extends _g{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,pickingFBO:l,deviceRect:{x:u,y:h,width:d,height:p},cullRect:_,effects:y,pass:v="picking",pickZ:T,shaderModuleProps:E}){this.pickZ=T;const R=this._resetColorEncoder(T),P=[u,h,d,p],D=super.render({target:l,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,cullRect:_,effects:y?.filter(L=>L.useInPicking),pass:v,isPicking:!0,shaderModuleProps:E,clearColor:[0,0,0,0],colorMask:15,scissorRect:P});return this._colorEncoderState=null,{decodePickingColor:R&&R4.bind(null,R),stats:D}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:a,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?s.blend=!1:a&&l.includes("draw")&&(Object.assign(s,A4),s.blend=!0,s.blendColor=E4(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function E4(n,e,t){const{byLayer:i,byAlpha:s}=n;let a,l=i.get(e);return l?(l.viewports.push(t),a=l.a):(a=i.size+1,a<=255?(l={a,layer:e,viewports:[t]},i.set(e,l),s[a]=l):(We.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function R4(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const ia={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Eu=Symbol.for("component"),Ns=Symbol.for("propTypes"),Ld=Symbol.for("deprecatedProps"),ha=Symbol.for("asyncPropDefaults"),cr=Symbol.for("asyncPropOriginal"),Ms=Symbol.for("asyncPropResolved");function vg(n,e=()=>!0){return Array.isArray(n)?yT(n,e,[]):e(n)?[n]:[]}function yT(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?yT(s,e,t):e(s)&&t.push(s)}return t}function C4({target:n,source:e,start:t=0,count:i=1}){const s=e.length,a=i*s;let l=0;for(let u=t;l<s;l++)n[u++]=e[l];for(;l<a;)l<a-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+a-l),l=a);return n}class M4{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=uu(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class P4{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let a=this._resources[e];a?a.setData(t,i):(a=new M4(e,t,this._context),this._resources[e]=a),a.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:a,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=a[e];if(this._track(i,s,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const a=this._consumers,l=a[e]=a[e]||{};let u=l[t];const h=u&&u.resourceId&&this._resources[u.resourceId];h&&(h.unsubscribe(u),this.prune()),i&&(u?(u.onChange=s,u.resourceId=i.id):u={onChange:s,resourceId:i.id},l[t]=u,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const O4="layerManager.setLayers",I4="layerManager.activateViewport";class N4{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{nn(I4,this,u),u&&(this.context.viewport=u)};const{deck:i,stats:s,viewport:a,timeline:l}=t||{};this.layers=[],this.resourceManager=new P4({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:NI(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[jP],renderPass:void 0,stats:s||new ku({id:"deck.gl"}),viewport:a||new ul({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new dT,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){nn(O4,this,t,e),this._lastRenderedLayers=e;const i=vg(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const l of e)i[l.id]?We.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let a=!1;for(const l of s)if(l.hasUniformTransition()){a=`Uniform transition in ${l}`;break}this._needsUpdate=a,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const a=t[s.id];a===null&&We.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let l=null;try{this._debug&&a!==s&&s.validateProps(),a?(this._transferLayerState(a,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(u){this._handleError("matching",u,s)}l&&this._updateSublayersRecursively(l,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ia.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ia.MATCHED,t!==e&&(e.lifecycle=ia.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ia.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ia.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Jn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Jn(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!Jn(n[a],e[a],t-1))return!1;return!0}return!1}class k4{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.containsPixel(s)){const u=e.slice();return u[0]-=l.x,u[1]-=l.y,l.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=vg(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Jn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):We.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>this.getView(e.id)?.makeViewport({viewState:a,width:this.width,height:this.height})})}_updateController(e,t,i,s){const a=e.controller;if(a&&i){const l={...t,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==a.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const a=e[s],l=this.getViewState(a),u=a.makeViewport({viewState:l,width:this.width,height:this.height});let h=t[a.id];const d=!!a.controller;d&&!h&&(i=!0),(i||!d)&&h&&(h.finalize(),h=null),this.controllers[a.id]=this._updateController(a,l,u,h),u&&this._viewports.unshift(u)}for(const s in t){const a=t[s];a&&!this.controllers[s]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const D4=/([0-9]+\.?[0-9]*)(%|px)/;function xs(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=D4.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Ts(n,e){return n.relative?Math.round(n.position*e):n.position}class wa{constructor(e){const{id:t,x:i=0,y:s=0,width:a="100%",height:l="100%",padding:u=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xs(i),this._y=xs(s),this._width=xs(a),this._height=xs(l),this._padding=u&&{left:xs(u.left||0),right:xs(u.right||0),top:xs(u.top||0),bottom:xs(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Jn(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Ts(this._x,e),y:Ts(this._y,t),width:Ts(this._width,e),height:Ts(this._height,t)};return this._padding&&(i.padding={left:Ts(this._padding.left,e),top:Ts(this._padding.top,t),right:Ts(this._padding.right,e),bottom:Ts(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Hu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const tv=()=>{},Sp={BREAK:1,SNAP_TO_END:2,IGNORE:3},B4=n=>n,U4=Sp.BREAK;class L4{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:a,endProps:l,duration:u,easing:h}}=t,d=h(i/u),p=s.interpolateProps(a,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Hu(e.timeline),this.onViewStateChange=e.onViewStateChange||tv,this.onStateChange=e.onStateChange||tv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:a,endProps:l}=this.transition.settings;s={...i,...a===Sp.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Sp.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),a=t.transitionInterpolator,l=a.getDuration?a.getDuration(e,t):t.transitionDuration;if(l===0)return;const u=a.initializeProps(e,s);this.propsInTransition={};const h={duration:l,easing:t.transitionEasing||B4,interpolator:a,interruption:t.transitionInterruption||U4,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Yt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class F4{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!Zo(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const a of this._propsToExtract)(a in e||a in t)&&(i[a]=e[a],s[a]=t[a]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];Yt(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const z4=["longitude","latitude","zoom","bearing","pitch"],V4=["longitude","latitude","zoom"];class bT extends F4{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:z4,required:V4},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:a}=this.opts;if(s&&a){const l=s(e),u=s(t),h=l.unproject(a);i.start.around=a,Object.assign(i.end,{around:u.project(h),aroundPosition:h,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const a of this._propsToExtract)s[a]=vu(e[a]||0,t[a]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...t,...s});Object.assign(s,a.panByPosition(t.aroundPosition,vu(e.around,t.around,i)))}return s}}const Ss={transitionDuration:0},H4=300,Uc=n=>1-(1-n)*(1-n),na={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Js={};class j4{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new L4({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return a&&t&&t.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?H4:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:a=!0,doubleClickZoom:l=!0,touchZoom:u=!0,touchRotate:h=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(na.WHEEL,p&&i),this.toggleEvents(na.PAN,p),this.toggleEvents(na.PINCH,p&&(u||h)),this.toggleEvents(na.MULTI_PAN,p&&h),this.toggleEvents(na.DOUBLE_CLICK,p&&l),this.toggleEvents(na.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=a,this.doubleClickZoom=l,this.touchZoom=u,this.touchRotate=h,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,Ss,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Ss,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Uc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Ss,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Uc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let l=2/(1+Math.exp(-Math.abs(a*i)));a<0&&l!==0&&(l=1/l);const u=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(u,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Ss,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Ss,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],a=this.controllerState.rotate({pos:s});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Uc},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Js._startPinchRotation=e.rotation,Js._lastPinchEvent=e,this.updateViewport(i,Ss,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Js._startPinchRotation-i})}return this.updateViewport(t,Ss,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Js._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Js;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let a=this.controllerState.rotateEnd();const l=Math.log2(e.scale),u=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),h=Math.pow(2,l+u*t/2);a=a.zoom({pos:s,scale:h}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:Uc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Js._startPinchRotation=null,Js._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:a,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let h;const d={};switch(e.srcEvent.code){case"Minus":h=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),d.isZooming=!0;break;case"Equal":h=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(h=u.rotateLeft(a),d.isRotating=!0):(h=u.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(h=u.rotateRight(a),d.isRotating=!0):(h=u.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(h=u.rotateUp(l),d.isRotating=!0):(h=u.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(h=u.rotateDown(l),d.isRotating=!0):(h=u.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Ss:e?{...t,transitionInterpolator:new bT({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class $4{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const nv=5,W4=1.2;class X4 extends $4{constructor(e){const{width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:u=0,pitch:h=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:v=60,minPitch:T=0,startPanLngLat:E,startZoomLngLat:R,startRotatePos:P,startBearing:D,startPitch:M,startZoom:L,normalize:H=!0}=e;Yt(Number.isFinite(a)),Yt(Number.isFinite(s)),Yt(Number.isFinite(l)),super({width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:u,pitch:h,altitude:d,maxZoom:_,minZoom:y,maxPitch:v,minPitch:T,normalize:H,position:p},{startPanLngLat:E,startZoomLngLat:R,startRotatePos:P,startBearing:D,startPitch:M,startZoom:L}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:a,startPitch:l}=this.getState();if(!s||a===void 0||l===void 0)return this;let u;return e?u=this._getNewRotation(e,s,l,a):u={bearing:a+t,pitch:l+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(t)||this._unproject(e)),!a)return this;const{maxZoom:l,minZoom:u}=this.getViewportProps();let h=s+Math.log2(i);h=Cs(h,u,l);const d=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...d.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:a}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(a-t.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=Cs(s,i,t);const{maxPitch:a,minPitch:l,pitch:u}=e;e.pitch=Cs(u,l,a);const{normalize:h=!0}=e;return h&&Object.assign(e,_I(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const a=e[0]-t[0],l=e[1]-t[1],u=e[1],h=t[1],{width:d,height:p}=this.getViewportProps(),_=a/d;let y=0;l>0?Math.abs(p-h)>nv&&(y=l/(h-p)*W4):l<0&&h>nv&&(y=1-u/h),y=Cs(y,-1,1);const{minPitch:v,maxPitch:T}=this.getViewportProps(),E=s+180*_;let R=i;return y>0?R=i+y*(T-i):y<0&&(R=i-y*(v-i)),{pitch:R,bearing:E}}}class Y4 extends j4{constructor(){super(...arguments),this.ControllerState=X4,this.transition={transitionDuration:300,transitionInterpolator:new bT({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class vT extends wa{constructor(e={}){super(e)}getViewportType(){return xa}get ControllerType(){return Y4}}vT.displayName="MapView";const q4=new fT;function K4(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class Z4{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>K4(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Jn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const a=t[s.id];let l=s;a&&a!==s?a.setProps?(a.setProps(s.props),l=a):a.cleanup(this._context):a||s.setup(this._context),i.push(l),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof fT)||this._resolvedEffects.push(q4),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Q4 extends _g{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const G4="deckRenderer.renderLayers";class J4{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Q4(e),this.pickLayersPass=new _T(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const a=t.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,nn(G4,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const a of e)if(a.postRender){s.target=a.id===this.lastPostProcessEffect?t.target:void 0;const l=a.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const eN={pickedColor:null,pickedObjectIndex:-1};function tN({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:a}){const{x:l,y:u,width:h,height:d}=a;let p=s*s,_=-1,y=0;for(let v=0;v<d;v++){const T=v+u-i,E=T*T;if(E>p)y+=4*h;else for(let R=0;R<h;R++){if(n[y+3]-1>=0){const D=R+l-t,M=D*D+E;M<=p&&(p=M,_=y)}y+=4}}if(_>=0){const v=n.slice(_,_+4),T=e(v);if(T){const E=Math.floor(_/4/h),R=_/4-E*h;return{...T,pickedColor:v,pickedX:l+R,pickedY:u+E}}We.error("Picked non-existent layer. Is picking buffer corrupt?")()}return eN}function nN({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const a=n.slice(i,i+4),l=a.join(",");if(!t.has(l)){const u=e(a);u?t.set(l,{...u,color:a}):We.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function xT({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:a}){let l=e[0];e.length>1&&(l=sN(n?.pickedViewports||e,{x:i,y:s}));let u;if(l){const h=[i-l.x,s-l.y];a!==void 0&&(h[2]=a),u=l.unproject(h)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function iN(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:a,pickedLayer:l,pickedObjectIndex:u}=e,h=l?[l]:[];if(i==="hover"){const _=t.index,y=t.layerId,v=l?l.props.id:null;if(v!==y||u!==_){if(v!==y){const T=s.find(E=>E.props.id===y);T&&h.unshift(T)}t.layerId=v,t.index=u,t.info=null}}const d=xT(n),p=new Map;return p.set(null,d),h.forEach(_=>{let y={...d};_===l&&(y.color=a,y.index=u,y.picked=!0),y=TT({layer:_,info:y,mode:i});const v=y.layer;_===l&&i==="hover"&&(t.info=y),p.set(v.id,y),i==="hover"&&v.updateAutoHighlight(y)}),p}function TT({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function sN(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class rN{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new _T(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},a=this.lastPickedInfo.info){const l=a&&a.layer&&a.layer.id,u=a&&a.viewport&&a.viewport.id,h=l?i.find(y=>y.id===l):null,d=u&&s.find(y=>y.id===u)||s[0],p=d&&d.unproject([e-d.x,t-d.y]);return{...a,...{x:e,y:t,viewport:d,coordinate:p,layer:h}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:a,radius:l=0,depth:u=1,mode:h="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:xT({viewports:i,x:s,y:a,pixelRatio:y})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([s,a],!0),E=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],R=Math.round(l*y),{width:P,height:D}=this.pickingFBO,M=this._getPickingRect({deviceX:E[0],deviceY:E[1],deviceRadius:R,deviceWidth:P,deviceHeight:D}),L={x:s-l,y:a-l,width:l*2+1,height:l*2+1};let H;const J=[],fe=new Set;for(let de=0;de<u;de++){let le;if(M){const Se=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:p,deviceRect:M,cullRect:L,effects:_,pass:`picking:${h}`});le=tN({...Se,deviceX:E[0],deviceY:E[1],deviceRadius:R,deviceRect:M})}else le={pickedColor:null,pickedObjectIndex:-1};let _e;if(le.pickedLayer&&d&&this.depthFBO){const{pickedColors:Se}=this._drawAndSample({layers:[le.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:le.pickedX,y:le.pickedY,width:1,height:1},cullRect:L,effects:_,pass:`picking:${h}:z`},!0);Se[3]&&(_e=Se[0])}le.pickedLayer&&de+1<u&&(fe.add(le.pickedLayer),le.pickedLayer.disablePickingIndex(le.pickedObjectIndex)),H=iN({pickInfo:le,lastPickedInfo:this.lastPickedInfo,mode:h,layers:v,viewports:i,x:s,y:a,z:_e,pixelRatio:y});for(const Se of H.values())Se.layer&&J.push(Se);if(!le.pickedColor)break}for(const de of fe)de.restorePickingColors();return{result:J,emptyInfo:H.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:a,width:l=1,height:u=1,mode:h="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([s,a],!0),E=T.x,R=T.y+T.height,P=this.device.canvasContext.cssToDevicePixels([s+l,a+u],!0),D=P.x+P.width,M=P.y,L={x:E,y:M,width:D-E,height:R-M},H=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:L,cullRect:{x:s,y:a,width:l,height:u},effects:_,pass:`picking:${h}`}),J=nN(H),fe=new Map,de=[],le=Number.isFinite(d);for(let _e=0;_e<J.length&&!(le&&de.length>=d);_e++){const Se=J[_e];let De={color:Se.pickedColor,layer:null,index:Se.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:v};De=TT({layer:Se.pickedLayer,info:De,mode:h});const Ee=De.layer.id;fe.has(Ee)||fe.set(Ee,new Set);const xe=fe.get(Ee),Fe=De.object??De.index;xe.has(Fe)||(xe.add(Fe),de.push(De))}return de}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:a,cullRect:l,effects:u,pass:h},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:a,cullRect:l,effects:u,pass:h,pickZ:d,preRenderStats:{},isPicking:!0};for(const D of u)D.useInPicking&&(_.preRenderStats[D.id]=D.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:v,y:T,width:E,height:R}=a,P=new(d?Float32Array:Uint8Array)(E*R*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:T,sourceWidth:E,sourceHeight:R,target:P}),{pickedColors:P,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:a}){const l=Math.max(0,e-i),u=Math.max(0,t-i),h=Math.min(s,e+i+1)-l,d=Math.min(a,t+i+1)-u;return h<=0||d<=0?null:{x:l,y:u,width:h,height:d}}}const aN={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},oN="top-left",iv="__root";class lN{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Jn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=oN}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,i).append(s),e._element=s}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const i=e||iv;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let a=s.querySelector(`.${t}`);return a||(a=document.createElement("div"),a.className=t,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,aN[t]),s.append(a)),a}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,a=i===iv||s,l=this.containers[i];a?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:t}px`):l.style.display="none"}}onRedraw({viewports:e,layers:t}){const i=e.reduce((s,a)=>(s[a.id]=a,s),{});for(const s of this.getWidgets()){const{viewId:a}=s;if(a){const l=i[a];l&&(s.onViewportChange&&s.onViewportChange(l),s.onRedraw?.({viewports:[l],layers:t}))}else{if(s.onViewportChange)for(const l of e)s.onViewportChange(l);s.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=_p[t.type];if(i)for(const s of this.getWidgets()){const{viewId:a}=s;(!a||a===e.viewport?.id)&&s[i]?.(e,t)}}}const cN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class uN{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,cN),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var aa;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(aa||(aa={}));const xg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Pt=(n,e,t)=>e?n.enable(t):n.disable(t),sv=(n,e,t)=>n.hint(t,e),wn=(n,e,t)=>n.pixelStorei(t,e),rv=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},Co=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function Fd(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const fN={3042:Pt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:Pt,2885:(n,e)=>n.cullFace(e),2929:Pt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:Pt,35723:sv,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:rv,36010:rv,34964:Co,36662:Co,36663:Co,35053:Co,35055:Co,2886:(n,e)=>n.frontFace(e),33170:sv,2849:(n,e)=>n.lineWidth(e),32823:Pt,32824:"polygonOffset",10752:"polygonOffset",35977:Pt,32926:Pt,32928:Pt,32938:"sampleCoverage",32939:"sampleCoverage",3089:Pt,3088:(n,e)=>n.scissor(...e),2960:Pt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:Pt,10754:Pt,12288:Pt,12289:Pt,12290:Pt,12291:Pt,12292:Pt,12293:Pt,12294:Pt,12295:Pt,3333:wn,3317:wn,37440:wn,37441:wn,37443:wn,3330:wn,3332:wn,3331:wn,3314:wn,32878:wn,3316:wn,3315:wn,32877:wn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Fd(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Fd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,u]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,a,l,u)},stencilOp:(n,e)=>{e=Fd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,u]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,a,l,u)},viewport:(n,e)=>n.viewport(...e)};function vt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const hN={blendEquation:(n,e,t)=>n.blendEquationSeparate(vt(32777,e,t),vt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(vt(32969,e,t),vt(32968,e,t),vt(32971,e,t),vt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(vt(32824,e,t),vt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(vt(32938,e,t),vt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,vt(2962,e,t),vt(2967,e,t),vt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,vt(34816,e,t),vt(36003,e,t),vt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,vt(2964,e,t),vt(2965,e,t),vt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,vt(34817,e,t),vt(34818,e,t),vt(34819,e,t))},av={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},ui=(n,e)=>n.isEnabled(e),ov={3042:ui,2884:ui,2929:ui,3024:ui,32823:ui,32926:ui,32928:ui,3089:ui,2960:ui,35977:ui},dN=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ca(n,e){if(gN(e))return;const t={};for(const s in e){const a=Number(s),l=fN[s];l&&(typeof l=="string"?t[l]=!0:l(n,e[s],a))}const i=n.state&&n.state.cache;if(i)for(const s in t){const a=hN[s];a(n,e,i)}}function ST(n,e=xg){if(typeof e=="number"){const s=e,a=ov[s];return a?a(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const a=ov[s];i[s]=a?a(n,Number(s)):n.getParameter(Number(s))}return i}function pN(n){Ca(n,xg)}function gN(n){for(const e in n)return!1;return!0}function mN(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class rr{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Ca(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?ST(e):Object.assign({},xg),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,yN(e);for(const i in av){const s=av[i];_N(e,i,s)}lv(e,"getParameter"),lv(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const l=e[a],u=this.cache[a];mN(l,u)||(t=!0,i=u,s&&!(a in s)&&(s[a]=u),this.cache[a]=l)}return{valueChanged:t,oldValue:i}}}function lv(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||dN.has(s))return t(s);const a=rr.get(n);return s in a.cache||(a.cache[s]=t(s)),a.enable?a.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function _N(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...a){const l=rr.get(n),{valueChanged:u,oldValue:h}=t(l._updateCache,...a);return u&&i(...a),h},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function yN(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=rr.get(n);s.program!==i&&(e(i),s.program=i)}}function bN(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let a=null;if(a||=n.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!a&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,a=n.getContext("webgl2",s),a.luma||={},a.luma.softwareRenderer=!0),a||(a=n.getContext("webgl",{}),a&&(a=null,i||="Your browser only supports WebGL1")),!a)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:u}=e;return n.addEventListener("webglcontextlost",h=>l(h),!1),n.addEventListener("webglcontextrestored",h=>u(h),!1),a.luma||={},a}function Aa(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function vN(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);Aa(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,a=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),u=a||t,h=l||i,d=n.getParameter(7938),p=wT(u,h),_=xN(u,h),y=TN(u,h);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:u,renderer:h,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function wT(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function xN(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function TN(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(wT(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function AT(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Do="WEBGL_compressed_texture_s3tc",Bo="WEBGL_compressed_texture_s3tc_srgb",oa="EXT_texture_compression_rgtc",la="EXT_texture_compression_bptc",SN="WEBGL_compressed_texture_etc",wN="WEBGL_compressed_texture_astc",AN="WEBGL_compressed_texture_etc1",EN="WEBGL_compressed_texture_pvrtc",RN="WEBGL_compressed_texture_atc",cv="EXT_texture_norm16",uv="EXT_render_snorm",CN="EXT_color_buffer_float",Tg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[uv],"norm16-renderable-webgl":[cv],"snorm16-renderable-webgl":[cv,uv],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Do,Bo,oa,la],"texture-compression-bc5-webgl":[oa],"texture-compression-bc7-webgl":[la],"texture-compression-etc2":[SN],"texture-compression-astc":[wN],"texture-compression-etc1-webgl":[AN],"texture-compression-pvrtc-webgl":[EN],"texture-compression-atc-webgl":[RN]};function MN(n){return n in Tg}function PN(n,e,t){return(Tg[e]||[]).every(s=>Aa(n,s,t))}const Sg={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:CN,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Do},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Bo},"bc1-rgba-unorm":{gl:33777,x:Do},"bc1-rgba-unorm-srgb":{gl:35916,x:Bo},"bc2-rgba-unorm":{gl:33778,x:Do},"bc2-rgba-unorm-srgb":{gl:35918,x:Bo},"bc3-rgba-unorm":{gl:33779,x:Do},"bc3-rgba-unorm-srgb":{gl:35919,x:Bo},"bc4-r-unorm":{gl:36283,x:oa},"bc4-r-snorm":{gl:36284,x:oa},"bc5-rg-unorm":{gl:36285,x:oa},"bc5-rg-snorm":{gl:36286,x:oa},"bc6h-rgb-ufloat":{gl:36495,x:la},"bc6h-rgb-float":{gl:36494,x:la},"bc7-rgba-unorm":{gl:36492,x:la},"bc7-rgba-unorm-srgb":{gl:36493,x:la},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function ON(n,e,t){let i=e.create;const s=Sg[e.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!Aa(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function ET(n){const e=Sg[n],t=kN(n),i=Qp(n);return{internalFormat:t,format:e?.dataFormat||NN(i.channels,i.integer,i.normalized,t),type:i.dataType?AT(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function IN(n){switch(Qp(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function NN(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function kN(n){const t=Sg[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const fv={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class DN extends yC{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,Aa(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),MN(e)&&PN(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(fv),...Object.keys(Tg)]}getWebGLFeature(e){const t=fv[e];return typeof t=="string"?!!Aa(this.gl,t,this.extensions):!!t}}class BN extends _C{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Ho extends Fu{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const s=36064+t;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const t=IN(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${LN(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:s}=t,a=t.props.baseMipLevel,l=t.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,s.handle,a,l);break;case 34067:const u=UN(l);i.framebufferTexture2D(36160,e,u,s.handle,a);break;case 3553:i.framebufferTexture2D(36160,e,3553,s.handle,a);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function UN(n){return n<34069?n+34069:n}function LN(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class FN extends Gp{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Ho(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}async function RT(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,a)=>{i.onload=s,i.onerror=l=>a(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(i)})}const zN=1;let An=null,hv=!1;const wg={debugSpectorJS:oe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function VN(n){if(!globalThis.SPECTOR)try{await RT(n.debugSpectorJSUrl||wg.debugSpectorJSUrl)}catch(e){oe.warn(String(e))}}function HN(n){if(n={...wg,...n},!n.debugSpectorJS)return null;if(!An&&globalThis.SPECTOR&&!globalThis.luma?.spector){oe.probe(zN,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;An=new e,globalThis.luma&&(globalThis.luma.spector=An)}if(!An)return null;if(hv||(hv=!0,An.spyCanvases(),An?.onCaptureStarted.add(e=>oe.info("Spector capture started:",e)()),An?.onCapture.add(e=>{oe.info("Spector capture complete:",e)(),An?.getResultUI(),An?.resultView.display(),An?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;An?.startCapture(n.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{oe.info("Spector capture stopped after 2 seconds")(),An?.stopCapture()})}return An}const jN="https://unpkg.com/webgl-debug@2.0.1/index.js";function CT(n){return n.luma=n.luma||{},n.luma}async function $N(){fr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await RT(jN))}function WN(n,e={}){return e.debugWebGL||e.traceWebGL?YN(n,e):XN(n)}function XN(n){const e=CT(n);return e.realContext?e.realContext:n}function YN(n,e){if(!globalThis.WebGLDebugUtils)return oe.warn("webgl-debug not loaded")(),n;const t=CT(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...aa,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,qN.bind(null,e),KN.bind(null,e));for(const l in aa)!(l in i)&&typeof aa[l]=="number"&&(i[l]=aa[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const a=Object.create(s);return t.realContext=n,t.debugContext=a,a.debug=!0,a}function dv(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function qN(n,e,t,i){i=Array.from(i).map(u=>u===void 0?"undefined":u);const s=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),l=`${s} in gl.${t}(${a})`;oe.error(l)();debugger}function KN(n,e,t){let i="";oe.level>=1&&(i=dv(e,t),n.traceWebGL&&oe.log(1,i)());for(const s of t)if(s===void 0){i=i||dv(e,t);debugger}}const zd={};function ZN(n="id"){zd[n]=zd[n]||1;const e=zd[n]++;return`${n}-${e}`}class jo extends ht{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=QN(this.props.usage),this.glUsage=GN(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,i=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,s,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function QN(n){return n&ht.INDEX?34963:n&ht.VERTEX?34962:n&ht.UNIFORM?35345:34962}function GN(n){return n&ht.INDEX||n&ht.VERTEX?35044:n&ht.UNIFORM?35048:35044}function JN(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,y]=s;t.push({message:y.trim(),type:pv(_),lineNum:0,linePos:0});continue}const[a,l,u,...h]=s;let d=parseInt(u,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),t.push({message:h.join(":").trim(),type:pv(a),lineNum:d,linePos:p})}return t}function pv(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class ek extends Lu{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?JN(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}oe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),oe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function tk(n,e,t,i){if(rk(e))return i(n);const s=n;s.pushState();try{return nk(n,e),Ca(s.gl,t),i(n)}finally{s.popState()}}function nk(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(ar("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const a=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=ar("provokingVertex",e.provokingVertex,{first:36429,last:36430});a?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=ar("polygonMode",e.polygonMode,{fill:6914,line:6913});a?.polygonModeWEBGL(1028,l),a?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(sk("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(wp("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&oe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,a=wp("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,a,0,s),i.stencilFuncSeparate(1029,a,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Vd("stencilPassOperation",e.stencilPassOperation),a=Vd("stencilFailOperation",e.stencilFailOperation),l=Vd("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,a,l,s),i.stencilOpSeparate(1029,a,l,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=gv("blendColorOperation",e.blendColorOperation||"add"),a=gv("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,a);const l=Lc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=Lc("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=Lc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Lc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,u,h,d)}}function wp(n,e){return ar(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Vd(n,e){return ar(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function gv(n,e){return ar(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Lc(n,e){return ar(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function ik(n,e){return`Illegal parameter ${e} for ${n}`}function ar(n,e,t){if(!(e in t))throw new Error(ik(n,e));return t[e]}function sk(n,e){return e}function rk(n){let e=!0;for(const t in n){e=!1;break}return e}function MT(n){const e={};return n.addressModeU&&(e[10242]=Hd(n.addressModeU)),n.addressModeV&&(e[10243]=Hd(n.addressModeV)),n.addressModeW&&(e[32882]=Hd(n.addressModeW)),n.magFilter&&(e[10240]=Ap(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=ak(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=wp("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Hd(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ap(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function ak(n,e="none"){if(!e)return Ap(n);switch(e){case"none":return Ap(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Ep extends qo{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=MT(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const s=Number(t);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class ca extends Uu{device;gl;handle;texture;constructor(e,t){super(e,{...ct.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const ok="Failed to deduce GL constant from typed array";function lk(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ok)}}function ck(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function PT(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function uk(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Ru(n,e,t){if(fk(e))return t(n);const{nocatch:i=!0}=e,s=rr.get(n);s.push(),Ca(n,e);let a;if(i)a=t(n),s.pop();else try{a=t(n)}finally{s.pop()}return a}function fk(n){for(const e in n)return!1;return!0}function hk(n,e,t){const{dimension:i,width:s,height:a,depth:l=0}=t,{glInternalFormat:u}=t,h=t.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(h,e,u,s,a,l);break;default:n.texStorage2D(h,e,u,s,a)}}function mv(n,e,t,i){const{width:s,height:a}=i,{dimension:l,depth:u=0,mipLevel:h=0}=i,{x:d=0,y:p=0,z:_=0}=i,{glFormat:y,glType:v}=i,T=OT(i.glTarget,l,u),E=i.flipY?{37440:!0}:{};Ru(n,E,()=>{switch(l){case"2d-array":case"3d":n.bindTexture(T,e),n.texSubImage3D(T,h,d,p,_,s,a,u,y,v,t),n.bindTexture(T,null);break;case"2d":case"cube":n.bindTexture(T,e),n.texSubImage2D(T,h,d,p,s,a,y,v,t),n.bindTexture(T,null);break;default:throw new Error(l)}})}function _v(n,e,t){const{dimension:i,width:s,height:a,depth:l=0,mipLevel:u=0,byteOffset:h=0}=t,{x:d=0,y:p=0,z:_=0}=t,{glFormat:y,glType:v,compressed:T}=t,E=OT(t.glTarget,i,l);switch(i){case"2d-array":case"3d":T?n.compressedTexSubImage3D(E,u,d,p,_,s,a,l,y,e,h):n.texSubImage3D(E,u,d,p,_,s,a,l,y,v,e,h);break;case"2d":case"cube":T?n.compressedTexSubImage2D(E,u,d,p,s,a,y,e,h):n.texSubImage2D(E,u,d,p,s,a,y,v,e,h);break;default:throw new Error(i)}}function dk(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function OT(n,e,t){return e==="cube"?34069+t:n}function pk(n,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:a=null,sourceWidth:l,sourceHeight:u,sourceDepth:h,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:y}=IT(n),{gl:v,handle:T}=_;l||=_.width,u||=_.height;const E=_.colorAttachments[s]?.texture;if(!E)throw new Error(`Invalid framebuffer attachment ${s}`);h=E?.depth||1,d||=E?.glFormat||6408,p||=E?.glType||5121,a=_k(a,p,d,l,u),p=p||lk(a);const R=v.bindFramebuffer(36160,T);return v.readBuffer(36064+s),v.readPixels(t,i,l,u,d,p,a),v.readBuffer(36064),v.bindFramebuffer(36160,R||null),y&&_.destroy(),a}function gk(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:a=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:u,sourceHeight:h,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:_}=IT(n);u=u||p.width,h=h||p.height;const y=p;d=d||5121;let v=t;if(!v){const E=PT(a),R=uk(d),P=l+u*h*E*R;v=y.device.createBuffer({byteLength:P})}const T=n.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:n,width:u,height:h,origin:[i,s],destinationBuffer:v,byteOffset:l}),T.destroy(),_&&p.destroy(),v}function IT(n){return n instanceof Fu?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:mk(n),deleteFramebuffer:!0}}function mk(n,e){const{device:t,width:i,height:s,id:a}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:i,height:s,colorAttachments:[n]})}function _k(n,e,t,i,s,a){if(n)return n;e||=5121;const l=ck(e,{clamped:!1}),u=PT(t);return new l(i*s*u)}class $o extends ct{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const i={...this.props};i.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=dk(this.props.dimension);const s=ET(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:i}=e;if(!t||!i){const s=ct.getTextureDataSize(e.data);t=s?.width||1,i=s?.height||1}if(this.width=t,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new ca(this.device,{...this.props,texture:this}),this.bind(),hk(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new ca(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof Ep?(this.sampler=e,t=e.props):(this.sampler=new Ep(this.device,e),t=e);const i=MT(t);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(oe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){oe.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=ct.getExternalImageSize(e.image),i={...ct.defaultCopyExternalImageOptions,...t,...e},{image:s,depth:a,mipLevel:l,x:u,y:h,z:d,flipY:p}=i;let{width:_,height:y}=i;const{dimension:v,glTarget:T,glFormat:E,glInternalFormat:R,glType:P}=this;if(_=Math.min(_,this.width-u),y=Math.min(y,this.height-h),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return mv(this.device.gl,this.handle,s,{dimension:v,mipLevel:l,x:u,y:h,z:d,width:_,height:y,depth:a,glFormat:E,glType:P,glTarget:T,flipY:p}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const i=ct.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&oe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const a=i[s];this._setMipLevel(t,s,a)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),_v(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of ct.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&oe.warn(`${this.id} has mipmap and multiple LODs.`)();const s=ct.CubeFaces.indexOf(t);this.setTexture2DData(e,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:i,height:s,pixels:a,data:l,format:u=6408,type:h=5121}=e,{gl:d}=this,p=a||l;this.bind(),p instanceof Promise?p.then(_=>this.setImageDataForFace(Object.assign({},e,{face:t,data:_,pixels:_}))):this.width||this.height?d.texImage2D(t,0,u,i,s,0,u,h,p):d.texImage2D(t,0,u,u,h,p)}_getImageDataMap(e){for(let t=0;t<ct.CubeFaces.length;++t){const i=ct.CubeFaces[t];e[i]&&(e[34069+t]=e[i],delete e[i])}return e}_setSamplerParameters(e){oe.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const s=Number(t),a=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,a);break;case 10241:this.gl.texParameteri(this.glTarget,s,a);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,a);break;default:this.gl.texParameteri(this.glTarget,s,a);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,i,s=this.glTarget){if(ct.isExternalImage(i)){mv(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:t,glTarget:s,flipY:this.props.flipY});return}if(ct.isTextureLevelData(i)){_v(this.device.gl,i.data,{...this,depth:e,mipLevel:t,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}const yk=[1,2,4,8];class bk extends er{device;glParameters;constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:a,height:l}=t.framebuffer;i=[0,0,a,l]}else{const[a,l]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,a,l]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((l,u)=>36064+u);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=yk.map(i=>!!(i&e.colorMask))),this.glParameters=t,Ca(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&Ru(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){Ru(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function vk(n){return xk.includes(n)}const xk=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],NT={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function kT(n){const e=NT[n];if(!e)throw new Error("uniform");const[t,i,,s]=e;return{format:s,components:i,glType:t}}function Tk(n){const e=NT[n];if(!e)throw new Error("attribute");const[,t,,i,s]=e;return{attributeType:i,vertexFormat:s,components:t}}function Sk(n,e){const t={attributes:[],bindings:[]};t.attributes=wk(n,e);const i=Rk(n,e);for(const u of i){const h=u.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:h})}const s=Ek(n,e);let a=0;for(const u of s)if(vk(u.type)){const{viewDimension:h,sampleType:d}=Mk(u.type);t.bindings.push({type:"texture",name:u.name,group:0,location:a,viewDimension:h,sampleType:d}),u.textureUnit=a,a+=1}s.length&&(t.uniforms=s);const l=Ak(n,e);return l?.length&&(t.varyings=l),t}function wk(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const a=n.getActiveAttrib(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:u}=a,h=n.getAttribLocation(e,l);if(h>=0){const{attributeType:d}=Tk(u),p=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:h,stepMode:p,type:d})}}return t.sort((s,a)=>s.location-a.location),t}function Ak(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const a=n.getTransformFeedbackVarying(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:u,size:h}=a,{glType:d,components:p}=kT(u),_={location:s,name:l,type:d,size:h*p};t.push(_)}return t.sort((s,a)=>s.location-a.location),t}function Ek(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const a=n.getActiveUniform(e,s);if(!a)throw new Error("activeInfo");const{name:l,size:u,type:h}=a,{name:d,isArray:p}=Pk(l);let _=n.getUniformLocation(e,d);const y={location:_,name:d,size:u,type:h,isArray:p};if(t.push(y),y.size>1)for(let v=0;v<y.size;v++){const T=`${d}[${v}]`;_=n.getUniformLocation(e,T);const E={...y,name:T,location:_};t.push(E)}}return t}function Rk(n,e){const t=(a,l)=>n.getActiveUniformBlockParameter(e,a,l),i=[],s=n.getProgramParameter(e,35382);for(let a=0;a<s;a++){const l={name:n.getActiveUniformBlockName(e,a)||"",location:t(a,35391),byteLength:t(a,35392),vertex:t(a,35396),fragment:t(a,35398),uniformCount:t(a,35394),uniforms:[]},u=t(a,35395)||[],h=n.getActiveUniforms(e,u,35383),d=n.getActiveUniforms(e,u,35384),p=n.getActiveUniforms(e,u,35387),_=n.getActiveUniforms(e,u,35388);for(let y=0;y<l.uniformCount;++y){const v=n.getActiveUniform(e,u[y]);if(!v)throw new Error("activeInfo");l.uniforms.push({name:v.name,format:kT(h[y]).format,type:h[y],arrayLength:d[y],byteOffset:p[y],byteStride:_[y]})}i.push(l)}return i.sort((a,l)=>a.location-l.location),i}const Ck={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Mk(n){const e=Ck[n];if(!e)throw new Error("sampler");const[t,i]=e;return{viewDimension:t,sampleType:i}}function Pk(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function Ok(n,e,t,i){const s=n;let a=i;a===!0&&(a=1),a===!1&&(a=0);const l=typeof a=="number"?[a]:a;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function Ik(n){return pT(n)!==null||typeof n=="number"||typeof n=="boolean"}function Nk(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];Ik(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function kk(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function Dk(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const yv=4;class Bk extends pa{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:s=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),oe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Sk(this.device.gl,this.handle),oe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Uk(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[i,s]of Object.entries(e)){const a=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!a){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");t?.disableWarnings||oe.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||oe.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(s instanceof jo)&&!(s.buffer instanceof jo))throw new Error("buffer value");break;case"texture":if(!(s instanceof ca||s instanceof $o||s instanceof Ho))throw new Error("texture value");break;case"sampler":oe.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(a.type)}this.bindings[i]=s}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:a,vertexCount:l,instanceCount:u,isInstanced:h=!1,firstVertex:d=0,transformFeedback:p}=e,_=kk(s),y=!!a.indexBuffer,v=a.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(t),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const T=t;return tk(this.device,i,T.glParameters,()=>{y&&h?this.device.gl.drawElementsInstanced(_,l||0,v,d,u||0):y?this.device.gl.drawElements(_,l||0,v,d):h?this.device.gl.drawArraysInstanced(_,d,l||0,u||0):this.device.gl.drawArrays(_,d,l||0),p&&p.end()}),a.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=Nk(e);Object.keys(t).forEach(i=>{oe.warn(`Unsupported value "${JSON.stringify(t[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),oe.time(yv,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),oe.timeEnd(yv,`linkProgram for ${this.id}`)(),oe.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}oe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),oe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(oe.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const s of this.shaderLayout.bindings){const a=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=e.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);e.uniformBlockBinding(this.handle,i,u),a instanceof jo?e.bindBufferBase(35345,i,a.handle):e.bindBufferRange(35345,i,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),i+=1;break;case"texture":if(!(a instanceof ca||a instanceof $o||a instanceof Ho))throw new Error("texture");let h;if(a instanceof ca)h=a.texture;else if(a instanceof $o)h=a;else if(a instanceof Ho&&a.colorAttachments[0]instanceof ca)oe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=a.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(h.glTarget,h.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:s,textureUnit:a}=e,l=this.uniforms[t]??a;l!==void 0&&Ok(this.device.gl,i,s,l)}}}function Uk(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const s=t.attributes.find(a=>a.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):oe.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class Lk extends eg{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Fk(this.device,t.options);break;case"copy-buffer-to-texture":zk(this.device,t.options);break;case"copy-texture-to-buffer":Vk(this.device,t.options);break;case"copy-texture-to-texture":Hk(this.device,t.options);break;default:throw new Error(t.name)}}}function Fk(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function zk(n,e){throw new Error("Not implemented")}function Vk(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:a=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:h=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||u!==0||_||y)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:T}=DT(t);let E;try{const R=d,P=a||v.width,D=l||v.height,M=ET(v.colorAttachments[0].texture.props.format),L=M.format,H=M.type;n.gl.bindBuffer(35051,R.handle),E=n.gl.bindFramebuffer(36160,v.handle),n.gl.readPixels(h[0],h[1],P,D,L,H,p)}finally{n.gl.bindBuffer(35051,null),E!==void 0&&n.gl.bindFramebuffer(36160,E),T&&v.destroy()}}function Hk(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:a=[0,0],destinationTexture:l}=e;let{width:u=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=DT(t),[_,y]=s,[v,T,E]=a,R=n.gl.bindFramebuffer(36160,d.handle);let P=null,D;if(l instanceof $o)P=l,u=Number.isFinite(u)?u:P.width,h=Number.isFinite(h)?h:P.height,P.bind(0),D=P.glTarget;else throw new Error("invalid destination");switch(D){case 3553:case 34067:n.gl.copyTexSubImage2D(D,i,v,T,_,y,u,h);break;case 35866:case 32879:n.gl.copyTexSubImage3D(D,i,v,T,E,_,y,u,h);break}P&&P.unbind(),n.gl.bindFramebuffer(36160,R),p&&d.destroy()}function DT(n){if(n instanceof ct){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class jk extends Jp{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Lk(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function $k(n){const{target:e,source:t,start:i=0,count:s=1}=n,a=t.length,l=s*a;let u=0;for(let h=i;u<a;u++)e[h++]=t[u];for(;u<l;)u<l-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+l-u),u=l);return n.target}class Ag extends tg{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return oA()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:a,stride:l,offset:u,normalized:h,integer:d,divisor:p}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),d?this.device.gl.vertexAttribIPointer(e,s,a,l,u):this.device.gl.vertexAttribPointer(e,s,a,h,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,p||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=AT(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const s=Ag.isConstantAttributeZeroSupported(this.device)||e!==0;(t||s)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=Wk(t),s=i.byteLength*e,a=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l=l||!Xk(i,this.bufferValue),l){const u=YC(t.constructor,a);$k({target:u,source:i,start:0,count:a}),this.buffer.write(u),this.bufferValue=t}return this.buffer}}function Wk(n){return Array.isArray(n)?new Float32Array(n):n}function Xk(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class Yk extends ng{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Dk(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:s,byteLength:a,byteOffset:l}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=s,oe.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:s,byteLength:a,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,a)}getBuffer(e){if(bv(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof jo)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:s}}_getVaryingIndex(e){if(bv(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,s){const a=t&&t.handle;!a||s===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,i,s)}}function bv(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class qk extends ig{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,s)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}class ua extends Os{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||ZN("webgl-device")});const t=Os._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new FN(this,t),this.lost=new Promise(p=>{this._resolveContextLost=p});const s={...e.webgl};t.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),e.powerPreference!==void 0&&(s.powerPreference=e.powerPreference);const l=this.props._handle||bN(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(e._reuseDevices)return oe.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=HN({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=vN(this.gl,this._extensions),this.limits=new BN(this.gl),this.features=new DN(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new rr(this.gl,{log:(...p)=>oe.log(1,...p)()}).trackState(this.gl,{copyState:!1});const h=e.debugWebGL||e.debug,d=e.debugWebGL;h&&(this.gl=WN(this.gl,{debugWebGL:h,traceWebGL:d}),oe.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(oe.level=Math.max(oe.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new jo(this,t)}createTexture(e){return new $o(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Ep(this,e)}createShader(e){return new ek(this,e)}createFramebuffer(e){return new Ho(this,e)}createVertexArray(e){return new Ag(this,e)}createTransformFeedback(e){return new Yk(this,e)}createQuerySet(e){return new qk(this,e)}createRenderPipeline(e){return new Bk(this,e)}beginRenderPass(e){return new bk(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new jk(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return pk(e,t)}readPixelsToBufferWebGL(e,t){return gk(e,t)}setParametersWebGL(e){Ca(this.gl,e)}getParametersWebGL(e){return ST(this.gl,e)}withParametersWebGL(e,t){return Ru(this.gl,e,t)}resetWebGL(){oe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),pN(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return ON(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){rr.get(this.gl).push()}popState(){rr.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const i=Number(e);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[s,a])=>(i[`${s}:${this.getGLKey(s,t)}`]=`${a}:${this.getGLKey(a,t)}`,i),{})}_constants;setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[e];switch(s&&Gk(s,t)&&oe.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Kk(this,e,t);break;case Int32Array:Zk(this,e,t);break;case Uint32Array:Qk(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Aa(this.gl,e,this._extensions),this._extensions}}function Kk(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function Zk(n,e,t){n.gl.vertexAttribI4iv(e,t)}function Qk(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function Gk(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const Jk={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},eD=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),tD=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),nD=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function iD(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&sD(s),s}return this.originalGetContext(t,i)}}function sD(n){n.getExtension("EXT_color_buffer_float");const e={...Jk,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:eD(n),OES_vertex_array_object:tD(n),ANGLE_instanced_arrays:nD(n)},t=n.getExtension;n.getExtension=function(s){const a=t.call(n,s);return a||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(e))}}const Fc=1;class rD extends SC{type="webgl";constructor(){super(),Os.defaultProps={...Os.defaultProps,...wg},ua.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){iD(e)}async attach(e){if(e instanceof ua)return e;if(e?.device instanceof Os)return e.device;if(!aD(e))throw new Error("Invalid WebGL2RenderingContext");return new ua({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){oe.groupCollapsed(Fc,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push($N()),e.debugSpectorJS&&t.push(VN(e));const i=await Promise.allSettled(t);for(const l of i)l.status==="rejected"&&oe.error(`Failed to initialize debug libraries ${l.reason}`)();const s=new ua(e),a=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return oe.probe(Fc,a)(),oe.table(Fc,s.info)(),oe.groupEnd(Fc)(),s}}function aD(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const vv=new rD;function ws(){}const oD=({isDragging:n})=>n?"grabbing":"grab",BT={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ws,onWebGLInitialized:ws,onResize:ws,onViewStateChange:ws,onInteractionStateChange:ws,onBeforeRender:ws,onAfterRender:ws,onLoad:ws,onError:n=>We.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:oD,getTooltip:null,debug:!1,drawPickingColors:!1};class Eg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ku({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;s.x=a.x,s.y=a.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=_p[i.type],a=i.offsetCenter;if(!s||!a||!this.layerManager)return;const l=this.layerManager.getLayers(),u=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:l,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:h}=u,d=h&&(h[s]||h.props[s]),p=this.props[s];let _=!1;d&&(_=d.call(h,u,i)),_||(p?.(u,i),this.widgetManager.onEvent(u,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const s=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...BT,...e},e=this.props,e.viewState&&e.initialViewState&&We.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&We.error("WebGL1 context not supported.")(),t=vv.attach(e.gl)),t||(t=op.createDevice({type:"best-available",_reuseDevices:!0,adapters:[vv],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&va.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&We.removed("onLayerHover","onHover")(),"onLayerClick"in e&&We.removed("onLayerClick","onClick")(),e.initialViewState&&!Jn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||i||s||a||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Yt(this.viewManager),this.viewManager.views}getViewports(e){return Yt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){Yt(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),a}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Yt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s,useDevicePixels:a}=t;return new u4({device:e,useDevicePixels:a,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new vT({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let s=i,a=!1;for(const l of t)s=l,a=l.layer?.onHover(l,e.event)||a;a||(this.props.onHover?.(s,e.event),this.widgetManager.onHover(s,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new dT;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new zO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Vb).map(s=>{const[a,l,u,h]=Vb[s],d=this.props.eventRecognizerOptions?.[s],p={...l,...d,event:s};return{recognizer:new a(p),recognizeWith:u,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in _p)this.eventManager.on(s,this._onEvent);this.viewManager=new k4({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new N4(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new Z4({deck:this,device:this.device}),this.deckRenderer=new J4(this.device),this.deckPicker=new rN(this.device),this.widgetManager=new lN({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new uN),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),We.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=op.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Eg.defaultProps=BT;Eg.VERSION=CR;function lD(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return _3(n)}}const cD=m3;function zc(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function nr(n){return n.stride||n.size*n.bytesPerElement}function uD(n,e){return n.type===e.type&&n.size===e.size&&nr(n)===nr(e)&&(n.offset||0)===(e.offset||0)}function Rp(n,e){e.offset&&We.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=nr(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,a=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:a,stride:t}}function fD(n,e){const t=Rp(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class hD{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,a=s==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let u;a?u="float32":!s&&t.isIndexed?u="uint32":u=s||"float32";let h=lD(s||u);this.doublePrecision=a,a&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:l,logicalType:s,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*nr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),va.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const a=Rp(this.getAccessor(),t),l=a.offset/s.BYTES_PER_ELEMENT,u=a.size||this.size;i[e]=s.subarray(l,l+u)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],a={name:this.id,byteStride:nr(i),attributes:s};if(this.doublePrecision){const l=fD(i,t||{});s.push(zc(e,{...i,...l.high},this.device.type),zc(`${e}64Low`,{...i,...l.low},this.device.type))}else if(t){const l=Rp(i,t);s.push(zc(e,{...i,...l},this.device.type))}else s.push(zc(e,i,this.device.type));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,a=i*s;if(t&&a&&t.length>=a){const l=new Array(s).fill(1/0),u=new Array(s).fill(-1/0);for(let h=0;h<a;)for(let d=0;d<s;d++){const p=t[h++];p<l[d]&&(l[d]=p),p>u[d]&&(u[d]=p)}e=[l,u]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ht?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=cD(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=nr(s)}if(t.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!t.constant||!this._areValuesEqual(a,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(i.buffer){const a=i.buffer;t.externalBuffer=a,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let a=i.value;t.externalBuffer=null,t.constant=!1,this.value=a;let{buffer:l}=this;const u=nr(s),h=(s.vertexOffset||0)*u;if(this.doublePrecision&&a instanceof Float64Array&&(a=Nd(a,s)),this.settings.isIndexed){const p=this.settings.defaultType;a.constructor!==p&&(a=new p(a))}const d=a.byteLength+h+u*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(a,h)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Nd(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,a=va.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=a;const{byteOffset:l}=this;let{buffer:u}=this;return(!u||u.byteLength<a.byteLength+l)&&(u=this._createBuffer(a.byteLength+l),t&&s&&u.write(s instanceof Float64Array?Nd(s,this):s,l)),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&We.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:a}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let l=a;for(;--l>=0;)t[i+l]=s[l];return t}switch(a){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let l=a;for(;--l>=0;)t[i+l]=Number.isFinite(e[l])?e[l]:s[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?ht.INDEX:ht.VERTEX)|ht.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const xv=[],Tv=[];function ju(n,e=0,t=1/0){let i=xv;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(Tv.length=n.length,i=Tv):i=xv,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function UT(n){return n&&n[Symbol.asyncIterator]}function LT(n,e){const{size:t,stride:i,offset:s,startIndices:a,nested:l}=e,u=n.BYTES_PER_ELEMENT,h=i?i/u:t,d=s?s/u:0,p=Math.floor((n.length-d)/h);return(_,{index:y,target:v})=>{if(!a){const P=y*h+d;for(let D=0;D<t;D++)v[D]=n[P+D];return v}const T=a[y],E=a[y+1]||p;let R;if(l){R=new Array(E-T);for(let P=T;P<E;P++){const D=P*h+d;v=new Array(t);for(let M=0;M<t;M++)v[M]=n[D+M];R[P-T]=v}}else if(h===t)R=n.subarray(T*t+d,E*t+d);else{R=new n.constructor((E-T)*t);let P=0;for(let D=T;D<E;D++){const M=D*h+d;for(let L=0;L<t;L++)R[P++]=n[M+L]}}return R}}const dD=[],tu=[[0,1/0]];function pD(n,e){if(n===tu||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let a=0;a<i;a++){const l=n[a];l[1]<e[0]?(t.push(l),s=a+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(s,0,e),t}const gD={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function FT(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...gD[t],...e,...n,type:t}}class zT extends hD{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:tu}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!uD(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(a=>e[a])]:e[t];return FT(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=pD(this.state.updateRanges,[i,s])}else this.state.updateRanges=tu}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=dD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==tu),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:l,noAlloc:u}}=this;let h=!0;if(l){for(const[d,p]of a)l.call(s,this,{data:t,startRow:d,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of a){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Yt(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const u=!!l.size&&l.size!==this.size;return i.binaryAccessor=LT(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const a in t){const l=super._getBufferLayout(a,t[a]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:a,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:u,state:h,value:d,size:p,startIndices:_}=e,{accessor:y,transform:v}=u;let T=h.binaryAccessor||(typeof y=="function"?y:a[y]);typeof T!="function"&&(T=()=>T),Yt(typeof T=="function",`accessor "${y}" is not a function`);let E=e.getVertexOffset(i);const{iterable:R,objectInfo:P}=ju(t,i,s);for(const D of R){P.index++;let M=T(D,P);if(v&&(M=v.call(this,M)),_){const L=(P.index<_.length-1?_[P.index+1]:l)-_[P.index];if(M&&Array.isArray(M[0])){let H=E;for(const J of M)e._normalizeValue(J,d,H),H+=p}else M&&M.length>p?d.set(M,E):(e._normalizeValue(M,P.target,0),C4({target:d,source:P.target,start:E,count:L}));E+=L*p}else e._normalizeValue(M,d,E),E+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function jd(n){const{source:e,target:t,start:i=0,size:s,getData:a}=n,l=n.end||t.length,u=e.length,h=l-i;if(u>h){t.set(e.subarray(0,h),i);return}if(t.set(e,i),!a)return;let d=u;for(;d<h;){const p=a(d,e);for(let _=0;_<s;_++)t[i+d]=p[_]||0,d++}}function mD({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:a}){if(!s||!a)return jd({source:n,target:e,size:t,getData:i}),e;let l=0,u=0;const h=i&&((p,_)=>i(p+u,_)),d=Math.min(s.length,a.length);for(let p=1;p<d;p++){const _=s[p]*t,y=a[p]*t;jd({source:n.subarray(l,_),target:e,start:u,end:y,size:t,getData:h}),l=_,u=y}return u<e.length&&jd({source:[],target:e,start:u,size:t,getData:h}),e}function _D(n){const{device:e,settings:t,value:i}=n,s=new zT(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function VT(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function HT(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function jT(n){n.push(n.shift())}function yD(n,e){const{doublePrecision:t,settings:i,value:s,size:a}=n,l=t&&s instanceof Float64Array?2:1;let u=0;const{shaderAttributes:h}=n.settings;if(h)for(const d of Object.values(h))u=Math.max(u,d.vertexOffset??0);return(i.noAlloc?s.length:(e+u)*a)*l}function $T({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function WT({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:a,getData:l=u=>u}){const u=t.doublePrecision&&t.value instanceof Float64Array?2:1,h=t.size*u,d=t.byteOffset,p=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,_=t.startIndices,y=a&&_,v=t.isConstant;if(!y&&e&&i>=s)return e;const T=t.value instanceof Float64Array?Float32Array:t.value.constructor,E=v?t.value:new T(t.getBuffer().readSyncWebGL(d,s*T.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!v){const M=l;l=(L,H)=>t.normalizeConstant(M(L,H))}const R=v?(M,L)=>l(E,L):(M,L)=>l(E.subarray(M+d,M+d+h),L),P=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),D=new Float32Array(s);return mD({source:P,target:D,sourceStartIndices:a,targetStartIndices:_,size:h,getData:R}),(!e||e.byteLength<D.byteLength+p)&&(e?.destroy(),e=n.createBuffer({byteLength:D.byteLength+p,usage:35050})),e.write(D,p),e}class XT{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Hu(i),this.attribute=t,this.attributeInTransition=_D(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=yD(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class bD extends XT{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=SD(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:l}=this;jT(a),a[0]=WT({device:this.device,buffer:a[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),a[1]=$T({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:u}=this,h=u.model;let d=Math.floor(this.currentLength/l.size);YT(l)&&(d/=2),h.setVertexCount(d),l.isConstant?(h.setAttributes({aFrom:a[0]}),h.setConstantAttributes({aTo:l.value})):h.setAttributes({aFrom:a[0],aTo:l.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:a}=this.transform,l={time:s};a.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const vD=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Sv={name:"interpolation",vs:vD,uniformTypes:{time:"f32"}},xD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,TD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function YT(n){return n.doublePrecision&&n.value instanceof Float64Array}function SD(n,e){const t=e.size,i=VT(t),s=HT(t),a=e.getBufferLayout();return YT(e)?new Ta(n,{vs:TD,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[PP,Sv],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ta(n,{vs:xD,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:a.attributes[0].format}],modules:[Sv],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class wD extends XT{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=PD(e),this.framebuffer=OD(e,this.texture),this.transform=MD(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:a,attribute:l}=this;for(let h=0;h<2;h++)a[h]=WT({device:this.device,buffer:a[h],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});a[2]=$T({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?u.setConstantAttributes({aTo:l.value}):u.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,a=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:a.stiffness,damping:a.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),jT(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const AD=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,ED={name:"spring",vs:AD,uniformTypes:{damping:"f32",stiffness:"f32"}},RD=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,CD=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function MD(n,e){const t=VT(e.size),i=HT(e.size);return new Ta(n,{vs:RD,fs:CD,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[ED],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function PD(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function OD(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const ID={interpolation:bD,spring:wD};class ND{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const a=e[s],l=a.getTransitionSetting(t);l&&this._updateAttribute(s,a,l)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let a=!s||s.type!==i.type;if(a){s&&this._removeTransition(e);const l=ID[i.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(We.error(`unsupported transition type '${i.type}'`)(),a=!1)}(a||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const wv="attributeManager.invalidate",kD="attributeManager.updateStart",DD="attributeManager.updateEnd",BD="attribute.updateStart",UD="attribute.allocate",LD="attribute.updateEnd";class FD{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=ol(QI),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new ND(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);nn(wv,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);nn(wv,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:a={},buffers:l={},context:u={}}){let h=!1;nn(kD,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],_=p.settings.accessor;p.startIndices=i,p.numInstances=t,a[d]&&We.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&p.setConstantValue(a[_])||p.needsUpdate()&&(h=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:a,context:u})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}h&&nn(DD,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const a in t){const l=t[a];l.needsRedraw(e)&&!i.hasAttribute(a)&&(s[a]=l)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],a={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new zT(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,a=s[e];return a&&a.forEach(l=>{const u=i[l];u&&u.setNeedsUpdate(u.id,t)}),a}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(nn(BD,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&nn(UD,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,nn(LD,t,i))}}class zD extends Hu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:a}}=this,l=a(e/s);this._value=vu(t,i,l)}}const Av=1e-5;function Ev(n,e,t,i,s){const a=e-n,u=(t-e)*s,h=-a*i;return u+h+a+e}function VD(n,e,t,i,s){if(Array.isArray(t)){const a=[];for(let l=0;l<t.length;l++)a[l]=Ev(n[l],e[l],t[l],i,s);return a}return Ev(n,e,t,i,s)}function Rv(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class HD extends Hu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:a=e,_currValue:l=e}=this;let u=VD(a,l,t,i,s);const h=Rv(u,t),d=Rv(u,l);h<Av&&d<Av&&(u=t,this.end()),this._prevValue=l,this._currValue=u}}const jD={interpolation:zD,spring:HD};class $D{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:a}=this;if(a.has(e)){const h=a.get(e),{value:d=h.settings.fromValue}=h;t=d,this.remove(e)}if(s=FT(s),!s)return;const l=jD[s.type];if(!l){We.error(`unsupported transition type '${s.type}'`)();return}const u=new l(this.timeline);u.start({...s,fromValue:t,toValue:i}),a.set(e,u)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function WD(n){const e=n[Ns];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function XD(n,e){const t=qT({newProps:n,oldProps:e,propTypes:n[Ns],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=qD(n,e);let s=!1;return i||(s=KD(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:ZD(n,e),transitionsChanged:YD(n,e)}}function YD(n,e){if(!n.transitions)return!1;const t={},i=n[Ns];let s=!1;for(const a in n.transitions){const l=i[a],u=l&&l.type;(u==="number"||u==="color"||u==="array")&&Cp(n[a],e[a],l)&&(t[a]=!0,s=!0)}return s?t:!1}function qT({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const a of Object.keys(n))if(!(a in t)){if(!(a in e))return`${s}.${a} added`;const l=Cp(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}for(const a of Object.keys(e))if(!(a in t)){if(!(a in n))return`${s}.${a} dropped`;if(!Object.hasOwnProperty.call(n,a)){const l=Cp(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}}return!1}function Cp(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function qD(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function KD(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&Cv(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&Cv(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function ZD(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function Cv(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},qT({oldProps:s,newProps:i,triggerName:t})}const QD="count(): argument not an object",GD="count(): argument not a container";function JD(n){if(!t6(n))throw new Error(QD);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(e6(n))return Object.keys(n).length;throw new Error(GD)}function e6(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function t6(n){return n!==null&&typeof n=="object"}function Mv(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const n6={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Mp={};function i6(n,e,t,i){if(t instanceof ct)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const a=e.createTexture({...t,sampler:{...n6,...s,...i},mipmaps:!0});return Mp[a.id]=n,a}function s6(n,e){!e||!(e instanceof ct)||Mp[e.id]===n&&(e.delete(),delete Mp[e.id])}const r6={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Pp(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Jn(n,e,1)}},accessor:{validate(n,e){const t=Cu(n);return t==="function"||t===Cu(e.value)},equal(n,e,t){return typeof e=="function"?!0:Jn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Pp(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Jn(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Jn(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:i6(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{s6(t.id,n)}}};function a6(n){const e={},t={},i={};for(const[s,a]of Object.entries(n)){const l=a?.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const u=o6(s,a);e[s]=u,t[s]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function o6(n,e){switch(Cu(e)){case"object":return Mo(n,e);case"array":return Mo(n,{type:"array",value:e,compare:!1});case"boolean":return Mo(n,{type:"boolean",value:e});case"number":return Mo(n,{type:"number",value:e});case"function":return Mo(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Mo(n,e){return"type"in e?{name:n,...r6[e.type],...e}:"value"in e?{name:n,type:Cu(e.value),...e}:{name:n,type:"object",value:e}}function Pp(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Cu(n){return Pp(n)?"array":n===null?"null":typeof n}function l6(n,e){let t;for(let a=e.length-1;a>=0;a--){const l=e[a];"extensions"in l&&(t=l.extensions)}const i=Op(n.constructor,t),s=Object.create(i);s[Eu]=n,s[cr]={},s[Ms]={};for(let a=0;a<e.length;++a){const l=e[a];for(const u in l)s[u]=l[u]}return Object.freeze(s),s}const c6="_mergedDefaultProps";function Op(n,e){if(!(n instanceof $u.constructor))return{};let t=c6;if(e)for(const s of e){const a=s.constructor;a&&(t+=`:${a.extensionName||a.name}`)}const i=KT(n,t);return i||(n[t]=u6(n,e||[]))}function u6(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Op(i),a=KT(n,"defaultProps")||{},l=a6(a),u=Object.assign(Object.create(null),s,l.defaultProps),h=Object.assign(Object.create(null),s?.[Ns],l.propTypes),d=Object.assign(Object.create(null),s?.[Ld],l.deprecatedProps);for(const p of e){const _=Op(p.constructor);_&&(Object.assign(u,_),Object.assign(h,_[Ns]),Object.assign(d,_[Ld]))}return f6(u,n),d6(u,h),h6(u,d),u[Ns]=h,u[Ld]=d,e.length===0&&!Rg(n,"_propTypes")&&(n._propTypes=h),u}function f6(n,e){const t=g6(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function h6(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const a of e[t])Rg(this,a)||(this[a]=i);We.deprecated(s,e[t].join("/"))()}})}function d6(n,e){const t={},i={};for(const s in e){const a=e[s],{name:l,value:u}=a;a.async&&(t[l]=u,i[l]=p6(l))}n[ha]=t,n[cr]={},Object.defineProperties(n,i)}function p6(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||UT(e)?this[cr][n]=e:this[Ms][n]=e},get(){if(this[Ms]){if(n in this[Ms])return this[Ms][n]||this[ha][n];if(n in this[cr]){const e=this[Eu]&&this[Eu].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[ha][n]}}return this[ha][n]}}}function Rg(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function KT(n,e){return Rg(n,e)&&n[e]}function g6(n){const e=n.componentName;return e||We.warn(`${n.name}.componentName not specified`)(),e||n.name}let m6=0;class $u{constructor(...e){this.props=l6(this,e),this.id=this.props.id,this.count=m6++}clone(e){const{props:t}=this,i={};for(const s in t[ha])s in t[Ms]?i[s]=t[Ms][s]:s in t[cr]&&(i[s]=t[cr][s]);return new this.constructor({...t,...i,...e})}}$u.componentName="Component";$u.defaultProps={};const _6=Object.freeze({});class y6{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Eu]||this.component;const t=e[Ms]||{},i=e[cr]||e,s=e[ha]||{};for(const a in t){const l=t[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l),t[a]=this.getAsyncProp(a)}for(const a in i){const l=i[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(UT(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,s),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let a=[],l=0;for await(const u of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?a=h(u,a):a=a.concat(u),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:l,endRow:a.length}]}),l=a.length,this._setAsyncPropValue(e,a,s)}this._onResolve(e,a)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Ns];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class b6 extends y6{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i?.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const v6="layer.changeFlag",x6="layer.initialize",T6="layer.update",S6="layer.finalize",w6="layer.matched",Pv=2**24-1,A6=Object.freeze([]),E6=ol(({oldViewport:n,viewport:e})=>n.equals(e));let Zn=new Uint8ClampedArray(0);const R6={data:{type:"data",value:A6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:a})=>{const{resourceManager:l}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,a&&(s={...s,fetch:{...s?.fetch,signal:a}});let u=l.contains(n);return!u&&!s&&(l.add({resourceId:n,data:uu(n,i),persistent:!1}),u=!0),u?l.subscribe({resourceId:n,onChange:h=>t.internalState?.reloadAsyncProp(e,h),consumerId:t.id,requestId:e}):uu(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ke.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Wi extends $u{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ia.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Yt(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=hT(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,a,l]=lT(i,t.pixelProjectionMatrix);return e.length===2?[s,a]:[s,a,l]}unproject(e){return Yt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Yt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return i4(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ke.DEFAULT||e===Ke.LNGLAT||e===Ke.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Yt(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:JD(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=Mv(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Mv(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,a=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(a!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:u,instancePickingColors:h}=t.attributes,d=u||h;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!E6({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Zn.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>Pv&&We.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Zn=va.allocate(Zn,t,{size:4,copy:!0,maxCount:Math.max(t,Pv)});const s=Math.floor(Zn.length/4),a=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,a),Zn[l*4+0]=a[0],Zn[l*4+1]=a[1],Zn[l*4+2]=a[2],Zn[l*4+3]=0}e.value=Zn.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const s=e.userData?.excludeAttributes||{},a={},l={};for(const u in t){if(s[u])continue;const h=t[u].getValue();for(const d in h){const p=h[d];p instanceof ht?t[u].settings.isIndexed?e.setIndexBuffer(p):a[d]=p:p&&(l[d]=p)}}e.setAttributes(a),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,a=i||s,l=a&&t.attributes&&t.attributes[a.id];if(l&&l.value){const u=l.value,h=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=a.getVertexOffset(d);u[p]===h[0]&&u[p+1]===h[1]&&u[p+2]===h[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const a=s.getVertexOffset(e),l=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(l-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Zn.buffer&&(i.value=Zn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Yt(!this.internalState),Yt(Number.isFinite(this.props.coordinateSystem)),nn(x6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new b6({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(We.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new $D(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){nn(w6,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(nn(T6,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,a=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||a,this.props=l;try{const u=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const p of this.props.extensions)p.updateState.call(this,u,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==h[0];this._postUpdate(u,d)}finally{i.viewport=a,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){nn(S6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const a=this.props,l=this.context;this.props=this.internalState.propsInTransition||a;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:u}=this.props,h=u&&u(i)||[0,0];l.device instanceof ua&&l.device.setParametersWebGL({polygonOffset:h});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof ua)l.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=a}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let a=!1;switch(s){case"dataChanged":const l=e[s],u=t[s];l&&Array.isArray(u)&&(t.dataChanged=Array.isArray(l)?u.concat(l):l,a=!0);default:t[s]||(t[s]=e[s],a=!0)}a&&nn(v6,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=XD(e,t);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],e.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){WD(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new FD(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,a=this.state.model;a?.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:u,highlightColor:h}=i;if(t||s.autoHighlight!==l||s.highlightedObjectIndex!==u||s.highlightColor!==h){const d={};Array.isArray(h)&&(d.highlightColor=h),(t||s.autoHighlight!==l||u!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Wi.defaultProps=R6;Wi.layerName="Layer";const C6="compositeLayer.renderLayers";class Cg extends Wi{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:s,parameters:a,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:h,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:v,modelMatrix:T,extensions:E,fetch:R,operation:P,_subLayerProps:D}=this.props,M={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:a,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:h,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:v,modelMatrix:T,extensions:E,fetch:R,operation:P},L=D&&e.id&&D[e.id],H=L&&L.updateTriggers,J=e.id||"sublayer";if(L){const fe=this.props[Ns],de=e.type?e.type._propTypes:{};for(const le in L){const _e=de[le]||fe[le];_e&&_e.type==="accessor"&&(L[le]=this.getSubLayerAccessor(L[le]))}}Object.assign(M,e,L),M.id=`${this.props.id}-${J}`,M.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...H};for(const fe of E){const de=fe.getSubLayerProps.call(this,fe);de&&Object.assign(M,de,{updateTriggers:Object.assign(M.updateTriggers,de.updateTriggers)})}return M}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const a=this.renderLayers();i=vg(a,Boolean),this.internalState.subLayers=i}nn(C6,this,s,i);for(const a of i)a.parent=this}}Cg.layerName="CompositeLayer";class ZT{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=va,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:s,geometryBuffer:a,positionFormat:l,dataChanged:u,normalize:h=!0}=this.opts;if(this.data=t,this.getGeometry=s,this.positionSize=a&&a.size||(l==="XY"?2:3),this.buffers=i,this.normalize=h,a&&(Yt(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),h||(i.vertexPositions=a)),this.geometryBuffer=i.vertexPositions,Array.isArray(u))for(const d of u)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?LT(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:s,_attributeDefs:a,typedArrayManager:l}=this;for(const u in a)if(u in s)l.release(i[u]),i[u]=null;else{const h=a[u];h.copy=t,i[u]=l.allocate(i[u],e,h)}}_forEachGeometry(e,t,i){const{data:s,getGeometry:a}=this,{iterable:l,objectInfo:u}=ju(s,t,i);for(const h of l){u.index++;const d=a?a(h,u):null;e(d,u.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:s}=this;const{data:a,geometryBuffer:l}=this,{startRow:u=0,endRow:h=1/0}=e||{},d={};if(e||(t=[0],i=[0]),this.normalize||!l)this._forEachGeometry((_,y)=>{const v=_&&this.normalizeGeometry(_);d[y]=v,i[y+1]=i[y]+(v?this.getGeometrySize(v):0)},u,h),s=i[i.length-1];else if(i=a.startIndices,s=i[a.length]||0,ArrayBuffer.isView(l))s=s||l.length/this.positionSize;else if(l instanceof ht){const _=this.positionSize*4;s=s||l.byteLength/_}else if(l.buffer){const _=l.stride||this.positionSize*4;s=s||l.buffer.byteLength/_}else if(l.value){const _=l.value,y=l.stride/_.BYTES_PER_ELEMENT||this.positionSize;s=s||_.length/y}this._allocate(s,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=s;const p={};this._forEachGeometry((_,y)=>{const v=d[y]||_;p.vertexStart=i[y],p.indexStart=t[y];const T=y<i.length-1?i[y+1]:s;p.geometrySize=T-i[y],p.geometryIndex=y,this.updateGeometryAttributes(v,p)},u,h),this.vertexCount=t[t.length-1]}}const M6=typeof window<"u"?V.useLayoutEffect:V.useEffect;function Mu(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const P6={position:"absolute",zIndex:-1};function QT(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>QT(t,e));if(Wu(n)){if(O6(n))return e.style=P6,V.cloneElement(n,e);if(I6(n))return V.cloneElement(n,e)}return n}function Wu(n){return n&&typeof n=="object"&&"type"in n||!1}function O6(n){return n.props?.mapStyle}function I6(n){const e=n.type;return e&&e.deckGLViewProps}function Ip(n){if(typeof n=="function")return V.createElement(wa,{},n);if(Array.isArray(n))return n.map(Ip);if(Wu(n)){if(n.type===V.Fragment)return Ip(n.props.children);if(Mu(n.type,wa))return n}return n}function N6({children:n,layers:e=[],views:t=null}){const i=[],s=[],a={};return V.Children.forEach(Ip(n),l=>{if(Wu(l)){const u=l.type;if(Mu(u,Wi)){const h=k6(u,l.props);s.push(h)}else i.push(l);if(Mu(u,wa)&&u!==wa&&l.props.id){const h=new u(l.props);a[h.id]=h}}else l&&i.push(l)}),Object.keys(a).length>0&&(Array.isArray(t)?t.forEach(l=>{a[l.id]=l}):t&&(a[t.id]=t),t=Object.values(a)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function k6(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const D6=V.createContext();function B6({children:n,deck:e,ContextProvider:t=D6.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},a=i.views[0].id;for(const l of n){let u=a,h=l;Wu(l)&&Mu(l.type,wa)&&(u=l.props.id||a,h=l.props.children);const d=i.getViewport(u),p=i.getViewState(u);if(d){p.padding=d.padding;const{x:_,y,width:v,height:T}=d;h=QT(h,{x:_,y,width:v,height:T,viewport:d,viewState:p}),s[u]||(s[u]={viewport:d,children:[]}),s[u].children.push(h)}}return Object.keys(s).map(l=>{const{viewport:u,children:h}=s[l],{x:d,y:p,width:_,height:y}=u,v={position:"absolute",left:d,top:p,width:_,height:y},T=`view-${l}`,E=V.createElement("div",{key:T,id:T,style:v},...h),R={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:D=>{D.viewId=l,e._onViewStateChange(D)},widgets:[]},P=`view-${l}-context`;return V.createElement(t,{key:P,value:R},E)})}const U6={mixBlendMode:null};function L6({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const a in t)a in U6?s[a]=t[a]:i[a]=t[a];return{containerStyle:i,canvasStyle:s}}function F6(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function GT(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function z6(n,e,t){const i=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{n.redrawReason=s;const a=i.getViewports();n.lastRenderedViewports!==a?n.forceUpdate():GT(n)}});return i}function V6(n,e){const[t,i]=V.useState(0),a=V.useRef({control:null,version:t,forceUpdate:()=>i(H=>H+1)}).current,l=V.useRef(null),u=V.useRef(null),h=V.useMemo(()=>N6(n),[n.layers,n.views,n.children]);let d=!0;const p=H=>d&&n.viewState?(a.viewStateUpdateRequested=H,null):(a.viewStateUpdateRequested=null,n.onViewStateChange?.(H)),_=H=>{d?a.interactionStateUpdateRequested=H:(a.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(H))},y=V.useMemo(()=>{const H={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:u.current,layers:h.layers,views:h.views,onViewStateChange:p,onInteractionStateChange:_};return delete H._customRender,a.deck&&a.deck.setProps(H),H},[n]);V.useEffect(()=>{const H=n.Deck||Eg;return a.deck=z6(a,H,{...y,parent:l.current,canvas:u.current}),()=>a.deck?.finalize()},[]),M6(()=>{GT(a);const{viewStateUpdateRequested:H,interactionStateUpdateRequested:J}=a;H&&p(H),J&&_(J)}),V.useImperativeHandle(e,()=>F6(a),[]);const v=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:T,width:E="100%",height:R="100%",id:P,style:D}=n,{containerStyle:M,canvasStyle:L}=V.useMemo(()=>L6({width:E,height:R,style:D}),[E,R,D]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===v||a.version!==t){a.lastRenderedViewports=v,a.version=t;const H=B6({children:h.children,deck:a.deck,ContextProvider:T}),J=V.createElement("canvas",{key:"canvas",id:P||"deckgl-overlay",ref:u,style:L});a.control=V.createElement("div",{id:`${P||"deckgl"}-wrapper`,ref:l,style:M},[J,H])}return d=!1,a.control}const H6=V.forwardRef(V6),Ov=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,j6={name:"icon",vs:Ov,fs:Ov,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},$6=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,W6=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,X6=1024,Y6=4,Iv=()=>{},Nv={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},q6={x:0,y:0,width:0,height:0};function K6(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function Z6(n,e,t,i){const s=Math.min(t/e.width,i/e.height),a=Math.floor(e.width*s),l=Math.floor(e.height*s);return s===1?{image:e,width:a,height:l}:(n.canvas.height=l,n.canvas.width=a,n.clearRect(0,0,a,l),n.drawImage(e,0,0,e.width,e.height,0,0,a,l),{image:n.canvas,width:a,height:l})}function Go(n){return n&&(n.id||n.url)}function Q6(n,e,t,i){const{width:s,height:a,device:l}=n,u=l.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipmaps:!0}),h=l.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:n,destinationTexture:u,width:s,height:a}),h.finish(),n.destroy(),u}function kv(n,e,t){for(let i=0;i<e.length;i++){const{icon:s,xOffset:a}=e[i],l=Go(s);n[l]={...s,x:a,y:t}}}function G6({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:s=0,rowHeight:a=0,canvasWidth:l}){let u=[];for(let h=0;h<n.length;h++){const d=n[h],p=Go(d);if(!t[p]){const{height:_,width:y}=d;i+y+e>l&&(kv(t,u,s),i=0,s=a+s+e,a=0,u=[]),u.push({icon:d,xOffset:i}),i=i+y+e,a=Math.max(a,_)}}return u.length>0&&kv(t,u,s),{mapping:t,rowHeight:a,xOffset:i,yOffset:s,canvasWidth:l,canvasHeight:K6(a+s+e)}}function J6(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:s,objectInfo:a}=ju(n);for(const l of s){a.index++;const u=e(l,a),h=Go(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");!i[h]&&(!t[h]||u.url!==t[h].url)&&(i[h]={...u,source:l,sourceIndex:a.index})}return i}class eB{constructor(e,{onUpdate:t=Iv,onError:i=Iv}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Y6,this._canvasWidth=X6,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Go(e):e;return this._mapping[t]||q6}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:s,textureParameters:a}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),s&&(this._mapping=s),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),a&&(this._samplerParameters=a)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(J6(e,t,this._mapping)||{});if(i.length>0){const{mapping:s,xOffset:a,yOffset:l,rowHeight:u,canvasHeight:h}=G6({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=u,this._mapping=s,this._xOffset=a,this._yOffset=l,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||Nv,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Q6(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||Nv)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,uu(i.url,this._loadOptions).then(s=>{const a=Go(i),l=this._mapping[a],{x:u,y:h,width:d,height:p}=l,{image:_,width:y,height:v}=Z6(t,s,d,p);this._texture?.copyExternalImage({image:_,x:u+(d-y)/2,y:h+(p-v)/2,width:y,height:v}),l.width=y,l.height=v,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}}const JT=[0,0,0,255],tB={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:JT},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Xu extends Wi{getShaders(){return super.getShaders({vs:$6,fs:W6,modules:[ll,cl,j6]})}initializeState(){this.state={iconManager:new eB(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:JT},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,a=this.getAttributeManager(),{iconAtlas:l,iconMapping:u,data:h,getIcon:d,textureParameters:p}=t,{iconManager:_}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:t.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?u:null,textureParameters:p}),y?i.iconMapping!==t.iconMapping&&a.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&_.packIcons(h,d),s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),a.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:a,billboard:l,alphaCutoff:u}=this.props,{iconManager:h}=this.state,d=h.getTexture();if(d){const p=this.state.model,_={iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:Hi[a],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:s,billboard:l,alphaCutoff:u};p.shaderInputs.setProps({icon:_}),p.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new ti(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Sa({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):We.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:s=t/2,anchorY:a=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-s,i/2-a]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:s,height:a}=this.state.iconManager.getIconMapping(e);return[t,i,s,a]}}Xu.defaultProps=tB;Xu.layerName="IconLayer";const Dv=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,nB={name:"scatterplot",vs:Dv,fs:Dv,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},iB=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,sB=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,rB=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Bv=[0,0,0,255],aB={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Bv},getLineColor:{type:"accessor",value:Bv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Mg extends Wi{getShaders(){return super.getShaders({vs:iB,fs:sB,source:rB,modules:[ll,cl,nB]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,stroked:l,filled:u,billboard:h,antialiasing:d,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:v}=this.props,T={stroked:l,filled:u,billboard:h,antialiasing:d,radiusUnits:Hi[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,lineWidthUnits:Hi[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:v},E=this.state.model;E.shaderInputs.setProps({scatterplot:T}),E.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new ti(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Sa({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Mg.defaultProps=aB;Mg.layerName="ScatterplotLayer";const e1={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function t1(n,e,t={}){return oB(n,t)!==e?(cB(n,t),!0):!1}function oB(n,e={}){return Math.sign(lB(n,e))}const Uv={x:0,y:1,z:2};function lB(n,e={}){const{start:t=0,end:i=n.length,plane:s="xy"}=e,a=e.size||2;let l=0;const u=Uv[s[0]],h=Uv[s[1]];for(let d=t,p=i-a;d<i;d+=a)l+=(n[d+u]-n[p+u])*(n[d+h]+n[p+h]),p=d;return l/2}function cB(n,e){const{start:t=0,end:i=n.length,size:s=2}=e,a=(i-t)/s,l=Math.floor(a/2);for(let u=0;u<l;++u){const h=t+u*s,d=t+(a-1-u)*s;for(let p=0;p<s;++p){const _=n[h+p];n[h+p]=n[d+p],n[d+p]=_}}}function ei(n,e){const t=e.length,i=n.length;if(i>0){let s=!0;for(let a=0;a<t;a++)if(n[i-t+a]!==e[a]){s=!1;break}if(s)return!1}for(let s=0;s<t;s++)n[i+s]=e[s];return!0}function Np(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function Jo(n,e,t,i,s=[]){const a=i+e*t;for(let l=0;l<t;l++)s[l]=n[a+l];return s}function kp(n,e,t,i,s=[]){let a,l;if(t&8)a=(i[3]-n[1])/(e[1]-n[1]),l=3;else if(t&4)a=(i[1]-n[1])/(e[1]-n[1]),l=1;else if(t&2)a=(i[2]-n[0])/(e[0]-n[0]),l=2;else if(t&1)a=(i[0]-n[0])/(e[0]-n[0]),l=0;else return null;for(let u=0;u<n.length;u++)s[u]=(l&1)===u?i[l]:a*(e[u]-n[u])+n[u];return s}function nu(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function n1(n,e){const{size:t=2,broken:i=!1,gridResolution:s=10,gridOffset:a=[0,0],startIndex:l=0,endIndex:u=n.length}=e||{},h=(u-l)/t;let d=[];const p=[d],_=Jo(n,0,t,l);let y,v;const T=s1(_,s,a,[]),E=[];ei(d,_);for(let R=1;R<h;R++){for(y=Jo(n,R,t,l,y),v=nu(y,T);v;){kp(_,y,v,T,E);const P=nu(E,T);P&&(kp(_,E,P,T,E),v=P),ei(d,E),Np(_,E),fB(T,s,v),i&&d.length>t&&(d=[],p.push(d),ei(d,_)),v=nu(y,T)}ei(d,y),Np(_,y)}return i?p:p[0]}const Lv=0,uB=1;function i1(n,e=null,t){if(!n.length)return[];const{size:i=2,gridResolution:s=10,gridOffset:a=[0,0],edgeTypes:l=!1}=t||{},u=[],h=[{pos:n,types:l?new Array(n.length/i).fill(uB):null,holes:e||[]}],d=[[],[]];let p=[];for(;h.length;){const{pos:_,types:y,holes:v}=h.shift();hB(_,i,v[0]||_.length,d),p=s1(d[0],s,a,p);const T=nu(d[1],p);if(T){let E=Fv(_,y,i,0,v[0]||_.length,p,T);const R={pos:E[0].pos,types:E[0].types,holes:[]},P={pos:E[1].pos,types:E[1].types,holes:[]};h.push(R,P);for(let D=0;D<v.length;D++)E=Fv(_,y,i,v[D],v[D+1]||_.length,p,T),E[0]&&(R.holes.push(R.pos.length),R.pos=Vc(R.pos,E[0].pos),l&&(R.types=Vc(R.types,E[0].types))),E[1]&&(P.holes.push(P.pos.length),P.pos=Vc(P.pos,E[1].pos),l&&(P.types=Vc(P.types,E[1].types)))}else{const E={positions:_};l&&(E.edgeTypes=y),v.length&&(E.holeIndices=v),u.push(E)}}return u}function Fv(n,e,t,i,s,a,l){const u=(s-i)/t,h=[],d=[],p=[],_=[],y=[];let v,T,E;const R=Jo(n,u-1,t,i);let P=Math.sign(l&8?R[1]-a[3]:R[0]-a[2]),D=e&&e[u-1],M=0,L=0;for(let H=0;H<u;H++)v=Jo(n,H,t,i,v),T=Math.sign(l&8?v[1]-a[3]:v[0]-a[2]),E=e&&e[i/t+H],T&&P&&P!==T&&(kp(R,v,l,a,y),ei(h,y)&&p.push(D),ei(d,y)&&_.push(D)),T<=0?(ei(h,v)&&p.push(E),M-=T):p.length&&(p[p.length-1]=Lv),T>=0?(ei(d,v)&&_.push(E),L+=T):_.length&&(_[_.length-1]=Lv),Np(R,v),P=T,D=E;return[M?{pos:h,types:e&&p}:null,L?{pos:d,types:e&&_}:null]}function s1(n,e,t,i){const s=Math.floor((n[0]-t[0])/e)*e+t[0],a=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=s,i[1]=a,i[2]=s+e,i[3]=a+e,i}function fB(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function hB(n,e,t,i){let s=1/0,a=-1/0,l=1/0,u=-1/0;for(let h=0;h<t;h+=e){const d=n[h],p=n[h+1];s=d<s?d:s,a=d>a?d:a,l=p<l?p:l,u=p>u?p:u}return i[0][0]=s,i[0][1]=l,i[1][0]=a,i[1][1]=u,i}function Vc(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const dB=85.051129;function pB(n,e){const{size:t=2,startIndex:i=0,endIndex:s=n.length,normalize:a=!0}=e||{},l=n.slice(i,s);r1(l,t,0,s-i);const u=n1(l,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const h of u)a1(h,t);return u}function gB(n,e=null,t){const{size:i=2,normalize:s=!0,edgeTypes:a=!1}=t||{};e=e||[];const l=[],u=[];let h=0,d=0;for(let _=0;_<=e.length;_++){const y=e[_]||n.length,v=d,T=mB(n,i,h,y);for(let E=T;E<y;E++)l[d++]=n[E];for(let E=h;E<T;E++)l[d++]=n[E];r1(l,i,v,d),_B(l,i,v,d,t?.maxLatitude),h=y,u[_]=d}u.pop();const p=i1(l,u,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:a});if(s)for(const _ of p)a1(_.positions,i);return p}function mB(n,e,t,i){let s=-1,a=-1;for(let l=t+1;l<i;l+=e){const u=Math.abs(n[l]);u>s&&(s=u,a=l-1)}return a}function _B(n,e,t,i,s=dB){const a=n[t],l=n[i-e];if(Math.abs(a-l)>180){const u=Jo(n,0,e,t);u[0]+=Math.round((l-a)/360)*360,ei(n,u),u[1]=Math.sign(u[1])*s,ei(n,u),u[0]=a,ei(n,u)}}function r1(n,e,t,i){let s=n[0],a;for(let l=t;l<i;l+=e){a=n[l];const u=a-s;(u>180||u<-180)&&(a-=Math.round(u/360)*360),n[l]=s=a}}function a1(n,e){let t;const i=n.length/e;for(let a=0;a<i&&(t=n[a*e],(t+180)%360===0);a++);const s=-Math.round(t/360)*360;if(s!==0)for(let a=0;a<i;a++)n[a*e]+=s}function yB(n,e,t,i){let s;if(Array.isArray(n[0])){const a=n.length*e;s=new Array(a);for(let l=0;l<n.length;l++)for(let u=0;u<e;u++)s[l*e+u]=n[l][u]||0}else s=n;return t?n1(s,{size:e,gridResolution:t}):i?pB(s,{size:e}):s}const bB=1,vB=2,$d=4;class xB extends ZT{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?yB(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(zv(e)){let i=0;for(const s of e)i+=this.getGeometrySize(s);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&zv(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,s=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:l}=t;i.fill(0,a,a+l),s?(i[a]=$d,i[a+l-2]=$d):(i[a]+=bB,i[a+l-2]+=vB),i[a+l-1]=$d}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:s,geometrySize:a}=t,l=new Array(3);for(let u=s,h=0;h<a;u++,h++)this.getPointOnPath(e,h,l),i[u*3]=l[0],i[u*3+1]=l[1],i[u*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:s}=this;t*s>=e.length&&(t+=1-e.length/s);const a=t*s;return i[0]=e[a],i[1]=e[a+1],i[2]=s===3&&e[a+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function zv(n){return Array.isArray(n[0])}const Vv=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,TB={name:"path",vs:Vv,fs:Vv,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},SB=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wB=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,o1=[0,0,0,255],AB={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:o1},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Wd={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Pg extends Wi{getShaders(){return super.getShaders({vs:SB,fs:wB,modules:[ll,cl,TB]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Wd,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Wd,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Wd,defaultValue:o1},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:s,target:a})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,a)}}),this.setState({pathTesselator:new xB({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,u=t.data.attributes||{};l.updateGeometry({data:t.data,geometryBuffer:u.getPath,buffers:u,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||s.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(a=>a.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:s,miterLimit:a,widthUnits:l,widthScale:u,widthMinPixels:h,widthMaxPixels:d}=this.props,p=this.state.model,_={jointType:Number(t),capType:Number(i),billboard:s,widthUnits:Hi[l],widthScale:u,miterLimit:a,widthMinPixels:h,widthMaxPixels:d};p.shaderInputs.setProps({path:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ti(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Sa({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Pg.defaultProps=AB;Pg.layerName="PathLayer";var Hc={exports:{}},Hv;function EB(){if(Hv)return Hc.exports;Hv=1,Hc.exports=n,Hc.exports.default=n;function n(S,I,N){N=N||2;var G=I&&I.length,w=G?I[0]*N:S.length,k=e(S,0,w,N,!0),W=[];if(!k||k.next===k.prev)return W;var Q,ae,ue,me,Ue,Te,ze;if(G&&(k=h(S,I,k,N)),S.length>80*N){Q=ue=S[0],ae=me=S[1];for(var Qe=N;Qe<w;Qe+=N)Ue=S[Qe],Te=S[Qe+1],Ue<Q&&(Q=Ue),Te<ae&&(ae=Te),Ue>ue&&(ue=Ue),Te>me&&(me=Te);ze=Math.max(ue-Q,me-ae),ze=ze!==0?32767/ze:0}return i(k,W,N,Q,ae,ze,0),W}function e(S,I,N,G,w){var k,W;if(w===Fe(S,I,N,G)>0)for(k=I;k<N;k+=G)W=De(k,S[k],S[k+1],W);else for(k=N-G;k>=I;k-=G)W=De(k,S[k],S[k+1],W);return W&&L(W,W.next)&&(Ee(W),W=W.next),W}function t(S,I){if(!S)return S;I||(I=S);var N=S,G;do if(G=!1,!N.steiner&&(L(N,N.next)||M(N.prev,N,N.next)===0)){if(Ee(N),N=I=N.prev,N===N.next)break;G=!0}else N=N.next;while(G||N!==I);return I}function i(S,I,N,G,w,k,W){if(S){!W&&k&&v(S,G,w,k);for(var Q=S,ae,ue;S.prev!==S.next;){if(ae=S.prev,ue=S.next,k?a(S,G,w,k):s(S)){I.push(ae.i/N|0),I.push(S.i/N|0),I.push(ue.i/N|0),Ee(S),S=ue.next,Q=ue.next;continue}if(S=ue,S===Q){W?W===1?(S=l(t(S),I,N),i(S,I,N,G,w,k,2)):W===2&&u(S,I,N,G,w,k):i(t(S),I,N,G,w,k,1);break}}}}function s(S){var I=S.prev,N=S,G=S.next;if(M(I,N,G)>=0)return!1;for(var w=I.x,k=N.x,W=G.x,Q=I.y,ae=N.y,ue=G.y,me=w<k?w<W?w:W:k<W?k:W,Ue=Q<ae?Q<ue?Q:ue:ae<ue?ae:ue,Te=w>k?w>W?w:W:k>W?k:W,ze=Q>ae?Q>ue?Q:ue:ae>ue?ae:ue,Qe=G.next;Qe!==I;){if(Qe.x>=me&&Qe.x<=Te&&Qe.y>=Ue&&Qe.y<=ze&&P(w,Q,k,ae,W,ue,Qe.x,Qe.y)&&M(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.next}return!0}function a(S,I,N,G){var w=S.prev,k=S,W=S.next;if(M(w,k,W)>=0)return!1;for(var Q=w.x,ae=k.x,ue=W.x,me=w.y,Ue=k.y,Te=W.y,ze=Q<ae?Q<ue?Q:ue:ae<ue?ae:ue,Qe=me<Ue?me<Te?me:Te:Ue<Te?Ue:Te,Ut=Q>ae?Q>ue?Q:ue:ae>ue?ae:ue,sn=me>Ue?me>Te?me:Te:Ue>Te?Ue:Te,pn=E(ze,Qe,I,N,G),ii=E(Ut,sn,I,N,G),Xe=S.prevZ,Ye=S.nextZ;Xe&&Xe.z>=pn&&Ye&&Ye.z<=ii;){if(Xe.x>=ze&&Xe.x<=Ut&&Xe.y>=Qe&&Xe.y<=sn&&Xe!==w&&Xe!==W&&P(Q,me,ae,Ue,ue,Te,Xe.x,Xe.y)&&M(Xe.prev,Xe,Xe.next)>=0||(Xe=Xe.prevZ,Ye.x>=ze&&Ye.x<=Ut&&Ye.y>=Qe&&Ye.y<=sn&&Ye!==w&&Ye!==W&&P(Q,me,ae,Ue,ue,Te,Ye.x,Ye.y)&&M(Ye.prev,Ye,Ye.next)>=0))return!1;Ye=Ye.nextZ}for(;Xe&&Xe.z>=pn;){if(Xe.x>=ze&&Xe.x<=Ut&&Xe.y>=Qe&&Xe.y<=sn&&Xe!==w&&Xe!==W&&P(Q,me,ae,Ue,ue,Te,Xe.x,Xe.y)&&M(Xe.prev,Xe,Xe.next)>=0)return!1;Xe=Xe.prevZ}for(;Ye&&Ye.z<=ii;){if(Ye.x>=ze&&Ye.x<=Ut&&Ye.y>=Qe&&Ye.y<=sn&&Ye!==w&&Ye!==W&&P(Q,me,ae,Ue,ue,Te,Ye.x,Ye.y)&&M(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.nextZ}return!0}function l(S,I,N){var G=S;do{var w=G.prev,k=G.next.next;!L(w,k)&&H(w,G,G.next,k)&&le(w,k)&&le(k,w)&&(I.push(w.i/N|0),I.push(G.i/N|0),I.push(k.i/N|0),Ee(G),Ee(G.next),G=S=k),G=G.next}while(G!==S);return t(G)}function u(S,I,N,G,w,k){var W=S;do{for(var Q=W.next.next;Q!==W.prev;){if(W.i!==Q.i&&D(W,Q)){var ae=Se(W,Q);W=t(W,W.next),ae=t(ae,ae.next),i(W,I,N,G,w,k,0),i(ae,I,N,G,w,k,0);return}Q=Q.next}W=W.next}while(W!==S)}function h(S,I,N,G){var w=[],k,W,Q,ae,ue;for(k=0,W=I.length;k<W;k++)Q=I[k]*G,ae=k<W-1?I[k+1]*G:S.length,ue=e(S,Q,ae,G,!1),ue===ue.next&&(ue.steiner=!0),w.push(R(ue));for(w.sort(d),k=0;k<w.length;k++)N=p(w[k],N);return N}function d(S,I){return S.x-I.x}function p(S,I){var N=_(S,I);if(!N)return I;var G=Se(N,S);return t(G,G.next),t(N,N.next)}function _(S,I){var N=I,G=S.x,w=S.y,k=-1/0,W;do{if(w<=N.y&&w>=N.next.y&&N.next.y!==N.y){var Q=N.x+(w-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(Q<=G&&Q>k&&(k=Q,W=N.x<N.next.x?N:N.next,Q===G))return W}N=N.next}while(N!==I);if(!W)return null;var ae=W,ue=W.x,me=W.y,Ue=1/0,Te;N=W;do G>=N.x&&N.x>=ue&&G!==N.x&&P(w<me?G:k,w,ue,me,w<me?k:G,w,N.x,N.y)&&(Te=Math.abs(w-N.y)/(G-N.x),le(N,S)&&(Te<Ue||Te===Ue&&(N.x>W.x||N.x===W.x&&y(W,N)))&&(W=N,Ue=Te)),N=N.next;while(N!==ae);return W}function y(S,I){return M(S.prev,S,I.prev)<0&&M(I.next,S,S.next)<0}function v(S,I,N,G){var w=S;do w.z===0&&(w.z=E(w.x,w.y,I,N,G)),w.prevZ=w.prev,w.nextZ=w.next,w=w.next;while(w!==S);w.prevZ.nextZ=null,w.prevZ=null,T(w)}function T(S){var I,N,G,w,k,W,Q,ae,ue=1;do{for(N=S,S=null,k=null,W=0;N;){for(W++,G=N,Q=0,I=0;I<ue&&(Q++,G=G.nextZ,!!G);I++);for(ae=ue;Q>0||ae>0&&G;)Q!==0&&(ae===0||!G||N.z<=G.z)?(w=N,N=N.nextZ,Q--):(w=G,G=G.nextZ,ae--),k?k.nextZ=w:S=w,w.prevZ=k,k=w;N=G}k.nextZ=null,ue*=2}while(W>1);return S}function E(S,I,N,G,w){return S=(S-N)*w|0,I=(I-G)*w|0,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,I=(I|I<<8)&16711935,I=(I|I<<4)&252645135,I=(I|I<<2)&858993459,I=(I|I<<1)&1431655765,S|I<<1}function R(S){var I=S,N=S;do(I.x<N.x||I.x===N.x&&I.y<N.y)&&(N=I),I=I.next;while(I!==S);return N}function P(S,I,N,G,w,k,W,Q){return(w-W)*(I-Q)>=(S-W)*(k-Q)&&(S-W)*(G-Q)>=(N-W)*(I-Q)&&(N-W)*(k-Q)>=(w-W)*(G-Q)}function D(S,I){return S.next.i!==I.i&&S.prev.i!==I.i&&!de(S,I)&&(le(S,I)&&le(I,S)&&_e(S,I)&&(M(S.prev,S,I.prev)||M(S,I.prev,I))||L(S,I)&&M(S.prev,S,S.next)>0&&M(I.prev,I,I.next)>0)}function M(S,I,N){return(I.y-S.y)*(N.x-I.x)-(I.x-S.x)*(N.y-I.y)}function L(S,I){return S.x===I.x&&S.y===I.y}function H(S,I,N,G){var w=fe(M(S,I,N)),k=fe(M(S,I,G)),W=fe(M(N,G,S)),Q=fe(M(N,G,I));return!!(w!==k&&W!==Q||w===0&&J(S,N,I)||k===0&&J(S,G,I)||W===0&&J(N,S,G)||Q===0&&J(N,I,G))}function J(S,I,N){return I.x<=Math.max(S.x,N.x)&&I.x>=Math.min(S.x,N.x)&&I.y<=Math.max(S.y,N.y)&&I.y>=Math.min(S.y,N.y)}function fe(S){return S>0?1:S<0?-1:0}function de(S,I){var N=S;do{if(N.i!==S.i&&N.next.i!==S.i&&N.i!==I.i&&N.next.i!==I.i&&H(N,N.next,S,I))return!0;N=N.next}while(N!==S);return!1}function le(S,I){return M(S.prev,S,S.next)<0?M(S,I,S.next)>=0&&M(S,S.prev,I)>=0:M(S,I,S.prev)<0||M(S,S.next,I)<0}function _e(S,I){var N=S,G=!1,w=(S.x+I.x)/2,k=(S.y+I.y)/2;do N.y>k!=N.next.y>k&&N.next.y!==N.y&&w<(N.next.x-N.x)*(k-N.y)/(N.next.y-N.y)+N.x&&(G=!G),N=N.next;while(N!==S);return G}function Se(S,I){var N=new xe(S.i,S.x,S.y),G=new xe(I.i,I.x,I.y),w=S.next,k=I.prev;return S.next=I,I.prev=S,N.next=w,w.prev=N,G.next=N,N.prev=G,k.next=G,G.prev=k,G}function De(S,I,N,G){var w=new xe(S,I,N);return G?(w.next=G.next,w.prev=G,G.next.prev=w,G.next=w):(w.prev=w,w.next=w),w}function Ee(S){S.next.prev=S.prev,S.prev.next=S.next,S.prevZ&&(S.prevZ.nextZ=S.nextZ),S.nextZ&&(S.nextZ.prevZ=S.prevZ)}function xe(S,I,N){this.i=S,this.x=I,this.y=N,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(S,I,N,G){var w=I&&I.length,k=w?I[0]*N:S.length,W=Math.abs(Fe(S,0,k,N));if(w)for(var Q=0,ae=I.length;Q<ae;Q++){var ue=I[Q]*N,me=Q<ae-1?I[Q+1]*N:S.length;W-=Math.abs(Fe(S,ue,me,N))}var Ue=0;for(Q=0;Q<G.length;Q+=3){var Te=G[Q]*N,ze=G[Q+1]*N,Qe=G[Q+2]*N;Ue+=Math.abs((S[Te]-S[Qe])*(S[ze+1]-S[Te+1])-(S[Te]-S[ze])*(S[Qe+1]-S[Te+1]))}return W===0&&Ue===0?0:Math.abs((Ue-W)/W)};function Fe(S,I,N,G){for(var w=0,k=I,W=N-G;k<N;k+=G)w+=(S[W]-S[k])*(S[k+1]+S[W+1]),W=k;return w}return n.flatten=function(S){for(var I=S[0][0].length,N={vertices:[],holes:[],dimensions:I},G=0,w=0;w<S.length;w++){for(var k=0;k<S[w].length;k++)for(var W=0;W<I;W++)N.vertices.push(S[w][k][W]);w>0&&(G+=S[w-1].length,N.holes.push(G))}return N},Hc.exports}var RB=EB();const CB=hx(RB),jc=e1.CLOCKWISE,jv=e1.COUNTER_CLOCKWISE,Ps={};function MB(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function Uo(n){return"positions"in n?n.positions:n}function iu(n){return"holeIndices"in n?n.holeIndices:null}function PB(n){return Array.isArray(n[0])}function OB(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function IB(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function NB(n,e,t,i){for(let s=0;s<e;s++)if(n[t+s]!==n[i-e+s])return!1;return!0}function $v(n,e,t,i,s){let a=e;const l=t.length;for(let u=0;u<l;u++)for(let h=0;h<i;h++)n[a++]=t[u][h]||0;if(!IB(t))for(let u=0;u<i;u++)n[a++]=t[0][u]||0;return Ps.start=e,Ps.end=a,Ps.size=i,t1(n,s,Ps),a}function Wv(n,e,t,i,s=0,a,l){a=a||t.length;const u=a-s;if(u<=0)return e;let h=e;for(let d=0;d<u;d++)n[h++]=t[s+d];if(!NB(t,i,s,a))for(let d=0;d<i;d++)n[h++]=t[s+d];return Ps.start=e,Ps.end=h,Ps.size=i,t1(n,l,Ps),h}function kB(n,e){MB(n);const t=[],i=[];if("positions"in n){const{positions:s,holeIndices:a}=n;if(a){let l=0;for(let u=0;u<=a.length;u++)l=Wv(t,l,s,e,a[u-1],a[u],u===0?jc:jv),i.push(l);return i.pop(),{positions:t,holeIndices:i}}n=s}if(!PB(n))return Wv(t,0,n,e,0,t.length,jc),t;if(!OB(n)){let s=0;for(const[a,l]of n.entries())s=$v(t,s,l,e,a===0?jc:jv),i.push(s);return i.pop(),{positions:t,holeIndices:i}}return $v(t,0,n,e,jc),t}function Xd(n,e,t){const i=n.length/3;let s=0;for(let a=0;a<i;a++){const l=(a+1)%i;s+=n[a*3+e]*n[l*3+t],s-=n[l*3+e]*n[a*3+t]}return Math.abs(s/2)}function Xv(n,e,t,i){const s=n.length/3;for(let a=0;a<s;a++){const l=a*3,u=n[l+0],h=n[l+1],d=n[l+2];n[l+e]=u,n[l+t]=h,n[l+i]=d}}function DB(n,e,t,i){let s=iu(n);s&&(s=s.map(u=>u/e));let a=Uo(n);const l=i&&e===3;if(t){const u=a.length;a=a.slice();const h=[];for(let d=0;d<u;d+=e){h[0]=a[d],h[1]=a[d+1],l&&(h[2]=a[d+2]);const p=t(h);a[d]=p[0],a[d+1]=p[1],l&&(a[d+2]=p[2])}}if(l){const u=Xd(a,0,1),h=Xd(a,0,2),d=Xd(a,1,2);if(!u&&!h&&!d)return[];u>h&&u>d||(h>d?(t||(a=a.slice()),Xv(a,0,2,1)):(t||(a=a.slice()),Xv(a,2,0,1)))}return CB(a,s,e)}class BB extends ZT{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=kB(e,this.positionSize);return this.opts.resolution?i1(Uo(t),iu(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?gB(Uo(t),iu(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(Yv(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return Uo(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&Yv(e))for(const i of e){const s=this.getGeometrySize(i);t.geometrySize=s,this.updateGeometryAttributes(i,t),t.vertexStart+=s,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:s}){const{attributes:a,indexStarts:l,typedArrayManager:u}=this;let h=a.indices;if(!h||!e)return;let d=s;const p=DB(e,this.positionSize,this.opts.preproject,this.opts.full3d);h=u.allocate(h,s+p.length,{copy:!0});for(let _=0;_<p.length;_++)h[d++]=p[_]+i;l[t+1]=s+p.length,a.indices=h}_updatePositions(e,{vertexStart:t,geometrySize:i}){const{attributes:{positions:s},positionSize:a}=this;if(!s||!e)return;const l=Uo(e);for(let u=t,h=0;h<i;u++,h++){const d=l[h*a],p=l[h*a+1],_=a>2?l[h*a+2]:0;s[u*3]=d,s[u*3+1]=p,s[u*3+2]=_}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){const{positionSize:s}=this,a=this.attributes.vertexValid,l=e&&iu(e);if(e&&e.edgeTypes?a.set(e.edgeTypes,t):a.fill(1,t,t+i),l)for(let u=0;u<l.length;u++)a[t+l[u]/s-1]=0;a[t+i-1]=0}}function Yv(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const qv=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,UB={name:"solidPolygon",vs:qv,fs:qv,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},l1=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,LB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${l1}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,FB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${l1}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,zB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Pu=[0,0,0,255],VB={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Pu},getLineColor:{type:"accessor",value:Pu},material:!0},$c={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Og extends Wi{getShaders(e){return super.getShaders({vs:e==="top"?LB:FB,fs:zB,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ll,Y3,cl,UB]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&t===Ke.DEFAULT&&(t=Ke.LNGLAT);let s;t===Ke.LNGLAT&&(i?s=e.projectPosition.bind(e):s=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new BB({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const a=this.getAttributeManager(),l=!0;a.remove(["instancePickingColors"]),a.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:$c,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:$c,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:$c,accessor:"getFillColor",defaultValue:Pu},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:$c,accessor:"getLineColor",defaultValue:Pu},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(u,{index:h,target:d})=>this.encodePickingColor(u&&u.__source?u.__source.index:h,d)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,s=this.props.data;return s[0]&&s[0].__source&&(t.object=s.find(a=>a.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:i,wireframe:s,elevationScale:a}=this.props,{topModel:l,sideModel:u,wireframeModel:h,polygonTesselator:d}=this.state,p={extruded:!!t,elevationScale:a,isWireframe:!1};h&&s&&(h.setInstanceCount(d.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{...p,isWireframe:!0}}),h.draw(this.context.renderPass)),u&&i&&(u.setInstanceCount(d.instanceCount-1),u.shaderInputs.setProps({solidPolygon:p}),u.draw(this.context.renderPass)),l&&i&&(l.setVertexCount(d.vertexCount),l.shaderInputs.setProps({solidPolygon:p}),l.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:s}=e,a=this.getAttributeManager();(s.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(this.state.models?.forEach(u=>u.destroy()),this.setState(this._getModels()),a.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:a}=this.state,l=e.data.attributes||{};a.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let s,a,l;if(t){const u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1;const h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new ti(this.context.device,{...u,id:`${e}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const u=this.getAttributeManager().getBufferLayouts({isInstanced:!0});a=new ti(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:u,geometry:new Sa({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new ti(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:u,geometry:new Sa({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[a,l,s].filter(Boolean),topModel:s,sideModel:a,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Og.defaultProps=VB;Og.layerName="SolidPolygonLayer";function HB({data:n,getIndex:e,dataRange:t,replace:i}){const{startRow:s=0,endRow:a=1/0}=t,l=n.length;let u=l,h=l;for(let y=0;y<l;y++){const v=e(n[y]);if(u>y&&v>=s&&(u=y),v>=a){h=y;break}}let d=u;const _=h-u!==i.length?n.slice(h):void 0;for(let y=0;y<i.length;y++)n[d++]=i[y];if(_){for(let y=0;y<_.length;y++)n[d++]=_[y];n.length=d}return{startRow:u,endRow:u+i.length}}function jB(n,e){if(!n)return null;const t="startIndices"in n?n.startIndices[e]:e,i=n.featureIds.value[t];return t!==-1?$B(n,i,t):null}function $B(n,e,t){const i={properties:{...n.properties[e]}};for(const s in n.numericProps)i.properties[s]=n.numericProps[s].value[t];return i}function WB(n,e){const t={points:null,lines:null,polygons:null};for(const i in t){const s=n[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(s.length*4);const a=[];for(let l=0;l<s.length;l++)e(s[l],a),t[i][l*4+0]=a[0],t[i][l*4+1]=a[1],t[i][l*4+2]=a[2],t[i][l*4+3]=255}return t}const Kv=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,XB={name:"sdf",vs:Kv,fs:Kv,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},YB=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Yd=192/256,Zv=[],qB={getIconOffsets:{type:"accessor",value:n=>n.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Ig extends Xu{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,XB],fs:YB}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:s})=>this.encodePickingColor(i,s)}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;let{outlineColor:s}=t;s!==i.outlineColor&&(s=s.map(a=>a/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!t.sdf&&t.outlineWidth&&We.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:i,outlineWidth:s}=this.props,{outlineColor:a}=this.state,l=s?Math.max(i,Yd*(1-s)):-1,u=this.state.model,h={buffer:Yd,outlineBuffer:l,gamma:i,enabled:!!t,outlineColor:a};if(u.shaderInputs.setProps({sdf:h}),super.draw(e),t&&s){const{iconManager:d}=this.state;d.getTexture()&&(u.shaderInputs.setProps({sdf:{...h,outlineBuffer:Yd}}),u.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):Zv}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):Zv}}Ig.defaultProps=qB;Ig.layerName="MultiIconLayer";const Wo=1e20;class KB{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:u="normal",lang:h=null}={}){this.buffer=t,this.cutoff=s,this.radius=i,this.lang=h;const d=this.size=e+t*4,p=this._createCanvas(d),_=this.ctx=p.getContext("2d",{willReadFrequently:!0});_.font=`${u} ${l} ${e}px ${a}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(e),u=Math.ceil(i),h=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),p=Math.min(this.size-this.buffer,u+Math.ceil(s)),_=d+2*this.buffer,y=p+2*this.buffer,v=Math.max(_*y,0),T=new Uint8ClampedArray(v),E={data:T,width:_,height:y,glyphWidth:d,glyphHeight:p,glyphTop:u,glyphLeft:h,glyphAdvance:t};if(d===0||p===0)return E;const{ctx:R,buffer:P,gridInner:D,gridOuter:M}=this;this.lang&&(R.lang=this.lang),R.clearRect(P,P,d,p),R.fillText(e,P,P+u);const L=R.getImageData(P,P,d,p);M.fill(Wo,0,v),D.fill(0,0,v);for(let H=0;H<p;H++)for(let J=0;J<d;J++){const fe=L.data[4*(H*d+J)+3]/255;if(fe===0)continue;const de=(H+P)*_+J+P;if(fe===1)M[de]=0,D[de]=Wo;else{const le=.5-fe;M[de]=le>0?le*le:0,D[de]=le<0?le*le:0}}Qv(M,0,0,_,y,_,this.f,this.v,this.z),Qv(D,P,P,d,p,_,this.f,this.v,this.z);for(let H=0;H<v;H++){const J=Math.sqrt(M[H])-Math.sqrt(D[H]);T[H]=Math.round(255-255*(J/this.radius+this.cutoff))}return E}}function Qv(n,e,t,i,s,a,l,u,h){for(let d=e;d<e+i;d++)Gv(n,t*a+d,a,s,l,u,h);for(let d=t;d<t+s;d++)Gv(n,d*a+e,1,i,l,u,h)}function Gv(n,e,t,i,s,a,l){a[0]=0,l[0]=-Wo,l[1]=Wo,s[0]=n[e];for(let u=1,h=0,d=0;u<i;u++){s[u]=n[e+u*t];const p=u*u;do{const _=a[h];d=(s[u]-s[_]+p-_*_)/(u-_)/2}while(d<=l[h]&&--h>-1);h++,a[h]=u,l[h]=d,l[h+1]=Wo}for(let u=0,h=0;u<i;u++){for(;l[h+1]<u;)h++;const d=a[h],p=u-d;n[e+u*t]=s[d]+p*p}}const ZB=32,QB=[];function GB(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function JB({characterSet:n,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:s,mapping:a={},xOffset:l=0,yOffset:u=0}){let h=0,d=l;const p=t+i*2;for(const _ of n)if(!a[_]){const y=e(_);d+y+i*2>s&&(d=0,h++),a[_]={x:d+i,y:u+h*p+i,width:y,height:p,layoutWidth:y,layoutHeight:t},d+=y+i*2}return{mapping:a,xOffset:d,yOffset:u+h*p,canvasHeight:GB(u+(h+1)*p)}}function c1(n,e,t,i){let s=0;for(let a=e;a<t;a++){const l=n[a];s+=i[l]?.layoutWidth||0}return s}function u1(n,e,t,i,s,a){let l=e,u=0;for(let h=e;h<t;h++){const d=c1(n,h,h+1,s);u+d>i&&(l<h&&a.push(h),l=h,u=0),u+=d}return u}function eU(n,e,t,i,s,a){let l=e,u=e,h=e,d=0;for(let p=e;p<t;p++)if((n[p]===" "||n[p+1]===" "||p+1===t)&&(h=p+1),h>u){let _=c1(n,u,h,s);d+_>i&&(l<u&&(a.push(u),l=u,d=0),_>i&&(_=u1(n,u,h,i,s,a),l=a[a.length-1])),u=h,d+=_}return d}function tU(n,e,t,i,s=0,a){a===void 0&&(a=n.length);const l=[];return e==="break-all"?u1(n,s,a,t,i,l):eU(n,s,a,t,i,l),l}function nU(n,e,t,i,s,a){let l=0,u=0;for(let h=e;h<t;h++){const d=n[h],p=i[d];p?(u||(u=p.layoutHeight),s[h]=l+p.layoutWidth/2,l+=p.layoutWidth):(We.warn(`Missing character: ${d} (${d.codePointAt(0)})`)(),s[h]=l,l+=ZB)}a[0]=l,a[1]=u}function iU(n,e,t,i,s){const a=Array.from(n),l=a.length,u=new Array(l),h=new Array(l),d=new Array(l),p=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,_=[0,0],y=[0,0];let v=0,T=0,E=0;for(let R=0;R<=l;R++){const P=a[R];if((P===`
`||R===l)&&(E=R),E>T){const D=p?tU(a,t,i,s,T,E):QB;for(let M=0;M<=D.length;M++){const L=M===0?T:D[M-1],H=M<D.length?D[M]:E;nU(a,L,H,s,u,y);for(let J=L;J<H;J++){u[J]-y[0]/2;const fe=a[J],de=s[fe]?.layoutOffsetY||0;h[J]=v+y[1]/2+de,d[J]=y[0]}v=v+y[1]*e,_[0]=Math.max(_[0],y[0])}T=E}P===`
`&&(u[T]=0,h[T]=0,d[T]=0,T++)}return _[1]=v,{x:u,y:h,rowWidth:d,size:_}}function sU({value:n,length:e,stride:t,offset:i,startIndices:s,characterSet:a}){const l=n.BYTES_PER_ELEMENT,u=t?t/l:1,h=i?i/l:0,d=s[e]||Math.ceil((n.length-h)/u),p=a&&new Set,_=new Array(e);let y=n;if(u>1||h>0){const v=n.constructor;y=new v(d);for(let T=0;T<d;T++)y[T]=n[T*u+h]}for(let v=0;v<e;v++){const T=s[v],E=s[v+1]||d,R=y.subarray(T,E);_[v]=String.fromCodePoint.apply(null,R),p&&R.forEach(p.add,p)}if(p)for(const v of p)a.add(String.fromCodePoint(v));return{texts:_,characterCount:d}}class f1{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function rU(){const n=[];for(let e=32;e<128;e++)n.push(String.fromCharCode(e));return n}const da={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:rU(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Jv=1024,ex=.9,tx=1.2,h1=3;let Ou=new f1(h1);function aU(n,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const i=Ou.get(n);if(!i)return t;for(const s in i.mapping)t.has(s)&&t.delete(s);return t}function oU(n,e){for(let t=0;t<n.length;t++)e.data[4*t+3]=n[t]}function nx(n,e,t,i){n.font=`${i} ${t}px ${e}`,n.fillStyle="#000",n.textBaseline="alphabetic",n.textAlign="left"}function lU(n){We.assert(Number.isFinite(n)&&n>=h1,"Invalid cache limit"),Ou=new f1(n)}class cU{constructor(){this.props={...da}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*tx+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=aU(this._key,this.props.characterSet),i=Ou.get(this._key);if(i&&t.size===0){this._atlas!==i&&(this._atlas=i);return}const s=this._generateFontAtlas(t,i);this._atlas=s,Ou.set(this._key,s)}_generateFontAtlas(e,t){const{fontFamily:i,fontWeight:s,fontSize:a,buffer:l,sdf:u,radius:h,cutoff:d}=this.props;let p=t&&t.data;p||(p=document.createElement("canvas"),p.width=Jv);const _=p.getContext("2d",{willReadFrequently:!0});nx(_,i,a,s);const{mapping:y,canvasHeight:v,xOffset:T,yOffset:E}=JB({getFontWidth:R=>_.measureText(R).width,fontHeight:a*tx,buffer:l,characterSet:e,maxCanvasWidth:Jv,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(p.height!==v){const R=_.getImageData(0,0,p.width,p.height);p.height=v,_.putImageData(R,0,0)}if(nx(_,i,a,s),u){const R=new KB({fontSize:a,buffer:l,radius:h,cutoff:d,fontFamily:i,fontWeight:`${s}`});for(const P of e){const{data:D,width:M,height:L,glyphTop:H}=R.draw(P);y[P].width=M,y[P].layoutOffsetY=a*ex-H;const J=_.createImageData(M,L);oU(D,J),_.putImageData(J,y[P].x,y[P].y)}}else for(const R of e)_.fillText(R,y[R].x,y[R].y+l+a*ex);return{xOffset:T,yOffset:E,mapping:y,data:p,width:p.width,height:p.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:s,sdf:a,radius:l,cutoff:u}=this.props;return a?`${e} ${t} ${i} ${s} ${l} ${u}`:`${e} ${t} ${i} ${s}`}}const ix=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,uU={name:"textBackground",vs:ix,fs:ix,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},fU=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,hU=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:n=>n.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Ng extends Wi{getShaders(){return super.getShaders({vs:fU,fs:hU,modules:[ll,cl,uU]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:i,sizeUnits:s,sizeMinPixels:a,sizeMaxPixels:l,getLineWidth:u}=this.props;let{padding:h,borderRadius:d}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]),Array.isArray(d)||(d=[d,d,d,d]);const p=this.state.model,_={billboard:t,stroked:!!u,borderRadius:d,padding:h,sizeUnits:Hi[s],sizeScale:i,sizeMinPixels:a,sizeMaxPixels:l};p.shaderInputs.setProps({textBackground:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new ti(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Sa({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}Ng.defaultProps=dU;Ng.layerName="TextBackgroundLayer";const sx={start:1,middle:0,end:-1},rx={top:1,center:0,bottom:-1},qd=[0,0,0,255],pU=1,gU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:qd},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:da.characterSet},fontFamily:da.fontFamily,fontWeight:da.fontWeight,lineHeight:pU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:qd},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:n=>n.text},getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:qd},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class kg extends Cg{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,s]}=this.transformParagraph(e,t);const{fontSize:a}=this.state.fontAtlasManager.props;i/=a,s/=a;const{getTextAnchor:l,getAlignmentBaseline:u}=this.props,h=sx[typeof l=="function"?l(e,t):l],d=rx[typeof u=="function"?u(e,t):u];return[(h-1)*i/2,(d-1)*s/2,i,s]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:a,y:l,rowWidth:u,size:[h,d]}=this.transformParagraph(e,t),p=sx[typeof i=="function"?i(e,t):i],_=rx[typeof s=="function"?s(e,t):s],y=a.length,v=new Array(y*2);let T=0;for(let E=0;E<y;E++){const R=(1-p)*(h-u[E])/2;v[T++]=(p-1)*h/2+R+a[E],v[T++]=(_-1)*d/2+l[E]}return v}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new cU},this.props.maxWidth>0&&We.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:i,changeFlags:s}=e;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:s,characterSet:a}=this.state,l={...e,characterSet:a,fontFamily:t,fontWeight:i};if(!s.mapping)return s.setProps(l),!0;for(const u in l)if(l[u]!==s.props[u])return s.setProps(l),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,i=e.attributes?.getText;let{getText:s}=this.props,a=e.startIndices,l;const u=t==="auto"&&new Set;if(i&&a){const{texts:h,characterCount:d}=sU({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:a,characterSet:u});l=d,s=(p,{index:_})=>h[_]}else{const{iterable:h,objectInfo:d}=ju(e);a=[0],l=0;for(const p of h){d.index++;const _=Array.from(s(p,d)||"");u&&_.forEach(u.add,u),l+=_.length,a.push(l)}}this.setState({getText:s,startIndices:a,numInstances:l,characterSet:u||t})}transformParagraph(e,t){const{fontAtlasManager:i}=this.state,s=i.mapping,a=this.state.getText,{wordBreak:l,lineHeight:u,maxWidth:h}=this.props,d=a(e,t)||"";return iU(d,u,l,h*i.props.fontSize,s)}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:s,atlas:a,mapping:l},styleVersion:u}=this.state,{data:h,_dataDiff:d,getPosition:p,getColor:_,getSize:y,getAngle:v,getPixelOffset:T,getBackgroundColor:E,getBorderColor:R,getBorderWidth:P,backgroundBorderRadius:D,backgroundPadding:M,background:L,billboard:H,fontSettings:J,outlineWidth:fe,outlineColor:de,sizeScale:le,sizeUnits:_e,sizeMinPixels:Se,sizeMaxPixels:De,transitions:Ee,updateTriggers:xe}=this.props,Fe=this.getSubLayerClass("characters",Ig),S=this.getSubLayerClass("background",Ng);return[L&&new S({getFillColor:E,getLineColor:R,getLineWidth:P,borderRadius:D,padding:M,getPosition:p,getSize:y,getAngle:v,getPixelOffset:T,billboard:H,sizeScale:le,sizeUnits:_e,sizeMinPixels:Se,sizeMaxPixels:De,transitions:Ee&&{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getSize:Ee.getSize,getFillColor:Ee.getBackgroundColor,getLineColor:Ee.getBorderColor,getLineWidth:Ee.getBorderWidth,getPixelOffset:Ee.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:xe.getPosition,getAngle:xe.getAngle,getSize:xe.getSize,getFillColor:xe.getBackgroundColor,getLineColor:xe.getBorderColor,getLineWidth:xe.getBorderWidth,getPixelOffset:xe.getPixelOffset,getBoundingRect:{getText:xe.getText,getTextAnchor:xe.getTextAnchor,getAlignmentBaseline:xe.getAlignmentBaseline,styleVersion:u}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Fe({sdf:J.sdf,smoothing:Number.isFinite(J.smoothing)?J.smoothing:da.smoothing,outlineWidth:fe/(J.radius||da.radius),outlineColor:de,iconAtlas:a,iconMapping:l,getPosition:p,getColor:_,getSize:y,getAngle:v,getPixelOffset:T,billboard:H,sizeScale:le*s,sizeUnits:_e,sizeMinPixels:Se*s,sizeMaxPixels:De*s,transitions:Ee&&{getPosition:Ee.getPosition,getAngle:Ee.getAngle,getColor:Ee.getColor,getSize:Ee.getSize,getPixelOffset:Ee.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:xe.getText,getPosition:xe.getPosition,getAngle:xe.getAngle,getColor:xe.getColor,getSize:xe.getSize,getPixelOffset:xe.getPixelOffset,getIconOffsets:{getTextAnchor:xe.getTextAnchor,getAlignmentBaseline:xe.getAlignmentBaseline,styleVersion:u}}}),{data:h,_dataDiff:d,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){lU(e)}}kg.defaultProps=gU;kg.layerName="TextLayer";const su={circle:{type:Mg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Xu,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:kg,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},ru={type:Pg,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Dp={type:Og,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Po({type:n,props:e}){const t={};for(const i in e)t[i]=n.defaultProps[e[i]];return t}function Kd(n,e){const{transitions:t,updateTriggers:i}=n.props,s={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const a in e){const l=e[a];let u=n.props[a];a.startsWith("get")&&(u=n.getSubLayerAccessor(u),s.updateTriggers[l]=i[a],t&&(s.transitions[l]=t[a])),s[l]=u}return s}function mU(n){if(Array.isArray(n))return n;switch(We.assert(n.type,"GeoJSON does not have type"),n.type){case"Feature":return[n];case"FeatureCollection":return We.assert(Array.isArray(n.features),"GeoJSON does not have features array"),n.features;default:return[{geometry:n}]}}function ax(n,e,t={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:a=n.length}=t;for(let l=s;l<a;l++){const u=n[l],{geometry:h}=u;if(h)if(h.type==="GeometryCollection"){We.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");const{geometries:d}=h;for(let p=0;p<d.length;p++){const _=d[p];ox(_,i,e,u,l)}}else ox(h,i,e,u,l)}return i}function ox(n,e,t,i,s){const{type:a,coordinates:l}=n,{pointFeatures:u,lineFeatures:h,polygonFeatures:d,polygonOutlineFeatures:p}=e;if(!yU(a,l)){We.warn(`${a} coordinates are malformed`)();return}switch(a){case"Point":u.push(t({geometry:n},i,s));break;case"MultiPoint":l.forEach(_=>{u.push(t({geometry:{type:"Point",coordinates:_}},i,s))});break;case"LineString":h.push(t({geometry:n},i,s));break;case"MultiLineString":l.forEach(_=>{h.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"Polygon":d.push(t({geometry:n},i,s)),l.forEach(_=>{p.push(t({geometry:{type:"LineString",coordinates:_}},i,s))});break;case"MultiPolygon":l.forEach(_=>{d.push(t({geometry:{type:"Polygon",coordinates:_}},i,s)),_.forEach(y=>{p.push(t({geometry:{type:"LineString",coordinates:y}},i,s))})});break}}const _U={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function yU(n,e){let t=_U[n];for(We.assert(t,`Unknown GeoJSON type ${n}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function d1(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Wc(n){return n.geometry.coordinates}function bU(n,e){const t=d1(),{pointFeatures:i,lineFeatures:s,polygonFeatures:a,polygonOutlineFeatures:l}=n;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=Wc,t.lines.data=s,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=Wc,t.polygons.data=a,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=Wc,t.polygonsOutline.data=l,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=Wc,t}function vU(n,e){const t=d1(),{points:i,lines:s,polygons:a}=n,l=WB(n,e);return t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:l.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:l.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines._pathType="open",t.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:{...a.attributes,getPolygon:a.positions,pickingColors:{size:4,value:l.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},t.polygons._normalize=!1,a.triangles&&(t.polygons.data.attributes.indices=a.triangles.value),t.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:{...a.attributes,getPath:a.positions,instancePickingColors:{size:4,value:l.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},t.polygonsOutline._pathType="open",t}const xU=["points","linestrings","polygons"],TU={...Po(su.circle),...Po(su.icon),...Po(su.text),...Po(ru),...Po(Dp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:n=>n.properties.icon},getText:{type:"accessor",value:n=>n.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Xo extends Cg{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:i}=this.props,s=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:s}),s?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const i=vU(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){const i=mU(e.data),s=this.getSubLayerRow.bind(this);let a={};const l={};if(Array.isArray(t.dataChanged)){const h=this.state.features;for(const d in h)a[d]=h[d].slice(),l[d]=[];for(const d of t.dataChanged){const p=ax(i,s,d);for(const _ in h)l[_].push(HB({data:a[_],getIndex:y=>y.__source.index,dataRange:d,replace:p[_]}))}}else a=ax(i,s);const u=bU(a,l);this.setState({features:a,featuresDiff:l,layerProps:u})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i,sourceLayer:s}=t;return t.featureType=xU.find(a=>s.id.startsWith(`${this.id}-${a}-`)),i>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,i=e.featureType==="points";for(const s of this.getSubLayers())s.id.startsWith(t)===i&&s.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,s="polygons-fill",a=this.shouldRenderSubLayer(s,i.polygons?.data)&&this.getSubLayerClass(s,Dp.type);if(a){const l=Kd(this,Dp.props),u=e&&t;return u||delete l.getLineColor,l.updateTriggers.lineColors=u,new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,s="polygons-stroke",a="linestrings",l=!e&&t&&this.shouldRenderSubLayer(s,i.polygonsOutline?.data)&&this.getSubLayerClass(s,ru.type),u=this.shouldRenderSubLayer(a,i.lines?.data)&&this.getSubLayerClass(a,ru.type);if(l||u){const h=Kd(this,ru.props);return[l&&new l(h,this.getSubLayerProps({id:s,updateTriggers:h.updateTriggers}),i.polygonsOutline),u&&new u(h,this.getSubLayerProps({id:a,updateTriggers:h.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:i}=this.state;let{highlightedObjectIndex:s}=this.props;!i&&Number.isFinite(s)&&(s=t.points.data.findIndex(u=>u.__source.index===s));const a=new Set(e.split("+")),l=[];for(const u of a){const h=`points-${u}`,d=su[u],p=d&&this.shouldRenderSubLayer(h,t.points?.data)&&this.getSubLayerClass(h,d.type);if(p){const _=Kd(this,d.props);let y=t.points;if(u==="text"&&i){const{instancePickingColors:v,...T}=y.data.attributes;y={...y,data:{...y.data,attributes:T}}}l.push(new p(_,this.getSubLayerProps({id:h,updateTriggers:_.updateTriggers,highlightedObjectIndex:s}),y))}}return l}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),s=this._renderPointLayers();return[!e&&t,i,s,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,s)=>{const{data:a,index:l}=s,u=jB(a,l);return e(u,s)}}}Xo.layerName="GeoJsonLayer";Xo.defaultProps=TU;const p1=["#FFC4C4","#FFA0A0","#FF7070","#E03B2F","#B51400","#730900"],g1=["#B7C8FF","#8FAEFF","#5D90FF","#2D6BFF","#0047D6","#001E5C"];function SU(n,e,t){return Math.max(e,Math.min(t,n))}function wU(n,e=235){try{const t=n.replace("#",""),i=parseInt(t.length===3?t.split("").map(s=>s+s).join(""):t,16);return[i>>16&255,i>>8&255,i&255,e]}catch{return[100,116,139,e]}}function m1(n){const e=Math.abs(n);return e<1?0:e<5?1:e<10?2:e<20?3:e<30?4:5}function AU(n,e=235){if(!isFinite(n))return[100,116,139,e];const t=m1(Math.abs(n)),i=n>=0?p1[t]:g1[t];return wU(i,e)}function lx(n){return 1e3+Math.min(40,Math.abs(n))/40*18e3}function EU(n,e,t){const i=SU(e,.5,1.5),s=Math.max(0,n||0)*i;return 1e3+Math.min(1.2,t>0?s/t:0)*18e3}const cx="https://rustbelt-backend-977058061007.us-central1.run.app/api/rustbelt",RU="/electionanalytics/",Zd=n=>{const e=n.startsWith("/")?n.slice(1):n;return RU+e},Oo=["17","18","26","27","39","42","55"];function dn(n){return n==null?null:String(n).padStart(2,"0")}function Ln(n,e,t){return Math.max(e,Math.min(t,n))}const _1="#64748B";function CU(n,e=235){try{const t=n.replace("#",""),i=parseInt(t.length===3?t.split("").map(s=>s+s).join(""):t,16);return[i>>16&255,i>>8&255,i&255,e]}catch{return[100,116,139,e]}}function ux(n,e=235){return isFinite(n)?AU(n,e):CU(_1,e)}const fx=()=>{const[n,e]=V.useState({longitude:-86.5,latitude:41.8,zoom:4.3,pitch:45,bearing:-10}),t=V.useRef(null),i=V.useRef(null),s=V.useRef(null),a=V.useRef(null),[l,u]=V.useState(0),[h,d]=V.useState("Loading"),[p,_]=V.useState("RB"),[y,v]=V.useState(!0),[T,E]=V.useState(0),[R,P]=V.useState(0),[D,M]=V.useState(0),[L,H]=V.useState(!1),[J,fe]=V.useState(0),[de,le]=V.useState(!1),_e=V.useRef(null),[Se,De]=V.useState("hybrid"),[Ee,xe]=V.useState(60),[Fe,S]=V.useState(1),[I,N]=V.useState(!1),[G,w]=V.useState(235),[k,W]=V.useState(()=>{try{return localStorage.getItem("rb_quality_mode")||"balanced"}catch{return"balanced"}}),[Q,ae]=V.useState(!0),[ue,me]=V.useState(.4),Ue=V.useRef(null),Te=[2008,2012,2016,2020,2024],[ze,Qe]=V.useState(2024),Ut=V.useRef(new Map),sn=V.useRef(new Map),pn=V.useRef(new Map),ii=V.useRef({p95:1,max:1}),[Xe,Ye]=V.useState(""),[rn,Yu]=V.useState("elastic"),[Xi,Ma]=V.useState(!1),Yi=V.useRef(new Map),[fl,yi]=V.useState(""),[gn,pr]=V.useState([]),ln=V.useMemo(()=>gn.join(","),[gn]),st=V.useRef(new Map);async function Wn(ee){const we=new Map;try{const ye=Zd(`data/results/counties_${ee}.json`),pe=await fetch(ye).then(he=>he.ok?he.json():[]);if(Array.isArray(pe))for(const he of pe){const ce=String(he?.FIPS||he?.fips||"").slice(-5);if(!ce||ce.length!==5)continue;const be=Number(he?.total_votes||he?.total||0),Ce=Number(he?.votes_gop||he?.gop||0),Me=Number(he?.votes_dem||he?.dem||0);we.set(ce,{fips:ce,stateFips:String(ce.slice(0,2)),countyName:String(he?.county||he?.name||"County"),totalVotes2024:be,votesGop2024:Ce,votesDem2024:Me})}}catch{}return we}V.useEffect(()=>{let ee=!0;return(async()=>{try{const we=await fetch(Zd("gz_2010_us_040_00_500k.json")).then(ce=>ce.json());if(!ee)return;s.current=we;const ye=(we.features||[]).filter(ce=>Oo.includes(dn(ce?.properties?.STATE)||""));t.current={type:"FeatureCollection",features:ye};const pe=await fetch(Zd("gz_2010_us_050_00_500k.json")).then(ce=>ce.json());if(!ee)return;a.current=pe;const he=(pe.features||[]).filter(ce=>Oo.includes(dn(ce?.properties?.STATE||ce?.properties?.STATEFP||ce?.properties?.STATEFP10)||""));i.current={type:"FeatureCollection",features:he},d("Ready")}catch{d("Geo load failed")}})(),()=>{ee=!1}},[]),V.useEffect(()=>{try{if(!s.current||!a.current)return;if(p==="RB"){const ee=(s.current.features||[]).filter(ye=>Oo.includes(dn(ye?.properties?.STATE||ye?.properties?.STATEFP||ye?.properties?.STATEFP10)||""));t.current={type:"FeatureCollection",features:ee};const we=(a.current.features||[]).filter(ye=>Oo.includes(dn(ye?.properties?.STATE||ye?.properties?.STATEFP||ye?.properties?.STATEFP10)||""));i.current={type:"FeatureCollection",features:we},pr(ye=>ye.filter(pe=>Oo.includes(pe)))}else t.current=s.current,i.current=a.current;u(ee=>ee+1)}catch{}},[p]),V.useEffect(()=>{let ee=!1;return(async()=>{try{const we=`${cx}/timeline?years=${Te.join(",")}`,ye=await fetch(we);if(ye.ok){const pe=await ye.json(),he=new Map;for(const be of Te){const Ce=Array.isArray(pe?.[String(be)])?pe[String(be)]:[],Me=new Map;for(const Re of Ce){const ke=String(Re?.fips||"").slice(-5);ke&&Me.set(ke,{fips:ke,stateFips:String(Re?.stateFips||ke.slice(0,2)),countyName:Re?.countyName||"County",totalVotes2024:Number(Re?.totalVotes2024||Re?.total||0),votesGop2024:Number(Re?.votesGop2024||Re?.gop||0),votesDem2024:Number(Re?.votesDem2024||Re?.dem||0)})}if(Me.size===0&&(be===2008||be===2012)){const Re=await Wn(be);Re.size&&he.set(be,Re)}else Me.size&&he.set(be,Me)}sn.current=he,Ut.current=sn.current;const ce=sn.current.get(ze);ce&&(st.current=ce)}}catch{}finally{ee||u(we=>we+1)}})(),()=>{ee=!0}},[]),V.useEffect(()=>{let ee=!1;return(async()=>{if(p==="RB"){Ut.current=sn.current;const we=Ut.current.get(ze);we&&(st.current=we),u(ye=>ye+1)}else{if(pn.current.size===0)try{d("Loading All States baselines");const ye=`${cx}/timeline?years=${Te.join(",")}&states=ALL`,pe=await fetch(ye);if(pe.ok){const he=await pe.json(),ce=new Map;for(const be of Te){const Ce=Array.isArray(he?.[String(be)])?he[String(be)]:[],Me=new Map;for(const Re of Ce){const ke=String(Re?.fips||"").slice(-5);ke&&Me.set(ke,{fips:ke,stateFips:String(Re?.stateFips||ke.slice(0,2)),countyName:Re?.countyName||"County",totalVotes2024:Number(Re?.totalVotes2024||Re?.total||0),votesGop2024:Number(Re?.votesGop2024||Re?.gop||0),votesDem2024:Number(Re?.votesDem2024||Re?.dem||0)})}if(Me.size===0&&(be===2008||be===2012)){const Re=await Wn(be);Re.size&&ce.set(be,Re)}else Me.size&&ce.set(be,Me)}pn.current=ce,ee||d("Ready")}else ee||d("National baselines unavailable")}catch{ee||d("National baselines load failed")}Ut.current=pn.current.size?pn.current:sn.current;const we=Ut.current.get(ze);we&&(st.current=we),u(ye=>ye+1)}})(),()=>{ee=!0}},[p]),V.useEffect(()=>{const ee=Ut.current.get(ze);ee&&(st.current=ee,u(we=>we+1))},[ze]),V.useEffect(()=>{vi(!1)},[ze]),V.useEffect(()=>{const ee=[];if(st.current.forEach(we=>{const ye=Number(we?.totalVotes2024||0);isFinite(ye)&&ye>0&&ee.push(ye)}),ee.length){ee.sort((be,Ce)=>be-Ce);const we=ee[ee.length-1],ye=(ee.length-1)*.95,pe=Math.floor(ye),he=ye-pe,ce=ee[pe]+(ee[Math.min(pe+1,ee.length-1)]-ee[pe])*(he||0);ii.current={p95:Math.max(1,ce),max:Math.max(1,we)}}else ii.current={p95:1,max:1}},[l,ze]),V.useEffect(()=>{u(ee=>ee+1)},[T,R,D,L,J,Ee,Fe,G,ue]),V.useEffect(()=>{if(L){const ee=Ln(J/2,-30,30),we=Ln(-J/2,-30,30);P(parseFloat(ee.toFixed(2))),E(parseFloat(we.toFixed(2)))}},[L,J]),V.useEffect(()=>(de?(_e.current&&clearInterval(_e.current),_e.current=setInterval(()=>{E(ee=>Math.max(-30,Math.min(30,ee+(Math.random()>.5?1:-1)))),P(ee=>Math.max(-30,Math.min(30,ee+(Math.random()>.5?1:-1)))),M(ee=>Math.max(-30,Math.min(30,ee+(Math.random()>.5?1:-1))))},1200)):_e.current&&(clearInterval(_e.current),_e.current=null),()=>{_e.current&&(clearInterval(_e.current),_e.current=null)}),[de]),V.useEffect(()=>{try{localStorage.setItem("rb_quality_mode",k)}catch{}},[k]);function Tt(ee,we){if(!ee||ee.totalVotes2024<=0)return{swing:0,newMargin:0,baseMargin:0};const ye=ee.votesGop2024/Math.max(1,ee.totalVotes2024),pe=ee.votesDem2024/Math.max(1,ee.totalVotes2024),he=(ye-pe)*100;let ce=0,be=0;if(Xi&&we){const Ze=Yi.current.get(we);Ze&&(ce=Ze.dem,be=Ze.gop)}let Ce=pe+T/100+ce/100,Me=ye+R/100+be/100;Ce=Ln(Ce,0,1),Me=Ln(Me,0,1);const Re=Ce+Me;if(Re>1){const Ze=1/Re;Ce*=Ze,Me*=Ze}const ke=(Me-Ce)*100;return{swing:ke-he,newMargin:ke,baseMargin:he,baseShares:{g:ye,d:pe},newShares:{g:Me,d:Ce},local:{dem:ce,gop:be}}}const bi=T!==0||R!==0||Xi;function gr(ee){const we=Array.from(st.current.values()).filter(he=>he.stateFips===ee);if(!we.length)return 0;let ye=0,pe=0;for(const he of we){const{newMargin:ce,baseMargin:be}=Tt(he,he.fips),Ce=bi?ce:be,Me=Math.max(0,Number(he.totalVotes2024||0));ye+=Me,pe+=Ce/100*Me}return ye>0?pe/ye*100:0}function qu(ee){const we=Array.from(st.current.values()).filter(he=>he.stateFips===ee);if(!we.length)return 0;let ye=0,pe=0;for(const he of we){const ce=he.votesGop2024/Math.max(1,he.totalVotes2024),be=he.votesDem2024/Math.max(1,he.totalVotes2024),Ce=(ce-be)*100,Me=Math.max(0,Number(he.totalVotes2024||0));ye+=Me,pe+=Ce/100*Me}return ye>0?pe/ye*100:0}function mr(){const ee=Array.from(st.current.values());let we=0,ye=0;for(const pe of ee){const{baseMargin:he,newMargin:ce}=Tt(pe,pe.fips);Math.sign(he)!==Math.sign(ce)&&Math.abs(he-ce)>.1&&we++,ye++}return{flips:we,total:ye}}const qi=V.useMemo(()=>{if(!i.current||gn.length===0)return null;const ye={type:"FeatureCollection",features:(i.current.features||[]).filter(ce=>{const be=dn(ce?.properties?.STATE||ce?.properties?.STATEFP||ce?.properties?.STATEFP10||"");return!!be&&gn.includes(be)}).map(ce=>({...ce}))},pe=k==="performance",he=k==="quality";return new Xo({id:"rb-counties",data:ye,pickable:!0,stroked:!0,filled:!0,extruded:!0,wireframe:!1,parameters:{depthTest:!1},getFillColor:ce=>{const be=ce?.properties?.GEO_ID?.slice(-5)||ce?.properties?.FIPS||ce?.properties?.COUNTYFP||"",Ce=st.current.get(be);if(!Ce)return[100,116,139,180];const{newMargin:Me,baseMargin:Re}=Tt(Ce,be);return ux(bi?Me:Re,Ln(G,30,255))},getElevation:ce=>{const be=ce?.properties?.GEO_ID?.slice(-5)||ce?.properties?.FIPS||ce?.properties?.COUNTYFP||"",Ce=1e3,Me=st.current.get(be);if(!Me)return Ce;const{newMargin:Re,baseMargin:ke}=Tt(Me,be),Ze=lx(bi?Re:ke),Ht=Ln(1+D/100,.5,1.5),qt=ii.current,Kt=EU(Number(Me.totalVotes2024||0),Ht,qt.p95);let jt=0;if(Se==="margin")jt=Ze;else if(Se==="turnout")jt=Kt;else{const mn=Ln(Ee,0,100)/100;jt=mn*Ze+(1-mn)*Kt}return jt*Ln(Fe,.1,3)*1.75},getLineColor:ce=>{if(!I)return[255,255,255,200];const be=ce?.properties?.GEO_ID?.slice(-5)||ce?.properties?.FIPS||ce?.properties?.COUNTYFP||"",Ce=st.current.get(be);if(!Ce)return[255,255,255,180];const{swing:Me}=Tt(Ce);if(!bi)return[255,255,255,180];const Re=120+Math.round(Math.min(100,Math.abs(Me)*10));return Me>=0?[220,38,38,Re]:[37,99,235,Re]},lineWidthMinPixels:I?he?2:1.2:.8,transitions:{getFillColor:{duration:pe?0:he?800:600},getElevation:{duration:pe?0:he?1200:900,enter:()=>0}},updateTriggers:{getFillColor:[l,k,T,R,ze,G,ln],getElevation:[l,Se,k,D,T,R,ze,Ee,Fe,ln],getLineColor:[l,I,T,R,ze,ln]},onHover:({x:ce,y:be,object:Ce})=>{if(!Ce)return;const Me=Ce?.properties?.GEO_ID?.slice(-5)||Ce?.properties?.FIPS||Ce?.properties?.COUNTYFP||"",Re=st.current.get(Me),ke=Ce?.properties?.NAME||"County",{swing:St,baseMargin:Ze,newMargin:Ht,baseShares:qt,newShares:Kt,local:jt}=Tt(Re,Me),wt=Ce?.properties?.STATE||Ce?.properties?.STATEFP||Ce?.properties?.STATEFP10,mn=dn(wt||"")||"",Zt=mn?gr(mn):null,Zi=Ln(1+D/100,.5,1.5),Cn=document.getElementById("rb-tip");if(Cn)if(Cn.style.display="block",Cn.style.left=`${ce+10}px`,Cn.style.top=`${be+10}px`,Q){const Qi=qt?(qt.g*100).toFixed(1):"",Rt=qt?(qt.d*100).toFixed(1):"",pl=Kt?(Kt.g*100).toFixed(1):"",gl=Kt?(Kt.d*100).toFixed(1):"",xi=(jt?.dem??0).toFixed(2),Gi=(jt?.gop??0).toFixed(2);Cn.innerHTML=`<div style='font-weight:600'>${ke}</div>
              <div style='font-size:11px;color:#cbd5e1'>Baseline: GOP ${Qi}%, DEM ${Rt}%, margin ${Ze.toFixed(2)} pp</div>
              <div style='font-size:11px;color:#cbd5e1'>Sliders: Dem ${T.toFixed(2)} pp, GOP ${R.toFixed(2)} pp${Xi?`, Local : Dem ${xi} pp, GOP ${Gi} pp`:""}</div>
              <div style='font-size:11px;color:#cbd5e1'>Projected: GOP ${pl}%, DEM ${gl}%, margin ${bi?Ht.toFixed(2)+" pp":""}</div>
              <div style='font-size:11px;color:#cbd5e1'>Turnout factor: ${Zi.toFixed(2)} (shift ${D}%)</div>
              ${Zt!=null?`<div style='font-size:11px;color:#cbd5e1'>State projected margin: ${Zt.toFixed(2)} pp</div>`:""}`}else Cn.innerHTML=`<div style='font-weight:600'>${ke}</div>
              <div style='font-size:11px;color:#cbd5e1'>Baseline: ${Ze.toFixed(2)} pp</div>
              <div style='font-size:11px;color:#cbd5e1'>Projected: ${bi?Ht.toFixed(2)+" pp":""}</div>`},onClick:()=>{}})},[i.current,l,ln]),Xn=V.useMemo(()=>{if(!t.current)return null;const ye={type:"FeatureCollection",features:(t.current.features||[]).filter(pe=>{const he=dn(pe?.properties?.STATE||pe?.properties?.STATEFP||pe?.properties?.STATEFP10||"");return!(gn.length>0&&he&&gn.includes(he))})};return new Xo({id:"rb-states",data:ye,pickable:!0,stroked:!0,filled:!0,extruded:!0,parameters:{depthTest:!0},getLineColor:[255,255,255,255],getFillColor:pe=>{const he=dn(pe?.properties?.STATE||pe?.properties?.STATEFP||pe?.properties?.STATEFP10||"");if(!he)return[0,0,0,0];const ce=gr(he);return ux(ce,Ln(Math.min(G,220),30,255))},lineWidthMinPixels:k==="quality"?1.6:1,getElevation:pe=>{const he=dn(pe?.properties?.STATE||pe?.properties?.STATEFP||pe?.properties?.STATEFP10||"");if(!he)return 0;const ce=gr(he),be=lx(ce),Ce=Ln(Fe,.1,3),Me=Ln(ue,.1,5);return be*Ce*Me*.6},transitions:{getElevation:{duration:k==="performance"?0:k==="quality"?1e3:800,enter:()=>0},getFillColor:{duration:k==="performance"?0:k==="quality"?800:600}},onHover:({x:pe,y:he,object:ce})=>{const be=document.getElementById("rb-tip");if(!ce){be&&(be.style.display="none");return}const Ce=ce?.properties?.NAME||"State",Me=dn(ce?.properties?.STATE||ce?.properties?.STATEFP||ce?.properties?.STATEFP10||""),Re=Me?qu(Me):0,ke=Me?gr(Me):0;be&&(be.style.display="block",be.style.left=`${pe+10}px`,be.style.top=`${he+10}px`,be.innerHTML=Q?`<div style='font-weight:600'>${Ce}</div>
               <div style='font-size:11px;color:#cbd5e1'>Baseline margin: ${Re.toFixed(2)} pp (RD)</div>
               <div style='font-size:11px;color:#cbd5e1'>Projected margin: ${ke.toFixed(2)} pp</div>`:`<div style='font-weight:600'>${Ce}</div>
               <div style='font-size:11px;color:#cbd5e1'>Projected: ${ke.toFixed(2)} pp</div>`)},onClick:({object:pe})=>{const he=dn(pe?.properties?.STATE||pe?.properties?.STATEFP||pe?.properties?.STATEFP10||"");he&&pr(ce=>ce.includes(he)?ce.filter(be=>be!==he):[...ce,he])},updateTriggers:{getFillColor:[l,k,T,R,ze,ln,G,p],getElevation:[l,k,T,R,ze,ln,Fe,ue,p]}})},[t.current,k,l,T,R,ze,ln,ue,Fe,p]),Ki=V.useMemo(()=>{if(!t.current||gn.length===0)return null;const ye={type:"FeatureCollection",features:(t.current.features||[]).filter(pe=>{const he=dn(pe?.properties?.STATE||pe?.properties?.STATEFP||pe?.properties?.STATEFP10||"");return!!he&&gn.includes(he)})};return new Xo({id:"rb-selected-borders",data:ye,pickable:!0,stroked:!0,filled:!1,extruded:!1,getLineColor:[255,255,255,255],lineWidthMinPixels:k==="quality"?1.6:1,onClick:({object:pe})=>{const he=dn(pe?.properties?.STATE||pe?.properties?.STATEFP||pe?.properties?.STATEFP10||"");he&&pr(ce=>ce.filter(be=>be!==he))}})},[t.current,ln,k]),Ds=V.useMemo(()=>{const ee=[];return qi&&ee.push(qi),Xn&&ee.push(Xn),Ki&&ee.push(Ki),ee},[Xn,qi,Ki]);function hl(){const ee=Array.from(st.current.values());if(!ee.length)return 0;let we=0,ye=0;for(const pe of ee){const{newMargin:he,baseMargin:ce}=Tt(pe,void 0),be=T!==0||R!==0?he:ce,Ce=Math.max(0,Number(pe.totalVotes2024||0));we+=Ce,ye+=be/100*Ce}return we>0?ye/we*100:0}function dl(){try{const ee=parseFloat(String(Xe||"").trim());if(!isFinite(ee)){yi("Enter a numeric target margin in pp (e.g., 1.5)");return}const we=hl(),ye=ee-we;if(Math.abs(ye)<.05){vi(!1),yi(`Already within ${ye.toFixed(2)} pp of target; no solver applied.`);return}const pe=Array.from(st.current.values());if(!pe.length){yi("No baseline data loaded");return}const he=pe.reduce((Ze,Ht)=>Ze+Math.max(0,Number(Ht.totalVotes2024||0)),0);if(he<=0){yi("Zero total votes baseline");return}const ce=Ut.current,be=Array.from(ce.keys()).sort(),Ce=new Map;for(const Ze of pe){const Ht=Ze.fips;let qt=[];for(const jt of be){const wt=ce.get(jt)?.get(Ht);if(wt&&wt.totalVotes2024>0){const mn=wt.votesGop2024/Math.max(1,wt.totalVotes2024),Zt=wt.votesDem2024/Math.max(1,wt.totalVotes2024);qt.push((mn-Zt)*100)}}let Kt=1;if(qt.length>=2){let jt=0,wt=0;for(let Zt=1;Zt<qt.length;Zt++)jt+=Math.abs(qt[Zt]-qt[Zt-1]),wt++;const mn=wt?jt/wt:0;Kt=Math.max(.5,Math.min(3,.5+mn/5))}Ce.set(Ht,Kt)}let Me=0;const Re=new Map;for(const Ze of pe){const Ht=Math.max(0,Number(Ze.totalVotes2024||0))/he;Re.set(Ze.fips,Ht),Me+=Ht*(rn==="elastic"&&Ce.get(Ze.fips)||1)}Me<=0&&(Me=1);const ke=new Map;let St=0;for(const Ze of pe){const Ht=Re.get(Ze.fips)||0,qt=rn==="elastic"&&Ce.get(Ze.fips)||1,Kt=ye*qt/Me,jt=Kt/2,wt=-Kt/2;St=Math.max(St,Math.abs(Kt)),ke.set(Ze.fips,{dem:wt,gop:jt})}Yi.current=ke,Ma(!0),yi(`${rn==="elastic"?"Elastic":"Uniform"} distribution: applied county swings to move statewide margin by ${ye.toFixed(2)} pp (max county  ${St.toFixed(2)} pp).`),u(Ze=>Ze+1)}catch(ee){yi("Solver error: "+(ee?.message||String(ee)))}}function vi(ee=!0){Yi.current=new Map,Ma(!1),ee&&u(we=>we+1)}return ne.jsxs("div",{className:"w-screen h-screen fixed inset-0 bg-slate-950 text-slate-100",children:[ne.jsx("button",{onClick:()=>v(!y),className:"fixed top-3 left-3 z-50 p-2 rounded-md bg-slate-900/90 border border-slate-700 hover:border-slate-600 lg:hidden","aria-label":"Toggle menu",children:ne.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y?ne.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):ne.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),ne.jsx("button",{onClick:()=>v(!y),className:"hidden lg:block fixed top-3 left-3 z-50 px-3 py-1.5 rounded-md text-xs font-medium bg-slate-900/80 border border-slate-700 hover:border-slate-600",children:y?" Hide":" Show"}),ne.jsxs("div",{className:`fixed top-3 z-40 flex gap-3 items-center transition-all duration-300 ${y?"left-20 lg:left-24":"left-14 lg:left-20"}`,children:[ne.jsx("a",{href:"/",className:"px-3 py-1.5 rounded-md text-xs font-medium bg-slate-900/80 border border-slate-700 hover:border-slate-600 hidden lg:inline-block",children:" Home"}),ne.jsx("span",{className:"text-[11px] text-slate-300 bg-slate-900/80 px-2 py-1 rounded border border-slate-700",children:h})]}),ne.jsx("div",{className:`fixed top-0 left-0 h-full z-40 transition-transform duration-300 ${y?"translate-x-0":"-translate-x-full"} w-full sm:w-96 lg:w-[28rem] overflow-hidden`,children:ne.jsx("div",{className:"h-full overflow-y-auto bg-slate-900/95 border-r border-slate-700 backdrop-blur-sm",children:ne.jsxs("div",{className:"p-3 pt-16 lg:pt-14 flex flex-col gap-2",children:[ne.jsxs("div",{className:"flex items-center justify-between",children:[ne.jsx("div",{className:"text-[11px] text-slate-200 font-semibold",children:"Scenario"}),gn.length>0&&ne.jsx("button",{onClick:()=>pr([]),className:"px-2 py-1 text-[10px] rounded bg-slate-800/70 border border-slate-700",children:"Clear state selection"})]}),ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("label",{className:"text-[11px] text-slate-300",children:"Scope"}),ne.jsxs("select",{value:p,onChange:ee=>_(ee.target.value),className:"text-[11px] bg-slate-800 border border-slate-700 rounded px-2 py-1",children:[ne.jsx("option",{value:"RB",children:"Rust Belt"}),ne.jsx("option",{value:"ALL",children:"All States"})]}),p==="ALL"&&pn.current.size===0&&ne.jsx("span",{className:"text-[10px] text-amber-300",children:"Loading All States baselines"}),p==="ALL"&&pn.current.size===0&&h.toLowerCase().includes("unavailable")&&ne.jsx("span",{className:"text-[10px] text-rose-300",children:"Baselines unavailable; showing Rust Belt data"})]}),ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsxs("label",{className:"flex items-center gap-2 text-[11px] text-slate-300",children:[ne.jsx("input",{type:"checkbox",checked:Q,onChange:ee=>ae(ee.target.checked)})," Verbose tooltip"]}),ne.jsx("button",{onClick:()=>{try{if(!t.current||gn.length===0)return;const ee=new Set(gn),we=(t.current.features||[]).filter(he=>ee.has(dn(he?.properties?.STATE||he?.properties?.STATEFP||he?.properties?.STATEFP10||"")||""));if(!we.length)return;const ye=[],pe=[];for(const he of we){const ce=he.bbox;ce&&ce.length===4&&(ye.push(ce[0],ce[2]),pe.push(ce[1],ce[3]))}if(ye.length&&pe.length){const he=Math.min(...ye),ce=Math.max(...ye),be=Math.min(...pe),Ce=Math.max(...pe),Me=(he+ce)/2,Re=(be+Ce)/2;e(ke=>({...ke,longitude:Me,latitude:Re,zoom:Math.max(4.8,(ke.zoom||0)+.6),pitch:Math.max(35,ke.pitch||0)}))}}catch{}},className:"px-2 py-1 text-[10px] rounded bg-slate-800/70 border border-slate-700",children:"Fit to selection"})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"State height"}),ne.jsx("input",{type:"range",min:.1,max:5,step:.05,value:ue,onChange:ee=>me(parseFloat(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-12 text-right text-[11px] text-slate-300",children:[ue.toFixed(2),""]})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Base year"}),ne.jsx("select",{value:ze,onChange:ee=>Qe(parseInt(ee.target.value)),className:"text-[11px] bg-slate-800 border border-slate-700 rounded px-2 py-1",children:Te.map(ee=>ne.jsx("option",{value:ee,children:ee},ee))})]}),ne.jsxs("div",{className:"mt-1 p-2 rounded-md border border-slate-700 bg-slate-900/70",children:[ne.jsx("div",{className:"text-[11px] text-slate-200 font-semibold mb-1",children:"Targeted Outcome"}),ne.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-28",children:"Target margin (pp)"}),ne.jsx("input",{value:Xe,onChange:ee=>Ye(ee.target.value),placeholder:"e.g. 1.5 or -0.8",className:"text-[11px] bg-slate-800 border border-slate-700 rounded px-2 py-1 w-28"}),ne.jsxs("select",{value:rn,onChange:ee=>Yu(ee.target.value),className:"text-[11px] bg-slate-800 border border-slate-700 rounded px-2 py-1",children:[ne.jsx("option",{value:"elastic",children:"Elastic"}),ne.jsx("option",{value:"uniform",children:"Uniform"})]}),ne.jsx("button",{onClick:dl,className:"px-2 py-1 text-[11px] rounded bg-emerald-700 hover:bg-emerald-600 border border-emerald-600",children:"Solve"}),Xi&&ne.jsx("button",{onClick:()=>vi(!0),className:"px-2 py-1 text-[11px] rounded bg-slate-700 hover:bg-slate-600 border border-slate-600",children:"Clear"})]}),fl&&ne.jsx("div",{className:"text-[10px] text-slate-400",children:fl})]}),ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsxs("label",{className:"flex items-center gap-2 text-[11px] text-slate-300",children:[ne.jsx("input",{type:"checkbox",checked:L,onChange:ee=>H(ee.target.checked)})," Link swings"]}),L&&ne.jsxs(ne.Fragment,{children:[ne.jsx("label",{className:"text-[11px] text-slate-300",children:"Net swing"}),ne.jsx("input",{type:"range",min:-60,max:60,value:J,onChange:ee=>fe(parseInt(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-14 text-right text-[11px] text-slate-300",children:[J," pp"]})]})]}),!L&&ne.jsxs(ne.Fragment,{children:[ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Dem swing"}),ne.jsx("input",{type:"range",min:-30,max:30,value:T,onChange:ee=>E(parseInt(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-12 text-right text-[11px] text-slate-300",children:[T," pp"]})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"GOP swing"}),ne.jsx("input",{type:"range",min:-30,max:30,value:R,onChange:ee=>P(parseInt(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-12 text-right text-[11px] text-slate-300",children:[R," pp"]})]})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Turnout"}),ne.jsx("input",{type:"range",min:-30,max:30,value:D,onChange:ee=>M(parseInt(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-12 text-right text-[11px] text-slate-300",children:[D,"%"]})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Extrusion"}),ne.jsxs("select",{value:Se,onChange:ee=>De(ee.target.value),className:"text-[11px] bg-slate-800 border border-slate-700 rounded px-2 py-1",children:[ne.jsx("option",{value:"margin",children:"Margin"}),ne.jsx("option",{value:"turnout",children:"Turnout"}),ne.jsx("option",{value:"hybrid",children:"Hybrid"})]})]}),Se==="hybrid"&&ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Hybrid mix"}),ne.jsx("input",{type:"range",min:0,max:100,value:Ee,onChange:ee=>xe(parseInt(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-16 text-right text-[11px] text-slate-300",children:[Ee,"% margin"]})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Height scale"}),ne.jsx("input",{type:"range",min:.1,max:3,step:.1,value:Fe,onChange:ee=>S(parseFloat(ee.target.value)),className:"w-48"}),ne.jsxs("div",{className:"w-10 text-right text-[11px] text-slate-300",children:[Fe.toFixed(1),""]})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("label",{className:"text-[11px] text-slate-300 w-20",children:"Fill opacity"}),ne.jsx("input",{type:"range",min:64,max:255,step:1,value:G,onChange:ee=>w(parseInt(ee.target.value)),className:"w-48"}),ne.jsx("div",{className:"w-10 text-right text-[11px] text-slate-300",children:G})]}),ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsxs("label",{className:"flex items-center gap-2 text-[11px] text-slate-300",children:[ne.jsx("input",{type:"checkbox",checked:I,onChange:ee=>N(ee.target.checked)})," Diff halo"]}),ne.jsx("label",{className:"text-[11px] text-slate-300",children:"Quality"}),ne.jsxs("select",{value:k,onChange:ee=>W(ee.target.value),className:"text-[11px] bg-slate-800 border border-slate-700 rounded px-2 py-1",children:[ne.jsx("option",{value:"performance",children:"Performance"}),ne.jsx("option",{value:"balanced",children:"Balanced"}),ne.jsx("option",{value:"quality",children:"Quality"})]})]}),ne.jsxs("div",{className:"flex items-center gap-2 pt-1 flex-wrap",children:[ne.jsx("button",{onClick:()=>le(ee=>!ee),className:"px-3 py-1.5 rounded-md text-xs font-medium border "+(de?"bg-yellow-900/70 border-yellow-700":"bg-emerald-900/70 border-emerald-700"),children:de?"Pause":"Auto"}),ne.jsx("button",{onClick:()=>{vi(!0),H(!0),fe(-5)},className:"px-2 py-1.5 rounded-md text-xs font-medium bg-slate-800/70 border border-slate-700",children:"Preset: D+5"}),ne.jsx("button",{onClick:()=>{vi(!0),H(!0),fe(5)},className:"px-2 py-1.5 rounded-md text-xs font-medium bg-slate-800/70 border border-slate-700",children:"Preset: R+5"}),ne.jsx("button",{onClick:()=>{M(10)},className:"px-2 py-1.5 rounded-md text-xs font-medium bg-slate-800/70 border border-slate-700",children:"High turnout +10%"}),ne.jsx("button",{onClick:()=>{M(-10)},className:"px-2 py-1.5 rounded-md text-xs font-medium bg-slate-800/70 border border-slate-700",children:"Low turnout -10%"}),ne.jsx("button",{onClick:()=>{E(0),P(0),M(0),H(!1),fe(0),xe(60),S(1),w(235),vi(!0)},className:"px-3 py-1.5 rounded-md text-xs font-medium bg-slate-800/70 border border-slate-700",children:"Reset All"})]}),ne.jsx(PU,{computeCurrentStatewideMarginNoLocal:hl,solverActive:Xi,countFlips:mr}),ne.jsx("div",{className:"mt-3 p-3 rounded-md border border-slate-700 bg-slate-900/70",children:ne.jsx("div",{ref:Ue,className:"text-[11px] text-slate-200",dangerouslySetInnerHTML:{__html:MU(bi)}})})]})})}),ne.jsx("div",{id:"rb-tip",className:"absolute z-30 pointer-events-none rounded-md border border-slate-700 bg-slate-900/90 px-2 py-1.5 text-[11px] shadow",style:{display:"none",left:0,top:0}}),ne.jsx(H6,{layers:Ds,viewState:n,controller:!0,onViewStateChange:ee=>e(ee.viewState),getCursor:({isDragging:ee})=>ee?"grabbing":"default",style:{position:"absolute",inset:"0"}})]})};function MU(n=!1){const e=[-15,-10,-7,-4,-2,-1,0,1,2,4,7,10,15],t=i=>{const s=i===0?-1:m1(Math.abs(i));return`<div style='display:flex;flex-direction:column;align-items:center;font-size:10px;color:#94a3b8;'>
      <div style='width:22px;height:12px;background:${i===0?_1:i>0?p1[s]:g1[s]};border:1px solid #1e293b;border-radius:3px;'></div>
      <div>${i>0?"+"+i:i}</div>
    </div>`};return`<div style='display:flex;flex-direction:column;gap:6px;'>
    <div style='font-weight:600;font-size:12px;'>${n?"Margin with swing (RD, pp)":"Baseline margin (RD, pp)"}</div>
    <div style='display:flex;gap:6px;flex-wrap:wrap;max-width:340px;'>${e.map(i=>t(i)).join("")}</div>
  </div>`}const PU=({computeCurrentStatewideMarginNoLocal:n,solverActive:e,countFlips:t})=>{const i=n(),s=t?t():null;return ne.jsxs("div",{className:"mt-2 p-2 rounded-md border border-slate-700 bg-slate-900/70",children:[ne.jsx("div",{className:"text-[11px] text-slate-200 font-semibold mb-1",children:"Statewide margin"}),ne.jsxs("div",{className:"text-[11px] text-slate-300",children:["Projected (incl. sliders",e?", solver":"","): ",ne.jsxs("span",{className:i>=0?"text-red-400":"text-blue-400",children:[i.toFixed(2)," pp"]})]}),s&&ne.jsxs("div",{className:"text-[10px] text-slate-400",children:["County flips: ",s.flips," / ",s.total]}),ne.jsx("div",{className:"text-[10px] text-slate-500",children:"Tip: Baseline is visible when swings are zero and solver is cleared."})]})};function OU(){return ne.jsx(Zw,{basename:"/electionanalytics",children:ne.jsxs(Rw,{children:[ne.jsx(Gd,{path:"/",element:ne.jsx(fx,{})}),ne.jsx(Gd,{path:"/rustbelt-swing-3d",element:ne.jsx(fx,{})})]})})}BS.createRoot(document.getElementById("root")).render(ne.jsx(OU,{}));
